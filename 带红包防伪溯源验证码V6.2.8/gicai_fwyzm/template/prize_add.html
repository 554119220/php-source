{template 'common/header'}
<div class="main">

	<ul class="nav nav-tabs" role="tablist">
        <li role="presentation"><a href="{php echo $this->createWebUrl('mlist');}&version_id=0" aria-controls="home" role="tab">返回列表</a></li>
		<li role="presentation"><a href="{php echo $this->createWebUrl('mprize',array('mo'=>'list','fid'=>$_GPC['fid']));}&version_id=0" aria-controls="home" role="tab">产品列表</a></li>
		<li role="presentation" class="active"><a href="#" aria-controls="home" role="tab">添加产品</a></li>
    </ul>
	<style>
	.right-content{padding-top:0px !important;}
    .we7-form .form-group, form .form-group{margin-bottom:10px !important;}
	.right-content .nav.nav-tabs{margin-bottom:20px !important;}
	.multi-img-details .multi-item{height:auto !important;}
	.nav-tabs{margin-bottom:20px;}
    </style>
    <div class="category">
		<form action="" method="post" class="form-horizontal form" id="setting-form" onsubmit="return validForm();">
		<div class="panel panel-default">
			<div class="panel-heading">添加产品</div>
			<div class="panel-body">
				 
            	<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">产品名称</label>
					<div class="col-sm-8">
						<input type="text" name="data[title]" id="title" class="form-control" value="" placeholder="产品名称" />
					</div>
				</div>
                <div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">产品描述</label>
					<div class="col-sm-8"> 
						<textarea style="height:80px;" class="form-control" cols="70" name="data[description]" autocomplete="off">产品描述</textarea>
					</div>
				</div>
                 
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">产品图片</label>
					<div class="col-sm-8">
						{php echo tpl_form_field_multi_image('data[picimg]',$account['picimg']);}
                     	 
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">日期</label>
					<div class="col-sm-8">
						{php echo tpl_form_field_daterange('data[infotime]',$account['infotime'], true);}
					</div>
				</div>
				 
				<style>
				.gicai_fwyzm_list{ height:auto;}
				.gicai_fwyzm_list ul{padding:0px;margin:0px 0px 0px 15px;clear:both;overflow:hidden;}
				.gicai_fwyzm_list ul li{  float:left;height:auto; line-height:35px; text-decoration:none; list-style-type:none; text-align:center;margin-right:5px;margin-bottom:5px;}
				.gicai_fwyzm_list .img-thumbnail{ display:none;}
				.prsw input{ display:none !important;}
				</style>
				<script type="text/javascript">
				$(document).ready(function(){
					 
				});
				var cssl	= '{$cssl}';
				function addparameter(){
					 
					if(cssl==''){cssl=0;}
					var sss	= cssl++;
				 
					var parameter = '<ul id="parameter_id_'+sss+'" class="parameterclass"><li style="width:240px;"><input type="text" name="data[parameter]['+sss+'][name]" class="form-control" style="width:100%;" value="" /></li><li style="width:300px;"><input type="text" name="data[parameter]['+sss+'][valer]" class="form-control" style="width:100%;" value="" /></li><li style="width:80px; cursor:pointer;" class=" btn-primary" onClick="delparameter('+sss+');">删除</li></ul>';
				 
					$("#parameter_div_dom").append(parameter);
					 
				}
				var djsl	= '{$count}';
				function addfield(){
					 
					if(djsl==''){djsl=0;}
					var s	= djsl++;
					var field = '<ul id="field_id_'+s+'" class="fieldclass"><li style="width:120px;"><select class="form-control" name="data[field]['+s+'][fieldlx]" id="fieldlx"><option value="0">管理员</option><option value="1">溯源员</option></select></li><li style="width:120px;"><input type="text" name="data[field]['+s+'][fieldzdm]"	id="fieldzdm" class="form-control" style="width:100%;" value=""  placeholder="职务/职称" /></li><li style="width:120px;"><input type="text" name="data[field]['+s+'][fieldname]"	id="fieldname" class="form-control" style="width:100%;" value="" /></li><li style="width:120px;"><input type="text" name="data[field]['+s+'][fieldatt]"	id="tjzu_'+s+'" class="form-control" style="width:100%;" onclick="tjzfun('+s+',`u`);" value=""/></li><li style="width:80px; cursor:pointer;" class=" btn-primary" onClick="delfield('+s+');">删除</li></ul>';
					$("#field_div_dom").append(field);
					 
				}
				var sysl	= '{$countt}';
				function adddata(){
					 
					if(sysl==''){djsl=0;}
					var ss	= sysl++;
					var data = '<ul id="data_id_'+ss+'" class="dataclass"><li style="width:180px;"><input type="text" name="data[data]['+ss+'][time]" class="form-control" style="width:100%;" value="" /></li><li style="width:170px;"><input type="text" name="data[data]['+ss+'][title]" class="form-control" style="width:100%;" value="" /></li><li style="width:120px;"><input type="text" name="data[data]['+ss+'][name]"	class="form-control" style="width:100%;" id="tjz_'+ss+'" onclick="tjzfun('+ss+',`f`);" value=""/></li><li style="width:140px;position:relative;"><div class="input-group "><input type="text" name="data[data]['+ss+'][images]" value="" class="form-control" autocomplete="off"><span class="input-group-btn"><button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button></span></div><div class="input-group" style="position:absolute;background:#FFF;  top:0px; z-index:9;width:58px;height:32px;line-height:32px;overflow:hidden;"><img src="./resource/images/nopic.jpg" onerror="this.src=`./resource/images/nopic.jpg`; this.title=`图片未找到.`" style="height:100%" /></div></li><li style="width:80px; cursor:pointer;" class=" btn-primary" onClick="deldata('+ss+');">删除</li></ul>';
					$("#data_div_dom").append(data);
					 
				}
				function delfield(s){
					var sl	= $(".fieldclass").length;
					$("#field_id_"+s).remove();
					
				}
				function deldata(s){
					var sl	= $(".dataclass").length;
					$("#data_id_"+s).remove();
					
				}
				
				function delparameter(s){
					var sl	= $(".parameterclass").length;
					$("#parameter_id_"+s).remove();
					
				}
				
			 
				 
				</script>
				
				<div class="form-group" >
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">参数设置</label>
					<div class="col-sm-8" style="padding:0px;margin:0px;">
						<div class="gicai_fwyzm_list" style="padding:0px;margin:0px; ">
                        	<ul>
								<li style="width:240px;text-align:left;">参数名称</li>
								<li style="width:300px;text-align:left;">参数值</li>
								 
								<li style="width:80px; cursor:pointer;" class=" btn-primary" onclick="addparameter();">添加参数</li>
							</ul>
                            <div id="parameter_div_dom">
							 
							</div>
                       	</div>
                        <div style="padding-left:20px; color:red;">留空则不显示！</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">是否开启溯源</label>
					<div class="col-sm-8">
						<label class="radio-inline">
                            <input type="radio" name="data[infodj]"  onclick="$('.infodjdiv').hide();"  {if $account['infodj'] == 0} checked="checked" {/if} value="0" /> 无需溯源
                        </label> 
						<label class="radio-inline">
                            <input type="radio" name="data[infodj]"  onclick="$('.infodjdiv').show();" value="1" /> 设置溯源
                        </label>
                         
					</div>
				</div>
				 
                <div class="form-group infodjdiv" style="display:none;">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">添加角色</label>
					<div class="col-sm-8" style="padding:0px;margin:0px; ">
						<div class="gicai_fwyzm_list" style="padding:0px;margin:0px; ">
                        	<ul>
								<li style="width:120px;text-align:left;">权限设置</li>
								<li style="width:120px;text-align:left;">职务/职称</li>
								<li style="width:120px;text-align:left;">微信名称</li>
								<li style="width:120px;text-align:left;">OPENID</li>
								<li style="width:80px; cursor:pointer;" class=" btn-primary" onclick="addfield();">添加角色</li>
							</ul>
                            <div id="field_div_dom">
							 
                             
                        	</div>
                             
                            
                             
                        </div>
                        <div style="padding-left:20px; color:red;">设置后尽量不删除，如果删除后出现混乱请重新添加</div>
					</div>
				</div>
				<div class="form-group infodjdiv" style="display:none;">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">溯源状态</label>
					<div class="col-sm-8">
						<label class="radio-inline">
                            <input type="radio" name="data[sydis]" checked="checked"	value="1" /> 前台显示
                        </label> 
						<label class="radio-inline">
                            <input type="radio" name="data[sydis]" value="0" /> 前台隐藏
                        </label>
                       	<div style="padding-left:5px;">对管理员无效！</div>
					</div>
				</div>
				
				<script type="text/javascript">
					function showImageDialog(elm, opts, options) {
						require(["util"], function(util){
							var btn = $(elm);
							var ipt = btn.parent().prev();
							var val = ipt.val();
							var img = ipt.parent().next().children();
							options = {'global':false,'class_extra':'','direct':true,'multiple':false,'fileSizeLimit':5120000};
							util.image(val, function(url){
								if(url.url){
									if(img.length > 0){
										img.get(0).src = url.url;
									}
									ipt.val(url.attachment);
									ipt.attr("filename",url.filename);
									ipt.attr("url",url.url);
								}
								if(url.media_id){
									if(img.length > 0){
										img.get(0).src = "";
									}
									ipt.val(url.media_id);
								}
							}, options);
						});
					}
					function deleteImage(elm){
						$(elm).prev().attr("src", "./resource/images/nopic.jpg");
						$(elm).parent().prev().find("input").val("");
					}
					
					var tjz_id	= 0;
					var type_id	= '';
				</script>
				
				<div class="form-group infodjdiv" style="display:none;">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">溯源信息</label>
					<div class="col-sm-8" style="padding:0px;margin:0px;">
						<div class="gicai_fwyzm_list" style="padding:0px;margin:0px; ">
                        	<ul>
								<li style="width:180px;text-align:left;">提交时间</li>
								<li style="width:170px;text-align:left;">溯源信息</li>
								<li style="width:120px;text-align:left;">提交者</li>
								<li style="width:140px;text-align:left;">溯源图片</li> 
								<li style="width:80px; cursor:pointer;" class=" btn-primary" onclick="adddata();">添加溯源</li>
							</ul>
                            <div id="data_div_dom">
							 

                             
                        	</div>
                             
                            
                             
                        </div>
                        <div style="padding-left:20px; color:red;">尽量不删除溯源信息，容易混淆出错！</div>
					</div>
				</div>
				
				<div id="modal-module-menus"  class="modal fade" tabindex="-1">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
								<h3>选择要设置的管理员</h3>
							</div>
							<div class="modal-body" >
								<div class="row">
									<div class="input-group">
										<input type="text" class="form-control" name="keyword" value="" id="search-kwd" placeholder="请输入微信名进行查询已报名的会员列表！" />
										<span class='input-group-btn'>
										<button type="button" class="btn btn-default" onclick="search_entries(tjz_id);">搜索</button>
										</span>
									</div>
									<div class="input-group" style="width:100% !important;">
										<div id="module-menus" style="padding-top:10px;"></div>
									</div>
									
								</div>
								 
							</div>
							<div style="margin-bottom:20px;"></div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">产品外链</label>
					<div class="col-sm-8">
						<input type="text" name="data[url]" id="title" class="form-control" value="{$account['url']}" />
						<div style="padding-left:5px;">留空则不显示！</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">状态</label>
					<div class="col-sm-8">
                    	<label class="radio-inline">
                            <input type="radio" name="data[state]" checked="checked" value="1" /> 正常
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="data[state]" value="0" /> 下架
                        </label> 
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">产品介绍</label>
					<div class="col-sm-8">
						 
						{php echo tpl_ueditor('data[content]',$account['content']);}
					</div>
				</div>
				 
               
				<div class="form-group">
					<div class="col-xs-12 col-sm-9 col-md-10 col-lg-10 col-sm-offset-3 col-md-offset-2 col-lg-offset-2">
						<input name="submit" type="submit" value="提交" class="btn btn-primary" />
						<input type="hidden" name="token" value="{$_W['token']}" />
					</div>
				</div>
			</div>
           </div>
	</form>
	</div>
</div>
<script type="text/javascript">
$(document).ready(function(){
	 
	 
	 
});
function tjzfun(id,type){
	 
	tjz_id	= id;
	type_id = type;
	$('#module-menus').html('');
	$('#modal-module-menus').modal();
}

function search_entries(id) {
 
	var kwd = $.trim($('#search-kwd').val());
	if(kwd=='' || kwd == null){
		util.message('请输入查询的名称;');
		 
	}else{
		 
		$.post("{php echo $this->createWebUrl('muser',array('mo'=>'userss'));}", {keyword: kwd,tjz:id}, function(dat){
	
			$('#module-menus').html(dat);
	
		});
	}

}

function select_entry(o,tjz) {

	$("#modal-module-menus .close").click();
 	 
	if(type_id=='u'){
		$("#tjzu_"+tjz).val(o.openid);
	}else{
		$("#tjz_"+tjz).val(o.openid);
	}
	 
}
</script>

 


{template 'common/footer'}