<?php
 class MobileBaseController extends BaseController { public $uid; public $userInfo; public $data; public $fenxiao_open; public $admin = false; public static $ORDER_STATUS = array(0 => array("\166\x61\x6c\x75\145" => "\xe5\276\x85\346\x94\257\344\xbb\230", "\143\x6c\141\163\x73" => "\147\x72\145\145\156", "\x69\x64" => 0), 1 => array("\166\141\154\x75\145" => "\xe6\234\xaa\xe5\217\221\350\xb4\xa7", "\143\x6c\141\x73\x73" => "\x72\x65\144", "\151\144" => 1), 2 => array("\166\141\154\x75\145" => "\xe5\267\xb2\345\217\221\350\264\xa7", "\x63\154\x61\163\x73" => "\171\x65\154\154\x6f\167", "\151\x64" => 2), 3 => array("\166\x61\x6c\x75\x65" => "\xe5\267\xb2\345\256\x8c\346\210\220", "\x63\x6c\141\163\x73" => "\x67\x72\141\171", "\151\x64" => 3), -1 => array("\166\141\154\x75\145" => "\xe5\xb7\262\345\x85\263\xe9\x97\255", "\143\x6c\x61\163\x73" => "\x63\x6c\157\163\x65", "\x69\x64" => -1)); public function __construct() { parent::__construct(); } public function init() { goto tC_1V; tC_1V: $agent = $this->site->configs["\x63\x6f\156\x66\151\x67"]["\x64\x61\151\x6c\x69\x74\151\x61\157\152\x69\141\156"]; goto FhK3K; FhK3K: $this->getUserInfo($agent); goto ZoZOS; FxrN2: Y1l9y: goto RpmW1; jWBYJ: $this->assign("\165\163\145\x72\x5f\x69\x6e\x66\157", $this->userInfo); goto h_lUw; h_lUw: $this->uid = $_SESSION["\x77\147\137\x66\145\x6e\170\151\141\x6f"]["\x69\x64"]; goto azLJt; dI9j5: $this->userInfo["\172\150\x65\x6b\157\x75"] = self::$LEVEL_DEFAULT["\172\150\145\153\157\x75"]; goto YnTVU; Wd2TP: mu4Go: goto uoPNQ; BL6kV: $this->admin = true; goto arRJf; uWuju: $this->userInfo["\x6c\x65\x76\145\x6c\x6e\141\155\145"] = self::$LEVEL_DEFAULT["\154\145\x76\x65\154\x6e\141\155\145"]; goto dI9j5; ZEnhU: W5X0y: goto Rq43S; uoPNQ: $this->userInfo["\154\145\x76\x65\154\156\141\x6d\x65"] = $levels[$this->userInfo["\141\x67\x65\156\164\x6c\x65\x76\x65\154"]]["\x6c\x65\x76\145\x6c\156\141\x6d\145"]; goto DcPnv; sjgQ0: $_SESSION["\167\x67\x5f\146\145\156\170\x69\141\x6f"] = $this->MemberModel->getOne(["\151\144" => 14]); goto VQKSl; t19ui: if (isset($levels[$this->userInfo["\x61\x67\145\156\164\x6c\x65\166\145\x6c"]]) && $this->userInfo["\x69\x73\x61\147\145\x6e\x74"] && $this->fenxiao_open) { goto mu4Go; } goto uWuju; HLhkQ: R5ZUE: goto fWfBL; arRJf: $this->assign("\x61\x64\155\x69\156", true); goto FxrN2; KgRDL: $this->assign("\x67\x6f\165\x5f\151\156\146\x6f", ["\x67\157\165" => $this->module["\143\157\156\x66\x69\x67"]["\147\157\165"], "\x67\157\x75\137\x74\x68\165\155\142" => $this->module["\x63\157\156\x66\x69\147"]["\147\157\165\x5f\164\x68\x75\155\x62"], "\x67\157\165\137\156\141\x6d\x65" => $this->module["\143\x6f\x6e\x66\x69\147"]["\147\x6f\165\137\156\141\155\145"], "\x67\157\x75\137\165\x72\154" => $this->module["\x63\157\156\146\151\147"]["\147\157\x75\x5f\165\162\154"]]); goto jtUHO; YnTVU: goto R5ZUE; goto Wd2TP; xjGb0: $this->assign("\146\145\x6e\x78\x69\x61\x6f\137\x6f\x70\x65\156", $this->fenxiao_open); goto KgRDL; ZoZOS: if (!($_SERVER["\123\105\x52\x56\x45\122\137\101\x44\104\122"] == "\61\62\67\x2e\60\56\x30\x2e\x31" && $_SERVER["\122\105\x4d\x4f\124\x45\137\101\x44\104\x52"] == "\x31\x32\x37\x2e\60\x2e\60\56\x31")) { goto W5X0y; } goto sjgQ0; RpmW1: bmO4N: goto rc54c; NDFN3: $this->userInfo = $this->MemberModel->getOne(["\151\x64" => $_SESSION["\x77\x67\137\146\145\x6e\170\151\x61\x6f"]["\151\144"]]); goto J33Yo; JOlyJ: $admins = explode("\54", $admin); goto NP7f2; azLJt: $admin = $this->module["\143\157\156\x66\151\x67"]["\141\x64\x6d\x69\x6e"]; goto T1HM9; fWfBL: $gou = $this->module["\x63\157\x6e\x66\x69\147"]["\147\x6f\x75"]; goto xjGb0; NP7f2: if (!in_array($this->uid, $admins)) { goto Y1l9y; } goto BL6kV; Rq43S: $this->site->getAuth(WG_APP_MODULE); goto NDFN3; VqQgr: $this->fenxiao_open = $this->site->configs["\143\x6f\x6e\x66\151\x67"]["\x6c\x65\x76\x65\x6c"]; goto t19ui; jtUHO: $this->assign("\x67\157\165\137\143\x6c\x6f\163\145", $gou == 1); goto jWBYJ; T1HM9: if (!($admin && $this->uid)) { goto bmO4N; } goto JOlyJ; DcPnv: $this->userInfo["\x7a\150\145\x6b\x6f\165"] = $levels[$this->userInfo["\141\x67\145\156\164\x6c\x65\166\x65\x6c"]]["\172\x68\145\153\157\165"]; goto HLhkQ; J33Yo: $levels = $this->getAllLevel('', $this->W["\x75\x6e\151\141\x63\151\144"]); goto VqQgr; VQKSl: $this->W["\167\145\151\144"] = 4; goto ZEnhU; rc54c: } public function getShoppingCartCount() { $sql = "\x73\145\154\x65\143\x74\x20\x73\165\x6d\50\141\155\157\165\156\164\51\x20\141\163\40\x60\163\x75\155\x60\x20\146\162\157\x6d\x20" . tablename($this->ShoppingCartModel->getTable()) . "\40\x77\150\x65\x72\x65\x20\165\151\144\75" . $this->uid; return $this->ShoppingCartModel->pdo_fetch($sql)["\x73\x75\x6d"]; } public function getShoppingCartInfo() { return $this->ShoppingCartModel->getList(["\165\x69\144" => $this->uid], "\x2a"); } public function updateShoppingCart($data, $inc = true) { goto zCsAm; ApvEl: kDwbe: goto F_6p8; rVkfW: $sql = "\x49\116\123\105\122\x54\x20\111\x4e\124\117\40" . tablename($this->ShoppingCartModel->getTable()) . "\x20\x28\x75\x69\144\54\x67\157\157\x64\163\x5f\x69\144\x2c\x60\164\x79\160\145\x60\x2c\141\x6d\x6f\x75\x6e\x74\51\x20\xa\40\40\x20\x20\x20\x20\x20\x20\x56\101\114\125\105\x53\x20\50" . $this->uid . "\x2c\47" . $data["\147\157\157\x64\163\137\x69\144"] . "\x27\54\47" . $data["\164\x79\x70\145"] . "\47\x2c\x27" . $data["\x61\155\x6f\165\x6e\164"] . "\47\51\40\xa\x20\40\x20\x20\40\x20\40\40\117\116\40\x44\125\x50\x4c\x49\103\x41\x54\105\x20\x4b\105\131\x20\125\x50\104\101\124\105\40\x61\155\x6f\x75\156\164\x3d\x61\x6d\x6f\x75\x6e\164\x2b" . (int) $data["\141\x6d\x6f\x75\156\x74"]; goto ApvEl; F_6p8: return $this->ShoppingCartModel->query($sql); goto AZo05; rqmeF: goto kDwbe; goto GSSxs; qphvL: $sql = "\111\x4e\123\105\122\x54\x20\111\x4e\x54\x4f\x20" . tablename($this->ShoppingCartModel->getTable()) . "\x20\x28\165\x69\x64\x2c\147\157\x6f\144\x73\x5f\x69\144\x2c\x60\x74\x79\160\145\x60\x2c\x61\x6d\157\x75\x6e\x74\51\40\12\x20\40\x20\40\40\x20\x20\x20\x56\101\114\125\x45\123\40\50" . $this->uid . "\54\x27" . $data["\147\157\157\144\x73\x5f\x69\x64"] . "\47\x2c\47" . $data["\164\171\x70\145"] . "\47\x2c\47" . $data["\141\155\157\x75\156\x74"] . "\47\51\40\12\40\x20\40\x20\x20\x20\40\40\117\116\40\x44\125\120\114\x49\103\x41\x54\105\40\113\105\131\40\x55\120\x44\101\x54\105\x20\x61\155\157\x75\156\164\75" . (int) $data["\x61\155\x6f\x75\156\164"]; goto rqmeF; zCsAm: if ($inc) { goto rX4DM; } goto qphvL; GSSxs: rX4DM: goto rVkfW; AZo05: } public function getUserInfo($agent) { goto K5BXP; b2Kow: $data = ["\157\x70\145\x6e\151\144" => $userinfo["\157\160\x65\x6e\x69\144"], "\167\x65\151\x64" => $this->W["\x75\x6e\x69\141\x63\151\x64"], "\x6e\x69\x63\153\x6e\141\155\145" => $userinfo["\156\151\x63\153\156\141\155\x65"], "\141\166\x61\x74\141\162" => $userinfo["\x68\145\141\144\151\x6d\147\x75\x72\x6c"], "\x66\x6f\154\x6c\157\167" => $userinfo["\163\x75\x62\163\x63\x72\151\142\x65"], "\160\141\162\145\x6e\164\137\x69\x64" => $from]; goto PqRSh; AFIIs: Sf3ny: goto sCkUB; p0BR1: $_SESSION["\x77\147\137\x66\x65\156\170\151\141\x6f"] = $this->MemberModel->getOne(["\x69\x64" => $id]); goto Xl8VL; GoXqK: $from = intval($_GET["\x66\x72\x6f\155\x66\x75\151\x64"]); goto H608Q; C49f3: IT5rJ: goto b2Kow; vxnvn: UAe2l: goto oSeNQ; XjwXH: gn6__: goto YrZBf; tFZOX: UV7WL: goto nmvs_; c28s_: $data["\151\x73\x61\147\145\x6e\164"] = 1; goto f5ODg; f5ODg: rO_x6: goto BukOC; sCkUB: echo "\347\231\xbb\xe5\275\x95\xe5\244\xb1\350\264\xa5\x2c\350\257\xb7\xe8\x81\x94\347\263\xbb\xe5\xbc\200\345\x8f\221\350\200\x85\121\x51\72\70\63\70\65\71\x36\x38\70"; goto ES36j; ES36j: exit; goto i4AM6; K5BXP: if (empty($_SESSION["\x77\147\x5f\x66\145\x6e\170\x69\141\157"])) { goto sXRHZ; } goto VF9AV; CFxCc: uS8NC: goto C49f3; nmvs_: $parent = []; goto GoXqK; i8f3K: uq9s5: goto wDRsP; T8f13: gfdzc: goto p0BR1; SKd6F: goto gfdzc; goto AFIIs; PqC95: if ($from) { goto gn6__; } goto SKd6F; TxVTa: if (!$userinfo) { goto UAe2l; } goto HGfms; BQOM2: $_SESSION["\167\147\x5f\146\145\156\x78\x69\x61\157"] = $member; goto i8f3K; ZjUIn: $this->MemberModel->update(["\151\144" => $member["\x69\144"]], $data); goto BQOM2; BukOC: $id = $this->MemberModel->add($data); goto VUbex; oVCIY: qFSjZ: goto kEune; sZkgt: O4UGa: goto Uy9Ol; UYD32: goto IT5rJ; goto oVCIY; juz4j: $from = 0; goto UYD32; Uy9Ol: $data = ["\156\x69\143\x6b\x6e\141\x6d\x65" => $userinfo["\x6e\151\x63\153\156\x61\155\145"], "\x61\166\x61\164\x61\162" => $userinfo["\x68\x65\x61\x64\151\x6d\x67\x75\162\x6c"], "\x66\x6f\154\154\157\x77" => $userinfo["\163\x75\x62\x73\x63\x72\151\142\x65"]]; goto cocUy; cocUy: $member = array_merge($member, $data); goto ZjUIn; M34UZ: if (!empty($member) && $userinfo) { goto O4UGa; } goto oZU78; Wpatz: if ($parent) { goto uS8NC; } goto To_LJ; VUbex: if (!$id) { goto Sf3ny; } goto PqC95; HGfms: goto YtTdf; goto tFZOX; To_LJ: $from = 0; goto CFxCc; PqRSh: if (!($agent == 4)) { goto rO_x6; } goto c28s_; Xl8VL: goto YtTdf; goto vxnvn; oSeNQ: YtTdf: goto HvT53; H608Q: if ($from) { goto qFSjZ; } goto juz4j; i4AM6: goto gfdzc; goto XjwXH; YrZBf: $this->sendXinZengGuanZhuTongZhi($parent, $this->site->configs["\143\157\156\146\x69\147"]["\170\x69\156\172\145\x6e\x67\x67\x75\x61\156\172\150\x75"], $data["\x6e\151\x63\x6b\156\141\155\x65"]); goto T8f13; kEune: $parent = $this->MemberModel->getOne(["\151\144" => $from]); goto Wpatz; oZU78: if ($userinfo && empty($member)) { goto UV7WL; } goto TxVTa; HvT53: goto uq9s5; goto sZkgt; ZDj88: sXRHZ: goto peY1R; wDRsP: return $_SESSION["\x77\x67\x5f\146\x65\x6e\x78\x69\x61\x6f"]; goto l4kMN; peY1R: $member = $this->MemberModel->getOne(["\157\160\145\156\151\x64" => $this->W["\157\160\145\156\151\144"], "\x77\x65\151\144" => $this->W["\x75\156\x69\x61\143\x69\144"]]); goto RAE9O; VF9AV: return $_SESSION["\x77\x67\x5f\146\x65\156\x78\x69\x61\x6f"]; goto ZDj88; RAE9O: $userinfo = mc_oauth_userinfo(); goto M34UZ; l4kMN: } public function getMemberInfo($uid) { return $this->MemberModel->getOne(["\x69\144" => $uid], ["\x69\x64", "\x77\145\x69\144", "\x69\163\141\x67\x65\156\x74", "\x6f\x70\x65\x6e\x69\144", "\x6e\x69\x63\x6b\x6e\141\155\x65", "\152\x69\x66\x65\156", "\141\x67\x65\x6e\x74\154\145\x76\x65\x6c", "\160\x61\x72\145\156\x74\137\151\x64"]); } public function getParents($parent_id) { goto R9Nmx; IPzuD: $arr[3] = $parent3; goto aKVEe; sRFAA: if (empty($parent3)) { goto jK7MZ; } goto IPzuD; gs76e: $arr[2] = $parent2; goto qGW2z; wKv0A: if (empty($parent2)) { goto DTmxb; } goto gs76e; zmjf4: Cv5p2: goto n2vCS; HPaMP: DTmxb: goto zmjf4; WPghN: $parent2 = $this->getMemberInfo($parent1["\160\x61\x72\145\156\x74\137\x69\144"]); goto wKv0A; qGW2z: $parent3 = $this->getMemberInfo($parent2["\x70\x61\x72\x65\x6e\164\137\x69\144"]); goto sRFAA; nijIN: if (empty($parent1)) { goto Cv5p2; } goto Cng9e; R9Nmx: $arr = array(); goto i47EI; Cng9e: $arr[1] = $parent1; goto WPghN; i47EI: $parent1 = $this->getMemberInfo($parent_id); goto nijIN; aKVEe: jK7MZ: goto HPaMP; n2vCS: return $arr; goto wrQBw; wrQBw: } private function _addUserCommission($uid, $money, $order, $i) { goto YESyw; kkI_o: $success = $this->MemberModel->update(["\x69\x64" => $uid], $data); goto YecJH; sJ9k0: huCa9: goto vOm1E; LDU4o: return $success; goto BlO1O; dh9_S: $data = ["\167\145\151\144" => $order["\x77\145\151\144"], "\165\x69\144" => $uid, "\157\162\144\145\162\x73\156" => $order["\x6f\162\x64\145\162\x73\x6e"], "\160" => $i, "\155\x6f\x6e\145\171" => $money, "\143\x72\145\x61\x74\x65\x74\151\x6d\145" => time()]; goto s6WI3; YecJH: if (!$success) { goto VvGIg; } goto dh9_S; vOm1E: VvGIg: goto LDU4o; h3Dc3: if ($add) { goto huCa9; } goto fe3gG; s6WI3: $add = $this->CommissionModel->add($data); goto h3Dc3; fe3gG: $this->crontab_log("\xe4\xbd\243\351\207\x91\x6c\x6f\147\346\267\xbb\xe5\x8a\240" . var_export($data), "\x65\x72\x72\157\162"); goto sJ9k0; YESyw: $data = ["\x63\x6f\155\x6d\151\x73\x73\151\157\x6e\40\53\75" => $money]; goto kkI_o; BlO1O: } public function _sendPack() { } public function sendOrderRedPack($order, $config) { goto GfSST; GfSST: $un_red_pack = $this->_getNoHongbao($config); goto G9JB0; oZKGf: $i = 1; goto IPH0n; G9JB0: $flag = true; goto oZKGf; uud_z: rQeSo: goto AmkBF; yQm06: $success = $this->_addUserCommission($order[$parent], $total_money, $order, $i); goto J_fCj; KRVlE: if (!($order[$parent] > 0 && $order[$commision] > 0)) { goto JLLAh; } goto Xs0u7; cTz7b: JLLAh: goto G27e5; tuCkZ: $flag = false; goto XLl6w; hFb11: $commision = "\143\157\x6d\x6d\151\163\x69\x6f\x6e" . $i; goto KRVlE; gorgt: goto JafSn; goto uud_z; k7Fry: if (!($i <= 3)) { goto rQeSo; } goto Wehox; G27e5: NyQI5: goto Qmqr8; XLl6w: Vp5qv: goto cTz7b; AmkBF: return $flag; goto x_Dwk; IPH0n: JafSn: goto k7Fry; Wehox: $parent = "\160\141\x72\145\x6e\x74" . $i; goto hFb11; Qmqr8: $i++; goto gorgt; Xs0u7: $total_money = $order[$commision]; goto yQm06; J_fCj: if ($success) { goto Vp5qv; } goto tuCkZ; x_Dwk: } protected function doResultRedPack($db_data, $order, $p, $red_pack_id, $again = false) { goto Ob8wD; SYtpb: if ($red_pack_update) { goto rIbYr; } goto Kf58G; Kf58G: $this->crontab_log("\144\x6f\x52\x65\x73\x75\x6c\x74\x52\145\144\x50\x61\143\x6b\40\165\x70\144\141\164\145\40\x72\x65\144\40\160\141\143\x6b\40\x66\x61\151\x6c\x20" . var_export($order, true) . var_export($db_data, true), "\145\162\162\x6f\x72"); goto b0rHn; RgBNY: goto qCK0K; goto TUzdt; QLnaW: qCK0K: goto kreUr; HPqPV: return true; goto QLnaW; Ob8wD: $db_data_msg = unserialize($db_data["\x72\145\164\x75\162\x6e\137\155\163\147"]); goto NoTbt; Am11h: $order_update = $this->OrderModel->update(["\151\x64" => $order["\x69\144"]], [$key . "\x20\53\75" => $db_data_msg["\164\x6f\164\x61\x6c\137\x61\155\x6f\165\156\x74"]]); goto j0ylm; NoTbt: if ($db_data["\145\x72\162\x5f\143\x6f\x64\145"] == "\123\x55\x43\103\105\x53\123") { goto Rquk1; } goto rL4Gb; WCJQD: rIbYr: goto HPqPV; DTxkw: $red_pack_update = $this->RedPackModel->update(["\151\144" => $red_pack_id], ["\x73\164\x61\164\165\163" => 1, "\163\145\156\144\x5f\x6c\x69\x73\164\x69\x64" => $db_data_msg["\163\145\x6e\144\137\154\151\163\164\x69\x64"]]); goto SYtpb; jysK_: byzJ5: goto DTxkw; b0rHn: return false; goto WCJQD; j0ylm: if ($order_update) { goto byzJ5; } goto d5lDx; d5lDx: $this->crontab_log("\x64\157\122\x65\163\165\154\x74\122\x65\x64\120\141\143\153\40\165\x70\x64\x61\x74\x65\x20\157\162\144\x65\x72\40\146\141\x69\154\40" . var_export($order, true) . var_export($db_data, true), "\145\162\162\x6f\x72"); goto jysK_; TUzdt: Rquk1: goto cfE56; kreUr: return false; goto DXXVG; cfE56: $key = "\x68\157\x6e\147\x62\x61\157" . $p; goto Am11h; rL4Gb: $this->RedPackModel->update(["\151\144" => $red_pack_id], ["\163\164\x61\164\x75\163" => 2, "\163\x65\156\x64\137\x6c\x69\x73\x74\151\144" => $db_data["\x73\145\x6e\x64\x5f\154\151\x73\x74\x69\144"], "\x65\162\162\x5f\x63\x6f\144\x65" => $db_data["\x65\162\162\137\x63\157\144\x65"], "\145\x72\162\x5f\143\x6f\144\x65\x5f\144\x65\163" => $db_data["\145\x72\x72\x5f\x63\x6f\144\145\x5f\x64\x65\x73"], "\x62\151\154\x6c\156\x6f" => $db_data_msg["\155\143\x68\137\142\151\x6c\x6c\156\157"]]); goto RgBNY; DXXVG: } protected function _getNoHongbao($config) { goto v9fnJ; SWrmK: $config = explode("\x2c", $config); goto xWNkU; v9fnJ: $config = $config["\x6e\157\150\x6f\x6e\147\142\141\x6f"]; goto ZsAjl; xWNkU: return $config; goto a3zjS; ZsAjl: $config = str_replace("\357\xbc\214", "\54", $config); goto SWrmK; a3zjS: } public function formatTime($time) { goto sVKVe; baCIp: if ($t < 60) { goto eSKWv; } goto MePOf; BUYVa: return "\346\234\252\xe7\x9f\xa5"; goto abvAo; abvAo: uZGx1: goto OrkqP; MePOf: if ($t < 60 * 60) { goto k466C; } goto kgAG7; W2PO4: goto BK14g; goto g_ZlU; fk5ls: $text = date("\155\55\144", $time); goto A2Ifj; Nh9eB: $text = "\xe5\x88\232\345\x88\232"; goto qi1j0; g_ZlU: bfU09: goto RLgsj; gh8NE: eSKWv: goto JJeD8; RLgsj: $text = date("\x48\x3a\151", $time); goto NXsAD; V7Osz: k466C: goto yX_6e; NXsAD: BK14g: goto xYahe; A2Ifj: goto BK14g; goto ZymEH; sVKVe: if ($time) { goto uZGx1; } goto BUYVa; EWk7K: if ($t == 0) { goto DxVsT; } goto baCIp; qi1j0: goto BK14g; goto gh8NE; JJeD8: $text = "\x31\xe5\210\206\xe9\x92\x9f\xe5\211\x8d"; goto sA2n2; ZymEH: DxVsT: goto Nh9eB; xYahe: return $text; goto gNLm0; kgAG7: if ($t < 60 * 60 * 24) { goto bfU09; } goto fk5ls; yX_6e: $text = floor($t / 60) . "\345\210\x86\351\x92\237\xe5\211\215"; goto W2PO4; sA2n2: goto BK14g; goto V7Osz; OrkqP: $t = time() - $time; goto EWk7K; gNLm0: } }