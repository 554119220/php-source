<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto X4wGR; SRDyB: $this->out_trade_no = $out_trade_no; goto qOIP3; EknWI: $this->openid = $openid; goto EeSqc; Fqpsy: $this->total_fee = $total_fee; goto IX4ZD; EeSqc: $this->mch_id = $mch_id; goto rKxlp; qOIP3: $this->body = $body; goto Fqpsy; X4wGR: $this->appid = $appid; goto EknWI; rKxlp: $this->key = $key; goto SRDyB; IX4ZD: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto ro5Jz; XAN2m: $parameters["\x73\x69\147\x6e"] = $this->getSign($parameters); goto OBmNr; ro5Jz: $url = "\x68\x74\164\160\163\72\57\57\x61\x70\151\56\x6d\143\150\x2e\x77\x65\x69\170\151\156\x2e\x71\161\56\143\x6f\x6d\x2f\x70\x61\x79\x2f\x75\x6e\151\x66\x69\x65\x64\x6f\162\x64\x65\162"; goto RspST; XBRFg: return $return; goto m2mcW; RspST: $parameters = array("\x61\x70\x70\x69\x64" => $this->appid, "\x6d\143\150\137\x69\x64" => $this->mch_id, "\156\157\156\x63\145\x5f\163\x74\x72" => $this->createNoncestr(), "\142\157\x64\171" => $this->body, "\157\165\164\137\164\x72\141\144\x65\137\156\157" => $this->out_trade_no, "\x74\x6f\x74\x61\154\x5f\x66\x65\145" => $this->total_fee, "\163\x70\142\x69\x6c\154\x5f\143\162\145\141\164\145\x5f\151\160" => "\x31\62\60\56\x37\71\x2e\61\x35\62\x2e\x31\60\65", "\156\x6f\164\x69\x66\x79\x5f\165\162\154" => "\x31\62\60\56\x37\x39\56\x31\65\x32\x2e\61\x30\x35", "\x6f\x70\145\x6e\151\x64" => $this->openid, "\x74\x72\x61\x64\145\x5f\x74\171\x70\145" => "\112\x53\x41\x50\111"); goto XAN2m; OBmNr: $xmlData = $this->arrayToXml($parameters); goto UwWUM; UwWUM: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto XBRFg; m2mcW: } private static function postXmlCurl($xml, $url, $second = 30) { goto KqwW7; Kb5zF: return $data; goto IivdF; IivdF: oe15d: goto Jad8z; GPZB_: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto n3CGo; XLIQk: curl_close($ch); goto bel__; sU5mZ: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto CWH5v; wnOHc: curl_setopt($ch, CURLOPT_POST, TRUE); goto L9k64; mCSDA: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto wnOHc; hW28y: curl_setopt($ch, CURLOPT_URL, $url); goto YQxlC; YQxlC: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto GPZB_; p6RaN: $data = curl_exec($ch); goto ZwEJJ; KqwW7: $ch = curl_init(); goto VgCJF; Q19EV: goto oe15d; goto sKiFu; bel__: throw new WxPayException("\x63\x75\162\x6c\xe5\207\272\xe9\224\x99\357\274\x8c\351\x94\231\xe8\257\xaf\347\xa0\x81\72{$error}"); goto Q19EV; t6B5Q: set_time_limit(0); goto p6RaN; sKiFu: oWNic: goto E2ZK5; VgCJF: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto hW28y; n3CGo: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto mCSDA; CWH5v: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto t6B5Q; L9k64: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto sU5mZ; RLtPZ: $error = curl_errno($ch); goto XLIQk; E2ZK5: curl_close($ch); goto Kb5zF; ZwEJJ: if ($data) { goto oWNic; } goto RLtPZ; Jad8z: } private function arrayToXml($arr) { goto E9baq; b4g1m: WsuEm: goto bc23A; NkgTL: foreach ($arr as $key => $val) { goto uIiq2; KrZkF: xBb95: goto ka02V; qA4Cx: v3g3M: goto KrZkF; Xm8aE: $xml .= "\74" . $key . "\76" . $val . "\74\57" . $key . "\76"; goto Q2GpT; Q2GpT: goto v3g3M; goto zxLDJ; uIiq2: if (is_array($val)) { goto YJSJ8; } goto Xm8aE; kTE__: $xml .= "\x3c" . $key . "\76" . arrayToXml($val) . "\74\x2f" . $key . "\76"; goto qA4Cx; zxLDJ: YJSJ8: goto kTE__; ka02V: } goto b4g1m; bc23A: $xml .= "\x3c\x2f\162\157\157\x74\76"; goto BRwsk; BRwsk: return $xml; goto SJ8Gd; E9baq: $xml = "\74\x72\x6f\x6f\x74\76"; goto NkgTL; SJ8Gd: } private function xmlToArray($xml) { goto IPJzP; URCft: return $val; goto XZh6t; IPJzP: libxml_disable_entity_loader(true); goto pXsrg; fOwsz: $val = json_decode(json_encode($xmlstring), true); goto URCft; pXsrg: $xmlstring = simplexml_load_string($xml, "\123\x69\x6d\x70\154\145\x58\x4d\114\x45\x6c\145\x6d\x65\156\x74", LIBXML_NOCDATA); goto fOwsz; XZh6t: } private function weixinapp() { goto UuiAi; UuiAi: $unifiedorder = $this->unifiedorder(); goto jOql1; jOql1: $parameters = array("\141\160\160\111\144" => $this->appid, "\164\x69\x6d\x65\123\x74\141\155\x70" => '' . time() . '', "\x6e\x6f\156\143\145\123\164\162" => $this->createNoncestr(), "\x70\141\x63\x6b\x61\x67\145" => "\x70\x72\x65\x70\x61\171\x5f\151\x64\75" . $unifiedorder["\x70\162\x65\160\x61\171\137\151\144"], "\163\151\147\x6e\x54\171\x70\x65" => "\115\x44\65"); goto nIkuR; nIkuR: $parameters["\160\x61\171\123\x69\x67\156"] = $this->getSign($parameters); goto hNRxZ; hNRxZ: return $parameters; goto EbU5g; EbU5g: } private function createNoncestr($length = 32) { goto Aa90H; Aa90H: $chars = "\141\x62\143\x64\145\146\147\150\x69\x6a\153\154\x6d\x6e\x6f\x70\161\x72\x73\164\x75\166\167\x78\171\x7a\60\x31\x32\x33\64\65\66\x37\x38\71"; goto VpoKc; VpoKc: $str = ''; goto k1G2r; FFxNG: return $str; goto J6F4a; UXhiq: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto tBbeE; Fpskj: if (!($i < $length)) { goto EOOPb; } goto UXhiq; tBbeE: wPVz9: goto RGA5y; ldo5p: BCjQr: goto Fpskj; RKjMC: EOOPb: goto FFxNG; k1G2r: $i = 0; goto ldo5p; RGA5y: $i++; goto qwkh4; qwkh4: goto BCjQr; goto RKjMC; J6F4a: } private function getSign($Obj) { goto EfqT8; b1AKr: $result_ = strtoupper($String); goto dY_e_; wT6ua: ksort($Parameters); goto yyXEg; spH0x: C3Y_8: goto wT6ua; b8Xgd: $String = md5($String); goto b1AKr; GhdfF: $String = $String . "\46\153\x65\171\x3d" . $this->key; goto b8Xgd; EfqT8: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; tHQOf: } goto spH0x; yyXEg: $String = $this->formatBizQueryParaMap($Parameters, false); goto GhdfF; dY_e_: return $result_; goto EGulM; EGulM: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto Kjuoa; EAkDM: if (!(strlen($buff) > 0)) { goto aNuFR; } goto qgIjR; FYoEF: ksort($paraMap); goto tI9f5; LExMD: aNuFR: goto Ijliq; Ijliq: return $reqPar; goto ZbnbN; qgIjR: $reqPar = substr($buff, 0, strlen($buff) - 1); goto LExMD; GqyV8: RxC5s: goto CQIU1; Kjuoa: $buff = ''; goto FYoEF; CQIU1: $reqPar; goto EAkDM; tI9f5: foreach ($paraMap as $k => $v) { goto WTBmM; LP9_s: $buff .= $k . "\75" . $v . "\x26"; goto hhqhD; cF4t9: P_m6u: goto LP9_s; WTBmM: if (!$urlencode) { goto P_m6u; } goto w3CPr; w3CPr: $v = urlencode($v); goto cF4t9; hhqhD: zuUSQ: goto kVvn_; kVvn_: } goto GqyV8; ZbnbN: } }