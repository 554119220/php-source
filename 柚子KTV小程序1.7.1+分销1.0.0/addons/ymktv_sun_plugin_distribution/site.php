<?php
 goto d7Wag; KtJJ3: include IA_ROOT . '/addons/ymktv_sun_plugin_distribution/func/func.php'; goto FbHvg; d7Wag: defined('IN_IA') or exit('Access Denied'); goto KtJJ3; FbHvg: class ymktv_sun_plugin_distributionModuleSite extends WeModuleSite { public function doWebdistribution_set() { goto SVAUm; SVAUm: global $_GPC, $_W; goto kVlkQ; yDBQp: $info['withdrawtype'] = $info['withdrawtype'] ? explode(',', $info['withdrawtype']) : array(); goto WtyeT; Qt13C: AEmKa: goto vz7wM; gWsF6: $tid = $_GPC['tid']; goto O2gYI; ZtfBj: vY2V6: goto Qt13C; O2gYI: $info = pdo_get('ymktv_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto yDBQp; WtyeT: switch ($settype) { case 1: goto cSJw0; qPSii: GVAvG: goto hZoE9; rnEXN: tUUk1: goto ur9qE; E2B8L: $add = json_decode($info, true); goto SdPL6; mOR2a: $data['keyword_id_list'] = [2, 4, 1]; goto FQvS0; iYvbf: goto GVAvG; goto rNjjM; cSJw0: if ($todo == 'setting') { goto UKDzK; } goto fXoZ_; QeKDJ: $token = getaccess_token(); goto CKMoz; vub6u: goto AEmKa; goto LeuH5; Qn2aR: $res = pdo_insert('ymktv_sun_distribution_set', $datas); goto f0VMS; CKMoz: $url = 'https://api.weixin.qq.com/cgi-bin/wxopen/template/add?access_token=' . $token; goto kmJX5; tMmA1: e5VLg: goto zgyM0; IPFb3: goto vS03M; goto nra9U; hdY72: if ($tid == 'tpl_wd_fail') { goto pWF3f; } goto Nmiwn; ketm2: if ($res) { goto lfraH; } goto NlVkx; bevw2: $data['id'] = 'AT1242'; goto Fs8TX; FQvS0: vS03M: goto p5KPX; N2Kjz: if ($res) { goto ibKKl; } goto moERr; SsX9A: if (empty($_GPC['id'])) { goto iRZOs; } goto YdBXi; SHeIf: $info = tocurl($url, $data, 0); goto E2B8L; j91T7: message('设置失败,参数错误', '', 'error'); goto HSZ5q; Gbww6: $data['uniacid'] = $_W['uniacid']; goto oxBlo; p5KPX: $data = json_encode($data); goto SHeIf; nra9U: pWF3f: goto bevw2; TWDYz: UKDzK: goto QeKDJ; hZoE9: goto sIolz; goto N9Rnr; Z9Adk: goto vBqAk; goto fs5Ph; K0xQx: lfraH: goto rNGa8; SZ0LI: $data = array(); goto px81B; nyvit: $data['id'] = 'AT0830'; goto PNBdR; f0VMS: x9BDR: goto ketm2; sn2mw: $datas[$tid] = $add['template_id']; goto Qn2aR; LXuZ4: ZXtmy: goto N2Kjz; zgyM0: $datas['uniacid'] = trim($_W['uniacid']); goto sn2mw; Fs8TX: $data['keyword_id_list'] = [3, 2]; goto X6rZJ; rNGa8: message('模板消息设置成功', $this->createWebUrl('distribution_set', array("settype" => 1)), 'success'); goto pkGKk; rNjjM: Bx_KP: goto GRgqz; X6rZJ: goto vS03M; goto rnEXN; SdPL6: if ($add['errcode'] == 0 && $add['errmsg'] == 'ok') { goto Bx_KP; } goto fQV8v; pkGKk: fU59K: goto qPSii; mLKwH: goto x9BDR; goto tMmA1; XI7yW: vBqAk: goto UE80j; UE80j: sIolz: goto vub6u; fs5Ph: ibKKl: goto nbAoY; nbAoY: message('成功!', $this->createWebUrl('distribution_set', array("settype" => 1)), 'success'); goto XI7yW; vRs5T: goto ZXtmy; goto RnVkl; oxBlo: $res = pdo_insert('ymktv_sun_distribution_set', $data); goto LXuZ4; kmJX5: if ($tid == 'tpl_wd_arrival') { goto Ij0Ro; } goto hdY72; fXoZ_: if ($todo == 'savetemplate') { goto fM7xk; } goto y3qb5; moERr: message('失败!', $this->createWebUrl('distribution_set', array("settype" => 1)), 'error'); goto Z9Adk; NlVkx: message('设置失败!', '', 'error'); goto ma3Aj; ScUXl: $data = $data_first; goto SsX9A; Nmiwn: if ($tid == 'tpl_share_check') { goto tUUk1; } goto j91T7; PNBdR: $data['keyword_id_list'] = [5, 3, 1, 8, 6]; goto IPFb3; px81B: $data_first = $_GPC['indata']; goto ScUXl; N9Rnr: fM7xk: goto SZ0LI; y3qb5: goto sIolz; goto TWDYz; HSZ5q: goto vS03M; goto dulJr; GRgqz: if (empty($_GPC['id'])) { goto e5VLg; } goto q6BKV; ur9qE: $data['id'] = 'AT0674'; goto mOR2a; ma3Aj: goto fU59K; goto K0xQx; YdBXi: $res = pdo_update('ymktv_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto vRs5T; q6BKV: $res = pdo_update('ymktv_sun_distribution_set', array($tid => $add['template_id']), array("uniacid" => $_W['uniacid'])); goto mLKwH; dulJr: Ij0Ro: goto nyvit; RnVkl: iRZOs: goto Gbww6; fQV8v: message('设置失败!!' . $add['errmsg'], '', 'error'); goto iYvbf; LeuH5: default: goto qCbzr; N2WVZ: goto AEmKa; goto F6zoK; jf8gT: bfepw: goto PDpoh; X7OD_: GmWe6: goto isUXO; ijVJF: goto NweDw; goto IaYFw; D1xbY: $data['uniacid'] = $_W['uniacid']; goto gj2xd; ty4AZ: $urlarr = array(); goto yICBa; qCbzr: if (!checksubmit()) { goto q5n32; } goto el1vP; nQmYD: goto NakB8; goto jf8gT; Ojjcd: $res = pdo_update('ymktv_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto ijVJF; PDpoh: message('成功!', $this->createWebUrl('distribution_set', $urlarr), 'success'); goto iGHYY; iTgpM: goto GmWe6; goto xLBGj; gj2xd: $res = pdo_insert('ymktv_sun_distribution_set', $data); goto nOoQh; avpos: q5n32: goto N2WVZ; ewvBH: $urlarr['settype'] = $settype; goto iTgpM; xLBGj: AvtEi: goto h2H5_; My9uP: if (empty($_GPC['id'])) { goto Tj7_Y; } goto Ojjcd; IaYFw: Tj7_Y: goto D1xbY; isUXO: $data = $data_first; goto My9uP; aUQVj: if ($res) { goto bfepw; } goto ggCXG; xAbvS: $data_first = $_GPC['indata']; goto ty4AZ; yICBa: if ($settype == 0) { goto AvtEi; } goto ewvBH; h2H5_: $data_first['withdrawtype'] = implode(',', $data_first['withdrawtype']); goto X7OD_; nOoQh: NweDw: goto aUQVj; iGHYY: NakB8: goto avpos; ggCXG: message('失败!', $this->createWebUrl('distribution_set', $urlarr), 'error'); goto nQmYD; el1vP: $data = array(); goto xAbvS; F6zoK: } goto ZtfBj; vz7wM: include $this->template('web/distribution_set'); goto o0a_P; ylHba: $todo = $_GPC['todo']; goto gWsF6; kVlkQ: $settype = intval($_GPC['settype']); goto ylHba; o0a_P: } public function doWebdistribution_commission() { goto WyL9I; g5rh7: $data['uniacid'] = $_W['uniacid']; goto x0aBl; vK0KE: ixk1p: goto Ukmnq; QPfjK: if (empty($_GPC['id'])) { goto W2G5z; } goto IrcQj; OJSmZ: goto UYiCo; goto VUBFo; VUBFo: W2G5z: goto g5rh7; SCeDY: UYiCo: goto Fo78q; Fo78q: if ($res) { goto ixk1p; } goto vVoL5; p1rf1: d3D92: goto qSDy1; kVKGB: if (!checksubmit()) { goto d3D92; } goto lSEw9; qSDy1: include $this->template('web/distribution_commission'); goto DHy8J; vVoL5: message('失败!', $this->createWebUrl('distribution_commission'), 'error'); goto h37Hq; AU7Jw: JTK8x: goto p1rf1; IrcQj: $res = pdo_update('ymktv_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto OJSmZ; Ukmnq: message('成功!', $this->createWebUrl('distribution_commission'), 'success'); goto AU7Jw; NPj1V: $data_first = $_GPC['indata']; goto Abk2j; WyL9I: global $_GPC, $_W; goto nbGz7; Abk2j: $data = $data_first; goto QPfjK; x0aBl: $res = pdo_insert('ymktv_sun_distribution_set', $data); goto SCeDY; nbGz7: $info = pdo_get('ymktv_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto kVKGB; lSEw9: $data = array(); goto NPj1V; h37Hq: goto JTK8x; goto vK0KE; DHy8J: } public function doWebdistribution_withdraw() { goto QKgAj; YPJR8: $wd_type = array("", "微信昵称", "支付宝账号", "银行卡号", "用户名"); goto vWeKl; NgDKS: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('ymktv_sun_distribution_withdraw') . ' as w left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=w.openid ' . $where, $data); goto XGDCk; UQ3Ee: $where = ' where w.uniacid=:uniacid '; goto NF_kK; zTqIa: $select_sql = $sql . ' order by id desc LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto DwhVJ; vWeKl: $status = array("待打款", "已经打款", "驳回"); goto kpnVt; NF_kK: $data[':uniacid'] = $uniacid; goto xSB07; uctIO: $wd_type_str = array("", "微信", "支付宝", "银行卡", "余额"); goto Z2nkt; QKgAj: global $_GPC, $_W; goto YPJR8; BJogC: $pagesize = 10; goto nNTlY; DwhVJ: $list = pdo_fetchall($select_sql, $data); goto NgDKS; Z2nkt: $pageindex = max(1, intval($_GPC['page'])); goto BJogC; XGDCk: $pager = pagination($total, $pageindex, $pagesize); goto nJBqG; xSB07: $sql = 'select w.*,u.name,u.img from ' . tablename('ymktv_sun_distribution_withdraw') . ' as w left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=w.openid ' . $where; goto zTqIa; kpnVt: $status_color = array("", "blue", "red"); goto uctIO; nJBqG: include $this->template('web/distribution_withdraw'); goto qcRjD; nNTlY: $uniacid = $_W['uniacid']; goto UQ3Ee; qcRjD: } public function doWebChangeWithdraw() { goto O8yAm; VQ6pb: message('失败，请先配置好小程序!', $this->createWebUrl('distribution_withdraw'), 'error'); goto CVLaJ; gkzC9: $res2 = pdo_update('ymktv_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto ovmuA; depqo: if ($info['withdrawaltype'] == 4) { goto txJ8q; } goto Q6kwY; PY96r: $amount = $info['realmoney'] * 100; goto S2_e5; RMXRZ: $sevenday = strtotime('-7 days'); goto x9fKD; d1m1N: Duhh1: goto dKF7q; i0jBU: LWXET: goto UTkEc; x9fKD: if (!($info['time'] >= $sevenday)) { goto aYN8G; } goto Mpr3_; vklPz: $key = $appData['wxkey']; goto B2UoU; y7J0a: $tpldata['ratesmoney'] = $info['ratesmoney']; goto sefhx; R0tCo: $status = intval($_GPC['status']); goto bUznI; ovmuA: $sendtplmessage = true; goto POFQ0; MfQ5G: $data = array(); goto fqJhI; DlrjR: $data['uniacid'] = $uniacid; goto YFsau; iY78l: $mch_appid = $appData['appid']; goto moL6q; nC24_: txJ8q: goto YLiUY; Kc6RY: $uniacid = $_W['uniacid']; goto ZU13w; S2_e5: $apiclient_cert = IA_ROOT . '/addons/ymktv_sun/cert/' . $appData['apiclient_cert']; goto U3nSh; dKF7q: if ($info['withdrawaltype'] == 1) { goto QhRD9; } goto depqo; YLiUY: $res = pdo_update('ymktv_sun_user_balance', array("money +=" => $info['realmoney']), array("uniacid" => $_W['uniacid'], "openid" => $info['openid'])); goto gD3bA; pggoE: message('失败，错误信息：参数错误', $this->createWebUrl('distribution_withdraw'), 'error'); goto ZtIcs; xWfyY: $return = $weixinfirmpay->pay(); goto shE1U; dxhuY: rHGMZ: goto Hv05Y; AN7vq: ZrVaH: goto ZuJ50; gD3bA: if ($res) { goto LWXET; } goto pggoE; shE1U: if ($return['result_code'] == 'SUCCESS') { goto A49aH; } goto CObrS; ysaWK: A4QXz: goto GdePh; M6RaX: sendtelmessage($info['openid'], 'tpl_wd_arrival', $haveformid, $tpldata); goto dxhuY; gxRN4: $tpldata['price'] = $info['money']; goto y7J0a; U3nSh: $apiclient_key = IA_ROOT . '/addons/ymktv_sun/cert/' . $appData['apiclient_key']; goto y2YYW; XR3_9: $desc = '分销提现打款'; goto PY96r; Q6kwY: $res1 = pdo_update('ymktv_sun_distribution_promoter', array("freezemoney -=" => $info['money'], "canwithdraw -=" => $info['money'], "allratesmoney +=" => $info['ratesmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto BDwqT; rDnSC: $res3 = pdo_insert('ymktv_sun_detailed', $data); goto gkzC9; m4Cnp: if (!$sendtplmessage) { goto rHGMZ; } goto q9Glq; GdePh: $tpldata = array(); goto gxRN4; sefhx: $tpldata['realmoney'] = $info['realmoney']; goto Ozb9W; WQ_0N: $haveformid = $info['form_id']; goto ysaWK; Hv05Y: TOdLF: goto alBPL; VRWAE: include IA_ROOT . '/addons/ymktv_sun_plugin_distribution/wxfirmpay.php'; goto PS_uI; ZtIcs: goto qczeu; goto i0jBU; Ozb9W: $tpldata['wd_type'] = $wd_type[$info['withdrawaltype']]; goto M6RaX; blV7P: A49aH: goto GJe2S; GJe2S: $res1 = pdo_update('ymktv_sun_distribution_promoter', array("freezemoney -=" => $info['money'], "canwithdraw -=" => $info['money'], "allratesmoney +=" => $info['ratesmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto DPFaX; eyD6e: if ($status == 1) { goto Duhh1; } goto vXOcc; POFQ0: qczeu: goto R6Gky; BDwqT: $res2 = pdo_update('ymktv_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto PMdfW; DY6S6: $res = pdo_update('ymktv_sun_distribution_withdraw', $data, array("uniacid" => $_W['uniacid'], "id" => $id)); goto iAox1; YFsau: $data['openid'] = $info['openid']; goto rDnSC; DPFaX: $res2 = pdo_update('ymktv_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto xltrm; UTkEc: $res1 = pdo_update('ymktv_sun_distribution_promoter', array("freezemoney -=" => $info['money'], "canwithdraw -=" => $info['money'], "allratesmoney +=" => $info['ratesmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto MfQ5G; iAox1: if (!($status == 2)) { goto ZrVaH; } goto QVq8C; fqJhI: $data['details_name'] = '分销提现到账'; goto aX8gr; CObrS: message('失败，错误信息：' . $return['return_msg'], $this->createWebUrl('distribution_withdraw'), 'error'); goto gU5XL; R6Gky: JulUi: goto m4Cnp; rkpQa: uN26G: goto TAgNj; KcG2d: $tpldata = array(); goto d5wpS; QVq8C: $res1 = pdo_update('ymktv_sun_distribution_promoter', array("freezemoney -=" => $info['money']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto RMXRZ; alBPL: message('成功!', $this->createWebUrl('distribution_withdraw'), 'success'); goto MIGrF; aX8gr: $data['details_money'] = $info['realmoney']; goto CJyIb; O8yAm: global $_GPC, $_W; goto Kc6RY; d5wpS: $tpldata['price'] = $info['money']; goto EUtIu; SgbqC: $sendtplmessage = false; goto eyD6e; ZU13w: $id = intval($_GPC['id']); goto R0tCo; PS_uI: $appData = pdo_get('ymktv_sun_system', array("uniacid" => $uniacid)); goto iY78l; WfgCj: $weixinfirmpay = new WeixinfirmPay($mch_appid, $mchid, $key, $openid, $partner_trade_no, $re_user_name, $desc, $amount, $apiclient_cert, $apiclient_key); goto xWfyY; moL6q: $mchid = $appData['mchid']; goto vklPz; ooinM: $wd_type = array("", "微信零钱", "支付宝", "银行卡", "账户余额"); goto SgbqC; vXOcc: $data = array(); goto YXe55; y2YYW: if (!($appData['appid'] == '' || $appData['mchid'] == '' || $appData['wxkey'] == '' || $appData['apiclient_cert'] == '' || $appData['apiclient_key'] == '')) { goto hI2wS; } goto VQ6pb; wjL2T: if (!($info['time'] >= $sevenday)) { goto A4QXz; } goto WQ_0N; B2UoU: $openid = $info['openid']; goto fVC1Y; MdOMn: goto JulUi; goto fxLQ8; CVLaJ: hI2wS: goto WfgCj; fxLQ8: QhRD9: goto VRWAE; fVC1Y: $partner_trade_no = $mchid . time() . rand(100000, 999999); goto uql4Z; rutge: aYN8G: goto KcG2d; q9Glq: $sevenday = strtotime('-7 days'); goto wjL2T; gU5XL: goto uN26G; goto blV7P; EUtIu: sendtelmessage($info['openid'], 'tpl_wd_fail', $haveformid, $tpldata); goto AN7vq; Mpr3_: $haveformid = $info['form_id']; goto rutge; YXe55: $data['status'] = $status; goto DY6S6; xltrm: $sendtplmessage = true; goto rkpQa; ZuJ50: goto TOdLF; goto d1m1N; bUznI: $info = pdo_get('ymktv_sun_distribution_withdraw', array("uniacid" => $_W['uniacid'], "id" => $id)); goto ooinM; PMdfW: $sendtplmessage = true; goto MdOMn; TAgNj: goto JulUi; goto nC24_; uql4Z: $re_user_name = $info['uname']; goto XR3_9; CJyIb: $data['addtime'] = time(); goto DlrjR; MIGrF: } public function doWebdistributor() { goto eFxw1; E8Nxi: if (!($info['status'] > 0)) { goto gfmLU; } goto mAL6A; lsBke: $pagesize = 10; goto KqB93; z8tds: $status = array("待审核", "通过审核", "拒绝"); goto leoQb; SqZv3: $sql = 'select w.*,u.name as uname,u.img from ' . tablename('ymktv_sun_distribution_promoter') . ' as w left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=w.openid ' . $where; goto F_8WK; WWw8w: $info = pdo_get('ymktv_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto E8Nxi; z0xIc: $where = ' where w.uniacid=:uniacid '; goto T2By3; eFxw1: global $_GPC, $_W; goto qVGMW; T2By3: $data[':uniacid'] = $uniacid; goto SqZv3; Mak1y: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('ymktv_sun_distribution_promoter') . ' as w left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=w.openid ' . $where, $data); goto TmaLG; qVGMW: $wd_type = array("", "微信昵称", "支付宝账号", "银行卡号", "用户名"); goto z8tds; TmaLG: $pager = pagination($total, $pageindex, $pagesize); goto Clip7; LjZKs: tVFJS: goto hwvY3; hwvY3: gfmLU: goto Mak1y; mAL6A: foreach ($list as $key => $val) { goto pFM9J; pFM9J: $list[$key]['code_img'] = ''; goto AhrjB; Y6GIc: a2v7D: goto WVpE1; AhrjB: if (!($info['status'] >= 1)) { goto GLEJE; } goto XOikn; XOikn: $list[$key]['nextone'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('ymktv_sun_user') . ' where parents_id=' . $val['uid'] . ' '); goto LT59J; ZNh8S: $list[$key]['nextthree'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('ymktv_sun_user') . ' where parents_id=ANY(SELECT id as user1 FROM ' . tablename('ymktv_sun_user') . ' WHERE parents_id=ANY(SELECT id as user1 FROM ' . tablename('ymktv_sun_user') . ' WHERE parents_id=' . $val['uid'] . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . '; '); goto vaONN; npKK3: if (!($info['status'] >= 2)) { goto a2v7D; } goto OVNMG; LT59J: GLEJE: goto npKK3; vaONN: E2HPA: goto js8aD; js8aD: piK4A: goto PGkW3; WVpE1: if (!($info['status'] >= 3)) { goto E2HPA; } goto ZNh8S; OVNMG: $list[$key]['nexttwo'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('ymktv_sun_user') . ' where parents_id=ANY(SELECT id as user1 FROM ' . tablename('ymktv_sun_user') . ' WHERE parents_id=' . $val['uid'] . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . '; '); goto Y6GIc; PGkW3: } goto LjZKs; F_8WK: $select_sql = $sql . ' order by w.id desc LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto xZsVd; leoQb: $pageindex = max(1, intval($_GPC['page'])); goto lsBke; Clip7: include $this->template('web/distributor'); goto CgrV0; xZsVd: $list = pdo_fetchall($select_sql, $data); goto WWw8w; KqB93: $uniacid = $_W['uniacid']; goto z0xIc; CgrV0: } public function doWebdistribution_order() { goto J_68D; Nxg8V: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_roomorder') . ' as o on o.id=os.order_id left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid ' . $where . ' order by o.id desc '); goto FTiaB; J_68D: global $_GPC, $_W; goto W5uTw; RCTf0: $where .= ' AND os.parent_id_1>0 '; goto gQEoR; fqT5y: B01kq: goto jS0nc; DeAMk: $sql = 'select o.status,u.name,u.img as uthumb,o.order_num,o.price as money,o.id,h.goods_name as pname,h.big_thumbnail as logo,os.first_price,os.second_price,os.third_price from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_roomorder') . ' as o on o.id=os.order_id left join 
			' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid left join ' . tablename('ymktv_sun_goods') . ' as h on h.id=o.gid ' . $where . ' order by o.id desc '; goto Nxg8V; aKjII: foreach ($list as $k => $v) { goto prFXs; lMd71: wGi7g: goto d4QC4; prFXs: if (!($ordertype == 1 || $ordertype == 3)) { goto SK_1B; } goto egu8s; lhsUA: SK_1B: goto MzKCQ; egu8s: $list[$k]['good_num'] = 1; goto lhsUA; MzKCQ: $list[$k]['pic'] = explode(',', $v['logo']); goto lMd71; d4QC4: } goto fqT5y; abKiy: if ($ordertype == 2) { goto HpuHz; } goto WzcaV; kmbkE: goto yvTjd; goto fY5J_; W5uTw: $uid = intval($_GPC['uid']); goto juudx; juudx: $ordertype = intval($_GPC['ordertype']); goto Iwxhg; mLa1F: $uniacid = $_W['uniacid']; goto WVD7N; zr7p9: $d_set = pdo_get('ymktv_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto HtR5n; tX_dC: goto yvTjd; goto ort1l; CgGIC: $pageindex = max(1, intval($_GPC['page'])); goto B2RVI; B2RVI: $pagesize = 10; goto mLa1F; SKTQE: $where = ' where o.uniacid=\'' . $uniacid . '\' and os.ordertype=\'' . $ordertype . '\' '; goto i8u3z; B1QV_: yvTjd: goto q37mV; FTiaB: goto yvTjd; goto U4BqT; tfni3: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid ' . $where . ' order by o.id desc '); goto kmbkE; ort1l: sF_Ta: goto DeAMk; Oua3G: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_kjorder') . ' as o on o.id=os.order_id left join ' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid ' . $where . ' order by o.id desc '); goto B1QV_; i8u3z: if ($uid > 0) { goto FMs4P; } goto RCTf0; WzcaV: if ($ordertype == 3) { goto n3mL1; } goto tX_dC; fY5J_: n3mL1: goto CtWfA; WVD7N: $status = array("未服务", "已服务"); goto SKTQE; jS0nc: $pager = pagination($total, $pageindex, $pagesize); goto zr7p9; HtR5n: include $this->template('web/distribution_order'); goto Q2mSc; DAoG9: if ($ordertype == 1) { goto sF_Ta; } goto abKiy; Iwxhg: $ordertype = $ordertype > 0 ? $ordertype : 1; goto CgGIC; g1nUz: YRbVH: goto DAoG9; CtWfA: $sql = 'select o.state as status,u.name,u.img as uthumb,o.order_num,o.price as money,o.id,b.gname as pname,b.pic as logo,os.first_price,os.second_price,os.third_price from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_kjorder') . ' as o on o.id=os.order_id left join 
			' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid left join ' . tablename('ymktv_sun_new_bargain') . ' as b on b.id=o.gid' . $where . ' order by o.id desc '; goto Oua3G; U4BqT: HpuHz: goto FwB0s; FwB0s: $sql = 'select o.status,u.name,u.img as uthumb,o.order_num,o.good_num,o.money,o.id,o.good_name as pname,o.good_imgs as logo,os.first_price,os.second_price,os.third_price from ' . tablename('ymktv_sun_distribution_order') . ' as os left join ' . tablename('ymktv_sun_order') . ' as o on o.id=os.order_id left join 
			' . tablename('ymktv_sun_user') . ' as u on u.openid=os.openid ' . $where . ' order by o.id desc '; goto tfni3; q5iUL: FMs4P: goto tcHgh; L2kFh: $list = pdo_fetchall($select_sql, $data); goto aKjII; q37mV: $select_sql = $sql . ' LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto L2kFh; tcHgh: $where .= ' AND (os.parent_id_1=\'' . $uid . '\' or os.parent_id_2=\'' . $uid . '\' or os.parent_id_3=\'' . $uid . '\') AND os.parent_id_1>0 '; goto g1nUz; gQEoR: goto YRbVH; goto q5iUL; Q2mSc: } public function doWebSetStatus() { goto hh4cR; bNF43: if (!($ress['addtime'] >= $sevenday)) { goto nOwi9; } goto CrFT_; CrFT_: $haveformid = $ress['form_id']; goto jAer_; Opsvm: message('失败!', $this->createWebUrl('distributor'), 'error'); goto On6J_; kb4ZX: $uniacid = $_W['uniacid']; goto WNheV; tpahB: $status = array("审核中", "已通过", "被拒绝"); goto jq7y7; rhWtQ: $data['status'] = $status; goto aP3O0; WNheV: $status = intval($_GPC['status']); goto rMne9; ciQtJ: if ($res) { goto cpr_G; } goto Opsvm; aP3O0: $res = pdo_update('ymktv_sun_distribution_promoter', $data, array("uniacid" => $_W['uniacid'], "id" => $id)); goto ciQtJ; On6J_: goto DUy7r; goto VDbuh; jAer_: nOwi9: goto AW7ND; AW7ND: $tpldata = array(); goto d0YhN; x4dL6: message('成功!', $this->createWebUrl('distributor'), 'success'); goto jCSHI; hh4cR: global $_GPC, $_W; goto kb4ZX; jCSHI: DUy7r: goto L8gkD; jq7y7: $sevenday = strtotime('-7 days'); goto bNF43; d0YhN: $tpldata['status'] = $status[$ress['status']]; goto GmPs7; rMne9: $id = intval($_GPC['id']); goto D76mB; D76mB: $data = array(); goto rhWtQ; r4XiO: $ress = pdo_get('ymktv_sun_distribution_promoter', array("uniacid" => $_W['uniacid'], "id" => $id)); goto tpahB; VDbuh: cpr_G: goto r4XiO; GmPs7: sendtelmessage($ress['openid'], 'tpl_share_check', $haveformid, $tpldata); goto x4dL6; L8gkD: } public function doWebDeleteDistributor() { goto FwPvH; yRVuf: $delres = pdo_delete('ymktv_sun_distribution_promoter', array("uniacid" => $uniacid, "id" => $id)); goto V1mvH; miqAD: Qqgx0: goto xq8jB; V1mvH: if ($delres) { goto eWadJ; } goto UrUgs; FwPvH: global $_GPC, $_W; goto qfgZ3; JF5Sp: goto Qqgx0; goto Dn_Fr; Dn_Fr: eWadJ: goto JaNLk; JaNLk: message('成功!', $this->createWebUrl('distributor'), 'success'); goto miqAD; qfgZ3: $uniacid = $_W['uniacid']; goto jkEFz; UrUgs: message('失败!', $this->createWebUrl('distributor'), 'error'); goto JF5Sp; jkEFz: $id = intval($_GPC['id']); goto yRVuf; xq8jB: } } ?>