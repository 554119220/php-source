{template 'header'}
<body class="mui-ios mui-ios-11 mui-ios-11-0 mui-backdrop-none" style="overflow:hidden;"><style type="text/css">
.mui-bar-tab~.mui-content{padding-bottom:0;}
.mui-content .mui-control-content{ height: 100%;}
.mui-content .mui-card:first-child{ margin-top:0;}
.mui-bar-nav,.mui-segmented-control.mui-scroll-wrapper,.mui-segmented-control.mui-scroll-wrapper .mui-scroll{ height:1.7rem;}
.mui-bar-nav .mui-segmented-control.mui-scroll-wrapper{height:1.7rem;padding-right:20%;}
.mui-bar-nav~.mui-content{padding-top:3.6rem;}
.mui-bar-nav~.mui-content .mui-card:first-child{ margin-top:0;}
.mui-bar-nav .mui-segmented-control .mui-control-item{font-size:.6rem;margin-left:0.4rem;margin-right: 0.5rem;line-height:1.75rem;border-bottom:none!important;}
.mui-bar-nav .mui-segmented-control .mui-control-item.mui-active{color:#FF7B33!important;border-bottom:none!important;}
.mui-bar-nav .mui-segmented-control .mui-slider-progress-ext{ bottom:0.5px; top:auto;}
.mui-bar-nav .mui-segmented-control .mui-tab-more{position:absolute;right:0;top:0.1rem;height:1.3rem;overflow: hidden;margin-top:5px;width:10%;background: #fff;box-shadow: rgba(255,255,255,0.85) -15px 0px 8px;z-index:10;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-table-view{height:100%;width:100%;display:table;table-layout:auto;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-table-view:after{ height:0;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-collapse{display:table-cell;vertical-align: middle;padding: inherit;width:100%;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-collapse a{ background:none;color:#fff;font-size:12px;line-height:2;width:100%; height:100%;margin:0;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-collapse a:after{right:10px;font-size: 13px;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-collapse.mui-active{background:none;}
.mui-bar-nav .mui-segmented-control .mui-tab-more .mui-collapse.mui-active a:after{color:#FF7B33}
.mui-bar-nav .mui-search .mui-placeholder{line-height:30px;}
.mui-bar-nav .mui-search .mui-placeholder .mui-icon{ padding:5px 10px;}
.mui-bar-nav .mui-slider-indicator:before{content: '';position: absolute;left: 0;right: auto;top:0;height: 1px;width: 100%;background-color:#e0e0e0;display: block;z-index: 15;-webkit-transform: scaleY(.5);transform: scaleY(.5);-webkit-transform-origin: 0 100%;transform-origin: 0 100%;}
.mui-search input[type=search]{padding-right:15px;}
.mui-popover .mui-popover-header a{ color:#969696;position:absolute;z-index:1;display:block;right:-10px;top:50%;-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);}
.mui-popover .mui-popover-header a me{ font-size:30px;}
.mui-popover .mui-popover-content{height:100%;}
.mui-popover-top{width:100%!important;border-radius:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0);-webkit-box-shadow:none;box-shadow:none;-webkit-transition:-webkit-transform .3s,opacity .3s;transition:transform .3s,opacity .3s;}
.mui-popover-top.mui-active{position:fixed;-webkit-transform:translate3d(0,0,0);transform: translate3d(0,0,0);}

.selector-control{ z-index:100; position:relative; height:1.71rem; overflow:hidden; background:#fdfdfd;}
.selector-control .mui-table-view{ background:#fdfdfd; margin-top:0; display:table;width:100%;table-layout: fixed;height: 1.7rem;}
.selector-control .mui-table-view-cell.mui-collapse{ overflow:visible;vertical-align: middle; padding:0;width:100%; text-align:center;display:table-cell!important;}
.selector-control .mui-table-view-cell.mui-collapse a{ line-height:3.5;font-size:0.5rem;}
.selector-control .mui-table-view-cell.mui-collapse.mui-active{ background:#fdfdfd; color:#FF7B33}
.selector-control .mui-table-view-cell.mui-collapse a.mui-active{ background:none; color:#FF7B33}
.selector-control .mui-table-view-cell.mui-collapse a:after{ right:inherit;content: ""!important; width: 0;height: 0;border-top: .2rem solid #bbb;border-left: .18rem solid transparent;border-right: .18rem solid transparent;border-bottom: 0;margin-left: .18rem;}
.selector-control .mui-table-view-cell.mui-collapse.mui-active a:after{ color:#FF7B33;border-top: 0;border-left: .18rem solid transparent;border-right: .18rem solid transparent;border-bottom: .2rem solid #FF7B33;margin-bottom: 0;}
.mui-refresh.mui-table-view:after{height:1px!important;}
.mui-refresh .mui-navigate-right:after{ content:'\e565'; font-size:20px;}

.selector-content{left:0;right:0;box-shadow:none;max-height:75%;width:100%; background:#FFF;}
.selector-content .selector-content-item{display:none;position:relative; height:100%;}
.selector-content .mui-table-view-cell a{ padding-left:30px; font-size:14px; line-height:1.5;}
.selector-content .mui-table-view-cell:after{ left:0;}
.selector-content .mui-table-view-cell.mui-selected{ color:#FF7B33;}
.selector-content .mui-table-view-cell.mui-selected a:before{ content: '\e472';left: 5px; font-size: 24px;}
.selector-content .selector-content-item ul:after{height:1px;}
.mui-scroll-container{ height:70px;overflow: hidden; margin-bottom:5px;}
.mui-scroll-container.onlyone{height:auto;}
.mui-scroll-control{ min-height:105px;text-align:left;white-space:nowrap;position:relative;overflow:hidden;overflow-x:scroll;}
.mui-scroll-control .scroll-control-item{ text-align:left;margin-left:2%; overflow:hidden; position:relative; height:70px; width:32%; display:inline-block;}
.mui-scroll-control .scroll-control-item:first-child{ margin-left:0;}
.mui-scroll-control .scroll-control-item img{position: relative;top: 0;left:50%;-webkit-transform: translateX(-50%);transform: translateX(-50%); min-height:3rem!important;display: block;}
.mui-scroll-control .mui-col-xs-12{width:100%!important;height:auto!important; position:relative}
.mui-scroll-control .mui-col-xs-12.scroll-control-item{border-radius:0.2rem; overflow:hidden;}
.mui-scroll-control .mui-col-xs-12.scroll-control-item img{height: auto; width:100%!important;left:0;-webkit-transform: translateX(0);transform: translateX(0%);}
.mui-scroll-container.onlyone .mui-scroll-control{overflow:hidden;}
.mui-blur .mui-content, .mui-blur .mui-bar, .mui-blur .subscribe{filter: url(blur.svg#blur);-webkit-filter: blur(10px);-moz-filter: blur(10px);-ms-filter: blur(10px);filter: blur(10px);filter: progid:DXImageTransform.Microsoft.Blur(PixelRadius=10, MakeShadow=false);}
.mui-card.mui-one{box-shadow:none}
.mui-card.mui-one .mui-card-header .mui-media-body i.mui-badge{right:-10px;border-radius: 100px 0 0 100px;}
.mui-card-content-inner{padding:0.5rem}
.mui-card.mui-one .mui-fee-bar p{margin:0}
.mui-card.mui-one .mui-fee-bar .mui-badge{border-radius:0.15rem;line-height:1.2;padding:0.15rem 0.3rem;font-size:0.5rem;}
.mui-card.mui-one .mui-fee-bar .mui-pull-left .mui-badge{padding:0;}
.mui-card.mui-one .mui-fee-bar .mui-pull-left .mui-badge:nth-child(2){border:solid 1px #ff4768;}
.mui-card.mui-one .mui-fee-bar .mui-pull-left .mui-badge:nth-child(2) em{background:#FFF;border-radius:0 0.15rem 0.15rem 0;color:#ff4768;display:inline-block;padding:2px;}
.search-row-item{display:table-cell;position:relative;vertical-align:middle;}
.search-row-item.first{min-width:35px;max-width:85px;padding-right:20px;padding-top:3px;}
.search-row-item.first .mui-navigate-right:after{content:'\e581';right:6px;font-weight:bold;color:#333;}
.search-row-item.last{width:38px;text-align:right; padding-top:3px;}
#mui_screen{ width:80%;left:auto;right:0;}
#mui_screen .mui-popover-content{padding-bottom:45px;}
#mui_screen .mui-btn-group{height:45px;overflow:hidden;background:#fafafa;margin-top:-40px;position:relative;z-index:15;}
#mui_screen .mui-btn-group .mui-btn{width:50%;height:45px;border-radius:0;}

.mui-table-view.mui-group-btn{margin:0; padding-left:10px!important;}
.mui-table-view.mui-group-btn,.mui-table-view.mui-group-btn .mui-table-view-cell{border-radius:0!important;}
.mui-table-view.mui-group-btn .mui-table-view-cell{float:left;text-align:center;width:28%; margin-right:5%;padding:3px 0!important; margin-bottom:3px;}
.mui-table-view.mui-group-btn .mui-table-view-cell:after{height:0!important;}
.mui-table-view.mui-group-btn .mui-table-view-cell a{background:#fff!important;margin:0!important;border-radius:5px!important;color:#333;line-height:2; font-size:12px;font-family: "Microsoft Yahei","微软雅黑",Arial,"Hiragino Sans GB","宋体","Helvetica Neue",Helvetica,sans-serif;}
.mui-table-view.mui-group-btn .mui-table-view-cell a:after{content:" ";width:199%;height:200%;position: absolute;top: 0;left: 0;border: 1px solid #aaa;box-sizing: border-box;border-radius:10px;-webkit-transform: scale(0.5);transform: scale(0.5);-webkit-transform-origin: 0 0;transform-origin: 0 0;}
.mui-table-view.mui-group-btn .mui-table-view-cell.mui-selected a{color:#ff6f02;}
.mui-table-view.mui-group-btn .mui-table-view-cell.mui-selected a:after{border:1px solid #ff6f02;}
#angle{width:4rem;height:4rem;color:#fff;transform:rotate(-45deg);-ms-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-webkit-transform:rotate(-45deg);-o-transform:rotate(-45deg);position: absolute;z-index:1;left: -2.4rem;top: -2.4rem;}
#angle em{position:absolute;bottom:0.21rem;left:1.4rem;font-size:0.4rem; line-height:1}
</style>
{template 'header1'}
<div class="mui-content" style="overflow:hidden;">
<div id="slider" class="mui-slider" style="height:100%" data-slider="6">
    <header class="mui-bar mui-bar-nav" style="height:auto;z-index:1000;">
        <div class="mui-input-row mui-search" style=" margin:0 auto; width:95%;padding:0.2rem 0;display:table;table-layout:auto;">
            <div class="search-row-item js-popover" data-popover="mui_search">
                <input type="search" class="mui-input-clear" placeholder="" data-input-clear="1" data-input-search="1" value="{$title}">
                <span class="mui-icon mui-icon-clear mui-hidden"></span>
                {if $title}
                <span class="mui-placeholder" style="text-align:left;"><span class="mui-icon" style="margin-left:3px;margin-top: 9px;"></span><i class="fa fa-search" aria-hidden="true"></i></span>
                {else}
                <span class="mui-placeholder"><span class="mui-icon"></span><i class="fa fa-search" aria-hidden="true"></i><span>搜索您喜欢的活动</span></span>
                {/if}
            </div>


           <!--  <div class="search-row-item last js-popover" data-popover="mui_screen">筛选</div> -->
        </div>
        <div id="category" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="font-size:0;" data-scroll="3">
            <div class="mui-scroll" style="transform: translate3d(0px, 0px, 0px) translateZ(0px); transition-timing-function: cubic-bezier(0.1, 0.57, 0.1, 1); transition-duration: 0ms;">
                <a class="control-item" href="{php echo $this->createMobileUrl('activity_category');}" data-pid="0" data-cid="0" data-key="0" style="font-size: .6rem;margin-left: 0.4rem;margin-right: 0.5rem;line-height: 1.75rem;border-bottom: none!important;{if $category_id==$item['id']}color: #FF7B33!important;border-bottom: none!important;{/if}">全部</a>
                {loop $category $key $item}
                <a class="control-item" href="{php echo $this->createMobileUrl('activity_category', array('category_id'=>$item['id']));}" data-key="{$item['id']}" style="font-size: .6rem;margin-left: 0.4rem;margin-right: 0.5rem;line-height: 1.75rem;border-bottom: none!important;{if $category_id==$item['id']}color: #FF7B33!important;border-bottom: none!important;{/if}">{$item['category_name']}</a>
                {/loop}
            </div>
        </div>
    </header>
	<div class="mui-slider-group" style="height: 100%; padding-top: 3.24rem; transform: translate3d(0px, 0px, 0px) translateZ(0px); transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1); transition-duration: 0ms;">
        <div id="item0" class="mui-slider-item mui-control-content">
            <div class="mui-scroll-wrapper-ext" id="list-content">
            	<div class="mui-scroll-ext">
	                <div class="list-content">
	                	{loop $list $item}
	                	<a href="{php echo $this->createMobileUrl('activity_detail', array('id'=>$item['id']));}">
		                	<div class="mui-card mui-one">
		                		<div class="mui-card-content mui-after-no">
		                			<div class="mui-card-content-inner">
		                				<div class="mui-scroll-container onlyone">
		                					<div class="mui-scroll-control">
		                						<div class="scroll-control-item mui-col-xs-12">
		                							{if $time<$item['baoming_e_time']}
			                						<div id="angle" style="background:#e53c4f;"><em>报名中</em>
			                						{else}
			                						<div id="angle" style="background:rgba(0,0,0,.15);"><em>已结束</em>
			                						{/if}
			                						</div>
		                							<img src="{$item['img']}">
		                						</div>
		                					</div>
			                			</div>
			                			<div class="mui-content-bar">
			                				<p style="color:#333;font-size:14px;" class="mui-ellipsis-2">
			                					<b>{$item['title']}</b>
			                				</p>
			                				<p class="mui-ext-icon"><i class='fa fa-clock-o' aria-hidden='true'></i>{php echo date('Y.m.d H:i',$item['baoming_e_time'])}结束报名</p>
			                				<p class="mui-ext-icon">{$item['joinnum']}人已报名 | 地址：{$item['address']}</p>
			                			</div>
			                			<div class="mui-fee-bar">
			                				<div class="mui-pull-left">
			                					<span class="mui-badge" style="background:none;color:#ff4768;padding-left:0;">
				                					<em class="mui-big">免费活动</em>
				                				</span>
			                				</div>
			                				{if $time<$item['baoming_e_time']}
			                				<div class="mui-pull-right"><span class="mui-badge mui-badge-yellow">立即报名</span>
			                				{else}
			                				<div class="mui-pull-right"><span class="mui-badge">报名结束</span>
			                				{/if}
			                				</div>
			                			</div>
		                			</div>
	                			</div>
	            			</div>
	        			</a>
	        			{/loop}
	        		</div>
        		<div class="dropload-down" style="display: none;"><div class="dropload-noData">全部数据加载完毕</div></div>
	        </div>
	    </div>
	</div>
</div>
</div>
</div>

<div id="mui_search" class="mui-popover mui-popover-left">
	<form action="" method="post" onsubmit="return check(this)" style="position: initial">
    <div class="mui-popover-header">
    	<div class="mui-input-row mui-search" style="margin:0;width:85%; background:none;">
            <input type="search" name="title" class="mui-input-clear" placeholder="输入感兴趣的活动名称" data-input-clear="1" data-input-search="1" value="">
            <span class="mui-icon"></span>
            <span class="mui-placeholder" style="margin-top:9px;"><span class="mui-icon"></span><i class="fa fa-search" aria-hidden="true"></i></span>
        </div>
        <a class="mui-pull-right mui-popover-close js-popover-close" data-popover="mui_search" style="right: -30px;padding: inherit;">取消&nbsp;</a>
    </div>
    </form>
    <div class="mui-popover-content">
        <div class="mui-scroll-wrapper" data-scroll="4">
            <div class="mui-scroll" style="transform: translate3d(0px, 0px, 0px) translateZ(0px);">
                <div class="mui-content-padded">
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/html" id="actlist">
<a href="{{d.go_url}}">
<div class="mui-card mui-one">
    <div class="mui-card-content mui-after-no">
        <div class="mui-card-content-inner">            
            <div class="mui-scroll-container onlyone">
                <div class="mui-scroll-control">{{d.tpl_atlas}}</div>
            </div>
			<div class="mui-content-bar">
				<p style="color:#333;font-size:14px;" class="mui-ellipsis-2">
				<b>{{d.title}}</b></p>
				<p class="mui-ext-icon"><i class='fa fa-clock-o' aria-hidden='true'></i> {{d.tpl_joinMsg}}</p>
				<p class="mui-ext-icon">{{d.joinnum+' 人已报名'}}|{{'地址：'+d.address}}</p>
				
			</div>
			<div class="mui-fee-bar">
				<div class="mui-pull-left"><span class="mui-badge" style="background:none;color:#ff4768;padding-left:0;">{{d.tpl_aprice}}</span>
								</div>
				<div class="mui-pull-right">{{d.tpl_joinBtn}}</div>
			</div>
        </div>
    </div>
</div>
</a>
</script>
<script>
var thispage = 1;
var category_id = {php echo $category_id;},
title = $(".search-row-item .mui-input-clear").val();
	//console.log(pricetype);
$('.mui-scroll-ext').dropload({
	scrollArea : $("#item0").find('.mui-scroll-wrapper-ext'),
	threshold : 6 * htmlFont,
	loadDownFn : function(me){
		mui.getJSON("{php echo $this->createMobileUrl('activity_category', array('op'=>'ajax_activity_category'));}",{page:thispage+1,category_id:category_id,title:title},
			function(data){
				
			var stime = new Date(),result='';
			if (data.total == 0){
				result = '<div class="no-orders-at-all">'
				+'<div class="head-block">'
				+'    <div class="blank-icon mui-ext-icon mui-icon-mhuodong"></div>'
				+'    <p class="hint">当前没有任何信息</p>'
				+'    <p class="recommend-hint"></p>'
				+'</div></div>';
				$('#list-content').append(result);
			}
			if (thispage >= data.tpage || data.tpage == 0){
				me.lock();// 锁定
				me.noData();// 无数据
			}
			for(var i = 0; i < data.list.length; i++){
				var id = data.list[i].id;
				data.list[i].go_url = "{php echo $this->createMobileUrl('activity_detail');}&id="+id;
				joinstime = new Date(data.list[i].baoming_c_time.replace("-", "/").replace("-", "/"));
				joinetime = new Date(data.list[i].baoming_e_time.replace("-", "/").replace("-", "/"));
				starttime = new Date(data.list[i].c_time.replace("-", "/").replace("-", "/"));
				endtime   = new Date(data.list[i].e_time.replace("-", "/").replace("-", "/"));
				var joinnum = parseInt(data.list[i].joinnum),
					gnum  = parseInt(data.list[i].join_num),
					tpl_gnum  = parseInt(data.list[i].tpl_gnum),
					address  = parseInt(data.list[i].address);
					strangle = '';
				if (stime > endtime){
					data.list[i].tpl_joinBtn = '<span class="mui-badge">活动结束</span>'
					strangle = '<div id="angle" style="background:#b6b6b6;"><em>已结束</em></div>';
				}else{
					if (stime < starttime){
						data.list[i].tpl_joinBtn = '<span class="mui-badge">活动未开始</span>'
					}else{
						data.list[i].tpl_joinBtn = '<span class="mui-badge">立即报名</span>'
						strangle = '<div id="angle" style="background:#ffbb12;"><em>进行中</em></div>';
					}
											
					if (joinnum >= gnum && tpl_gnum > 0){
						data.list[i].tpl_joinBtn = '<span class="mui-badge mui-badge-danger mui-pull-right">名额已满</span>'
						strangle = '<div id="angle" style="background:#ffbb12;"><em>进行中</em></div>';
					}else{
						data.list[i].tpl_joinBtn = joinstime > stime ? '<span class="mui-badge mui-badge-danger">'+'查看详情</span>' : (stime>joinetime ? '<span class="mui-badge">报名结束</span>': '<span class="mui-badge mui-badge-yellow">立即报名</span>');
						strangle = joinstime > stime ? '<div id="angle" style="background:#ffbb12;"><em>预热中</em></div>':(stime>joinetime ? '<div id="angle" style="background:#b6b6b6;"><em>已截止</em></div>': '<div id="angle" style="background:#e53c4f;"><em>报名中</em></div>');
					}						
				}

				data.list[i].tpl_joinMsg = data.list[i].new_baoming_e_time+'结束报名';

				data.list[i].tpl_atlas ='<div class="scroll-control-item mui-col-xs-12">' + strangle + '<img src="'+data.list[i].img+'"></div>';
				data.list[i].tpl_aprice = '<em class="mui-big">免费活动</em>';
				
				var gettpl = document.getElementById('actlist').innerHTML;
				laytpl(gettpl).render(data.list[i], function(html){
					$("#item0").find('.list-content').append(html);
				});
			}
			
			//$(id).find('.list-content').append(result);
			thispage++;
			// 每次数据加载完，必须重置
			me.resetload();
		});
	}
});

$(".js-popover-close").on("click", function(e) {
	mui("#mui_search").popover('toggle');
})
$(".js-popover").on("click", function(e) {
		$("body").removeClass('mui-backdrop-top');
		var popover = "#"+$(this).data("popover");
		mui(popover).popover('toggle');
		if (popover == '#mui_search') {
			var t = '';
			if (util.ios()){
				$("input[name='keyword']").focus().val(t);
			}else{

				setTimeout(function(){$("input[name='keyword']").focus().val(t);}, 520);
			}
		}
	});


function check(form){
	if ($.trim(form['keyword'].value) == '') {
		util.tips('关键词不能为空');
		return false;
	}else{
		form['keyword'].blur();
		return true;
	}
	return false;
}
</script>
<script>;</script>
<!-- <script type="text/javascript" src="{php echo $this->createMobileUrl('activity_list', array('op'=>'ajax_activity_category'));}"></script> -->
</body></html>