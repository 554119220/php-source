{template 'header'}
<body class="mui-ios mui-ios-11 mui-ios-11-0">
<link rel="stylesheet" type="text/css" href="{MODULE_URL}template/mobile/style/css/detail.css?v=201801148">
<style type="text/css">
.latecolor{color:#ff9900}
.latecolorbg{background-color:#ff9900}
.lateborder{border:1px solid#ff9900}
.addressXX{color:#000;line-height:22px}
.tag{padding:10px;background: -webkit-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);background: -moz-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);background: -o-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);background: linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);position: absolute;bottom:0; z-index:10; height:40px;left: 0;right: 0;}
.tag span{font-size:14px;line-height:1.5;text-align:left;color:#fff;}
.box-float{ display:none;}
.basic-box .mui-navigate-left{color:#828282;}
.basic-box .mui-navigate-left p{color:#828282; margin:0;}
.mui-detail{text-align:justify}
.mui-detail .mui-card-header span{ display:block; position:relative; color:#666666; font-size:15px; line-height:1.5}
.mui-detail .mui-card-header span:before{position: absolute;content: ""; height:100%!important;left:0;top:0;width:4px; background-color:#ff8208;}
.mui-detail .mui-card-content p{margin-bottom:0px; margin-top:10px;}
.mui-detail .mui-card-content p:first-child{margin:0;}
.mui-detail .mui-card-content img{margin: 0!important;max-width: 100%;height: auto!important;vertical-align: bottom;font-size: 0;}
.mui-detail .mui-card-content ul,.mui-detail .mui-card-content ol{padding-left: 15px;line-height:1.5;color:#7f7f7f; margin:0;}
.mui-detail .mui-card-footer{text-align:center;font-size:12px;}
.mui-detail .mui-card-footer.js-show{-webkit-box-shadow:0 -20px 30px #fff;box-shadow:0px -25px 30px #FFF;-webkit-backface-visibility: hidden;backface-visibility: hidden;}
.mui-detail .mui-card-footer.js-show .mui-ext-icon:after{content: "\e662";font-size:10px;}
.mui-detail .mui-card-footer.js-hide .mui-ext-icon:after{content: "\e663";font-size:10px;}
.mui-detail .mui-card-footer.js-hide{box-shadow:none;}
.mui-table-box{display:table;table-layout:auto;width:100%;}
.mui-table-box .mui-table-item{display:table-cell;vertical-align:middle;}
.mui-table-box.mui-time{height:40px;border-radius:3px;padding:1px;margin-bottom:10px;}
.mui-table-box.mui-time .mui-table-item:first-child{width:70px;background:#fff;border-radius:3px 0 0 3px;text-align:center;position:relative}
.mui-table-box.mui-time .mui-table-item:nth-child(2){border-bottom:38px solid #fff;border-left:0;border-right:10px solid transparent;}
.mui-table-box.mui-time .mui-table-item .arrow{display:block;width:14px;height:14px;font-size:14px;overflow:hidden;position:absolute;left:10px;}
.mui-table-box.mui-time .mui-table-item em.arrow{top:-10px;color:#FF7B33;font-style:normal;}
.mui-table-box.mui-time .mui-table-item span.arrow{top:-9px;color:white;}
.mui-table-box.mui-time.wait-countdown{background:#07cbb7}
.mui-table-box.mui-time.wait-countdown .mui-table-item em.arrow{color:#07cbb7;}
.mui-table-box.mui-time.wait-countdown .mui-table-item.countdown .clockrun span{color:#12bfa1!important;}
.mui-card-view .mui-media-body{color:#a6742b}
.mui-card-view .mui-navigate-right:after{ color:#FFF; font-size:16px;right:2px;}
.mui-card-view .mui-table-view-cell.mui-media{border-radius:0!important;}
.pricebar>.mui-card .mui-card-header h5{color:#333333;line-height:1.3;font-weight:800;}
.pricebar>.mui-card .mui-card-footer{min-height:25px;padding:10px;}
.pricebar>.mui-card .mui-card-footer span{ color:#828282;}
.mui-card-media .mui-table-view:after{height:1px!important;}
.mui-card-media .mui-table-view a.mui-active{background:#fff;}
.mui-card.mui-one{box-shadow:none;}
.mui-card.mui-one .mui-card-footer .mui-footer-item{ margin-right:10px;}
.mui-bar .mui-btn-outlined{ border:none!important;}

.mui-card.mui-two .mui-card-header{ position:relative;}
.mui-card.mui-two .mui-card-header{ background:none;}
.mui-card.mui-two .mui-card-header img:first-child{ width: 36px!important;height: 36px!important;border-radius:5px;}
.mui-card.mui-two .mui-card-header .mui-media-body{ height:36px; font-size:13px; line-height:1.8!important;overflow:hidden;margin-left:48px;}
.mui-card.mui-two .mui-card-header .mui-media-body>span{ overflow:hidden; position:relative;}
.mui-card.mui-two .mui-card-header .mui-media-body i.mui-badge{ right:0; padding-top:4px;}
.mui-card.mui-two .mui-card-header .mui-media-body i.mui-badge-orange{ background:#fff!important; color:#ff6f02!important;padding-top:6px; padding-bottom:5px;}
.mui-card.mui-two .mui-card-header .mui-media-body i.mui-badge-orange:after{content: " ";width: 200%;height: 200%;position: absolute;top: 0;left: 0;border: 1px solid #ff6f02;box-sizing: border-box;border-radius: 100px;-webkit-transform: scale(0.5);transform: scale(0.5);-webkit-transform-origin: 0 0;transform-origin: 0 0;}
.mui-card.mui-two .mui-card-header .mui-icon-renzheng3{ width:15px; height:15px;font-size:12px;line-height:15px; text-align:center;position:absolute; top:35px;left:35px;background:#fff;border-radius: 100%; z-index:999}
.mui-card.mui-two .mui-card-header .mui-icon-renzheng3:after{ color:#ff6d1f;}
.mui-card.mui-two .mui-card-content{ margin:0 10px;}
.mui-card.mui-two .mui-card-content:after{ height:0px;}
.mui-card.mui-two .mui-card-content-inner{background:#f7f7f7; padding:10px;border-radius: 10px; margin-bottom:10px;}
.mui-card.mui-two .mui-card-content-inner p.mui-small{ font-size:80%!important;line-height:1.5}
.mui-card.mui-two .mui-card-footer a.mui-badge{font-size:13px;padding:0 10px;padding-top:6px; padding-bottom:5px;}
.mui-card.mui-two .mui-card-footer span:nth-child(3){position:relative}
.mui-card.mui-two .mui-card-footer span:nth-child(3):after{content: " ";position: absolute;border-right: 1px solid #d3d3d3;top: 50%;height: 120%;-webkit-transform: scaleX(0.5) translateY(-50%);transform: scaleX(0.5) translateY(-50%);-webkit-transform-origin: 0 100%;transform-origin: 0 100%;}
.mui-card.mui-three .mui-card-content:after{ height:0;}
.mui-card.mui-three .mui-media .mui-media-body .mui-ext-icon:before{color:#9c9c9c;top:48%;}
.mui-card.mui-three .mui-media .mui-tel{ position:absolute; width:45px; height:100%; top:0px; right:0px; z-index:999; margin:0;}
.mui-card.mui-three .mui-media-body{ position:relative; overflow:initial;min-height:26px;display:table; width:100%;}
.mui-card.mui-three .mui-media-body .mui-media-content-inner{vertical-align: middle;display: table-cell;}
.mui-card-footer .mui-ext-icon:before{font-size:12px;}

.mui-media .mui-media-header .mui-badge,.mui-index .mui-table-view .mui-badge{border-radius: 3px;padding:3px;}
.mui-media.location-phone .mui-media-body .mui-ext-icon{line-height:1.3;position:relative;}
.mui-media.location-phone .mui-navigate-right:after{line-height:2;color:#11c0a3; font-size:25px;}
.mui-media.location-phone .mui-media-body:after{content: " ";position: absolute;border-right: 1px solid #e5e5e5;top: 0px;right: -10px;height: 100%;-webkit-transform: scaleX(0.5);transform: scaleX(0.5); }
.market-box.mui-table-view{font-size:11px;}
.market-box.mui-table-view:before{left:14px;}
.market-box.mui-table-view .mui-table-view-cell{background:#fafafa;padding:9px 12px;}
.market-box span.mui-badge-orange.mui-badge-outlined{padding:1px 5px;font-size:11px;position:relative;}
.market-box span.mui-badge-orange.mui-badge-outlined:before{border-radius:10px;}
.market-box span.mui-badge-orange.mui-badge-outlined~span{padding-left:0.1rem;}

.join-none{background:rgba(0, 0, 0, 0.75);box-shadow:none;-webkit-box-shadow:none;}
.join-none .mui-btn{background:none!important;border:none!important; color:#fff}
.mui-icon-location-fill:after{content: '\e333';}
footer.mui-bar.mui-bar-tab,footer.mui-bar.mui-bar-tab .mui-tab-item{height:45px!important;}
footer.mui-bar.mui-bar-tab .mui-tab-item{color:#333333;}
footer.mui-bar.mui-bar-tab .mui-tab-item .mui-icon{width:20px;height:20px;top:0px;}
footer.mui-bar.mui-bar-tab .mui-ext-icon:before{font-size:16px;color:#929292}
footer.mui-bar.mui-bar-tab .mui-active.mui-ext-icon:before{color:#ff5100;}
footer.mui-bar.mui-bar-tab .mui-btn{font-size:14px!important;top:0px!important;height:45px;line-height:36px!important;border-radius:0!important;}
footer.mui-bar.mui-bar-tab .mui-gradient-orange{background:-webkit-linear-gradient(left, rgba(255,202,0,1) 0%, rgba(255,148,2,1) 100%);background:-moz-linear-gradient(left, rgba(255,202,0,1) 0%, rgba(255,148,2,1) 100%);background:-o-linear-gradient(left, rgba(255,202,0,1) 0%, rgba(255,148,2,1) 100%);background:linear-gradient(left, rgba(255,202,0,1) 0%, rgba(255,148,2,1) 100%);color:#fff!important}
footer.mui-bar.mui-bar-tab .mui-gradient-danger{background:-webkit-linear-gradient(left, rgba(255,148,0,1) 0%, rgba(255,51,84,1) 100%);background:-moz-linear-gradient(left, rgba(255,110,1,1) 0%, rgba(252,75,85,1) 100%);background:-o-linear-gradient(left, rgba(255,110,1,1) 0%, rgba(252,75,85,1) 100%);background:linear-gradient(left, rgba(255,110,1,1) 0%, rgba(252,75,85,1) 100%);color:#fff!important}
  .mui-pl20{padding-left:1px!important}
</style>
{template 'detail_footer'}                                                                                                               
                            

<div class="mui-content">
<div class="mui-scroll-ext">
    <div class="mui-slider">
        <div class="mui-slider-group mui-slider-loop" style="transform: translate3d(-375px, 0px, 0px) translateZ(0px);">
            <!--支持循环，需要重复图片节点-->
	        <div class="mui-slider-item mui-slider-item-duplicate" style="width:auto;height:auto;">
	        	<img src="{php echo tomedia($detail['img'])}">
	        </div>
        </div>
    </div>
        <div class="pricebar" id="J_PriceBar">
       		<div class="mui-card mui-one" style="margin:0;">
        		<div class="mui-card-header mui-card-media" style="padding-bottom:0;">
                	<h5 class="mui-ellipsis-2">{$detail['title']}</h5>
            	</div>
            	<div class="mui-card-content mui-afterbefore-no">
            		<div class="mui-card-content-inner">
                    	<div class="mui-table-box" style=" height:45px;">
                        	<div class="mui-table-item mui-text-orange" style="font-size:20px;">
                                <span class="mui-small">免费活动</span>
							</div>
                        	<div class="mui-table-item mui-text-gray" style="vertical-align:bottom;text-align:right;line-height:2.7">
                        		已报名<span class="mui-text-yellow">{if $sum==0}0{else}{$sum}{/if}</span>人
                        	</div>
                    	</div>
                        <div class="mui-table-box mui-time mui-gradient-danger js-countdown">
	                    	<div class="mui-table-item">
	                        	<em class="arrow">◆</em>
	                            <span class="arrow">◆</span>
	                        	<span class="mui-text-orange" style="margin-top:3px;display:inline-block;font-size:16px;padding-left:5px">
	                            赶快报名</span>
	                        </div>
	                        <div class="mui-table-item"></div>
	                        <div class="mui-table-item countdown" style="text-align:right;">
	                            <span class="txt" id="J_CountDownTxt">距报名结束仅剩余</span>
	                            <div class="clockrun mui-pull-right"><span id="ti_time_day">10</span> 天 <span id="ti_time_hour">00</span>:<span id="ti_time_min">44</span>:<span id="ti_time_sec">13</span></div>
	                        </div>
                    	</div>
                    </div>
            	</div>
	        </div>
	    </div>
        <div class="content">
        <!-- 基本信息 -->      
        <div class="mui-card mui-one mui-three" style="margin-bottom:0px;">
            <div class="mui-card-content">
                <ul class="mui-table-view mui-table-view-chevron">
                <li class="mui-table-view-cell mui-media" id="storesData">
					<a class="" data-popover="storelist">
                    	<div class="mui-media-body">
                        	<div class="mui-media-content-inner">
                                <p>活动地址<span class="store-num"></span></p>
                            </div>
                        </div>
					</a>
				</li>
                <li class="mui-table-view-cell mui-media">
					<a style="background:#fff;">
						<div class="mui-media-body">
                        	<div class="mui-media-content-inner">
                                <p>
                                    <span class="mui-pl20 mui-ellipsis-2 mui-text-gray"><img src="{MODULE_URL}template/mobile/style/images/dingwei.png" style="width:15px;">{$detail['address']}</span>
                                </p>
                            </div>

						</div>
					</a>
                </li>
                <li class="mui-table-view-cell mui-media location-phone" style="padding-right:12px;">
                    <a class="" style="background:#fff;">
                        <div class="mui-media-body">
                            <div class="mui-media-content-inner">
                                <p>
                                    <span class="mui-pl20 mui-ellipsis-2 mui-text-rmb"><img src="{MODULE_URL}template/mobile/style/images/shijian.png" style="width:15px;">{php echo date('Y年m月d日 H:i',$detail['c_time'])} 至 {php echo date('Y年m月d日 H:i',$detail['e_time'])}</span>
                                </p>
                            </div>
                        </div>
                    </a>
                </li>
				</ul>
            </div>
        </div>


        <div class="mui-card mui-one mui-three mui-detail" style="margin-top:10px;">
            <div class="mui-card-header mui-card-media" style="padding:0;">
                <ul class="mui-table-view">
                 	<li class="mui-table-view-cell"><a href="javascript:;"><p>活动简介</p></a></li>
                </ul>
            </div>
            <div class="mui-card-content">
            	<div class="mui-card-content-inner" style="padding:10px;" id="introduction">
                    
                </div>
            </div>
        </div>
        <div class="mui-card mui-one mui-three mui-detail" style="margin-top:10px;">
            <div class="mui-card-header mui-card-media" style="padding:0;">
                <ul class="mui-table-view">
                 	<li class="mui-table-view-cell"><a href="javascript:;"><p>报名须知</p></a></li>
                </ul>
            </div>
            <div class="mui-card-content">
            	<div class="mui-card-content-inner" style="padding:10px;" id="notice">
                   
                </div>
            </div>
        </div>
                <div class="mui-card mui-one mui-three mui-detail js-detail" style="margin-top:10px">
            <div class="mui-card-header mui-card-media" style="padding:0;">
                <ul class="mui-table-view">
                 	<li class="mui-table-view-cell"><a href="javascript:;"><p>活动详情</p></a></li>
                </ul>
            </div>
            <div class="mui-card-content" style="overflow: hidden; max-height: none;">
            	<div class="mui-card-content-inner" style="padding:10px;" id="details">
                	
                </div>
            </div>
        </div>
        {if $sum!='0'}
        <div class="M_detail" style="margin:0;">
            <ul class="mui-table-view mui-before-no" style="margin-top:10px">
                <li class="mui-table-view-cell">
                	<p>已报名({if $sum=='0'}0{else}{$sum}{/if})</p>
                </li>
            </ul>
            <div class="detail-item detail-more">
                {loop $join_num $key $item}
	            <div class="bm-user" style="width:50px;height: 80px;">
	                <img src="{$item['avatar']}">
	                <p class="mui-small mui-ellipsis mui-text-gray">{$item['nickname']}</p>
	            </div>
                {/loop}
            </div>
            
        </div>
        {/if}
        <div style="height:65px;"></div>
    </div>
</div>
</div>
<div id="cover"></div>
<style type="text/css">
.mui-popup-backdrop{z-index:1009!important;}
.marketing-popover{ background:#f7f7f7!important; height:80%;}
.marketing-popover .mui-popover-content{ height:85%;}
.marketing-popover .mui-scroll-wrapper{ margin-bottom:0;}
.marketing-popover .mui-table-view{text-align:left!important;color:rgb(102, 102, 102)!important;}
.marketing-popover .mui-table-view li{border-radius:0!important;}
.marketing-popover .mui-table-view li:last-child:after{ height:0;}
.marketing-popover .mui-table-view li.noselect{color:#333!important;background-color:#eaeaea!important;}
.marketing-popover .mui-table-view li a{border-radius:0!important;}
.marketing-popover .mui-input-group:before{ height:0;}
.marketing-popover .mui-input-row{ background:none!important;}
.marketing-popover .mui-input-row:last-child:after{ height:0;}
.marketing-popover .mui-input-row label{ float:left!important; line-height:1}
#marketing_1 span.mui-badge-orange.mui-badge-outlined{left:-10px;}
#marketing_1 span.mui-badge-orange.mui-badge-outlined:before{border-radius:100px;}
#marketing_1 span.mui-badge-orange.mui-badge-outlined~span{padding-left:0;}
#storelist .mui-table-view .mui-media-body{position:relative;width:100%;overflow:initial;}
#storelist .closesttome{display:none;}
</style>

<div class="mui-setting-content">
    <div id="detail" class="mui-popover mui-popover-left">
    <div class="mui-popover-header">报名资料<a href="#detail" class="mui-pull-right mui-popover-close"><i class="fa fa-times" aria-hidden="true"></i></a></div>
    <div class="mui-popover-content">
        <div class="mui-scroll-wrapper" data-scroll="1" style="overflow: visible;">
            <div class="mui-scroll" style="transform: translate3d(0px, 0px, 0px) translateZ(0px);">
                <ul class="mui-table-view">
                    {loop $detail['tpl_title'] $key $val}
                    <li class="mui-table-view-cell" data-type="" style="padding:3px 12px;line-height: 60px;">
                        <a>
                            <div>{$val}：
                                <span class="mui-badge mui-badge-inverted" data-type="{$detail['type'][$key]}">
                                    <input name="tpl_title" type="hidden" value="{$val}">
                                    {if $detail['type'][$key]=="input"}
                                    <input name="tpl_value" type="text" style="height: 37px;margin-top: 15px;">
                                    {else if $detail['type'][$key]=="checkbox"}
                                        {loop explode("|",$detail['tpl_type'][$key]) $k $v}
                                        <input type="checkbox" name="tpl_value" style="margin-left: 5px;" value="{$v}">{$v}
                                        {/loop}
                                    {else if $detail['type'][$key]=="radio"}
                                        {loop explode("|",$detail['tpl_type'][$key]) $k $v}
                                        <input type="radio" name="tpl_value" style="margin-left: 5px;" value="{$v}">{$v}
                                        {/loop}
                                    {/if}
                                </span>
                            </div>
                        </a>
                    </li>
                    {/loop}
                </ul>

                <ul class="mui-table-view">
                    <li class="mui-table-view-cell" style="text-align: center;">
                        <input id="sign_up" type="button" onclick="sign_up()" value="确认报名" style="background-color:green;color:#fff">
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
</div>
<script>
mui('.mui-bar-tab').on('tap','a',function(){
    var $this = $(this);
    if (this.getAttribute('href') != null) {
        location.href = this.getAttribute('href');
    } else {
        if ($(this).data('type')!=undefined){
            if ($(this).data('type')=='collection'){
                openFun.setProperty(this,{$detail['id']}, 'collection');
            }
        }
        return true;
    }
})



var container = isWeiXin();
var openFun = {
	setProperty:function(obj,id,op){/*收藏 */
        var favorite = parseInt($(obj).attr('data-favorite'));
		util.loading();
		$.post("{php echo $this->createMobileUrl('activity_detail', array('op'=>'collection'));}&status="+favorite+"&id="+id,function(d){
			util.loading().close();
			if (op=='collection'){
                console.log(d);
				if(d.result=='1'){
					util.tips(d.data?'收藏成功':'取消收藏');
					$(obj).attr("data-favorite",d.data);
					if (d.data){
						$('.js-favorite').removeClass("mui-active");
					}else{
						$('.js-favorite').addClass("mui-active");
					}
				}else if (d.result==2){
					if (container==true){
						util.confirm('还未注册，点击确认自动注册？', ' ', function(e) {
							if (e.index == 1) {
								location.href = "";
							}
						});
					}else{
						util.tips('需要在微信中打开');
					}
				}else{
					util.tips('收藏失败');
				}
			}
		},"json");
	}
}

function isWeiXin(){
    var ua = window.navigator.userAgent.toLowerCase();
    if(ua.match(/MicroMessenger/i) == 'micromessenger' || ua.match(/_SQ_/i) == '_sq_'){
        return true;
    }else{
        return false;
    }
}



//计时
var sh,joinstime = "{php echo date('Y-m-d H:i:s',$detail['baoming_c_time'])}",joinetime = "{php echo date('Y-m-d H:i:s',$detail['baoming_e_time'])}";
FreshTime(".clockrun",joinstime,joinetime);
sh=setInterval(function(){FreshTime(".clockrun",joinstime,joinetime)},1000);
var is_join = {php echo $is_join};
function FreshTime(id,starttime,endtime){
	var st = starttime.replace(/-/g,"/"),//开始时间
	    et = endtime.replace(/-/g,"/");//结束时间
		st = new Date(st);//开始时间
	    et = new Date(et);//结束时间
		console.log(st);
	var nowtime = new Date(),//当前时间
		start_time = parseInt(st.getTime()),
		end_time = parseInt(et.getTime()),
		now_time = parseInt(nowtime.getTime()),
		lefttime = -1; 
	if (start_time > now_time){
		lefttime = parseInt((start_time - now_time)/1000);
	}else if(end_time > now_time){
		lefttime = parseInt((end_time - now_time)/1000);
		//console.log(lefttime);
	}
	//var bar_width =  (1-(lefttime/3600))*100+"%"; //计算进度条百分比
	if (lefttime >= 0) {
		dd=util.pad(parseInt((lefttime/86400)),2);
		hh=util.pad(parseInt((lefttime/3600))-dd*24,2);
		mm=util.pad(parseInt((lefttime/60)%60),2);
		ss=util.pad(parseInt(lefttime%60),2);
		var clockrun ='<span id="ti_time_hour">'+hh+'</span>:<span id="ti_time_min">'+mm+'</span>:<span id="ti_time_sec">'+ss+'</span>';
		clockrun = dd!='00' ? '<span id="ti_time_day">'+dd+'</span> 天 ' + clockrun : clockrun;
		if (start_time > now_time){
			$('#J_CountDownTxt').text('距开始报名还有');
			$('.js-join').find('span.mui-btn').text('报名还未开始');
			$(id).html(clockrun);
		}else if(end_time > now_time){
			$('#J_CountDownTxt').text('距报名结束仅剩余');
            if(is_join==1){
                $('.js-join').removeClass('js-join1');
                $('.js-join').find('span.mui-btn').text('已报名，点击查看');
                $('.js-join').attr('href',"{php echo $this->createMobileUrl('my_sign_up');}");
            }else{
               $('.js-join').find('span.mui-btn').text('立即报名');
               $('.js-join').attr('href',"javascript:;");
            }
			
			$('.js-join').find('span.mui-btn').removeClass('mui-btn-default');
			$('.js-join').find('span.mui-btn').addClass('mui-gradient-danger');
			$(id).html(clockrun);
		}
		//$('#progressbar').css("width",bar_width);
	}else{
		$('.js-join').attr('href','javascript:;');
		$('.js-join').removeClass('js-selector');
        $('.js-join').removeClass('js-join1');
		$('.js-join').find('span.mui-btn').text('来晚了，报名已结束');
		$('.js-join').find('span.mui-btn').addClass('mui-btn-default');
		$('.js-join').find('span.mui-btn').addClass('mui-gradient-danger');
		$('.js-countdown').remove();
	}
}

document.getElementById("notice").innerHTML = escape2Html('{$detail["notice"]}');
document.getElementById("introduction").innerHTML = escape2Html('{$detail["introduction"]}');
document.getElementById("details").innerHTML = escape2Html('{$detail["details"]}');
 function escape2Html(str) {
    var arrEntities={'lt':'<','gt':'>','nbsp':' ','amp':'&','quot':'"'};
   return str.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(all,t){return arrEntities[t];});
}







$('body').delegate('.js-join1','tap', function(e) {
    mui("#detail").popover('toggle');
});

function sign_up(){
    var tpl_title = [];
    var tpl_value = [];
    var type;
    var sta = 1;
   $("input[name='tpl_title']").each(function(){
        tpl_title.push($(this).val());

        type = $(this).parent().attr("data-type");
        if(type=="input"){
            if($(this).next().val()==""){
                sta = 0;
            }else{
                tpl_value.push($(this).next().val());
            }
        }else if(type=="checkbox"){
            var str="";
            sta = 0;
            $(this).nextAll().each(function(){
                if($(this).is(":checked")){
                    str += $(this).val()+"|";
                    sta = 1;
                }
                
            });
            tpl_value.push(str);
        }else if(type=="radio"){
            sta = 0;
            $(this).nextAll().each(function(){
                if($(this).is(":checked")){
                    tpl_value.push($(this).val());
                    sta = 1;
                }
            });
            
        }
        //tpl_value.push($(this).val());
    })
    if(sta==0){
        alert("请将数据填写完整");
    }

    /*var sta = 1;
    $("input[name='tpl_value']").each(function(){
        if($(this).val()==""){
            sta = 0;
        }
        tpl_value.push($(this).val());
    })
    if(sta==0){
        alert("请将数据填写完整");  
        return false;
    }*/
    var activity_id = {php echo $detail['id']};

    jQuery.ajaxSettings.traditional = true;
    if(sta==1){
        $.post("{php echo $this->createMobileUrl('my_sign_up', array('op'=>'sign_up'));}&tpl_title="+tpl_title+"&tpl_value="+tpl_value+"&activity_id="+activity_id,function(d){
            if(d.result=='1'){
                util.tips(d.data?'报名成功':'报名失败');
                mui("#detail").popover('toggle');
                if (d.data){
                    $('.js-join').removeClass('js-join1');
                    $('.js-join').find('span.mui-btn').text('已报名，点击查看');
                    $('.js-join').attr('href',"{php echo $this->createMobileUrl('my_sign_up');}");
                    is_join = 1;
                }
            }else if (d.result==2){
                if (container==true){
                    util.confirm('还未注册，点击确认自动注册？', ' ', function(e) {
                        if (e.index == 1) {
                            location.href = "";
                        }
                    });
                }else{
                    util.tips('需要在微信中打开');
                }
            }else{
                util.tips('报名失败');
            }
        },"json");
    }
    
}
</script>
<script>;</script>
</body></html>