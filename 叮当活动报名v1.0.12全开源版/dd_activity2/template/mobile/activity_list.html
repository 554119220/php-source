{template 'header'}
<body class="mui-ios mui-ios-11 mui-ios-11-0"><style type="text/css">
img{vertical-align: bottom;}
.mui-index .mui-card{ margin:10px 0; margin-right:0;}
.mui-index .mui-card, .mui-index .mui-card-header,.mui-index .mui-card-footer{ border-radius:0; background-color:#fff;border:none;}
.mui-index .mui-card .mui-table-view .mui-table-view-cell.mui-media{padding:10px;}
.mui-index .mui-card-header{padding:10px 8px;position:relative; font-size:18px}
.mui-index .mui-card-header:before{position: absolute;content: "";height: 13px;left: 0;top: 50%;width: 6px;background-color: #f06000;border-radius:0 20% 20% 0;-moz-border-radius:0 20% 20% 0;border-radius:0 20% 20% 0;-webkit-font-smoothing: antialiased;-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);}
.mui-index .mui-card-header h5{color:#333; font-weight:600; font-size:15px;}
.mui-index .mui-card.card img{border-radius:0.2rem 0 0 0.2rem;}
.mui-index .mui-card.card .mui-card-content-inner .card-info{width:42%;color:#FFF;padding:0.6rem;position:absolute;background: -webkit-linear-gradient(left, rgba(110,82,252,1) 20%, rgba(180,42,250,1) 100%);top:0;right:10px;bottom:10px;border-radius:0 0.2rem 0.2rem 0;}
.mui-index .mui-card.card .mui-card-content-inner .card-info:before {content: "";position: absolute;left:-0.4rem;top:50%;border-top:0.8rem solid transparent;border-right: 0.8rem solid #6e52fc;
border-bottom:0.8rem solid transparent;-webkit-transform: translateY(-50%)}
.mui-index .mui-card.card .mui-card-content-inner .card-info h4{font-size:1rem;}
.mui-index .mui-card.card .mui-card-content-inner .card-info ul{color:#fff;padding-left:17px; line-height:1.8;font-size:0.42rem;}
.mui-index .mui-card-footer{ text-align:center; font-size:12px;}
.mui-index .mui-card-footer a{color:#59acff!important;}
.mui-index .mui-table-view .mui-media-object{ max-width:115px!important;width:115px!important; height:85px;background-size:auto 100%!important;border-radius: 4px;}
.mui-index .mui-table-view p{ color:#999999; line-height:1.6;}
.mui-index .mui-table-view p.mui-ellipsis-2{line-height:1.3;}
.mui-index .mui-table-view span.title{ color:#333333; display:inherit; line-height:1.2;}
.mui-index .mui-slider .mui-slider-indicator{ bottom: 0; text-align:right;padding-right:10px}
.mui-index .mui-slider-title{ color:#666666;opacity:1;background: -webkit-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.75) 100%);background: -moz-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.75) 100%);background: -o-linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.75) 100%);background: linear-gradient(top, rgba(0,0,0,0) 0%, rgba(0,0,0,0.75) 100%);padding-right: 35%;color: #fff;}
.mui-index .mui-media-body .mui-media-footer{ overflow:hidden; height:22px;}
.mui-index .mui-media-body .mui-media-footer span{ overflow:hidden;}
.mui-index .mui-media-body .mui-media-footer span:first-child~span{ display:inline-block; line-height:1; font-size:12px;padding:2px 0;}
.mui-index .mui-grid-view{ background:#FFF}
.mui-index .mui-grid-view .mui-table-view-cell{border:none;padding:inherit;}
.mui-index .mui-grid-view .mui-table-view-cell .mui-category-ico{height:40px;width:40px;display:-webkit-inline-box;overflow:hidden;border-radius:100%;}
.mui-index .mui-grid-view .mui-media-body{ font-size:0.48rem!important;margin-top:0!important;color:#666666!important; height:auto!important; line-height:1.1!important}
#category .mui-popover-content{height:100%;}
.mui-table-view.mui-group-btn dd{position:relative;padding:5px 10px; height:40px;overflow:hidden}
.mui-table-view.mui-group-btn dd:after{content:'';position:absolute;left:0;bottom:0;right:auto;top:auto;height:1px;width:100%;background-color:#e6e6e6;display:block;z-index:15;-webkit-transform:scaleY(.5);transform:scaleY(.5);}
.mui-table-view.mui-group-btn dd span{display:-webkit-inline-box;font-size:14px;padding:inherit;}
.mui-table-view.mui-group-btn dd span:nth-child(2){font-size:16px;padding-left:10px;}
.mui-table-view.mui-group-btn dd img{border-radius:100%;width:22px; height:22px;font-size:0;}
.mui-table-view.mui-group-btn .mui-table-view-cell{float:left;border-radius:0!important;text-align:center;width:25%; padding:0;}
.mui-table-view.mui-group-btn .mui-table-view-cell:after{left:0px;}
.mui-table-view.mui-group-btn .mui-table-view-cell:last-child:after{height:1px;}
.mui-table-view.mui-group-btn .mui-table-view-cell a{height:1.7rem;margin:0!important;color:#666666;line-height:1.7rem; font-size:0.48rem;font-family: "Microsoft Yahei","微软雅黑",Arial,"Hiragino Sans GB","宋体","Helvetica Neue",Helvetica,sans-serif;}
.mui-table-view.mui-group-btn .mui-table-view-cell a:after{content:" ";width:200%;height:200%;position: absolute;top:0;left:0;right:0; border: 1px solid #e6e6e6;border-left:none;border-top:none;border-bottom:none;box-sizing:border-box;-webkit-transform: scale(0.5);transform: scale(0.5);-webkit-transform-origin: 0 0;transform-origin: 0 0;}
.mui-table-view.mui-group-btn .mui-table-view-cell.bdr-none a:after{border-right:none;}

</style>
{template 'header1'}
<div class="mui-content mui-index" style="padding-bottom: 0px;">
    <div class="mui-scroll-wrapper-ext">
        <div class="mui-scroll-ext">
        	<ul class="mui-table-view mui-grid-view mui-grid-9">
            	{loop $category $item}
                <li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
                    <a href="{php echo $this->createMobileUrl('activity_category', array('category_id'=>$item['id']));}"><span class="mui-category-ico"><img width='100%' height="100%" src="{$item['img']}" /></span><div class="mui-media-body">{$item['category_name']}</div></a>
                </li>                                                
                {/loop}
            </ul>
            <div id="hot" class="mui-card mui-afterbefore-no">
                <div class="mui-card-header"><h5>最新活动</h5></div>
                <div class="mui-card-content">
                    <ul class="mui-table-view">
                    	{loop $list $row}
                     	<li class="mui-table-view-cell mui-media" style="">
                     		<a href="{php echo $this->createMobileUrl('activity_detail',array('id'=>$row['id']));}">
                     			<div class="mui-media-object mui-pull-left" no-repeat center"><img width='100%' height="100%" src="{$row['img']}" style="border-radius: 4px;" /></div>
                     			<div class="mui-media-body">
                     				<span class="title mui-ellipsis">{$row['title']}</span>
                     				<p class="mui-ellipsis-2 mui-small"></p>
                     				<p class="mui-small">已报名：<font color="#666666">{$row['joinnum']}人</font> 剩余名额：<font color="#666666">{$row['tpl_gnum']}人</font></p>
                     				<div class="mui-media-footer">
                     					{if $row['baoming_c_time']>$time}
                     					<span class="mui-badge mui-badge-orange">还未开始</span>
                     					{elseif $row['baoming_e_time']<$time && $row['c_time']>$time}
                     					<span class="mui-badge mui-badge-orange">报名结束</span>
                     					{elseif $row['baoming_e_time']<$time && $row['c_time']<$time && $row['e_time']>$time}
                     					<span class="mui-badge mui-badge-orange">进行中</span>
                     					{elseif $row['e_time'] < $time}
                     					<span class="mui-badge mui-badge-orange">已结束</span>
                     					{else}
                     					<span class="mui-badge mui-badge-orange">报名中</span>
                     					{/if}
                     					<span class="mui-text-success">免费活动</span>
                     				</div>
                     				{if $row['is_join']==1}
                     				<p class="mui-ellipsis-2 mui-small" style="color:red">已报名</p>
                     				{/if}
                     			</div>
                     		</a>
                     	</li>
                     	{/loop}
                 	</ul>
                     
                </div>
                
            </div>
            <div class="dropload-down" style="display: none;"><div class="dropload-noData">全部数据加载完毕</div></div>
        </div>
    </div>
</div>
<div>&#22823;&#37327;&#28304;&#30721;&#65292;&#25345;&#32493;&#26356;&#26032;&#65306;&#119;&#119;&#119;&#46;&#108;&#97;&#110;&#114;&#101;&#110;&#122;&#104;&#105;&#106;&#105;&#97;&#46;&#99;&#111;&#109;</div>
<script type="text/html" id="list">
<li class="mui-table-view-cell mui-media" style="">
	<a href="{php echo $this->createMobileUrl('activity_detail');}&id={{d.id}}">
		<div class="mui-media-object mui-pull-left"><img width='100%' height="100%" src="{{d.img}}" style="border-radius: 4px;" /></div>
		<div class="mui-media-body">
			<span class="title mui-ellipsis">{{d.title}}</span>
			<p class="mui-ellipsis-2 mui-small"></p>
			<p class="mui-small">已报名：<font color="#666666">{{d.joinnum}}人</font> 剩余名额：<font color="#666666">{{d.tpl_gnum}}</font></p>
			<div class="mui-media-footer">
				<span class="mui-badge mui-badge-orange">报名中</span>
				{{d.tpl_price}}
			</div>
			{{d.is_join}}
		</div>
	</a>
</li>
</script>
<script>
//上拉加载活动列表
var thispage = 1;
$('.mui-scroll-ext').dropload({
	scrollArea : $('.mui-scroll-wrapper-ext'),
	threshold : 800,
	loadDownFn : function(me){
		mui.getJSON("{php echo $this->createMobileUrl('activity_list', array('op'=>'ajax_activity_list'));}", {page:thispage+1}, 
		function(data){
			var stime = new Date(), result='', gettpl = document.getElementById('list').innerHTML;

			if (data.total == 0){
				result = '<li class="mui-table-view-cell"><p style="text-align:center">当前没有推荐信息</p><li>';
			}
			if (thispage >= data.tpage || data.tpage == 0){
				me.lock();// 锁定
				me.noData();// 无数据
			}
			for(var i = 0; i < data.list.length; i++){
				joinstime = new Date(data.list[i].baoming_c_time.replace("-", "/").replace("-", "/"));
				joinetime = new Date(data.list[i].baoming_e_time.replace("-", "/").replace("-", "/"));
				starttime = new Date(data.list[i].c_time.replace("-", "/").replace("-", "/"));
				endtime   = new Date(data.list[i].e_time.replace("-", "/").replace("-", "/"));
				
				var joinnum = parseInt(data.list[i].join_num),
				gnum  = parseInt(data.list[i].join_num);
				if (stime > endtime){
					data.list[i].tpl_status = '<span class="mui-badge">活动结束</span>';
				}else{
					if (joinnum >= gnum && gnum > 0){
						data.list[i].tpl_status = '<span class="mui-badge mui-badge-danger">名额已满</span>';
					}else{
						if(joinstime>stime){
							data.list[i].tpl_status = '<span class="mui-badge">还未开始</span>';
						}elseif(joinetime<stime && starttime>stime){
							data.list[i].tpl_status = '<span class="mui-badge">报名结束</span>';
						}elseif(joinetime<stime && starttime<stime && endtime>stime){
							data.list[i].tpl_status = '<span class="mui-badge">进行中</span>';
						}elseif(endtime<stime){
							data.list[i].tpl_status = '<span class="mui-badge">已结束</span>';
						}else{
							data.list[i].tpl_status = '<span class="mui-badge">报名中</span>';
						}
					}						
				}
				
				data.list[i].tpl_price = '<span class="mui-text-success">免费活动</span>';
				data.list[i].tpl_gnum = data.list[i].tpl_gnum+' 人';
				if (data.list[i].is_join == 1){
					data.list[i].is_join = '<p class="mui-ellipsis-2 mui-small" style="color:red">已报名</p>';
				}else{
					data.list[i].is_join = "";
				}
				
				laytpl(gettpl).render(data.list[i], function(html){
					$("#hot").find('.mui-table-view').append(html);
					$("#hot").find('.mui-table-view .mui-table-view-cell').fadeIn();
				});
			}
			
			//$(id).find('.list-content').append(result);
			thispage++;
			// 每次数据加载完，必须重置
			me.resetload();
		});
	}
});


//格式化日期
Date.prototype.format = function(format) {
    var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
    }
    if (/(y+)/.test(format)) {
        format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    }
    for (var k in o) {
        if (new RegExp("(" + k + ")").test(format)) {
            format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
        }
    }
    return format;
}
</script>
<script>;</script><!-- <script type="text/javascript" src="{php echo $this->createMobileUrl('activity_list', array('op'=>'ajax_activity_list'));}"></script> --></body>
</html>