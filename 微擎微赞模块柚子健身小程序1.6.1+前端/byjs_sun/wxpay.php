<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto O2RcK; O2RcK: $this->appid = $appid; goto EMrLb; j5UMI: $this->out_trade_no = $out_trade_no; goto PYsY3; KB6cA: $this->mch_id = $mch_id; goto IDfRM; uKUkx: $this->total_fee = $total_fee; goto B9aWc; EMrLb: $this->openid = $openid; goto KB6cA; IDfRM: $this->key = $key; goto j5UMI; PYsY3: $this->body = $body; goto uKUkx; B9aWc: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto qvyNs; LrQtl: $xmlData = $this->arrayToXml($parameters); goto giTAS; pMZpk: $parameters = array("\x61\160\x70\151\144" => $this->appid, "\x6d\143\150\137\151\x64" => $this->mch_id, "\x6e\157\156\x63\x65\137\163\x74\162" => $this->createNoncestr(), "\142\x6f\144\x79" => $this->body, "\157\x75\x74\137\x74\162\141\x64\x65\137\x6e\157" => $this->out_trade_no, "\164\x6f\x74\x61\x6c\137\146\145\x65" => $this->total_fee, "\x73\x70\x62\151\154\154\x5f\143\162\145\x61\x74\x65\137\x69\x70" => "\61\x39\62\56\x31\x36\x38\56\x30\56\61\x36\61", "\x6e\x6f\x74\151\x66\x79\x5f\165\162\154" => "\x68\164\164\x70\x3a\57\57\167\167\x77\x2e\x77\x65\151\x78\151\x6e\x2e\x71\161\56\x63\157\x6d\x2f\167\170\160\x61\x79\57\x70\141\171\x2e\x70\150\x70", "\157\160\145\156\151\144" => $this->openid, "\x74\x72\x61\144\145\137\164\x79\160\x65" => "\112\123\x41\120\x49"); goto OwU2I; OwU2I: $parameters["\x73\x69\x67\x6e"] = $this->getSign($parameters); goto LrQtl; qvyNs: $url = "\x68\164\164\x70\x73\x3a\x2f\x2f\141\160\151\x2e\155\x63\x68\56\167\145\x69\170\151\x6e\56\161\x71\56\143\157\155\x2f\x70\x61\171\57\165\156\151\x66\x69\x65\144\157\x72\144\x65\162"; goto pMZpk; zLig1: return $return; goto Nvfjc; giTAS: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto zLig1; Nvfjc: } private static function postXmlCurl($xml, $url, $second = 30) { goto BDBP7; L5J7T: curl_setopt($ch, CURLOPT_URL, $url); goto eVy2h; CdosC: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto iQX0z; AIbqD: a5oYB: goto jbZty; xxwLa: if ($data) { goto a5oYB; } goto KiBDG; jbZty: curl_close($ch); goto M97LZ; M97LZ: return $data; goto luJr4; qa5yc: $data = curl_exec($ch); goto xxwLa; Pdnil: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto L5J7T; CkT7Q: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto Ars_T; DGmtr: curl_close($ch); goto aa3rM; luJr4: DZuqb: goto rGgtk; ZFEI0: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto VZl7Z; KiBDG: $error = curl_errno($ch); goto DGmtr; aa3rM: throw new WxPayException("\x63\x75\x72\x6c\xe5\207\xba\xe9\x94\231\357\xbc\214\351\224\231\350\xaf\xaf\347\xa0\x81\x3a{$error}"); goto DNT2B; VZl7Z: curl_setopt($ch, CURLOPT_POST, TRUE); goto v69S0; iQX0z: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto ZFEI0; Ars_T: set_time_limit(0); goto qa5yc; VpHcw: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto CkT7Q; v69S0: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto VpHcw; DNT2B: goto DZuqb; goto AIbqD; BDBP7: $ch = curl_init(); goto Pdnil; eVy2h: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto CdosC; rGgtk: } private function arrayToXml($arr) { goto oLe2c; Fm938: foreach ($arr as $key => $val) { goto gwMYY; y58Q1: TrQ7p: goto iLW1u; moU3f: OtMsO: goto Mzgmd; gwMYY: if (is_array($val)) { goto TrQ7p; } goto psDLI; Mzgmd: L0tHL: goto OGdzx; iLW1u: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\x3c\57" . $key . "\x3e"; goto moU3f; psDLI: $xml .= "\x3c" . $key . "\76" . $val . "\x3c\x2f" . $key . "\x3e"; goto GAKaM; GAKaM: goto OtMsO; goto y58Q1; OGdzx: } goto YPM9k; dVu61: return $xml; goto Z09Y5; YPM9k: q1KQ4: goto geTMv; geTMv: $xml .= "\74\57\162\157\157\164\76"; goto dVu61; oLe2c: $xml = "\74\162\x6f\x6f\x74\x3e"; goto Fm938; Z09Y5: } private function xmlToArray($xml) { goto LmfLQ; Hvy0C: return $val; goto Bnrrw; Gw7Xl: $val = json_decode(json_encode($xmlstring), true); goto Hvy0C; BQgjg: $xmlstring = simplexml_load_string($xml, "\x53\151\155\x70\x6c\x65\130\115\114\x45\154\145\155\x65\x6e\164", LIBXML_NOCDATA); goto Gw7Xl; LmfLQ: libxml_disable_entity_loader(true); goto BQgjg; Bnrrw: } private function weixinapp() { goto xwn_l; KRL_3: $parameters["\160\x61\171\x53\151\x67\x6e"] = $this->getSign($parameters); goto JKxwm; xwn_l: $unifiedorder = $this->unifiedorder(); goto HFzNQ; HFzNQ: $parameters = array("\x61\160\160\x49\x64" => $this->appid, "\164\x69\x6d\145\x53\164\141\155\160" => '' . time() . '', "\156\x6f\x6e\x63\x65\123\164\162" => $this->createNoncestr(), "\x70\141\143\x6b\x61\147\145" => "\x70\x72\145\160\141\x79\x5f\x69\144\75" . $unifiedorder["\160\x72\145\x70\141\171\x5f\x69\144"], "\x73\151\x67\156\124\x79\x70\145" => "\115\x44\x35"); goto KRL_3; JKxwm: return $parameters; goto ImP5r; ImP5r: } private function createNoncestr($length = 32) { goto rjQmb; w1IPk: goto cF_v3; goto vpxSK; pcMiI: $i++; goto w1IPk; iby8p: cF_v3: goto JXw3s; rjQmb: $chars = "\141\x62\x63\x64\145\146\x67\150\x69\x6a\153\154\155\156\x6f\160\161\x72\x73\164\165\x76\x77\x78\171\x7a\60\x31\62\x33\x34\x35\x36\67\70\71"; goto Llh0L; UfN3A: $i = 0; goto iby8p; ANf6R: return $str; goto ax1u4; JXw3s: if (!($i < $length)) { goto e4UCP; } goto Sf1WO; vpxSK: e4UCP: goto ANf6R; Sf1WO: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto VG_uO; VG_uO: SaGrA: goto pcMiI; Llh0L: $str = ''; goto UfN3A; ax1u4: } private function getSign($Obj) { goto IT7qK; ul4ZJ: $String = md5($String); goto nnd3J; Dcd0D: fZYUf: goto Fndbe; nnd3J: $result_ = strtoupper($String); goto vlMJd; IT7qK: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; Uom8R: } goto Dcd0D; vlMJd: return $result_; goto a1eq8; H0TXF: $String = $this->formatBizQueryParaMap($Parameters, false); goto RCP0M; Fndbe: ksort($Parameters); goto H0TXF; RCP0M: $String = $String . "\46\153\145\171\75" . $this->key; goto ul4ZJ; a1eq8: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto FTxIw; Xcle7: ksort($paraMap); goto O7e34; e3w4r: xkUET: goto zYXme; H82ji: if (!(strlen($buff) > 0)) { goto xkUET; } goto rODHH; GmU5K: Yfj3u: goto gueOg; rODHH: $reqPar = substr($buff, 0, strlen($buff) - 1); goto e3w4r; zYXme: return $reqPar; goto b9v2q; FTxIw: $buff = ''; goto Xcle7; O7e34: foreach ($paraMap as $k => $v) { goto p_7nq; J2hN1: Jae9s: goto p7yrG; p7yrG: $buff .= $k . "\x3d" . $v . "\x26"; goto cqTWy; pvxmz: $v = urlencode($v); goto J2hN1; cqTWy: h5FP2: goto ST45q; p_7nq: if (!$urlencode) { goto Jae9s; } goto pvxmz; ST45q: } goto GmU5K; gueOg: $reqPar; goto H82ji; b9v2q: } }