(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-login"],{"6bb2":function(e,t,a){"use strict";a.r(t);var n=a("8a46"),o=a("c220");for(var i in o)"default"!==i&&function(e){a.d(t,e,function(){return o[e]})}(i);a("79f7");var r=a("2877"),u=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,"aabfebe4",null);t["default"]=u.exports},"79f7":function(e,t,a){"use strict";var n=a("7eae"),o=a.n(n);o.a},"7eae":function(e,t,a){var n=a("88c5");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=a("4f06").default;o("2d8bfa0c",n,!0,{sourceMap:!1,shadowMode:!1})},"88c5":function(e,t,a){t=e.exports=a("2350")(!1),t.push([e.i,"uni-page-body[data-v-aabfebe4]{background:#fff;font-size:%?32?%}.container[data-v-aabfebe4]{padding:0 %?60?%}.wechatapp[data-v-aabfebe4]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-aabfebe4]{margin:0 auto}.wechatapp .header .app-name[data-v-aabfebe4]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-aabfebe4]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;-webkit-border-radius:50%;border-radius:50%;border:2px solid #fff;-webkit-box-shadow:1px 0 5px rgba(50,50,50,.3);box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-aabfebe4]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-aabfebe4]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-aabfebe4]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;-webkit-border-radius:%?6?%;border-radius:%?6?%}.login-btn[data-v-aabfebe4]:after{display:none}.login-btn.button-hover[data-v-aabfebe4]{-webkit-box-shadow:inset 0 %?5?% %?30?% rgba(0,0,0,.15);box-shadow:inset 0 %?5?% %?30?% rgba(0,0,0,.15)}body.?%PAGE?%[data-v-aabfebe4]{background:#fff}",""])},"8a46":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"wechatapp"},[a("v-uni-view",{staticClass:"header"},[a("v-uni-image",{attrs:{src:e.appLogo}}),a("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[e._v(e._s(e.appName))])],1)],1),a("v-uni-view",{staticClass:"auth-title"},[e._v("申请获取以下权限:")]),a("v-uni-view",{staticClass:"auth-subtitle"},[e._v("• 获得你的公开信息（昵称、头像等）")]),a("v-uni-button",{staticClass:"login-btn",on:{click:function(t){t=e.$handleEvent(t),e.authorLogin(t)}}},[e._v("授权登录")])],1)},o=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return o})},c220:function(e,t,a){"use strict";a.r(t);var n=a("f55d"),o=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);t["default"]=o.a},f55d:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(a("deda"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){r(e,t,a[t])})}return e}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u={data:function(){return{}},components:{},computed:{},onLoad:function(e){},onShow:function(){},mounted:function(){},methods:{authorLogin:function(e){var t=this,a=t.$store.state.clientType;if("2"===a&&"getUserInfo:ok"!==e.detail.errMsg)return n.default.showError("登录失败,请重试"),!1;uni.getProvider({service:"oauth",success:function(a){t.userLogin(a.provider[0],e.detail)}})},getLoginData:function(e,t){return new Promise(function(a,n){t.iv&&t.encryptedData?a(t):uni.getUserInfo({provider:e,withCredentials:!0,complete:function(t){console.log(t),t.iv||"alipay"===e?(!t.encryptedData&&t.data&&(t.encryptedData=t.data),a(t)):n()}})})},userLogin:function(e,t){var a=this,o=a.$store.state.clientType,i={};uni.showLoading({title:"正在登录"}),uni.login({provider:e,scopes:"auth_user",success:function(r){i.code=r.code,a.getLoginData(e,t).then(function(e){"7"!==o&&(i=Object.assign(i,{user_info:e.rawData||"",encrypted_data:e.encryptedData,iv:e.iv,signature:e.signature||""})),"7"===o&&(i=Object.assign(i,{nickName:e.userInfo.nickName||"",avatarUrl:e.userInfo.avatarUrl})),a.getUserInfo(i)}).catch(function(){"9"===o?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(e){e.confirm&&uni.openSetting({success:function(e){e.authSetting["scope.userInfo"]&&n.default.showError("授权成功,请重新登录")}})}}):n.default.showError("登录失败,请重试")})}})},getUserInfo:function(e){var t=this;n.default._post_form("user/login",i({},e,{referee_id:t.$store.state.refereeId}),function(e){t.$store.commit("userInfo",e.data.status),uni.setStorageSync("token",e.data.token),uni.setStorageSync("user_id",e.data.user_id),t.globalSaveRefereeId&&n.default.saveRefereeQuest(),t.$store.commit("iswrite",e.data.status.status),t.navigateBack()},!1,function(){uni.hideLoading()})},navigateBack:function(){var e=getCurrentPages(),t=e[e.length-2],a=uni.getStorageSync("currentPage").options;uni.removeStorageSync("currentPage"),"pages/mainPages/write/write"===t.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):(t.onLoad(a),uni.navigateBack())}}};t.default=u}}]);