(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-login"],{"069c":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"wechatapp"},[a("v-uni-view",{staticClass:"header"},[a("v-uni-image",{attrs:{src:t.appLogo}}),a("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[t._v(t._s(t.appName))])],1)],1),a("v-uni-view",{staticClass:"auth-title"},[t._v("申请获取以下权限:")]),a("v-uni-view",{staticClass:"auth-subtitle"},[t._v("• 获得你的公开信息（昵称、头像等）")]),a("v-uni-button",{staticClass:"login-btn",on:{click:function(e){e=t.$handleEvent(e),t.authorLogin(e)}}},[t._v("授权登录")])],1)},o=[];a.d(e,"a",function(){return n}),a.d(e,"b",function(){return o})},"1a58":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,"uni-page-body[data-v-1f638faf]{background:#fff;font-size:%?32?%}.container[data-v-1f638faf]{padding:0 %?60?%}.wechatapp[data-v-1f638faf]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-1f638faf]{margin:0 auto}.wechatapp .header .app-name[data-v-1f638faf]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-1f638faf]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;-webkit-border-radius:50%;border-radius:50%;border:2px solid #fff;-webkit-box-shadow:1px 0 5px rgba(50,50,50,.3);box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-1f638faf]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-1f638faf]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-1f638faf]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;-webkit-border-radius:%?6?%;border-radius:%?6?%}.login-btn[data-v-1f638faf]:after{display:none}.login-btn.button-hover[data-v-1f638faf]{-webkit-box-shadow:inset 0 %?5?% %?30?% rgba(0,0,0,.15);box-shadow:inset 0 %?5?% %?30?% rgba(0,0,0,.15)}body.?%PAGE?%[data-v-1f638faf]{background:#fff}",""])},"312b":function(t,e,a){"use strict";var n=a("b608"),o=a.n(n);o.a},"6bb2":function(t,e,a){"use strict";a.r(e);var n=a("069c"),o=a("c220");for(var i in o)"default"!==i&&function(t){a.d(e,t,function(){return o[t]})}(i);a("312b");var r=a("2877"),u=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,"1f638faf",null);e["default"]=u.exports},b608:function(t,e,a){var n=a("1a58");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("4f06").default;o("063c30fe",n,!0,{sourceMap:!1,shadowMode:!1})},c220:function(t,e,a){"use strict";a.r(e);var n=a("f55d"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,function(){return n[t]})}(i);e["default"]=o.a},f55d:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(a("deda"));function o(t){return t&&t.__esModule?t:{default:t}}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),n.forEach(function(e){r(t,e,a[e])})}return t}function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u={data:function(){return{}},components:{},computed:{},onLoad:function(t){},onShow:function(){},mounted:function(){},methods:{authorLogin:function(t){var e=this,a=e.$store.state.clientType;if("2"===a&&"getUserInfo:ok"!==t.detail.errMsg)return n.default.showError("登录失败,请重试"),!1;uni.getProvider({service:"oauth",success:function(a){e.userLogin(a.provider[0],t.detail)}})},getLoginData:function(t,e){return new Promise(function(a,n){e.iv&&e.encryptedData?a(e):uni.getUserInfo({provider:t,withCredentials:!0,complete:function(e){console.log(e),e.iv||"alipay"===t?(!e.encryptedData&&e.data&&(e.encryptedData=e.data),a(e)):n()}})})},userLogin:function(t,e){var a=this,o=a.$store.state.clientType,i={};uni.login({provider:t,scopes:"auth_user",success:function(r){i.code=r.code,a.getLoginData(t,e).then(function(t){"7"!==o&&(i=Object.assign(i,{user_info:t.rawData||"",encrypted_data:t.encryptedData,iv:t.iv,signature:t.signature||""})),"7"===o&&(i=Object.assign(i,{nickName:t.userInfo.nickName||"",avatarUrl:t.userInfo.avatarUrl})),a.getUserInfo(i)}).catch(function(){"9"===o?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(t){t.confirm&&uni.openSetting({success:function(t){t.authSetting["scope.userInfo"]&&n.default.showError("授权成功,请重新登录")}})}}):n.default.showError("登录失败,请重试")})}})},getUserInfo:function(t){uni.showLoading({title:"正在登录"});var e=this;n.default._post_form("user/login",i({},t,{referee_id:e.$store.state.refereeId}),function(t){e.$store.commit("userInfo",t.data.status),uni.setStorageSync("token",t.data.token),uni.setStorageSync("user_id",t.data.user_id),e.$store.commit("iswrite",t.data.status.status),e.navigateBack()},!1,function(){uni.hideLoading()})},navigateBack:function(){var t=getCurrentPages(),e=t[t.length-2],a=uni.getStorageSync("currentPage").options;e.onLoad(a),uni.navigateBack(),uni.removeStorageSync("currentPage")}}};e.default=u}}]);