<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto g40Mw; V7VGx: $this->openid = $openid; goto uoH11; g40Mw: $this->appid = $appid; goto V7VGx; uoH11: $this->mch_id = $mch_id; goto B8u1j; LdOOI: $this->total_fee = $total_fee; goto famvr; B8u1j: $this->key = $key; goto cahZy; VXma0: $this->body = $body; goto LdOOI; cahZy: $this->out_trade_no = $out_trade_no; goto VXma0; famvr: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto btG2x; kI7SX: $parameters = array("\141\x70\x70\x69\144" => $this->appid, "\155\143\x68\x5f\151\x64" => $this->mch_id, "\156\157\x6e\x63\x65\137\x73\164\162" => $this->createNoncestr(), "\142\x6f\144\x79" => $this->body, "\x6f\165\164\x5f\164\162\x61\x64\145\137\156\x6f" => $this->out_trade_no, "\x74\157\x74\x61\x6c\x5f\146\145\145" => $this->total_fee, "\x73\x70\142\x69\x6c\154\137\143\162\145\141\x74\145\x5f\151\x70" => "\61\71\62\x2e\x31\x36\70\56\x30\56\61\x36\x31", "\x6e\x6f\x74\151\x66\171\137\x75\x72\x6c" => "\150\164\164\160\72\57\57\x77\x77\x77\56\x77\145\x69\x78\151\156\56\161\161\56\x63\x6f\x6d\x2f\167\x78\x70\141\171\x2f\160\x61\171\x2e\160\x68\160", "\x6f\160\145\x6e\x69\x64" => $this->openid, "\x74\162\141\144\x65\x5f\x74\x79\160\145" => "\112\x53\101\120\x49"); goto fSYLs; VPKUo: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto r2Xqy; fSYLs: $parameters["\x73\151\147\x6e"] = $this->getSign($parameters); goto urJry; urJry: $xmlData = $this->arrayToXml($parameters); goto VPKUo; r2Xqy: return $return; goto Z_CM1; btG2x: $url = "\x68\x74\x74\x70\163\x3a\57\x2f\x61\x70\x69\56\x6d\x63\x68\56\167\145\151\170\151\156\56\161\x71\56\143\157\x6d\57\160\x61\171\57\165\x6e\x69\146\x69\145\x64\x6f\162\x64\x65\162"; goto kI7SX; Z_CM1: } private static function postXmlCurl($xml, $url, $second = 30) { goto hrCfc; yQ9pJ: curl_close($ch); goto a29DI; ZEloM: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto ExdhC; bJOc5: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto SQlqz; rs7SQ: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto bJOc5; AE0P1: curl_setopt($ch, CURLOPT_URL, $url); goto rs7SQ; LBW2Z: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto AE0P1; nGe9T: $data = curl_exec($ch); goto uhJZd; YLv9N: curl_close($ch); goto FRAQ1; FRAQ1: return $data; goto n4mFt; bZqVF: curl_setopt($ch, CURLOPT_POST, TRUE); goto r6hp5; uhJZd: if ($data) { goto y1kkH; } goto RmwvE; tgAXg: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto ZEloM; a29DI: throw new WxPayException("\143\x75\162\154\345\x87\272\351\224\x99\357\274\x8c\351\x94\231\xe8\257\257\xe7\240\201\72{$error}"); goto TWv5Z; un8kE: y1kkH: goto YLv9N; r6hp5: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto tgAXg; hrCfc: $ch = curl_init(); goto LBW2Z; ExdhC: set_time_limit(0); goto nGe9T; CCJ7P: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto bZqVF; n4mFt: MaTCm: goto ajOT_; TWv5Z: goto MaTCm; goto un8kE; SQlqz: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto CCJ7P; RmwvE: $error = curl_errno($ch); goto yQ9pJ; ajOT_: } private function arrayToXml($arr) { goto fDf3x; ZpoGh: zLrCB: goto yN2Is; sAqYy: foreach ($arr as $key => $val) { goto publx; bp1Rd: KKo40: goto p2b5_; XXGO9: $xml .= "\74" . $key . "\76" . $val . "\x3c\57" . $key . "\76"; goto y0W9W; Tf7w8: oB8Ab: goto Do2_s; Do2_s: IohT4: goto dRlaX; p2b5_: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\x3c\x2f" . $key . "\x3e"; goto Tf7w8; y0W9W: goto oB8Ab; goto bp1Rd; publx: if (is_array($val)) { goto KKo40; } goto XXGO9; dRlaX: } goto ZpoGh; yN2Is: $xml .= "\x3c\x2f\x72\x6f\x6f\164\x3e"; goto IF1s7; fDf3x: $xml = "\74\162\157\x6f\x74\x3e"; goto sAqYy; IF1s7: return $xml; goto jrjb2; jrjb2: } private function xmlToArray($xml) { goto Mz5Hf; ksNLR: return $val; goto Lh3u0; Gvpox: $val = json_decode(json_encode($xmlstring), true); goto ksNLR; WQalR: $xmlstring = simplexml_load_string($xml, "\123\x69\x6d\160\154\145\x58\115\114\105\x6c\x65\x6d\145\156\x74", LIBXML_NOCDATA); goto Gvpox; Mz5Hf: libxml_disable_entity_loader(true); goto WQalR; Lh3u0: } private function weixinapp() { goto vNriK; xBgCu: return $parameters; goto H5_wR; v7ErL: $parameters = array("\141\160\x70\x49\144" => $this->appid, "\x74\151\155\145\x53\x74\141\155\x70" => '' . time() . '', "\156\157\x6e\143\145\x53\164\x72" => $this->createNoncestr(), "\x70\141\x63\153\x61\147\x65" => "\x70\x72\145\x70\x61\x79\137\151\x64\x3d" . $unifiedorder["\x70\162\145\x70\x61\x79\137\x69\x64"], "\163\x69\147\x6e\x54\171\x70\145" => "\x4d\x44\x35"); goto N5A1A; N5A1A: $parameters["\x70\141\171\x53\x69\x67\x6e"] = $this->getSign($parameters); goto xBgCu; vNriK: $unifiedorder = $this->unifiedorder(); goto v7ErL; H5_wR: } private function createNoncestr($length = 32) { goto D5W4N; gJrjG: $i = 0; goto f4btp; fwumv: bTPLH: goto fDAKS; f4btp: GVpMh: goto xR99L; Bi6Ji: return $str; goto jnyVv; xR99L: if (!($i < $length)) { goto ngdK5; } goto KC2xk; GYnSV: goto GVpMh; goto WYzTy; WYzTy: ngdK5: goto Bi6Ji; D5W4N: $chars = "\141\x62\x63\144\x65\146\147\x68\x69\152\153\x6c\x6d\x6e\157\160\x71\x72\163\x74\x75\166\167\x78\x79\x7a\60\x31\62\63\x34\x35\x36\67\70\x39"; goto XtFqu; XtFqu: $str = ''; goto gJrjG; KC2xk: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto fwumv; fDAKS: $i++; goto GYnSV; jnyVv: } private function getSign($Obj) { goto GnHfl; viIfZ: $result_ = strtoupper($String); goto FPp69; bUUqt: $String = $this->formatBizQueryParaMap($Parameters, false); goto n2Zpx; GnHfl: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; kfJ41: } goto asQFz; n2Zpx: $String = $String . "\x26\x6b\145\171\75" . $this->key; goto WvgIy; asQFz: q_53d: goto ltZQc; WvgIy: $String = md5($String); goto viIfZ; FPp69: return $result_; goto gkONo; ltZQc: ksort($Parameters); goto bUUqt; gkONo: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto MeWKu; Em4pA: Swh8f: goto RFLfo; MeWKu: $buff = ''; goto K0EVz; RNOUu: $reqPar = substr($buff, 0, strlen($buff) - 1); goto zDK1y; kVhln: if (!(strlen($buff) > 0)) { goto jOhiw; } goto RNOUu; zDK1y: jOhiw: goto dD3Lg; dD3Lg: return $reqPar; goto w8tjm; RFLfo: $reqPar; goto kVhln; uJGrk: foreach ($paraMap as $k => $v) { goto nM4dp; TNaSh: $v = urlencode($v); goto N7w7n; N7w7n: t8HCT: goto wedWw; wedWw: $buff .= $k . "\75" . $v . "\46"; goto cfTqh; cfTqh: wjYOX: goto Q95F7; nM4dp: if (!$urlencode) { goto t8HCT; } goto TNaSh; Q95F7: } goto Em4pA; K0EVz: ksort($paraMap); goto uJGrk; w8tjm: } }