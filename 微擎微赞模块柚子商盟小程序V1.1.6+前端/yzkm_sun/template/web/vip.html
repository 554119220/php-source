{template 'public/header'}
{template 'public/comhead'}
<link rel="stylesheet" type="text/css" href="../addons/yzkm_sun/template/public/ygcsslist.css">
<ul class="nav nav-tabs">
    <span class="ygxian"></span>
    <div class="ygdangq">当前位置:</div>
    <li><a href="{php echo $this->createWebUrl('vipcardopen')}">会员卡设置</a></li>
    <!-- <li><a href="{php echo $this->createWebUrl('viplist')}">会员列表</a></li> -->
    <li><a href="{php echo $this->createWebUrl('addvipcard')}">会员卡添加</a></li>
    <li class="active"><a href="{php echo $this->createWebUrl('vip')}">会员卡列表</a></li>
    <li><a href="{php echo $this->createWebUrl('vipcode',array('op'=>'create'))}">生成激活码</a></li>
    <li><a href="{php echo $this->createWebUrl('vipcodelist',array('status'=>1))}">激活码列表</a></li>
</ul>
<div class="main">
    <!-- <div class="panel panel-default"> -->
        <!-- <div class="panel-body ygbtn"> -->
            <!--<div class="btn ygshouqian2" id="allselect">批量删除</div>-->
            <!-- <div class="btn ygyouhui2"><a href="{php echo $this->createWebUrl('')}">会员卡列表</a></div> -->
            <!--<div class="btn storegrey2" id="allrefuse">批量禁用</div>-->
        <!-- </div> -->

    <!-- </div> -->
    <!-- 门店列表部分开始 -->
    <div class="panel panel-default">
        <div class="panel-heading">
            会员卡列表
        </div>
        <div class="panel-body" style="padding: 0px 15px;">
            <div class="row">
                <table class="yg5_tabel col-md-12">
                    <tr class="yg5_tr1">
                        <td class="store_td1 col-md-1">会员卡类型名称</td>
                        <td class="col-md-2" style="width: 10%;">会员卡价格</td>
                        <td class="col-md-2" style="width:  10%;">会员卡有效期</td>
                        <td class="col-md-2" style="width:  10%;">发布时间</td>
                        <td class="col-md-2" style="width:  10%;">激活码前缀</td>
                        <td class="col-md-2">状态</td>
                        <td class="col-md-2">操作</td>
                    </tr>
                    {loop $list $item}
                    <tr class="yg5_tr2">
                        <td>{$item['title']}</td>
                        <td>{$item['price']}</td>
                        <td>{$item['day']}</td>
                        <td>{$item['time']}</td>
                        <td>{$item['prefix']}</td>
                        <td>{if $item['status']==1}
                            <span class='label label-success'>已开启</span>
                            {else}
                            <span class='label label-danger'>未开启</span>
                            {/if}
                        </td>
                        <td>
                            {if $item['status'] == 2} <a href="{php echo $this->createWebUrl('vip', array('id' => $item['id'], 'op' => 'done','status'=>1))}" onclick="return confirm('确认开启？');"
                                                         class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" title="开启">开启</a>
                            {else}

                            <a href="{php echo $this->createWebUrl('vip', array('id' => $item['id'], 'op' => 'done','status'=>2))}" onclick="return confirm('确认关闭？');"
                               class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" title="关闭">关闭</a>
                            {/if}
                            <a href="{php echo $this->createWebUrl('addvipcard', array('id' => $item['id']))}" class="storespan btn btn-xs">
                                <span class="fa fa-pencil"></span>
                                <span class="bianji">编辑
                                        <span class="arrowdown"></span>
                                    </span>
                            </a>
                            <a href="javascript:void(0);" class="storespan btn btn-xs" data-toggle="modal" data-target="#myModal{$item['id']}">
                                <span class="fa fa-trash-o"></span>
                                <span class="bianji">删除
                                        <span class="arrowdown"></span>
                                    </span>
                            </a>
                            <!-- <a class="btn btn-warning btn-xs" href="{php echo $this->createWebUrl('addtype', array('id' => $row['id']))}" title="编辑">改</a>&nbsp;&nbsp;
                           <button type="button" class="btn btn-danger btn-xs" data-toggle="modal" data-target="#myModal{$row['id']}">删</button> -->
                        </td>
                    </tr>
                    <div class="modal fade" id="myModal{$item['id']}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel" style="font-size: 20px;">提示</h4>
                                </div>
                                <div class="modal-body" style="font-size: 20px">
                                    确定删除么？
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <a href="{php echo $this->createWebUrl('vip', array('id' => $item['id'],'op'=>'delete'))}" type="button" class="btn btn-info" >确定</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {/loop}

                </table>
            </div>
        </div>
    </div>
    {$pager}
</div>
<script type="text/javascript">
    $(function(){
        $("#frame-9").show();
        $("#yframe-9").addClass("wyactive");

        // ———————————————批量删除———————————————
        $("#allselect").on('click',function(){
            var check = $("input[type=checkbox][class!=allcheck]:checked");
            if(check.length < 1){
                alert('请选择要删除的分类!');
                return false;
            }else if(confirm("确认要删除此分类?")){
                var id = new Array();
                check.each(function(i){
                    id[i] = $(this).val();
                });
                console.log(id)
                $.ajax({
                    type:"post",
                    url:"{$_W['siteroot']}/app/index.php?i={$_W['uniacid']}&c=entry&do=DeleteType&m=yzkm_sun",
                    dataType:"text",
                    data:{id:id},
                    success:function(data){
                        console.log(data);
                        location.reload();
                    }
                })

            }
        });

        // ———————————————批量通过———————————————
        $("#allpass").on('click',function(){
            var check = $("input[type=checkbox][class!=allcheck]:checked");
            if(check.length < 1){
                alert('请选择要启用的分类!');
                return false;
            }else if(confirm("确认要启用此分类?")){
                var id = new Array();
                check.each(function(i){
                    id[i] = $(this).val();
                });
                console.log(id)
                $.ajax({
                    type:"post",
                    url:"{$_W['siteroot']}/app/index.php?i={$_W['uniacid']}&c=entry&do=QyType&m=yzkm_sun",
                    dataType:"text",
                    data:{id:id},
                    success:function(data){
                        console.log(data);
                        location.reload();
                    }
                })
            }
        });

        // ———————————————批量拒绝———————————————
        $("#allrefuse").on('click',function(){
            var check = $("input[type=checkbox][class!=allcheck]:checked");
            if(check.length < 1){
                alert('请选择要禁用的分类!');
                return false;
            }else if(confirm("确认要禁用此分类?")){
                var id = new Array();
                check.each(function(i){
                    id[i] = $(this).val();
                });
                console.log(id)
                $.ajax({
                    type:"post",
                    url:"{$_W['siteroot']}/app/index.php?i={$_W['uniacid']}&c=entry&do=JyType&m=yzkm_sun",
                    dataType:"text",
                    data:{id:id},
                    success:function(data){
                        console.log(data);
                        location.reload();
                    }
                })
            }
        });

        $(".allcheck").on('click',function(){
            var checked = $(this).get(0).checked;
            $("input[type=checkbox]").prop("checked",checked);
        });
    })
</script>