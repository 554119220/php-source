<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto b2YRX; loPBz: $this->total_fee = $total_fee; goto m0Wi9; Xv25r: $this->openid = $openid; goto c_TLB; b2YRX: $this->appid = $appid; goto Xv25r; KMW1v: $this->out_trade_no = $out_trade_no; goto edNL2; TCdNc: $this->key = $key; goto KMW1v; c_TLB: $this->mch_id = $mch_id; goto TCdNc; edNL2: $this->body = $body; goto loPBz; m0Wi9: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto mjf02; mjf02: $url = "\x68\x74\x74\160\x73\x3a\x2f\57\141\x70\151\56\x6d\x63\150\56\167\x65\151\170\151\x6e\x2e\x71\x71\56\143\x6f\x6d\57\x70\141\171\x2f\x75\x6e\x69\146\x69\x65\144\157\x72\144\145\162"; goto epSxj; czT2d: $xmlData = $this->arrayToXml($parameters); goto oDL2q; oDL2q: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto Mcu90; epSxj: $parameters = array("\x61\160\160\x69\144" => $this->appid, "\155\x63\150\137\151\144" => $this->mch_id, "\156\x6f\x6e\x63\x65\137\x73\x74\x72" => $this->createNoncestr(), "\x62\157\x64\171" => $this->body, "\157\x75\164\137\164\162\x61\x64\145\x5f\x6e\x6f" => $this->out_trade_no, "\164\x6f\x74\x61\154\137\x66\x65\x65" => $this->total_fee, "\163\160\x62\x69\x6c\154\137\x63\x72\x65\x61\x74\x65\x5f\x69\160" => "\61\62\60\x2e\x37\x39\56\x31\65\62\x2e\61\x30\65", "\156\x6f\164\151\x66\171\x5f\x75\162\x6c" => "\x31\62\x30\x2e\x37\71\x2e\x31\x35\62\x2e\61\60\x35", "\x6f\160\145\156\x69\144" => $this->openid, "\x74\x72\x61\144\x65\137\x74\171\x70\x65" => "\x4a\x53\101\x50\111"); goto eOYWP; eOYWP: $parameters["\x73\x69\x67\x6e"] = $this->getSign($parameters); goto czT2d; Mcu90: return $return; goto aX8cq; aX8cq: } private static function postXmlCurl($xml, $url, $second = 30) { goto yRZN0; Ddrfe: return $data; goto NOLvX; vhtJ6: $data = curl_exec($ch); goto c4jDR; r639F: curl_setopt($ch, CURLOPT_POST, TRUE); goto Iy_65; DV6TC: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto VoyEI; yRZN0: $ch = curl_init(); goto DV6TC; expD2: curl_close($ch); goto Ddrfe; VoyEI: curl_setopt($ch, CURLOPT_URL, $url); goto da8MD; dCxHW: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto bgMh2; tF4op: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto dvudd; c4jDR: if ($data) { goto K5JIl; } goto zm9Oj; mHr2R: curl_close($ch); goto jto7U; Iy_65: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto tF4op; ayQfc: K5JIl: goto expD2; zRr0Q: goto BfNnS; goto ayQfc; JT_59: set_time_limit(0); goto vhtJ6; dvudd: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto JT_59; da8MD: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto UrEGR; jto7U: throw new WxPayException("\143\165\x72\154\345\207\272\xe9\224\231\xef\xbc\214\351\224\x99\350\257\xaf\347\240\201\x3a{$error}"); goto zRr0Q; bgMh2: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto r639F; UrEGR: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto dCxHW; NOLvX: BfNnS: goto YKdrX; zm9Oj: $error = curl_errno($ch); goto mHr2R; YKdrX: } private function arrayToXml($arr) { goto G9hWO; jMycb: return $xml; goto hVlkk; IpJ8h: fgkqC: goto nSEIR; iQ0ca: foreach ($arr as $key => $val) { goto OmzSe; I4slU: $xml .= "\74" . $key . "\76" . $val . "\x3c\x2f" . $key . "\76"; goto uoiZ3; NimOZ: uV2B1: goto M8pm1; OmzSe: if (is_array($val)) { goto e3I9s; } goto I4slU; uoiZ3: goto g4ngW; goto FZYU3; FZYU3: e3I9s: goto Jyjdo; Jyjdo: $xml .= "\74" . $key . "\x3e" . arrayToXml($val) . "\74\x2f" . $key . "\x3e"; goto CTE8f; CTE8f: g4ngW: goto NimOZ; M8pm1: } goto IpJ8h; G9hWO: $xml = "\x3c\x72\x6f\x6f\x74\76"; goto iQ0ca; nSEIR: $xml .= "\x3c\57\x72\157\157\x74\x3e"; goto jMycb; hVlkk: } private function xmlToArray($xml) { goto gq5eQ; RGKpT: $val = json_decode(json_encode($xmlstring), true); goto OPZVN; OPZVN: return $val; goto Pg8s2; gq5eQ: libxml_disable_entity_loader(true); goto ryjaC; ryjaC: $xmlstring = simplexml_load_string($xml, "\123\x69\155\160\x6c\x65\x58\115\114\105\154\x65\x6d\145\x6e\x74", LIBXML_NOCDATA); goto RGKpT; Pg8s2: } private function weixinapp() { goto o52GY; aG7GQ: return $parameters; goto CU0QT; JEQCs: $parameters = array("\x61\160\x70\111\144" => $this->appid, "\164\151\x6d\145\x53\x74\141\x6d\x70" => '' . time() . '', "\156\x6f\x6e\x63\x65\123\x74\162" => $this->createNoncestr(), "\160\141\143\153\x61\x67\x65" => "\160\x72\x65\x70\x61\x79\x5f\x69\144\x3d" . $unifiedorder["\x70\162\145\160\x61\x79\x5f\151\x64"], "\x73\x69\x67\156\x54\x79\x70\145" => "\x4d\x44\x35"); goto ir_In; o52GY: $unifiedorder = $this->unifiedorder(); goto JEQCs; ir_In: $parameters["\x70\x61\171\123\151\x67\156"] = $this->getSign($parameters); goto aG7GQ; CU0QT: } private function createNoncestr($length = 32) { goto sdCKu; tQebd: $str = ''; goto Ma62H; Ma62H: $i = 0; goto t2eM3; t2eM3: KQdU9: goto xy1rT; SI1Ml: STAV0: goto aPgrR; T5BOI: goto KQdU9; goto w0Kby; OXo0E: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto SI1Ml; xy1rT: if (!($i < $length)) { goto OehTK; } goto OXo0E; WVtUj: return $str; goto ZchxI; w0Kby: OehTK: goto WVtUj; aPgrR: $i++; goto T5BOI; sdCKu: $chars = "\x61\142\143\x64\145\146\x67\x68\151\x6a\153\x6c\x6d\156\157\160\161\162\x73\164\x75\166\x77\x78\171\172\x30\x31\x32\63\64\65\x36\x37\x38\x39"; goto tQebd; ZchxI: } private function getSign($Obj) { goto hX4bG; nYoIk: UUUvc: goto J7pPb; EtWdb: $result_ = strtoupper($String); goto VczYn; abTXg: $String = $String . "\x26\153\x65\x79\x3d" . $this->key; goto P0nEA; hX4bG: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; zn7SD: } goto nYoIk; VczYn: return $result_; goto htkoH; P0nEA: $String = md5($String); goto EtWdb; Qmgoi: $String = $this->formatBizQueryParaMap($Parameters, false); goto abTXg; J7pPb: ksort($Parameters); goto Qmgoi; htkoH: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto SRnry; Ski3i: if (!(strlen($buff) > 0)) { goto FJ516; } goto pKVON; zUxKU: FJ516: goto mKOXN; SRnry: $buff = ''; goto sAcJO; Jk86o: foreach ($paraMap as $k => $v) { goto w82g7; kr4B3: $buff .= $k . "\x3d" . $v . "\46"; goto bvGVm; kxCyy: R0qPg: goto kr4B3; bvGVm: rlLp9: goto QABa_; h6Ejd: $v = urlencode($v); goto kxCyy; w82g7: if (!$urlencode) { goto R0qPg; } goto h6Ejd; QABa_: } goto oJSYm; mKOXN: return $reqPar; goto ffVQT; oJSYm: KY7SQ: goto eEmrZ; pKVON: $reqPar = substr($buff, 0, strlen($buff) - 1); goto zUxKU; eEmrZ: $reqPar; goto Ski3i; sAcJO: ksort($paraMap); goto Jk86o; ffVQT: } }