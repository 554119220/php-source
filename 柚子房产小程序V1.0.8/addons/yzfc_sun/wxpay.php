<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto Sq6Zr; jtYqa: $this->out_trade_no = $out_trade_no; goto QriO1; qIeqH: $this->key = $key; goto jtYqa; LmW0v: $this->openid = $openid; goto PxYjg; Sq6Zr: $this->appid = $appid; goto LmW0v; PxYjg: $this->mch_id = $mch_id; goto qIeqH; gm0F4: $this->total_fee = $total_fee; goto jTGCA; QriO1: $this->body = $body; goto gm0F4; jTGCA: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto Lc4ri; bi3NS: return $return; goto HFvRN; AFJXD: $xmlData = $this->arrayToXml($parameters); goto jfMfN; jfMfN: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto bi3NS; zCsN8: $parameters["\163\x69\147\x6e"] = $this->getSign($parameters); goto AFJXD; Lc4ri: $url = "\x68\x74\x74\160\x73\x3a\x2f\x2f\141\160\151\56\155\143\150\56\x77\x65\x69\x78\151\x6e\x2e\161\x71\x2e\x63\157\155\x2f\160\141\171\x2f\165\156\151\146\151\145\144\x6f\162\144\145\x72"; goto ALytr; ALytr: $parameters = array("\x61\160\160\151\144" => $this->appid, "\x6d\143\150\x5f\x69\144" => $this->mch_id, "\x6e\x6f\156\143\x65\137\x73\164\x72" => $this->createNoncestr(), "\x62\157\144\171" => $this->body, "\157\165\164\x5f\164\x72\141\144\x65\137\x6e\x6f" => $this->out_trade_no, "\x74\x6f\x74\x61\154\137\146\x65\145" => $this->total_fee, "\x73\160\x62\x69\x6c\154\137\143\x72\145\x61\x74\145\137\x69\x70" => "\61\71\62\56\61\66\x38\56\x30\56\61\x36\x31", "\156\x6f\x74\x69\x66\171\x5f\x75\x72\154" => "\150\x74\x74\160\72\57\57\x77\167\167\56\167\x65\151\x78\151\x6e\x2e\161\x71\x2e\x63\157\x6d\57\x77\170\x70\141\171\x2f\160\x61\171\56\160\x68\160", "\x6f\160\x65\156\151\144" => $this->openid, "\x74\162\141\x64\145\137\164\171\x70\x65" => "\x4a\x53\101\120\x49"); goto zCsN8; HFvRN: } private static function postXmlCurl($xml, $url, $second = 30) { goto Sg5Li; TpTW0: $error = curl_errno($ch); goto bWfzI; auK02: curl_close($ch); goto JpWER; S_yCr: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto TC6R2; U5uHH: cvgsd: goto auK02; I7RTG: if ($data) { goto cvgsd; } goto TpTW0; Wt2jA: goto e70Lh; goto U5uHH; tlzSy: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto TFqkz; u2IUG: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto swNzo; NFMVh: set_time_limit(0); goto wZ8g4; Sg5Li: $ch = curl_init(); goto u2IUG; ZooVA: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto NFMVh; TC6R2: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto J6AMW; J6AMW: curl_setopt($ch, CURLOPT_POST, TRUE); goto tlzSy; bWfzI: curl_close($ch); goto mY41J; TFqkz: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto ZooVA; diP9K: e70Lh: goto kGwIm; JpWER: return $data; goto diP9K; mY41J: throw new WxPayException("\x63\165\162\x6c\345\207\272\xe9\224\x99\357\274\x8c\xe9\x94\x99\xe8\xaf\xaf\xe7\240\x81\72{$error}"); goto Wt2jA; u1zfm: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto uJPYj; wZ8g4: $data = curl_exec($ch); goto I7RTG; swNzo: curl_setopt($ch, CURLOPT_URL, $url); goto u1zfm; uJPYj: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto S_yCr; kGwIm: } private function arrayToXml($arr) { goto V4sTl; T7PSU: return $xml; goto Gl5oJ; uARMi: bKxBf: goto QTKER; NiALP: foreach ($arr as $key => $val) { goto IffvO; RABPk: goto Z_S5q; goto n5Gz2; merIP: $xml .= "\x3c" . $key . "\76" . $val . "\74\57" . $key . "\76"; goto RABPk; voktJ: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\x3c\x2f" . $key . "\76"; goto hHVpg; hHVpg: Z_S5q: goto qisuG; n5Gz2: qbsZU: goto voktJ; IffvO: if (is_array($val)) { goto qbsZU; } goto merIP; qisuG: wOBYN: goto IeyOm; IeyOm: } goto uARMi; V4sTl: $xml = "\x3c\x72\157\x6f\x74\x3e"; goto NiALP; QTKER: $xml .= "\x3c\57\x72\157\157\164\76"; goto T7PSU; Gl5oJ: } private function xmlToArray($xml) { goto rvJmk; rvJmk: libxml_disable_entity_loader(true); goto V6ln_; QsTk7: return $val; goto w1OgG; V6ln_: $xmlstring = simplexml_load_string($xml, "\123\151\x6d\160\x6c\x65\x58\x4d\x4c\105\154\145\155\145\156\164", LIBXML_NOCDATA); goto S1KOb; S1KOb: $val = json_decode(json_encode($xmlstring), true); goto QsTk7; w1OgG: } private function weixinapp() { goto P51pX; P51pX: $unifiedorder = $this->unifiedorder(); goto mY3W_; MlfCs: return $parameters; goto miId6; hOOAz: $parameters["\x70\x61\171\123\151\x67\x6e"] = $this->getSign($parameters); goto MlfCs; mY3W_: $parameters = array("\141\160\160\x49\x64" => $this->appid, "\164\151\155\x65\123\x74\141\x6d\x70" => '' . time() . '', "\156\157\x6e\x63\145\x53\x74\x72" => $this->createNoncestr(), "\x70\x61\143\x6b\x61\x67\x65" => "\x70\x72\x65\160\x61\171\137\x69\144\75" . $unifiedorder["\160\162\x65\160\x61\171\137\x69\x64"], "\163\151\x67\156\x54\171\x70\x65" => "\x4d\104\65"); goto hOOAz; miId6: } private function createNoncestr($length = 32) { goto wZU3c; wZU3c: $chars = "\x61\x62\143\x64\145\x66\x67\150\151\x6a\x6b\x6c\x6d\156\x6f\x70\161\162\x73\x74\x75\x76\167\x78\171\x7a\60\61\x32\x33\64\65\x36\67\x38\x39"; goto bxH0I; CypAl: $i++; goto zm3fv; MMlg2: a9SkC: goto P1yMb; coVmo: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto TKyo_; bxH0I: $str = ''; goto bS9pD; DXuBP: iLI9D: goto pzwyw; pzwyw: return $str; goto n9Ap3; TKyo_: NCLW0: goto CypAl; bS9pD: $i = 0; goto MMlg2; zm3fv: goto a9SkC; goto DXuBP; P1yMb: if (!($i < $length)) { goto iLI9D; } goto coVmo; n9Ap3: } private function getSign($Obj) { goto GaERq; kLxOR: return $result_; goto ooy0r; u8z6t: $String = $this->formatBizQueryParaMap($Parameters, false); goto sviyK; XSZ5w: ksort($Parameters); goto u8z6t; GaERq: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; NjcV1: } goto J593d; sviyK: $String = $String . "\46\153\145\171\75" . $this->key; goto R0x9A; J593d: xxCcY: goto XSZ5w; jP5Qj: $result_ = strtoupper($String); goto kLxOR; R0x9A: $String = md5($String); goto jP5Qj; ooy0r: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto cB6Jy; LCGT3: foreach ($paraMap as $k => $v) { goto G6IiT; GSMyO: TolXE: goto Pkynq; Pkynq: $buff .= $k . "\75" . $v . "\x26"; goto b60z8; WMrO3: $v = urlencode($v); goto GSMyO; b60z8: tK_uj: goto UlWWK; G6IiT: if (!$urlencode) { goto TolXE; } goto WMrO3; UlWWK: } goto TmBlf; vz03x: return $reqPar; goto tqoec; ffN6h: ksort($paraMap); goto LCGT3; aYY87: $reqPar; goto eN715; eN715: if (!(strlen($buff) > 0)) { goto rm3zF; } goto oeXWy; cB6Jy: $buff = ''; goto ffN6h; oSAvf: rm3zF: goto vz03x; oeXWy: $reqPar = substr($buff, 0, strlen($buff) - 1); goto oSAvf; TmBlf: U9hmr: goto aYY87; tqoec: } }