{template 'common/header'}
<script type="text/javascript" src="{MODULE_URL}/template/static/web/jquery-easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="{MODULE_URL}/template/static/web/jquery-easyui/jquery.portal.js"></script>
<script type="text/javascript" src="{MODULE_URL}/template/static/web/jquery-easyui/locale/easyui-lang-zh_CN.js"></script>

<link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/static/web/jquery-easyui/themes/gray/easyui.css" />
<link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/static/web/jquery-easyui/themes/color.css" />
<link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/static/web/jquery-easyui/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="{MODULE_URL}/template/static/web/jquery-easyui/themes/IconExtension.css" />
<link href="{MODULE_URL}/template/static/css/layui.css" rel="stylesheet">
<link href="{MODULE_URL}/template/static/css/hujia.css" rel="stylesheet">

<link href="{MODULE_URL}/template/static/js/jquery.contextMenu.css" rel="stylesheet">
<link href="{MODULE_URL}/template/static/js/poster.css" rel="stylesheet">
<link href="{MODULE_URL}/template/static/css/font-awesome.css" rel="stylesheet">
<script>
	$(document).ready(function(){
		$(".wuyu").click(function(){
			$(".xuanxiang").toggle();
		});
	});
</script>
<style>
	.myinqut
	{
		width: 250px;
		margin-left: 20px;
	}
	.mysou
	{
		width: 80px;
		margin-left: 10px;
	}
	.kani
	{
		margin-left: 18px;
	}
        .xianshi {
            display: inline-block !important;
            cursor: pointer;
        }
        .form-group
        {
        	margin-left: 0 !important;
        	margin-right: 0 !important;
        }
        .btn-poster {
		    border: none;
		    outline: none;
		    margin-bottom: 10px;
		   }
		   .fa
		   {
		   	 margin-right: 7px;
		   }
		   .zhidao
	{
		
		height: 60px;
		/*border-bottom: 1px solid #e7e7eb;*/
		margin-left: -30px;
        margin-right: -30px;
		margin-top: -30px;
		margin-bottom: 30px;
	}
	.zhanneixin
	{
		height: 59px;
		line-height: 70px;
		/*border-bottom: 3px solid #428bca;*/
		font-family: "微软雅黑";
		font-size: 16px;
		color: #323232;
		margin-left: 30px;
	}
	.lakai
	{
		
	}
	.myinqut
	{
		width: 250px;
		margin-left: 20px;
	}
	.mysou
	{
		width: 80px;
		margin-left: 10px;
	}
	.wuyu
{
	width: 130px;
	height: 35px;
	border-radius:5px;
	border: 1px solid #C2C2C2;
	position: absolute;
	right: 30px;
	top: 80px;
	display: -webkit-flex;
	flex-direction: row;
	cursor: pointer;
}
.wuyu_one
{
	flex: 4;
	text-align: center;
	line-height: 35px;
	font-family: "微软雅黑";
	font-size: 14px;
	color: #000000;
}	
.wuyu_two
{
	flex: 1;
	text-align: center;
	line-height: 35px;
	color: #666666;
}
.xuanxiang
{
	width: 130px;
	position: absolute;
	top: 37px;
	left: 0;
	z-index: 999;
	border: 1px solid #EEEEEE;
	display: none;
}
.xuanxiang ul
{
	margin: 0;
	padding: 0;
	list-style: none;
}
.xuanxiang ul li
{
	width: 100%;
	height: 40px;
	background: white;
	text-align: center;
	line-height: 40px;
	font-family: "微软雅黑";
	font-size: 14px;
	color: #666666;
	
}
.xuanxiang ul li:hover
{
	background: #F5F5F5;
}
.xihuan_ji
	{
		width: 100%;
		height: 40px;
		margin-top: 25px;
		display: -webkit-flex;
		flex-direction: row;
	}
</style>
<div class="zhidao">
	<div class="zhanneixin">
		经纪人海报 [{$reply['activecode']} ]
	</div>
</div>
<div class="wuyu">
	<div class="wuyu_one">快捷管理菜单</div>
	<div class="wuyu_two">
		<span class="icon-caret-down"></span>
	</div>
	<div class="xuanxiang">
		<ul>
			<a href="{php echo $this->createWebUrl('votelist',array('rid'=>$reply['rid']))}" rel="tooltip" title="选手&订单"><li>选手&订单</li></a>
			<a href="{php echo $this->createWebUrl('robotmanage',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}" rel="tooltip" title="机器人管理" {if $this->module['config']['ischeatshow'] == 1}hidden{/if}><li>机器人管理</li></a>
			<a href="{php echo $this->createWebUrl('commandvote',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}" rel="tooltip" title="口令管理"><li>口令管理</li></a>
			<a href="{php echo $this->createWebUrl('mirrorvote',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}" rel="tooltip" title="镜像管理"><li>镜像管理</li></a>
			<a href="{php echo $this->createWebUrl('agenthb',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="经纪人海报"><li>经纪人海报</li></a>
            <a href="{php echo $this->createWebUrl('voteaddps',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="造势" {if $this->module['config']['ischeatshow'] == 1}hidden{/if}><li>造势</li></a>
            <a href="{php echo $this->createWebUrl('voteaddgift',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="刷礼物" {if $this->module['config']['ischeatshow'] == 1}hidden{/if}><li>刷礼物</li></a>
            <a href="{php echo $this->createWebUrl('detailset',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="模板管理"><li>模板管理</li></a>
            <a href="{php echo $this->createWebUrl('htmlmode',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="主题模板设置"><li hidden>主题模板设置</li></a>
            <a href="{php echo $this->createWebUrl('domainlist',array('reply_id'=>$reply['id'],'rid'=>$reply['rid']))}"  rel="tooltip" title="域名防封"><li>域名防封</li></a>
            {if $reply['config']['isredpack']==1}
            <a href="{php echo $this->createWebUrl('lottery',array('rid'=>$reply['rid']))}" rel="tooltip" title="红包管理"> <li>红包管理</li></a>
            {/if}
            {if $reply['saiqustatus']==1}
            <a href="{php echo $this->createWebUrl('saiqumanage',array('reply_id'=>$reply['id'],'rid'=>$reply['rid'],'op'=>'display'))}"  rel="tooltip" title="赛区管理"><li>赛区管理</li></a>
            {/if}
            <a rel="tooltip" href="{php echo url('platform/reply/post',array('m'=>'silence_vote','rid'=>$reply['rid']));}" title="编辑活动"><li class="bianjiea">编辑活动</li></a>
		</ul>
	</div>
</div>
<ul class="nav nav-tabs">
    <li {if $operation=='display'}class="active"{/if}>
        <a href="{php echo $this->createWebUrl('agenthb',array('rid'=>rid,'op'=>'display'))}">经纪人海报</a>
    </li>
</ul>

{if $operation == 'display'}
<script  src="{MODULE_URL}/template/static/js/jquery.form.js"></script>
<script  src="{MODULE_URL}/template/static/js/designer.js" type="text/javascript"></script>
<script  src="{MODULE_URL}/template/static/js/jquery.contextMenu.js" type="text/javascript"></script>

<form id='agenthb-form' action="{php echo $this->createWebUrl('agenthb',array('op'=>'post'))}" method="post" class="form form-horizontal">
<div class="we7-form  nav_tab   nav_9">
            <div class="wq-panel-body">
            {if $nofont==1}
                <div class="alert alert-danger" role="alert">没有字体文件，请点击 <a href="http://beta.wxj360.com/addons/silence_vote/lib/font/font.ttf" target="_blank"  class="btn-danger" value="check">下载字体</a> 下载字体文件，上传至以下目录，字体文件名必须为 font.ttf，不可修改。<br/><br/>
                <span class="label label-success">/addons/silence_vote/lib/font/font.ttf</span>，没有目录就新建。
                </div>
            {/if}
                <div class="form-group" hidden>
                  <label class="control-label col-sm-2">海报功能</label>
                  <div class="form-controls  col-sm-8 ">
                     <label><input class="xianshi" type="radio" value="0" name="isposter" {if $aghb['isposter'] == 0 }checked{/if}>关闭    </label>
                     <label><input class="xianshi" type="radio" value="1" name="isposter" {if $aghb['isposter'] == 1 }checked{/if}>开启    </label>
                     <div class="help-block"></div>
                  </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-sm-2"><span class="text-danger">*</span>海报提示</label>
                    <div class="form-controls col-sm-8 col-xs-12">
                        <input type="text" class="form-control" name="bill_hint" value="{$aghb['bill_hint']}"/>
                    </div>
                </div>
                <div class="form-group" style="min-height:600px;">
                    <div class="form-controls col-sm-12 ">
                        <table style='width:100%;'>
                            <tr>
                                <td id="bgtd" style='padding-right: 10px;' valign='top'>
                                    <div id='tiger_poster'>
                                        {if !empty($aghb['bill_bg'])}
                                          <img src="{php echo toimage($aghb['bill_bg'])}" class='bg'/>
                                        {/if}
                                        
                                        {if !empty($bill_data)}
                                        {loop $bill_data $index $item}
                                        <div class="drag" type="{$item['type']}" index="{php echo $index+1}" style="zindex:{php echo $index+1};left:{$item['left']};top:{$item['top']};
                                               width:{$item['width']};height:{$item['height']}" size="{$item['size']}" color="{$item['color']}" >
                                            {if $item['type']=='img' || $item['type']=='thumb'}
                                            <img src="{MODULE_URL}/template/static/images/default.jpg" />
                                            {elseif $item['type']=='avatar'}
                                            <img src="{MODULE_URL}/template/static/images/avatar.jpg" />
                                            {elseif $item['type']=='qr'}
                                            <img src="{MODULE_URL}/template/static/images/qr.png" />
                                            {elseif $item['type']=='name'}
                                            <div class=text style="font-size:{$item['size']};color:{$item['color']}" >海报提示</div>
                                            {elseif $item['type']=='number'}
                                            <div class=text style="font-size:{$item['size']};color:{$item['color']}" >编号</div>
                                            {/if}
                                            <div class="dRightDown"> </div><div class="dLeftDown"> </div><div class="dRightUp"> </div><div class="dLeftUp"> </div><div class="dRight"> </div><div class="dLeft"> </div><div class="rUp"> </div><div class="rDown"></div>
                                        </div>
                                        {/loop}
                                        {/if}
                                    </div>
                                </td>
                                
                                
                                <td valign='top'>
                                    <div class='we7-form'>
                                        <div class='wq-panel-body'>
                                            <div class="form-group">
                                                <label class="control-label col-sm-2">海报元素</label>
                                                <div class="form-controls col-sm-10 col-xs-12 ys-btn">
                                                    <button class='btn-info btn-poster  btn-sm' type='button'
                                                            data-type='img' hidden><i class="fa fa-photo"></i>报名照片
                                                    </button>
                                                    <button class='btn-primary btn-poster btn-sm' type='button'
                                                            data-type='avatar'><i class="fa fa-user"></i>经纪人头像
                                                    </button>
                                                    <button class='btn-warning btn-poster btn-sm' type='button'
                                                            data-type='name'><i class="fa fa-file-text-o"></i>海报提示
                                                    </button>
                                                                               <button class='btn-success btn-poster btn-sm' type='button'
                                                            data-type='number' hidden><i class="fa fa-file-text-o"></i>选手编号
                                                    </button>
                                                    <button class='btn-danger btn-poster btn-sm' type='button'
                                                            data-type='qr'><i class="fa fa-qrcode"></i>二维码
                                                    </button>
                                                    <div class='help-block' style="color:#f49422;display:block; clear:both;">请保持” 海报提示 “在最顶层，右键点击” 移动至最顶层 “。为了性能，最多添加3个种类。海报提示字体大小为16px时，字数限制15位</div>
                                                </div> 
                                                
                                            </div>
                                            <div id='namesset' style='display:none'>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">字体颜色</label>
                                                    <div class="form-controls col-sm-10 col-xs-12">
                                                        {php echo tpl_form_field_color('color')}
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">字体大小</label>
                                                    <div class="form-controls col-sm-10">
                                                        <div class='input-group'>
                                                            <input type="text" id="namesize"
                                                                   class="form-control namesize" placeholder="例如: 15"/>
                                                            <div class='input-group-addon'>px</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group" id="posterbg">
                                                <label class="control-label col-sm-2">海报背景</label>
                                                <div class="form-controls col-sm-8 col-xs-12">
                                                    {php echo tpl_form_field_image('bill_bg', $aghb['bill_bg'])}
                                                    <span class='help-block'>海报背景大小建议尺寸为: 640 * 1008</span>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                    <label class="control-label col-sm-2"></label>
                                                    <div class="form-controls col-sm-10 col-xs-12">
                                                        <button  type="button" class="btn btn-danger clearposter" value="check">清除经纪人海报</button>
                                                        <span class='help-block'>修改海报信息时，请清除已生成海报图片数据。
                            <br>
<!--                            <a href="http://doc.wxj360.com/index.php?s=/1&page_id=7" target="_blank"   class="btn_add_join text-primary"><i class="fa fa-eye" title="查看教程"></i> 查看教程</a>-->
                            </span>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>


            </div>
        <input type="hidden" name="bill_data" value="" />
        </div>
                    <div class="form-group">
                    <div class="col-sm-9 col-md-offset-2">
                        <input name="submit" type="submit" value="提交" class="btn btn-primary ">
                        <input type="hidden" name="token" value="{$_W['token']}"/>
                        <input type="hidden" name="id" value="{$aghb['id']}"/>
                        <input type="hidden" name="rid" value="{$rid}"/>
                    </div>
                </div>
 </form>
{/if}
<script  src="{MODULE_URL}/template/static/js/poster.js" type="text/javascript"></script>
<script type="text/javascript">  

	

$(document).ready(function(){




var we7form=$("#reply-form .we7-form:first").html();
$("#we7form").html(we7form);
$("#reply-form .we7-form:first").remove();
//清除海报
$(".clearposter").click(function(){
	$.ajax({
		type: "POST",
		url: "{php echo $this->createWebUrl('otherset', array('rid' => $aghb['rid'],'ty'=>'delposterimg_agent'))}",
		dataType: "json",
		success: function(str) {
			if(str!=null && str!=''){
				if(str.status == 200){
					util.message('操作成功', '', 'success');
				}
			}
		},
		error: function(err) {
			util.message('操作失败');
		}
	});

});
//清除海报
require(['jquery', 'util'], function($, util){
  $(function(){

		//礼物设置
		$('#btn_add_gift').bind('click', function(){
			 var content='<tr><td class="text-left" ><input type="text" placeholder="输入名称" value="" class="form-control" name="gifttitle[]"></td><td><div class="adimgbox"><a href="javascript:;" class="thumbadimg"><img src="../attachment/images/global/nopic.jpg"  height="30"><input type="hidden" value="" name="gifticon[]"></a></div></td><td class="text-left" ><div class="input-group"><input type="text" placeholder="输入支付价格" value="" class="form-control" name="giftprice[]"><span class="input-group-addon">元</span></div></td><td class="text-left" ><div class="input-group"><input type="text" placeholder="输入礼物奖励的票数" value="" class="form-control" name="giftvote[]"></div></td><td><button type="button" class="btn btn-danger btn_del_ad btn-xs">删除</button></td></tr>';
			 $("#js-table-2 tr:last").after(content);
		  });
  });
});
		
  $('.btn_clear_ad').click(function(){ 
	$("input[name='voteadimg']").val("");
	$(".tanchuad .thumbadimg img").attr("src","");
	$("input[name='voteadurl']").val("");
  });
    //Default Action  
    $(".nav_tab").hide(); //Hide all content  
    $(".navtab a:first").addClass("active").show(); //Activate first tab  
    $(".nav_tab:first").show(); //Show first tab content  
      
    //On Click Event  
    $(".navtab a").click(function() {  
        $(".navtab a").removeClass("active"); //Remove any "active" class  
        $(this).addClass("active"); //Add "active" class to selected tab  
        $(".nav_tab").hide(); //Hide all tab content  
        var activeTab = $(this).attr("data-tab"); //Find the rel attribute value to identify the active tab + content  
        $("."+activeTab).show(); //Fade in the active content  
        return false;  
    });  
	
	$('body').delegate('.thumbadimg img','click', function() {
      thimg=$(this);
      util.image('',function(data){
      thimg.attr("src",data['url']);
      thimg.next().val(data['attachment']);
      },'',{'fileNumLimit':1, 'width'  :320,'height' : 120,'thumb': true});
    });
	$('body').delegate('.btn_del_ad','click', function() {
      var obj = $(this).parent().parent();
      obj.slideUp(300, function() {
        obj.remove();
      });
    });
	$('body').delegate('.del_box','click', function() {
		var obj = $(this).parent();
		obj.remove();
				
	});
  
});  	
  window.initReplyController = function($scope) {
  };
  window.validateReplyForm = function(form, $, _, util, $scope) {
    return true;
  };

  $('.del_box').bind('click', function(){
			var obj = $(this).parent();
			obj.remove();
			
   });
  		
 //海报start
var gqrt = 0;
    var siteurl = "{$_W['siteroot']}";
    var attachurl = "{$_W['attachurl']}";
    var ncounter = 0;

    function tiger_bind(obj){
        var imgsset = $('#imgsset');
        var namesset = $("#namesset");
        imgsset.hide();
        namesset.hide();
        deleteTimers();
        var type = obj.attr('type');
        if(type=='name' || type=='number'){
            namesset.show();
            var size = obj.attr('size') || "16";
            var picker = namesset.find('.sp-preview-inner');
            var input = namesset.find('input:first');
            var namesize = namesset.find('#namesize');
            var color = obj.attr('color') || "#000";
            input.val(color); namesize.val(size.replace("px",""));
            picker.css( {'background-color':color,'font-size':size});
            ncounter = setInterval(function(){
                obj.attr('color',input.val()).find('.text').css('color',input.val());
                obj.attr('size',namesize.val() +"px").find('.text').css('font-size',namesize.val() +"px");
            },100);
        }
    }
    var bscounter = 0 ;
    var imgcounter = 0 ;
    $(function(){

        $('.drag').each(function(){
            dragEvent($(this));
        });

        $('.btn-poster').click(function(){
            var imgsset = $('#imgsset');
            var namesset = $("#namesset");
            imgsset.hide();
            namesset.hide();
            deleteTimers();
            var type = $(this).data('type');
            var img = "";
            if(type=='img' || type=='thumb'){
                img = '<img src="{MODULE_URL}/template/static/images/default.jpg" />';
            } else if(type=='avatar'){
                img = '<img src="{MODULE_URL}/template/static/images/avatar.jpg" />';
            } else if(type=='name'){
                img = '<div class=text>海报提示</div>';
            }else if(type=='number'){
                img = '<div class=text>编号</div>';
            }else if(type=='qr'){
                img = '<img src="{MODULE_URL}/template/static/images/qr.png" />';
            }
            var index = $('#tiger_poster .drag').length+1;
            var obj = $('<div class="drag" type="' + type +'" index="' + index +'" style="z-index:' + index+';left:0;top:0;">' + img+'<div class="dRightDown"> </div><div class="dLeftDown"> </div><div class="dRightUp"> </div><div class="dLeftUp"> </div><div class="dRight"> </div><div class="dLeft"> </div><div class="rUp"> </div><div class="rDown"></div></div>');
            $('#tiger_poster').append(obj);
            dragEvent(obj);

            $('.drag').click(function(){
                tiger_bind($(this));
            })

        });
    });
	
	 var imgcounter = 0 ;   
     $('#agenthb-form').submit(function(){

      var infotypeval = 0;
      $("select[name='infotype[]']").each(  
        function(index,e){  
            if($(this).val()==""){
                infotypeval=1;
            }
        }  
      );
      if(infotypeval){ 
        util.message('请至“报名设置”-“报名信息”-选择报名信息输入类型，不可重复选择！');
        return false;
      }

        var poster = [];
        $('.drag').each(function(){
            var obj = $(this);
            var type = obj.attr('type');
            var left = obj.css('left');
            var top = obj.css('top');
            var d= {left:left,top:top,type:obj.attr('type'),width:obj.css('width'),height:obj.css('height')};
            if(type=='name' ||type=='number' ){
                d.size = obj.attr('size');
                d.color = obj.attr('color');
            }
            poster.push(d);
        });
        $('input[name="bill_data"]').val( JSON.stringify(poster));
        return true;
    });
//海报end 
//模板风格设置start
	$('.temp_box ul li img').click(function(){
	    $(this).parent().siblings().removeClass("ontemp");
        $(this).parent().addClass("ontemp");
		$("#template").val($(this).parent().attr("data-temp"));
		$(".temp_style p").removeClass("onstyle");
		$(this).next().children("p:first").addClass("onstyle");
		$("#setstyle").val($(this).next().children("p:first").attr("data-sty"));
    });
	$('.setstyle').click(function(){
	   $(".temp_style p").removeClass("onstyle");
	   $(this).addClass("onstyle");
	   $("#setstyle").val($(this).attr("data-sty"));
	   $('.temp_box ul li').removeClass("ontemp");
	   $(this).parent().parent().addClass("ontemp");
	   $("#template").val($(this).parent().parent().attr("data-temp"));
	});
//模板风格设置end
</script>
{template 'common/footer'}