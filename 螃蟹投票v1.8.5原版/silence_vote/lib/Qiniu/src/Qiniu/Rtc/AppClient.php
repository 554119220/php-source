<?php
 namespace Qiniu\Rtc; use Qiniu\Http\Client; use Qiniu\Http\Error; use Qiniu\Config; use Qiniu\Auth; class AppClient { private $auth; private $baseURL; public function __construct(Auth $auth) { $this->auth = $auth; $this->baseURL = sprintf("\x25\163\57\45\163\x2f\x61\160\160\x73", Config::RTCAPI_HOST, Config::RTCAPI_VERSION); } public function createApp($hub, $title, $maxUsers = null, $noAutoKickUser = null) { goto K6Vtv; m6cKO: $body = json_encode($params); goto rsKiw; rsKiw: $ret = $this->post($this->baseURL, $body); goto beRx4; lELd9: $params["\x6e\157\x41\165\x74\x6f\113\151\x63\153\x55\x73\x65\x72"] = $noAutoKickUser; goto U31R3; U22_3: if (empty($maxUsers)) { goto aEqx7; } goto cZI3m; bbw8k: $params["\164\x69\x74\154\x65"] = $title; goto U22_3; K6Vtv: $params["\x68\x75\x62"] = $hub; goto bbw8k; U31R3: OKTg3: goto m6cKO; cZI3m: $params["\155\141\170\x55\x73\x65\x72\163"] = $maxUsers; goto N0bWo; N0bWo: aEqx7: goto I2k8b; I2k8b: if (empty($noAutoKickUser)) { goto OKTg3; } goto lELd9; beRx4: return $ret; goto lTmDD; lTmDD: } public function updateApp($appId, $hub, $title, $maxUsers = null, $mergePublishRtmp = null, $noAutoKickUser = null) { goto lRR5v; BVHHB: EiiSl: goto JF04a; mj0NA: $params["\155\145\x72\x67\145\120\x75\x62\x6c\151\x73\150\x52\x74\x6d\x70"] = $mergePublishRtmp; goto BVHHB; JF04a: $body = json_encode($params); goto XnQYb; BcaQQ: if (empty($noAutoKickUser)) { goto a_3Ir; } goto lt1RL; Ob3hn: $params["\164\151\164\154\145"] = $title; goto TcMSW; lt1RL: $params["\x6e\157\101\165\x74\x6f\113\x69\x63\153\x55\x73\x65\162"] = $noAutoKickUser; goto Qi3Xo; jEggG: return $ret; goto gsPhu; bCS6l: fmwtS: goto BcaQQ; TcMSW: if (empty($maxUsers)) { goto fmwtS; } goto VWR9v; VWR9v: $params["\x6d\x61\170\x55\x73\x65\162\x73"] = $maxUsers; goto bCS6l; Qi3Xo: a_3Ir: goto hJ_Cs; lRR5v: $url = $this->baseURL . "\x2f" . $appId; goto uSRG4; hJ_Cs: if (empty($mergePublishRtmp)) { goto EiiSl; } goto mj0NA; uSRG4: $params["\150\x75\x62"] = $hub; goto Ob3hn; XnQYb: $ret = $this->post($url, $body); goto jEggG; gsPhu: } public function getApp($appId) { goto usCe6; usCe6: $url = $this->baseURL . "\x2f" . $appId; goto gCRpG; gCRpG: $ret = $this->get($url); goto JeEPp; JeEPp: return $ret; goto Npz6q; Npz6q: } public function deleteApp($appId) { goto zWoC_; rp2HQ: return $err; goto PkRUU; Vacuq: list(, $err) = $this->delete($url); goto rp2HQ; zWoC_: $url = $this->baseURL . "\x2f" . $appId; goto Vacuq; PkRUU: } public function listUser($appId, $roomName) { goto dWh2W; c1L_L: return $ret; goto yWrKz; xrXT6: $ret = $this->get($url); goto c1L_L; dWh2W: $url = sprintf("\45\163\x2f\x25\163\57\x72\157\x6f\155\163\57\45\163\x2f\x75\163\x65\162\x73", $this->baseURL, $appId, $roomName); goto xrXT6; yWrKz: } public function kickUser($appId, $roomName, $userId) { goto mwUje; mwUje: $url = sprintf("\45\163\57\x25\163\x2f\162\157\x6f\155\163\x2f\x25\163\x2f\165\163\x65\162\x73\57\x25\x73", $this->baseURL, $appId, $roomName, $userId); goto V0Pv5; V0Pv5: list(, $err) = $this->delete($url); goto UA8uU; UA8uU: return $err; goto AZbPI; AZbPI: } public function listActiveRooms($appId, $prefix = null, $offset = null, $limit = null) { goto Fi1jl; XffT7: uVafg: goto SDfCP; dYdic: $url = sprintf("\x25\163\57\x25\x73\x2f\162\157\157\x6d\163", $this->baseURL, $appId); goto lz9n8; gphvh: $url = sprintf("\45\x73\x2f\45\163\57\162\157\157\155\x73\x25\163", $this->baseURL, $appId, $query); goto L5d_U; Mtf7W: $ret = $this->get($url); goto LyL1p; DwIFP: $query["\154\x69\x6d\x69\164"] = $limit; goto XffT7; SDfCP: if (isset($query) && !empty($query)) { goto UU4hJ; } goto dYdic; L5d_U: rwo2y: goto Mtf7W; JEDTd: $query["\x6f\x66\x66\x73\145\x74"] = $offset; goto sIatS; LyL1p: return $ret; goto CH0fR; xN1bP: $query = "\x3f" . http_build_query($query); goto gphvh; K7GMj: $query["\x70\x72\x65\x66\x69\170"] = $prefix; goto Ml8md; lz9n8: goto rwo2y; goto SDNFz; Whgzd: if (!isset($offset)) { goto mHbim; } goto JEDTd; Fi1jl: if (!isset($prefix)) { goto awPeU; } goto K7GMj; k5a_R: if (!isset($limit)) { goto uVafg; } goto DwIFP; Ml8md: awPeU: goto Whgzd; sIatS: mHbim: goto k5a_R; SDNFz: UU4hJ: goto xN1bP; CH0fR: } public function appToken($appId, $roomName, $userId, $expireAt, $permission) { goto ehcD5; ehcD5: $params["\x61\x70\x70\111\x64"] = $appId; goto idEgP; wibh2: $appAccessString = json_encode($params); goto eL2S5; P72Ku: $params["\x70\145\x72\155\x69\x73\x73\151\x6f\x6e"] = $permission; goto bus56; s3mJP: $params["\162\x6f\157\x6d\x4e\x61\155\145"] = $roomName; goto P72Ku; idEgP: $params["\x75\163\145\162\x49\x64"] = $userId; goto s3mJP; bus56: $params["\x65\x78\160\x69\162\x65\x41\x74"] = $expireAt; goto wibh2; eL2S5: return $this->auth->signWithData($appAccessString); goto lxJrK; lxJrK: } private function get($url, $cType = null) { goto ir9qb; rPMYH: return array(null, new Error($url, $ret)); goto vdIDO; XpfTr: $rtcToken["\x43\x6f\156\164\x65\x6e\x74\x2d\x54\x79\160\x65"] = $cType; goto tdww3; ir9qb: $rtcToken = $this->auth->authorizationV2($url, "\x47\105\124", null, $cType); goto XpfTr; tdww3: $ret = Client::get($url, $rtcToken); goto M3eHA; vdIDO: uRVw3: goto mIrLp; M3eHA: if ($ret->ok()) { goto uRVw3; } goto rPMYH; mIrLp: return array($ret->json(), null); goto OR3QJ; OR3QJ: } private function delete($url, $contentType = "\141\x70\x70\x6c\x69\x63\141\164\x69\157\x6e\x2f\x6a\x73\157\x6e") { goto pcCVY; imNzC: $ret = Client::delete($url, $rtcToken); goto Q02vP; x8rND: $rtcToken["\x43\157\156\164\x65\156\x74\55\x54\x79\x70\x65"] = $contentType; goto imNzC; cAtnk: return array($ret->json(), null); goto zWkKT; Q02vP: if ($ret->ok()) { goto G643S; } goto gJBM5; z4p1f: G643S: goto cAtnk; gJBM5: return array(null, new Error($url, $ret)); goto z4p1f; pcCVY: $rtcToken = $this->auth->authorizationV2($url, "\x44\105\114\x45\x54\x45", null, $contentType); goto x8rND; zWkKT: } private function post($url, $body, $contentType = "\141\160\160\x6c\151\143\x61\164\151\157\x6e\57\x6a\x73\157\x6e") { goto EnnNg; bl6Uk: $ret = Client::post($url, $body, $rtcToken); goto jt11l; m6Ipm: bRG7B: goto Qea6s; Qea6s: $r = $ret->body === null ? array() : $ret->json(); goto E1wFy; EnnNg: $rtcToken = $this->auth->authorizationV2($url, "\120\117\123\124", $body, $contentType); goto RFpyp; jt11l: if ($ret->ok()) { goto bRG7B; } goto wpGO1; wpGO1: return array(null, new Error($url, $ret)); goto m6Ipm; RFpyp: $rtcToken["\103\x6f\x6e\164\145\156\164\55\124\171\x70\x65"] = $contentType; goto bl6Uk; E1wFy: return array($r, null); goto CuoUT; CuoUT: } }