<?php
 namespace Qiniu\Processing; use Qiniu; final class ImageUrlBuilder { protected $modeArr = array(0, 1, 2, 3, 4, 5); protected $formatArr = array("\160\x73\x64", "\152\x70\x65\147", "\x70\x6e\x67", "\x67\x69\146", "\167\145\x62\x70", "\x74\151\x66\146", "\x62\x6d\x70"); protected $gravityArr = array("\116\157\x72\x74\150\x57\145\163\x74", "\116\157\162\164\150", "\x4e\x6f\162\x74\x68\105\141\163\x74", "\127\x65\163\x74", "\x43\145\156\x74\x65\x72", "\x45\141\163\164", "\x53\157\x75\164\150\x57\x65\x73\164", "\x53\x6f\x75\x74\x68", "\123\x6f\x75\164\x68\105\x61\163\x74"); public function thumbnail($url, $mode, $width, $height, $format = null, $interlace = null, $quality = null, $ignoreError = 1) { goto sM8hn; fjVJQ: return $url . ($this->hasQuery($url) ? "\x7c" : "\x3f") . $thumbStr; goto X7aWQ; qhIK4: if (!(!is_null($interlace) && in_array(intval($interlace), array(0, 1), true))) { goto upaxO; } goto S7Hft; TLVau: if (!(!is_null($quality) && intval($quality) >= 0 && intval($quality) <= 100)) { goto swh1e; } goto XN0vF; hP0W9: if (in_array(intval($mode), $this->modeArr, true)) { goto oBtnJ; } goto Ukiq4; XN0vF: $thumbStr .= "\161\57" . $quality . "\x2f"; goto F6eqr; Ghbsw: return $url; goto VoVWA; VoVWA: eh8Hu: goto vRfOE; sM8hn: if ($this->isUrl($url)) { goto Foy2D; } goto e4uXg; vRfOE: $thumbStr = "\x69\x6d\x61\147\145\126\151\145\167\x32\x2f" . $mode . "\x2f\x77\57" . $width . "\57\150\x2f" . $height . "\x2f"; goto pj8gD; a5Zac: oBtnJ: goto IDkAe; IDkAe: if (!(!$width || !$height)) { goto eh8Hu; } goto Ghbsw; pj8gD: if (!(!is_null($format) && in_array($format, $this->formatArr))) { goto TyBSn; } goto UqZeM; pW6Us: Foy2D: goto hP0W9; Ukiq4: return $url; goto a5Zac; uONb1: $thumbStr .= "\x69\147\x6e\157\162\x65\55\x65\162\162\157\162\x2f" . $ignoreError . "\57"; goto fjVJQ; LMdxE: upaxO: goto TLVau; e4uXg: return $url; goto pW6Us; GB1sR: TyBSn: goto qhIK4; F6eqr: swh1e: goto uONb1; S7Hft: $thumbStr .= "\151\x6e\x74\x65\162\154\141\143\x65\x2f" . $interlace . "\57"; goto LMdxE; UqZeM: $thumbStr .= "\146\x6f\x72\x6d\x61\x74\x2f" . $format . "\x2f"; goto GB1sR; X7aWQ: } public function waterImg($url, $image, $dissolve = 100, $gravity = "\x53\x6f\x75\164\150\x45\141\x73\x74", $dx = null, $dy = null, $watermarkScale = null) { goto lXm5k; QIIHL: $waterStr = "\x77\141\x74\x65\162\155\141\162\153\57\61\x2f\151\x6d\141\147\x65\x2f" . \Qiniu\base64_urlSafeEncode($image) . "\57"; goto Z5OPT; CJFf_: if (!(!is_null($dx) && is_numeric($dx))) { goto DKiFN; } goto OFZhV; P7pQF: $waterStr .= "\144\171\x2f" . $dy . "\x2f"; goto j2y3F; V83y_: fTxxX: goto iG81B; lXm5k: if ($this->isUrl($url)) { goto oHgXE; } goto Y0nDZ; QJSI6: DKiFN: goto iKFbr; OFZhV: $waterStr .= "\x64\x78\x2f" . $dx . "\57"; goto QJSI6; iG81B: return $url . ($this->hasQuery($url) ? "\x7c" : "\77") . $waterStr; goto XpMoD; U2IYl: if (!(!is_null($watermarkScale) && is_numeric($watermarkScale) && $watermarkScale > 0 && $watermarkScale < 1)) { goto fTxxX; } goto kmkzQ; hfqxe: oHgXE: goto QIIHL; j2y3F: UyzxR: goto U2IYl; Z5OPT: if (!(is_numeric($dissolve) && $dissolve <= 100)) { goto S0HbE; } goto orT0p; kmkzQ: $waterStr .= "\167\163\x2f" . $watermarkScale . "\57"; goto V83y_; tVosc: coipt: goto CJFf_; iKFbr: if (!(!is_null($dy) && is_numeric($dy))) { goto UyzxR; } goto P7pQF; wnsnQ: if (!in_array($gravity, $this->gravityArr, true)) { goto coipt; } goto UorGN; Y0nDZ: return $url; goto hfqxe; esMqJ: S0HbE: goto wnsnQ; orT0p: $waterStr .= "\x64\151\163\163\x6f\154\x76\145\57" . $dissolve . "\x2f"; goto esMqJ; UorGN: $waterStr .= "\x67\162\x61\x76\x69\x74\171\57" . $gravity . "\x2f"; goto tVosc; XpMoD: } public function waterText($url, $text, $font = "\351\273\x91\xe4\xbd\x93", $fontSize = 0, $fontColor = null, $dissolve = 100, $gravity = "\x53\x6f\x75\x74\150\x45\x61\163\164", $dx = null, $dy = null) { goto KSbak; lIWRG: if (!(!is_null($dx) && is_numeric($dx))) { goto J8UkH; } goto PTVoP; FaqVn: zmt1T: goto axO0I; I3c2n: $waterStr .= "\x64\x69\x73\163\157\154\x76\145\57" . $dissolve . "\57"; goto yeiHq; oD49Q: IKY5K: goto lIWRG; jLMGa: $waterStr .= "\x67\x72\141\x76\151\164\x79\57" . $gravity . "\57"; goto oD49Q; KSbak: if ($this->isUrl($url)) { goto qUqys; } goto fY3t2; I3iSg: J8UkH: goto tQU2m; PTVoP: $waterStr .= "\x64\170\x2f" . $dx . "\57"; goto I3iSg; axO0I: return $url . ($this->hasQuery($url) ? "\x7c" : "\x3f") . $waterStr; goto iPYNT; sUtma: $waterStr .= "\x66\x6f\156\164\163\151\x7a\x65\x2f" . $fontSize . "\57"; goto yxClH; AMbDe: if (!is_int($fontSize)) { goto sooN2; } goto sUtma; yeiHq: Waqc0: goto oCBFi; HOCBK: if (!(!is_null($fontColor) && $fontColor)) { goto zYmsF; } goto xTqM1; yxClH: sooN2: goto HOCBK; oCBFi: if (!in_array($gravity, $this->gravityArr, true)) { goto IKY5K; } goto jLMGa; tQU2m: if (!(!is_null($dy) && is_numeric($dy))) { goto zmt1T; } goto K1ZBP; K1ZBP: $waterStr .= "\144\x79\x2f" . $dy . "\57"; goto FaqVn; NIc23: zYmsF: goto pOzZS; xTqM1: $waterStr .= "\x66\151\154\154\57" . \Qiniu\base64_urlSafeEncode($fontColor) . "\x2f"; goto NIc23; IXFo6: $waterStr = "\167\141\x74\x65\x72\x6d\141\162\153\x2f\x32\57\x74\x65\x78\x74\57" . \Qiniu\base64_urlSafeEncode($text) . "\x2f\x66\x6f\x6e\164\57" . \Qiniu\base64_urlSafeEncode($font) . "\x2f"; goto AMbDe; pOzZS: if (!(is_numeric($dissolve) && $dissolve <= 100)) { goto Waqc0; } goto I3c2n; bJ4fb: qUqys: goto IXFo6; fY3t2: return $url; goto bJ4fb; iPYNT: } protected function isUrl($url) { $urlArr = parse_url($url); return $urlArr["\x73\143\x68\x65\x6d\145"] && in_array($urlArr["\x73\143\150\145\x6d\x65"], array("\x68\x74\164\x70", "\150\164\164\160\163")) && $urlArr["\x68\x6f\163\164"] && $urlArr["\x70\141\164\150"]; } protected function hasQuery($url) { $urlArr = parse_url($url); return !empty($urlArr["\x71\165\x65\x72\x79"]); } }