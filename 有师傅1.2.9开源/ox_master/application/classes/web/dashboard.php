<?phpif (!(defined('IN_IA'))){    exit('Access Denied');}class Web_dashboard extends Web_Base{    /* * 概览 曲线图 */    public function linechart(){        global $_W,$_GPC;        $type = $_GPC['type'];        $uniacid=$_W['uniacid'];        $table_name = 'ox_master_store';        $by = 'create_time';        $title = '新增用户';        if($type == 'messages'){            $table_name = 'ox_master_store';            $filed = 'count(create_time) nums, create_time';            $title = '新增师傅';        }elseif($type == 'purchases'){            $table_name = 'ox_master_finance';            $filed = 'sum(account) nums, create_time';            $title = '今日收益';        }elseif($type == 'shoppings'){            $table_name = 'ox_master_order';            $filed = 'count(create_time) nums, create_time';            $title = '今日订单';        }elseif($type == 'newVisitis'){            $table_name = 'mc_mapping_fans';            $filed = 'count(updatetime) nums, updatetime as create_time';            $by = 'updatetime';        }        $sql = "select  $filed from ".tablename($table_name)." where uniacid = $uniacid group by $by order by $by asc limit 10 ";        $list = pdo_fetchall($sql);        $result = [];        $expectedData = [];        $xdata = [];        foreach($list as $k=>$v){            $expectedData[$k] = $v['nums'];            $date = date('Y-m-d',$v['create_time']);            $xdata[$k] = $date;        }        $result['actualData'] = $expectedData;        $result['xData'] = $xdata;        $result['title'] = $title;        //查询所有会员数        $usernum = pdo_fetchcolumn('select count(*) from '.tablename('mc_mapping_fans').' where uniacid='.$uniacid);        $datas['usernum'] = empty($usernum) ? 0 : (int)$usernum;        //查询所有师傅数量        $store = pdo_fetchcolumn('select count(*) from '.tablename('ox_master_store').' where uniacid='.$uniacid.' and status=1');        $datas['store'] = empty($store) ? 0 : (int)$store;        //查询今日收益        //今日开始时间时间戳        $today = strtotime(date('Y-m-d',time()));        $income = pdo_fetchcolumn('select sum(account) from '.tablename('ox_master_finance').' where uniacid='.$uniacid.' and status=1 and  create_time>'.$today);        $datas['income'] = empty($income) ? 0 : (float)$income;        //查询今日订单数        $order = pdo_fetchcolumn('select count(*) from '.tablename('ox_master_order').' where uniacid='.$uniacid.' and create_time >'.$today);        $datas['order'] = empty($order) ? 0 : (int)$order;        $result['datas'] = $datas;        return $this->result(0,'',$result);    }}