<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto SbLPO; qX8sh: $this->key = $key; goto LXNnn; en1Z1: $this->openid = $openid; goto VQYq1; k9XA1: $this->body = $body; goto tJUsg; VQYq1: $this->mch_id = $mch_id; goto qX8sh; tJUsg: $this->total_fee = $total_fee; goto uLYUe; SbLPO: $this->appid = $appid; goto en1Z1; LXNnn: $this->out_trade_no = $out_trade_no; goto k9XA1; uLYUe: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto dTY2S; aI0K1: return $return; goto n_y75; BzMx3: $parameters["\x73\x69\147\156"] = $this->getSign($parameters); goto kOP_7; TVpg_: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto aI0K1; dTY2S: $url = "\150\164\x74\160\x73\72\x2f\x2f\x61\x70\x69\56\155\143\x68\56\167\145\x69\x78\151\156\x2e\x71\161\x2e\x63\x6f\x6d\57\160\141\x79\x2f\165\x6e\151\x66\151\145\x64\157\x72\144\x65\x72"; goto E4yd_; kOP_7: $xmlData = $this->arrayToXml($parameters); goto TVpg_; E4yd_: $parameters = array("\x61\x70\x70\151\x64" => $this->appid, "\x6d\143\150\137\x69\144" => $this->mch_id, "\156\x6f\156\143\x65\137\163\x74\x72" => $this->createNoncestr(), "\x62\x6f\x64\x79" => $this->body, "\x6f\x75\x74\137\164\x72\141\144\x65\x5f\156\x6f" => $this->out_trade_no, "\164\157\164\x61\154\137\x66\x65\145" => $this->total_fee, "\163\160\x62\x69\x6c\x6c\137\x63\162\x65\141\164\x65\137\151\160" => "\x31\x39\62\56\x31\66\x38\x2e\x30\56\61\66\x31", "\156\157\164\151\146\171\137\165\x72\154" => "\x68\x74\x74\x70\x3a\57\57\167\x77\167\x2e\167\x65\151\x78\x69\x6e\x2e\x71\161\56\x63\157\x6d\x2f\x77\170\x70\141\171\57\x70\x61\x79\x2e\160\150\160", "\157\x70\145\156\151\144" => $this->openid, "\x74\162\141\144\145\137\164\x79\x70\x65" => "\112\x53\x41\120\x49"); goto BzMx3; n_y75: } private static function postXmlCurl($xml, $url, $second = 30) { goto mSwvR; WvNxS: curl_close($ch); goto ejubD; TxIK0: $error = curl_errno($ch); goto WvNxS; kATYo: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto oN8at; phBb4: curl_close($ch); goto xEbRW; Aes5W: curl_setopt($ch, CURLOPT_POST, TRUE); goto aa_Lx; F4na2: pN97W: goto EN6un; aa_Lx: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto qE3xT; xEbRW: return $data; goto F4na2; oN8at: set_time_limit(0); goto LdXOO; bAFzy: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto wGHUX; mSwvR: $ch = curl_init(); goto bAFzy; LdXOO: $data = curl_exec($ch); goto kCi6X; hgyNx: eBStc: goto phBb4; oNyri: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto UeK2r; UeK2r: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto Wpr3Y; VWssr: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto oNyri; kCi6X: if ($data) { goto eBStc; } goto TxIK0; wGHUX: curl_setopt($ch, CURLOPT_URL, $url); goto VWssr; Wpr3Y: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto Aes5W; ejubD: throw new WxPayException("\x63\165\x72\154\345\x87\xba\xe9\x94\231\357\274\214\xe9\224\231\350\xaf\257\347\240\x81\x3a{$error}"); goto BSJtX; qE3xT: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto kATYo; BSJtX: goto pN97W; goto hgyNx; EN6un: } private function arrayToXml($arr) { goto FJ8GA; Zxnwf: foreach ($arr as $key => $val) { goto xE4Qd; bi_jl: aFwN4: goto ce254; LH8P4: cYSru: goto Y4C6u; xE4Qd: if (is_array($val)) { goto aFwN4; } goto Lz3up; iJxMR: IkpEU: goto LH8P4; Lz3up: $xml .= "\x3c" . $key . "\x3e" . $val . "\x3c\57" . $key . "\x3e"; goto kjdAA; ce254: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\74\57" . $key . "\x3e"; goto iJxMR; kjdAA: goto IkpEU; goto bi_jl; Y4C6u: } goto YnPCc; jn9aG: $xml .= "\74\x2f\x72\157\157\x74\76"; goto GcPVc; GcPVc: return $xml; goto Xfhlq; FJ8GA: $xml = "\74\x72\x6f\157\x74\76"; goto Zxnwf; YnPCc: ULIms: goto jn9aG; Xfhlq: } private function xmlToArray($xml) { goto l93jF; uEi3M: $val = json_decode(json_encode($xmlstring), true); goto Sqj3P; Zi4hJ: $xmlstring = simplexml_load_string($xml, "\x53\x69\155\x70\154\145\130\115\114\105\x6c\145\155\x65\156\164", LIBXML_NOCDATA); goto uEi3M; Sqj3P: return $val; goto H_0u2; l93jF: libxml_disable_entity_loader(true); goto Zi4hJ; H_0u2: } private function weixinapp() { goto ZBPY6; G_CLU: $parameters["\x70\x61\x79\x53\x69\x67\x6e"] = $this->getSign($parameters); goto d3PvZ; ZBPY6: $unifiedorder = $this->unifiedorder(); goto IHn8t; d3PvZ: return $parameters; goto GvwNW; IHn8t: $parameters = array("\141\160\160\x49\144" => $this->appid, "\164\x69\155\x65\x53\x74\141\x6d\x70" => '' . time() . '', "\156\157\x6e\143\145\123\x74\x72" => $this->createNoncestr(), "\160\x61\x63\x6b\x61\x67\145" => "\x70\x72\145\x70\141\171\137\x69\x64\x3d" . $unifiedorder["\x70\x72\x65\160\x61\171\137\151\x64"], "\x73\x69\147\x6e\124\x79\x70\145" => "\115\x44\65"); goto G_CLU; GvwNW: } private function createNoncestr($length = 32) { goto C0d3M; Y9rIX: return $str; goto geNhI; C0d3M: $chars = "\x61\x62\x63\144\x65\146\147\150\151\152\x6b\x6c\x6d\x6e\157\160\x71\162\163\164\165\x76\167\170\171\172\x30\61\x32\x33\64\x35\x36\67\x38\x39"; goto dz1O9; Vp_GV: Jtc2L: goto feAYw; BMHVR: g93JV: goto Y9rIX; Ogjjj: $i = 0; goto Vp_GV; Z7wco: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto emo6y; cegQ5: goto Jtc2L; goto BMHVR; emo6y: oiHJ3: goto Fwh6b; dz1O9: $str = ''; goto Ogjjj; feAYw: if (!($i < $length)) { goto g93JV; } goto Z7wco; Fwh6b: $i++; goto cegQ5; geNhI: } private function getSign($Obj) { goto VOjQF; J_6n1: $String = md5($String); goto ZUwpq; WMlCP: ksort($Parameters); goto BpIXf; BpIXf: $String = $this->formatBizQueryParaMap($Parameters, false); goto NjOEw; cj1hG: noIgD: goto WMlCP; VOjQF: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; qXH5G: } goto cj1hG; NjOEw: $String = $String . "\x26\x6b\145\171\x3d" . $this->key; goto J_6n1; ZUwpq: $result_ = strtoupper($String); goto UQ8AY; UQ8AY: return $result_; goto YgKxL; YgKxL: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto K8nQJ; AMqAT: foreach ($paraMap as $k => $v) { goto rI44S; R21UW: Oe_iG: goto eEc11; UbIUi: $v = urlencode($v); goto jn0gL; LAJJ7: $buff .= $k . "\75" . $v . "\x26"; goto R21UW; rI44S: if (!$urlencode) { goto ivmco; } goto UbIUi; jn0gL: ivmco: goto LAJJ7; eEc11: } goto GgURg; vZtHK: ksort($paraMap); goto AMqAT; Psw1i: $reqPar; goto Dddkj; t39Y3: $reqPar = substr($buff, 0, strlen($buff) - 1); goto Li3P7; x_79i: return $reqPar; goto XZrO3; K8nQJ: $buff = ''; goto vZtHK; Li3P7: T5KX7: goto x_79i; Dddkj: if (!(strlen($buff) > 0)) { goto T5KX7; } goto t39Y3; GgURg: d6FeP: goto Psw1i; XZrO3: } }