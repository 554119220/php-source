<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto WaItJ; WTRf4: $this->mch_id = $mch_id; goto RwUc2; RwUc2: $this->key = $key; goto VUweZ; jrraO: $this->openid = $openid; goto WTRf4; VUweZ: $this->out_trade_no = $out_trade_no; goto R15Xu; R15Xu: $this->body = $body; goto jhN8p; WaItJ: $this->appid = $appid; goto jrraO; jhN8p: $this->total_fee = $total_fee; goto bB2I4; bB2I4: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto cpnM2; Lpgz9: return $return; goto PGQto; KXemN: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto Lpgz9; cpnM2: $url = "\150\x74\x74\160\x73\72\x2f\57\x61\160\x69\56\x6d\x63\150\56\167\145\x69\170\151\156\56\161\x71\x2e\143\157\155\57\x70\x61\171\x2f\165\x6e\151\146\151\x65\x64\x6f\x72\144\x65\162"; goto y4car; y4car: $parameters = array("\x61\x70\160\151\x64" => $this->appid, "\155\x63\x68\x5f\151\x64" => $this->mch_id, "\156\157\156\x63\145\x5f\163\164\x72" => $this->createNoncestr(), "\142\x6f\x64\171" => $this->body, "\x6f\165\x74\137\164\x72\x61\144\x65\x5f\156\x6f" => $this->out_trade_no, "\x74\157\x74\141\154\x5f\146\x65\x65" => $this->total_fee, "\x73\x70\142\x69\x6c\154\x5f\x63\162\145\x61\164\145\x5f\x69\160" => "\61\71\x32\56\x31\66\x38\x2e\60\x2e\61\x36\x31", "\156\157\164\x69\x66\171\x5f\165\x72\154" => "\150\164\164\x70\x3a\57\x2f\167\167\167\56\x77\145\x69\x78\151\x6e\56\161\x71\56\x63\x6f\155\57\167\170\160\x61\171\57\x70\x61\x79\56\x70\150\160", "\x6f\x70\145\156\x69\144" => $this->openid, "\164\x72\x61\144\145\137\x74\171\x70\x65" => "\x4a\123\101\x50\111"); goto KJKGc; NYH53: $xmlData = $this->arrayToXml($parameters); goto KXemN; KJKGc: $parameters["\x73\x69\x67\156"] = $this->getSign($parameters); goto NYH53; PGQto: } private static function postXmlCurl($xml, $url, $second = 30) { goto Mo18i; ZA3Oc: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto l734v; p81qK: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto njZ_X; znlas: set_time_limit(0); goto VpTJE; njZ_X: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto R4L1u; liKUI: curl_close($ch); goto PxSA0; PxSA0: throw new WxPayException("\x63\x75\162\154\345\207\xba\xe9\x94\x99\xef\xbc\214\351\224\x99\xe8\257\xaf\347\240\201\x3a{$error}"); goto XLHzk; GE3hj: curl_setopt($ch, CURLOPT_POST, TRUE); goto p81qK; VpTJE: $data = curl_exec($ch); goto Zll5k; Zll5k: if ($data) { goto r210T; } goto Tee7u; wfgmj: curl_close($ch); goto wK39Z; qT55G: r210T: goto wfgmj; LXX4H: jKNnB: goto PtfzG; wK39Z: return $data; goto LXX4H; WVi2N: curl_setopt($ch, CURLOPT_URL, $url); goto ZA3Oc; M2lNj: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto WVi2N; Tee7u: $error = curl_errno($ch); goto liKUI; XLHzk: goto jKNnB; goto qT55G; l734v: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto VTMPn; Ezy5O: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto GE3hj; VTMPn: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto Ezy5O; Mo18i: $ch = curl_init(); goto M2lNj; R4L1u: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto znlas; PtfzG: } private function arrayToXml($arr) { goto GuNmP; GuNmP: $xml = "\x3c\162\x6f\x6f\164\x3e"; goto e_gFD; NAlf7: return $xml; goto t6qwL; iutCz: EPk3t: goto ImVbZ; e_gFD: foreach ($arr as $key => $val) { goto tqmR0; VAuZN: z83UQ: goto V5KxC; pXrD4: XX0fs: goto Jmg8p; wLNgA: goto Ofxyo; goto VAuZN; V5KxC: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\74\x2f" . $key . "\x3e"; goto fXVsh; tqmR0: if (is_array($val)) { goto z83UQ; } goto TyNaj; TyNaj: $xml .= "\74" . $key . "\x3e" . $val . "\x3c\x2f" . $key . "\76"; goto wLNgA; fXVsh: Ofxyo: goto pXrD4; Jmg8p: } goto iutCz; ImVbZ: $xml .= "\x3c\57\162\x6f\157\x74\76"; goto NAlf7; t6qwL: } private function xmlToArray($xml) { goto Xf3Ux; sz7hD: $xmlstring = simplexml_load_string($xml, "\123\151\x6d\x70\x6c\145\130\115\114\105\x6c\145\155\x65\156\164", LIBXML_NOCDATA); goto JJ9P6; he2Sm: return $val; goto l3qEK; Xf3Ux: libxml_disable_entity_loader(true); goto sz7hD; JJ9P6: $val = json_decode(json_encode($xmlstring), true); goto he2Sm; l3qEK: } private function weixinapp() { goto jjx4I; Z0abu: $parameters["\x70\x61\x79\x53\x69\147\x6e"] = $this->getSign($parameters); goto sPktu; QTUmC: $parameters = array("\x61\160\x70\x49\144" => $this->appid, "\164\151\155\145\123\164\141\155\x70" => '' . time() . '', "\156\157\156\143\145\123\x74\162" => $this->createNoncestr(), "\x70\141\143\153\x61\x67\145" => "\160\x72\145\x70\141\171\137\151\144\75" . $unifiedorder["\x70\162\145\x70\141\x79\137\x69\x64"], "\x73\151\x67\x6e\x54\171\x70\x65" => "\115\104\x35"); goto Z0abu; jjx4I: $unifiedorder = $this->unifiedorder(); goto QTUmC; sPktu: return $parameters; goto C6Xzd; C6Xzd: } private function createNoncestr($length = 32) { goto f9nHb; jqQ3V: goto F_B1z; goto Pgqm8; koun5: if (!($i < $length)) { goto ek4Gq; } goto DUMkL; yo0wT: HAVpA: goto t9C5i; RdMR4: F_B1z: goto koun5; Pgqm8: ek4Gq: goto pTNB9; Tm1vo: $str = ''; goto T10Gq; T10Gq: $i = 0; goto RdMR4; f9nHb: $chars = "\x61\142\x63\144\145\x66\x67\x68\151\152\x6b\154\155\156\157\160\161\162\163\164\x75\x76\167\x78\x79\x7a\60\x31\x32\x33\64\x35\66\x37\70\x39"; goto Tm1vo; t9C5i: $i++; goto jqQ3V; DUMkL: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto yo0wT; pTNB9: return $str; goto ykTf3; ykTf3: } private function getSign($Obj) { goto Ach29; v1X7c: $String = $String . "\46\153\145\x79\x3d" . $this->key; goto de7os; Ach29: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; k5u4U: } goto mS_9O; QWH4k: ksort($Parameters); goto RJjTj; EtU2_: $result_ = strtoupper($String); goto dTLT2; RJjTj: $String = $this->formatBizQueryParaMap($Parameters, false); goto v1X7c; de7os: $String = md5($String); goto EtU2_; dTLT2: return $result_; goto lxSis; mS_9O: dLzSb: goto QWH4k; lxSis: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto UPknN; vXzOM: if (!(strlen($buff) > 0)) { goto R0UWW; } goto oUcO3; aJrwD: ksort($paraMap); goto hGf7e; eguTp: h6sHv: goto yuz5P; oUcO3: $reqPar = substr($buff, 0, strlen($buff) - 1); goto sXb2t; yuz5P: $reqPar; goto vXzOM; UPknN: $buff = ''; goto aJrwD; gurXI: return $reqPar; goto Lju7r; sXb2t: R0UWW: goto gurXI; hGf7e: foreach ($paraMap as $k => $v) { goto Lvzpe; f6YfZ: DX_x3: goto rNgeq; om6DM: $v = urlencode($v); goto Z9qRS; Z9qRS: GRVso: goto tP1bQ; Lvzpe: if (!$urlencode) { goto GRVso; } goto om6DM; tP1bQ: $buff .= $k . "\75" . $v . "\46"; goto f6YfZ; rNgeq: } goto eguTp; Lju7r: } }