<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>修改信息</title>
    <script src="{MODULE_URL}/template/static/assets/js/core/jquery.3.2.1.min.js"></script>
    <script src="{MODULE_URL}/template/static/js/layer_mobile/layer.js"></script>
    <link rel="stylesheet" href="{MODULE_URL}/static/css/addcar.css">
</head>
<body>
<div id="id_keyboard_province" style="display:none;bottom: 56px;z-index: 99">
</div>
<div data-reactroot="" class="body" >
    <div>
        <section class="main">
            <div class="mainWrap">
                <div class="main_left">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAA4CAMAAABt5J6JAAAAPFBMVEVHcEwwd+wwd+0xeekwd+wwd+wwd+wwd+wwd+wwd+wwd+wwd+wvd+wwd+wwd+wwd+0wd+0wd+wwd+wwd+y0IqbSAAAAE3RSTlMA1BYKJct+6fjvuW8wY6Q/kN5RX5n+jQAAAqVJREFUWMPtmFm7oyAMhmWTgOz+//86CYu1c5zqc/Ruyl0svIYvC9SJGaN/PXCpSoVPbZj13sjWO9FQcBO1art0lr6LgjxYt1Evvx5AQWc9gCK/ZsefQdEey0Oo1dj0FGo17DHUqp9Dmf8KBTqzrOHQqqbCwbK5gNI2zSkwM6oBLTt+Boamx4HPMpyiWCou+pD7WrRKYtCrP/kouRBcxiUofYZSWJSCe9tWq9kJOatq5OAd7w2uwvQpSuJU1zxBlJwaCnKgpiu4i7ESnbf6CoqX+k4gq6F08PiDcD4F1AvbiXCLNRdQk/TVlZdX+FxMPM6Wac3CHPkk4syuoERMFKMNZUJEUknK0Bu0mtEUxcIF1ITKm4FiAGx2KE8PAMIsTXM/lP+BEhwFluT+QBnr8dHOCx3iNMkN/U8URomkCGZlHaUpfMKr1zxbRPf8A4qj5gu9c1GQG2rNiaRadjIrL0acP6HcTJEn5VlyL5TcoxjuGFH5DJUsbYj7YBNl+xFKXUUxliJFLM0nqNMNYk7VqdH7HYrvZb+olZwzRVtQKGVFtQiWFwpqBJfzCCIKKA8ww0TPK0rJuDkBOdW8YnCKwinG9utXzfaMoUSxhhetuONZtndU02fqOV03JEblmHrVqF0NTM7awGdU29QoDyxCQc3AUm8Pi2sVTw08JOyo8BHVtB6oBhauUG/HYPTixjYUsWWrQ5TfULUdb0VL900iY63TvnnrfGD9PpJ/lzNK0iKjWyvpAuH9KY578CRLqsuBWoY8RmU8VfDA6WdM8HGzVqPSUrCzY3cvS+jHEJ5JOIMdbdAwG2w/Bum8Ci8LTYUi4whWjXNQK5p/KDtG1xh4M9/S0GT2fjbTBPjlnQHgeyn6or4oQsFTKLj9N3zn1a2PA7vPBCb/AfB39hGEt9LVAAAAAElFTkSuQmCC" alt="">
                    <p>车牌号</p>
                </div>
                <div class="main_left_card">
                    <button  class="btn2 card" id="id_province"  onclick="provinceSelect();">{php  echo mb_substr($car['car'],0,1,'utf-8');}</button>
                </div>

                <div class="main_right">
                    <input type="text" pattern="[A-Z]*" onkeyup="value=value.replace(/[^\w\.\/]/ig,'');value=value.toUpperCase()" placeholder="车牌号" id="car"  maxlength="11" value="{php $len=mb_strlen($car['car'],'utf-8'); echo mb_substr($car['car'],1,$len,'utf-8');}">
                </div>
            </div>
            <div class="mainWrap">
                <div class="main_left">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAA4CAMAAABt5J6JAAAAP1BMVEVHcEwwd+wwd+0wd+wwd+0veO0xduswd+wwd+wwd+wwd+wwd+wwd+wwd+wwd+wxeOowd+wwd+wwd+0wd+wwd+x9m/wCAAAAFHRSTlMA2FGdzx8W3vquW/HAeGgK54k0RbdRv3QAAAKLSURBVFjD5ZfZkqMwDEURtvG+kv//1pEwDCRNYtNhnkbVKSquzomWK0UehhMTc3aQkuwxcNrPYji3OJWgQT0eqm0PZRNnoUznKDFml5DUaza5PJ+x0CUGF0CLwRnrqkvVFM+vMcZiGL8MIpYz5Tm42Wv5GxKFaI4uYXDcnn5nAs6lVVbiczF6g4eQtv9POh+D8xpOSZaz7D3jWHYfgqcXvgHt6Wm3bOndJZRlOnXJ8myKKMHhh4sQ+CdIeA7fFCySVdVx99elwM6DQ5+w0nGIo+bakKwjJnVkXAeBakYH6scsrPrGfKc3CU1spDoTipm14huKjlktlJI1OPPOJaqNX8pcvfqBGop3O4paTn5QX5h2lNhRrqKEqREiKrb07cxH1GT0hppb+n6H0j9QTDdazpnYiXqf78tepVZ3cdIlWnDPFSSJThNJd0PJFkpq7BpPjQNVYUvfMwA8xxbKGjYxNCcB9jL2LXXujopzBkvnHLaO7kNJQJOvqP28G4Xjw2OIGMhzgNItgWctuwNc047pfe5B/G2g89nvaVcdYojxVO2RJsEuhg7UZ4mO+pJXfRJt56o1GS54dSPqvgD7J0M7VzemvX8yqP99Msh/MRngpsmARf9+Mow3ToYNBfc1DjR+6C80DjTWj44Kik9LkbhQQcnm6T2KFNatK+sOC+QraiqHBbK5fihkjYUmA2i8F02C5kFda6dlF66+4FrrmksD+kVLdl22TUAzgbl12d62alq2WdMtZMntCsAPVwC5PA9XAM+aa9FzvOvrtTh4MRk9f3xvyoWCl9uLbp2SgC5xuLTrr1nASC8LC6z6wiWs7DoTaXNfYOo3htdwvNJP+900Ow7yVwZc55GG4PAHi5jPxrz2m20AAAAASUVORK5CYII=" alt="">
                    <p>手机号</p>
                </div>
                <div class="main_right">
                    <input type="text" pattern="[0-9]*" placeholder="请输入手机号" id="mobile" maxlength="11" value="{$car['mobile']}">
                </div>
            </div>
            <input type="hidden" id="carid" value="{$_GPC['id']}">
            <div class="main_btn" onclick="editcar();">确认修改</div>
        </section>
    </div>
</div>

<script type="text/javascript">

            function editcar () {
                var c = $("#id_province").text();
                var ca = $("#car").val();
                var car = c+ca;
                var mobile = $("#mobile").val();
                var re=/^[\u4e00-\u9fa5]{1}[A-Z_a-z]{1}[A-Z_0-9_a-z]{5,6}$/;
                var carid = $('#carid').val();
                if(ca==''){
                    layer.open({
                        content: '请输入车牌号'
                        ,btn: '我知道了'
                    })
                }else if(car.search(re)==-1)
                {
                    layer.open({
                        content: '输入的车牌号格式不正确'
                        ,btn: '我知道了'
                    })
                }else if (!(/^(0|86|17951)?(13[0-9]|15[012356789]|17[35678]|18[0-9]|14[57]|19[0-9]|16[0-9])[0-9]{8}$/.test(mobile)))  {
                    layer.open({
                        content: '手机号填写的格式不对，请正确填写'
                        ,btn: '我知道了'
                    })
                }
                else {
                    layer.open({
                        type: 2
                        ,content: '修改中'
                    });
                }
                    $.post('',{carid:carid,'data[car]':car,'data[mobile]':mobile,},function (data) {
                        if(data.code == 1){
                            layer.closeAll();
                            layer.open({
                                content: data.msg
                                ,btn: '我知道了'
                                ,yes:function () {
                                    window.location.href="{php echo $this->createMobileUrl('myqrcodelist')}";
                                }
                            })
                        }else{
                            layer.open({
                                content: data.msg
                                ,btn: '我知道了'
                            })
                        }
                    },'json')
                }
                var provinces = new Array("京","沪","浙","苏","粤","鲁","晋","冀",
                    "豫","川","渝","辽","吉","黑","皖","鄂",
                    "津","贵","云","桂","琼","青","新","藏",
                    "蒙","宁","甘","陕","闽","赣","湘");
                function provinceSelect(){
                    showProvince();
                }
                function showProvince(){
                    var screenWidth=window.screen.width;
                    //求出列数，向下取整
                    var columns = Math.floor((screenWidth - 9)/42);
                    //求出行数，向上取整
                    var rows = Math.ceil(31/columns);
                    //算出按键背景的高度，为每个按键的高度+间隔+上下边距，48为每个按键的高度+距下一个按键的距离
                    var key_bg_height= (rows*48)+16;
                    var x_space = (screenWidth - 9 - 42*columns)/(columns);
                    var start_x = 9+x_space;
                    var start_y = 12;
                    var keyboard_province = document.getElementById("id_keyboard_province");
                    keyboard_province.style.position="absolute";
                    //keyboard_province.style.top= (window.screen.height-key_bg_height)+"px";
                    keyboard_province.style.left=0;
                    keyboard_province.style.backgroundColor="#f2f2f2";
                    keyboard_province.style.width="100%";
                    keyboard_province.style.height=key_bg_height+"px";
                    //keyboard_province.style.display="block";
                    keyboard_province.innerHTML = '';

                    for(var i=0;i<rows;i++){
                        for(var j=0;j<columns;j++){
                            var provinceIds = i*columns+j;
                            if(provinceIds<provinces.length){
                                var x = 9+(j+1)*x_space+j*42;
                                var y = 12+i*48;
                                /* var addHtml = addKeyProvince(x,y,provinceIds);
                                alert(addHtml); */
                                $("#id_keyboard_province").append(addKeyProvince(x,y,provinceIds));
                            }
                            else{
                                keyboard_province.style.display="block";
                                return;
                            }
                        }
                    }


                }

                function addKeyProvince(x,y,provinceIds){

                    var addHtml = '<div style="position:absolute;left:'+x+'px;top:'+y+'px;width:42px;height:48px;">';
                    addHtml += '<button id="id_'+provinceIds+'"  class="btn2" style="padding: 0.5rem" onclick="chooseProvince(this.innerHTML);">'+provinces[provinceIds]+'</button>';
                    addHtml += '</div>';
                    return addHtml;
                }


                function chooseProvince(province){
                    /* alert(province+"======"+provinces[7]); */
                    document.getElementById("id_province").innerHTML=province;
                    $("#id_keyboard_province").hide();
                }
</script>
{template 'footer'}
</body>
</html>