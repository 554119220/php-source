<?php/** * 推广处理 * Class Extend */class Extend {    /**     * 返佣记录添加     * @param $uid       消费者uid     * @param $account   消费金额     * @param int $type  消费类型     * @return bool     */    public static function add_brokerage($uid, $account, $type=1) {        global $_W;        // 如果当前用户未被推广过则直接返回true        $user = pdo_get('monai_newsharing_member', array('uid'=>$uid, 'uniacid'=>$_W['uniacid']), array('parent_id'));        if ($user['parent_id'] < 1) {            echo 1;            return true;        }        // 获取推广人用户数据        $member = pdo_get('monai_newsharing_extend_member', array('uniacid'=>$_W['uniacid'], 'uid'=>$user['parent_id']), array('id', 'balance', 'c_account', 'account'));        if (empty($member)) {            echo 2;            return false;        }        // 获取返佣比例        $set = pdo_get('monai_newsharing_extend_set', array('uniacid'=>$_W['uniacid']), array('ratio'));        // 计算佣金        $number = floor($account * $set['ratio']) / 100;        $number = 1;        if ($number > 0) {            pdo_begin();            // 更新推广人的推广数据            $data = array(                'c_account' => $member['c_account'] + $account,                'account' => $member['account'] + $number,                'balance' => $member['balance'] + $number,            );            $res1 = pdo_update('monai_newsharing_extend_member', $data, array('uid'=>$user['parent_id'], 'uniacid'=>$_W['uniacid']));            //添加推广人的佣金记录            $data = array(                'uid' => $uid,                'uniacid' => $_W['uniacid'],                'parent_uid' => $user['parent_id'],                'type' => $type,                'account' => $account,                'brokerage' => $number,                'create_time' => time()            );            $res2 = pdo_insert('monai_newsharing_extend_brokerage', $data);            if ($res1 && $res2) {                pdo_commit();                return true;            } else {                pdo_rollback();                return false;            }        }        return true;    }    public function check_switch() {    }}