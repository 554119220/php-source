<?php
 goto vaQZ2; wtHNm: $config["\x63\157\156\164\145\156\x74\163"] = json_decode($config["\x63\x6f\x6e\164\145\x6e\164\x73"], true); goto xFk89; wd6ia: if (!$config) { goto Pp6ZJ; } goto wtHNm; zhwO2: $token = ''; goto r5D3x; vaQZ2: global $_W, $_GPC, $xcconfig; goto bYdz1; i7R9s: Pp6ZJ: goto n1a62; n1a62: $online = new Online($token, $uniacid, $_W["\x61\143\143\157\165\x6e\164"]["\153\x65\x79"]); goto AMVP0; r5D3x: $config = pdo_get("\x78\143\137\x78\151\156\x67\165\x77\165\x5f\x6f\164\150\x65\162", array("\x6b\145\x79\x76\x61\x6c" => "\x6f\x6e\154\151\x6e\x65", "\x75\156\x69\x61\x63\151\144" => $uniacid)); goto wd6ia; dlyM4: yyKj6: goto i7R9s; bYdz1: $uniacid = $_W["\165\x6e\151\141\x63\151\144"]; goto cns5l; cns5l: load()->func("\x6c\x6f\147\x67\x69\x6e\147"); goto rit0u; rit0u: class Online { public $token, $uniacid; public function __construct($token, $uniacid, $appid) { goto M6t94; C7b9I: $this->appid = $appid; goto zNQf9; lR3Vo: $this->uniacid = $uniacid; goto C7b9I; M6t94: $this->token = $token; goto lR3Vo; zNQf9: } public function check_server() { goto jFeLE; kZQSl: goto Qv0Kw; goto Huvz_; jFeLE: logging_run(isset($_GET["\x65\143\150\x6f\x73\164\x72"])); goto qaMct; l2I7_: $this->responseMsg(); goto kZQSl; qaMct: if (isset($_GET["\145\x63\x68\x6f\163\x74\x72"])) { goto dWR_0; } goto l2I7_; Sggjh: $this->valid(); goto D9c31; Huvz_: dWR_0: goto Sggjh; D9c31: Qv0Kw: goto gy1ze; gy1ze: } public function valid() { goto TeiH_; lbq6A: exit; goto tYNWx; TzVtb: owyn3: goto MG3Qf; tYNWx: iFWvz: goto meQRU; JZXFM: if ($this->checkSignature()) { goto owyn3; } goto wc1hz; MG3Qf: header("\x63\x6f\156\164\145\x6e\164\x2d\x74\x79\160\x65\72\164\145\x78\x74"); goto zPu1K; B4ZuI: exit; goto LSmJh; LSmJh: goto iFWvz; goto TzVtb; TeiH_: $echoStr = $_GET["\145\x63\x68\x6f\x73\x74\x72"]; goto JZXFM; wc1hz: echo $echoStr . "\x2b\x2b\53" . $this->token; goto B4ZuI; zPu1K: echo $echoStr; goto lbq6A; meQRU: } private function checkSignature() { goto ccDrF; pz_3j: return true; goto ymppQ; nqdfp: $tmpStr = sha1($tmpStr); goto Z263U; qBYgN: $tmpStr = implode($tmpArr); goto nqdfp; PIht6: return false; goto D1i3z; tyC6l: oE1Bw: goto pz_3j; EnmQy: $nonce = $_GET["\156\x6f\156\x63\145"]; goto jJnKx; ymppQ: gJCq3: goto hbiQk; NmRKp: $timestamp = $_GET["\164\x69\x6d\145\163\x74\x61\155\x70"]; goto EnmQy; ccDrF: $signature = $_GET["\x73\x69\x67\156\x61\164\x75\x72\145"]; goto NmRKp; Z263U: if ($tmpStr == $signature) { goto oE1Bw; } goto PIht6; PnxFY: sort($tmpArr, SORT_STRING); goto qBYgN; dIffZ: $tmpArr = array($token, $timestamp, $nonce); goto PnxFY; D1i3z: goto gJCq3; goto tyC6l; jJnKx: $token = $this->token; goto dIffZ; hbiQk: } public function responseMsg() { goto PoflO; Kc256: $data["\x74\x79\160\145"] = 2; goto lHFCm; PGdhZ: wPdxE: goto fBuj0; fcV1u: logging_run("\350\xbf\233\xe5\x85\245\345\256\242\346\x9c\x8d\344\274\232\xe8\257\x9d\357\274\232" . json_encode($postArr)); goto nO2T9; exoBO: goto WrVVq; goto gMvBf; fcanP: echo ''; goto wLW1c; F_sFc: goto WrVVq; goto t_04W; ySJDN: if ($postArr["\115\x73\147\x54\x79\x70\145"] == "\145\166\145\156\164" && $postArr["\105\x76\x65\156\x74"] == "\x75\163\x65\x72\137\x65\156\x74\145\162\x5f\x74\145\155\160\163\x65\163\x73\x69\157\156") { goto KLFG8; } goto exoBO; eyBcv: $data["\157\x70\x65\156\x69\144"] = $postArr["\106\x72\157\155\125\x73\x65\x72\116\x61\x6d\x65"]; goto N56mz; lHFCm: $data["\x63\157\x6e\164\145\x6e\x74"] = $postArr["\120\x69\143\x55\x72\154"]; goto lhebz; Syz6O: YUzOJ: goto w3pVt; RIf7t: goto wPdxE; goto Syz6O; lhebz: $this->checkOnline($data); goto F_sFc; PwoO9: suWKF: goto C4_T4; VN1o3: if (!empty($postStr) && is_string($postStr)) { goto YUzOJ; } goto fcanP; N56mz: $data["\164\171\160\x65"] = 1; goto KfSZf; qozoK: if (!empty($postArr["\x4d\x73\x67\124\171\x70\145"]) && $postArr["\x4d\x73\147\124\171\x70\x65"] == "\x69\155\x61\147\145") { goto suWKF; } goto ySJDN; EkPNT: if (!empty($postArr["\x4d\163\147\124\x79\x70\145"]) && $postArr["\115\x73\147\x54\171\x70\145"] == "\164\145\170\164") { goto Qimq1; } goto qozoK; nO2T9: WrVVq: goto VJJot; w3pVt: $postArr = json_decode($postStr, true); goto EkPNT; mg8A6: exit; goto PGdhZ; PoflO: $postStr = file_get_contents("\160\x68\x70\72\57\x2f\151\156\160\x75\164"); goto VN1o3; VJJot: echo "\x73\165\143\143\145\x73\x73"; goto mg8A6; gMvBf: Qimq1: goto VwDsG; C4_T4: $data["\x75\x6e\151\x61\143\151\144"] = $this->uniacid; goto YfAOL; YfAOL: $data["\x6f\160\x65\156\x69\x64"] = $postArr["\x46\162\x6f\155\125\163\x65\162\x4e\x61\x6d\145"]; goto Kc256; t_04W: KLFG8: goto fcV1u; KfSZf: $data["\x63\x6f\x6e\x74\x65\x6e\x74"] = base64_encode($postArr["\103\157\156\164\145\x6e\x74"]); goto KgSBy; MxJkM: goto WrVVq; goto PwoO9; VwDsG: $data["\x75\156\x69\141\x63\x69\x64"] = $this->uniacid; goto eyBcv; KgSBy: $this->checkOnline($data); goto MxJkM; wLW1c: exit; goto RIf7t; fBuj0: } public function checkOnline($data) { goto SlPpf; iisRm: $prev = pdo_getall("\x78\143\x5f\x78\151\x6e\x67\x75\167\165\137\157\156\x6c\151\x6e\145\137\x6c\x6f\147", array("\165\x6e\151\x61\x63\x69\144" => $data["\165\156\x69\x61\x63\x69\144"], "\160\x69\144" => $data["\x70\151\144"], "\144\165\x74\171" => 2), array(), '', "\143\162\145\x61\164\x65\x74\x69\155\145\40\x44\x45\123\x43\x2c\151\x64\x20\x44\x45\x53\103", array(1, 5)); goto JBt4X; N4xZd: $this->sendMon($data); goto KQ9k_; sCpPZ: $this->sendMon($data); goto m8Qtj; fysaY: $request = pdo_insert("\170\143\x5f\x78\151\x6e\x67\165\x77\x75\x5f\157\156\154\151\x6e\x65", array("\x75\156\151\141\x63\151\x64" => $data["\x75\x6e\151\141\x63\151\x64"], "\x6f\160\x65\156\x69\144" => $data["\x6f\x70\145\x6e\x69\144"], "\155\x65\x6d\142\145\162" => 1, "\x75\x70\144\141\x74\x65\x74\x69\x6d\145" => date("\x59\x2d\x6d\x2d\144\x20\110\x3a\151\x3a\163"), "\x74\171\160\x65" => $data["\164\171\160\145"], "\143\x6f\x6e\164\145\x6e\x74" => $data["\143\x6f\x6e\164\x65\156\x74"])); goto wJcVR; XlApD: if (!$config) { goto NwFPI; } goto EbKRB; uJeMx: $data["\x70\151\144"] = pdo_insertid(); goto IEIcY; SlPpf: $online = pdo_get("\170\143\x5f\170\x69\156\x67\x75\167\x75\137\157\x6e\154\151\156\x65", array("\x75\156\x69\x61\143\151\144" => $data["\165\156\x69\x61\143\151\x64"], "\x6f\160\145\x6e\151\x64" => $data["\157\160\145\156\x69\x64"])); goto MJFSh; QVZP1: pdo_query($sql, array("\x3a\164\x69\155\145\163" => date("\131\x2d\155\x2d\x64\40\x48\72\151\x3a\x73"), "\72\151\144" => $online["\151\x64"], "\x3a\x75\156\x69\141\x63\x69\x64" => $data["\165\x6e\151\141\143\x69\144"], "\x3a\164\171\x70\x65" => $data["\x74\171\160\x65"], "\x3a\x63\157\156\x74\145\x6e\x74" => $data["\x63\157\156\164\x65\156\164"])); goto iisRm; EbKRB: $config["\x63\157\156\164\145\156\x74\163"] = json_decode($config["\143\x6f\156\x74\145\156\164\x73"], true); goto I1AUJ; b2F3Q: FGYzI: goto iV189; yaUKc: VQuiw: goto PLIRr; E83rX: $config = pdo_get("\170\143\x5f\170\151\x6e\x67\165\x77\x75\137\157\x74\x68\x65\162", array("\153\x65\x79\x76\x61\154" => "\x6f\156\x6c\x69\156\145", "\x75\156\x69\141\x63\151\144" => $this->uniacid)); goto XlApD; R1arx: if (!$request) { goto Gx5tC; } goto ZjDbp; wvttq: WbyGu: goto qqB1l; M_kuj: Gx5tC: goto wvttq; cwXSY: ZJR_x: goto E83rX; KQ9k_: AeINy: goto yaUKc; wJcVR: if (!$request) { goto lgllv; } goto uJeMx; LZrPU: $this->sendMon($data); goto cWzhB; ZVM7P: ZIdrl: goto M_kuj; MJFSh: if ($online) { goto FGYzI; } goto fysaY; JBt4X: if ($prev) { goto ZJR_x; } goto LZrPU; t9LKZ: if (!(time() - strtotime($prev[0]["\x63\x72\x65\x61\x74\x65\164\151\x6d\145"]) >= intval($config["\143\x6f\156\164\x65\156\164\x73"]["\x6a\x69\x61\x6e\147\145"]))) { goto AeINy; } goto N4xZd; qwcZQ: goto WbyGu; goto b2F3Q; ZjDbp: $sql = "\125\x50\x44\x41\x54\105\40" . tablename("\170\143\137\170\151\156\147\165\167\165\137\x6f\156\154\x69\156\x65") . "\40\123\105\x54\x20\x6d\145\155\x62\145\x72\x3d\155\x65\x6d\142\145\162\x2b\61\54\165\x70\x64\141\x74\145\164\x69\x6d\145\x3d\x3a\x74\151\155\x65\163\54\x74\x79\x70\145\x3d\x3a\x74\x79\160\145\x2c\x63\x6f\156\x74\x65\156\x74\x3d\x3a\x63\157\x6e\164\x65\156\x74\x20\x57\x48\x45\122\105\x20\x69\x64\x3d\x3a\151\x64\x20\101\x4e\104\x20\165\x6e\x69\x61\x63\x69\144\x3d\72\x75\156\x69\141\x63\151\x64"; goto QVZP1; iV189: $data["\160\151\x64"] = $online["\x69\144"]; goto FtsI7; IEIcY: pdo_insert("\170\x63\137\x78\151\x6e\147\x75\167\165\137\157\156\154\151\156\145\x5f\154\x6f\x67", $data); goto sCpPZ; m8Qtj: lgllv: goto qwcZQ; PLIRr: NwFPI: goto ZVM7P; cWzhB: goto ZIdrl; goto cwXSY; FtsI7: $request = pdo_insert("\170\x63\137\x78\151\x6e\x67\165\x77\165\137\x6f\x6e\154\x69\156\x65\137\x6c\157\x67", $data); goto R1arx; I1AUJ: if (empty($config["\x63\x6f\156\164\x65\x6e\x74\x73"]["\152\x69\x61\x6e\x67\145"])) { goto VQuiw; } goto t9LKZ; qqB1l: } public function sendMon($data) { goto QzKLF; nuqQn: $templateParam["\x63\x6f\156\x74\145\x6e\x74"] = base64_decode($data["\143\x6f\156\x74\x65\x6e\164"]); goto rUe4H; EP89j: $userinfo = pdo_get("\170\x63\x5f\x78\x69\x6e\147\165\x77\165\x5f\155\x65\x6d\142\145\162", array("\x75\156\x69\x61\x63\151\x64" => $this->uniacid, "\x6f\160\145\x6e\x69\144" => $data["\157\x70\x65\156\151\144"]), array("\x6e\x69\143\153\156\x61\x6d\145")); goto KYomQ; Xqlq0: if (empty($config["\x63\x6f\156\x74\x65\x6e\x74\x73"])) { goto uEEz8; } goto h4lxn; lYoMg: goto zhpsT; goto v8cGX; eGR6r: $conte = "\345\x9b\xbe\xe7\x89\207"; goto lYoMg; pUSje: K7Glt: goto M8r2d; D3QLr: $config["\x63\157\x6e\164\145\156\164\x73"] = json_decode($config["\143\x6f\156\x74\145\156\x74\x73"], true); goto Xqlq0; UeVcZ: YhSzz: goto S_HCj; HZI1l: $template = $config["\x63\x6f\x6e\x74\x65\156\164\x73"]["\x78\143"]; goto WW2R6; h4lxn: $web = pdo_get("\x78\x63\x5f\x78\151\x6e\147\x75\x77\x75\x5f\x6f\x74\x68\x65\x72", array("\153\x65\171\166\141\154" => "\x77\145\x62\143\157\x6e\x66\x69\x67", "\x75\x6e\x69\x61\x63\x69\144" => $data["\165\156\151\x61\143\151\144"])); goto tbcWS; DyEq8: $sendopenid = array(); goto EkYv8; M_0d4: if (!(!empty($web["\x63\x6f\156\x74\x65\156\x74\x73"]) && !empty($web["\143\x6f\x6e\164\145\156\x74\x73"]["\x77\145\x62\156\141\x6d\x65"]))) { goto zZKaZ; } goto zzvS5; vbqnz: jThMJ: goto xO_Nq; meq3c: goto U2_q_; goto H0oo2; Hnfcr: $web["\143\157\156\x74\x65\x6e\164\163"] = json_decode($web["\x63\157\156\x74\145\156\164\x73"], true); goto M_0d4; XgZhB: momessv2($accessurl, $template, $sendopenid, $templateParam); goto AiLVU; EkYv8: foreach ($openids as $itemopenis) { $sendopenid[] = $itemopenis["\x6f\x70\145\x6e\x69\x64"]; c5T4H: } goto X3F9x; AiLVU: uEEz8: goto UeVcZ; U63Dn: if (!$web) { goto jThMJ; } goto Hnfcr; xO_Nq: if (!($userinfo && !empty($userinfo["\156\151\x63\153\156\141\x6d\145"]))) { goto K7Glt; } goto QO5xE; ExFQK: dP931: goto myffG; Kv3j7: $templateParam = array("\167\145\x62\156\141\155\145\170" => $webset["\167\145\142\x6e\x61\x6d\145"], "\156\151\x63\x6b" => base64_decode($userinfo["\156\x69\143\153\x6e\141\x6d\x65"]), "\x63\157\x6e\x74\x65\156\x74" => $conte, "\141\x70\160\x69\x64" => $this->appid, "\160\x61\x67\145" => "\x2f\x78\143\137\x78\x69\156\x67\165\x77\x75\x2f\x70\141\147\145\x73\57\x6f\x6e\154\151\x6e\x65\x2f\151\x6e\144\x65\x78"); goto tjHmm; VsTQZ: $openids = $config["\143\x6f\x6e\164\x65\156\x74\x73"]["\x75\x73\x65\x72\x6c\x69\163\x74"]; goto DyEq8; QO5xE: $templateParam["\156\151\x63\153"] = base64_decode($userinfo["\156\151\x63\x6b\156\x61\x6d\x65"]); goto pUSje; zFCXZ: if (!$config) { goto YhSzz; } goto D3QLr; H0oo2: MXsVy: goto nuqQn; myffG: $accessurl = $web["\143\x6f\156\164\145\x6e\x74\163"]["\x78\x63\x6d\x65\x73\x73\x61\147\x65"] . "\46\157\160\75\163\145\x6e\144\166\x32"; goto HZI1l; DizYR: $templateParam["\143\157\x6e\x74\145\156\164"] = "\xe5\233\xbe\xe7\x89\207"; goto DFdUU; vnQih: zhpsT: goto Kv3j7; btC2A: if (!($data["\164\x79\160\x65"] == 2)) { goto E1w5x; } goto DizYR; j5LEF: $conte = base64_decode($data["\143\157\156\164\x65\156\164"]); goto vnQih; KYomQ: if ($data["\x74\171\160\145"] == 1) { goto xcfi9; } goto eGR6r; DmZ6d: $web["\x63\x6f\156\164\x65\156\x74\163"] = json_decode($web["\x63\x6f\x6e\x74\145\x6e\x74\163"], true); goto ExFQK; M8r2d: if ($data["\x74\x79\x70\145"] == 1) { goto MXsVy; } goto btC2A; DFdUU: E1w5x: goto meq3c; rUe4H: U2_q_: goto XgZhB; zzvS5: $templateParam["\167\145\142\x6e\x61\x6d\x65\170"] = $web["\x63\157\x6e\x74\x65\156\164\x73"]["\x77\145\x62\x6e\x61\x6d\x65"]; goto rdxT8; tjHmm: $config = pdo_get("\170\x63\137\x78\x69\156\147\x75\x77\x75\x5f\x6f\164\150\145\162", array("\x6b\x65\171\x76\141\x6c" => "\157\156\154\x69\156\145", "\x75\156\151\x61\x63\151\144" => $this->uniacid)); goto zFCXZ; v8cGX: xcfi9: goto j5LEF; X3F9x: ut8VQ: goto VfVTN; rdxT8: zZKaZ: goto vbqnz; tbcWS: if (!$web) { goto dP931; } goto DmZ6d; QzKLF: $webset = pdo_get("\x78\x63\x5f\170\x69\156\x67\x75\167\x75\137\x6f\164\x68\145\162", array("\165\156\x69\x61\143\151\x64" => $data["\165\x6e\151\x61\143\151\144"], "\153\145\171\166\141\154" => "\167\145\x62\x63\157\156\146\x69\x67"), array("\x77\x65\x62\156\x61\x6d\145")); goto EP89j; VfVTN: $web = pdo_get("\170\143\137\x78\151\x6e\x67\x75\167\165\x5f\x6f\164\150\145\162", array("\153\x65\171\166\141\154" => "\x77\145\x62\x63\157\156\x66\151\147", "\x75\x6e\x69\141\143\151\144" => $this->uniacid)); goto U63Dn; WW2R6: $template["\x64\x61\x74\141"] = $config["\x63\157\156\x74\145\156\164\x73"]["\144\141\164\x61"]; goto VsTQZ; S_HCj: } } goto zhwO2; QtHFE: $token = $config["\143\157\x6e\x74\145\156\x74\163"]["\164\x6f\x6b\x65\x6e"]; goto dlyM4; xFk89: if (!(!empty($config["\x63\x6f\156\x74\145\156\164\x73"]) && !empty($config["\x63\x6f\x6e\164\145\x6e\164\x73"]["\x74\157\153\x65\156"]))) { goto yyKj6; } goto QtHFE; AMVP0: $online->check_server();