<!DOCTYPE html>
<html lang="en">
<head>
    {template 'common/edithead'}
    <!--微擎 -->
    <!--这个放在最后一切平白安全-->
    <script type="text/javascript" src="./resource/js/require.js?v=20170915"></script>
    <script type="text/javascript">
        var urobj = [];
    </script>
    <style>
        #awardteb li i {
            position: absolute;
            right: 0px;
            top: -6px;
        }
    </style>
</head>
<body class="nav-md" style="min-width: 800px">
<div>
    <div class="container xc_edit_from">
        <div class="main_container" style="overflow-x: hidden;min-height: 100vh;background-color: white;width: 100%;">
            <div class="col-md-12 col-xs-12">
                <div class="x_panel">
                    <ul class="we7-page-tab">
                        <li>
                            <a href="{php echo $this->createWebUrl($do, array('op'=>'list','xtitleb'=>urlencode($xtitleb),'xtitlea'=>urlencode($xtitlea)));}">
                                {$xtitleb}- {$xtitlea}列表 </a></li>
                        <li><a a
                               href="{php echo $this->createWebUrl($do, array('op'=>'edit','xtitleb'=>urlencode($xtitleb),'xtitlea'=>urlencode($xtitlea)));}">{$xtitleb}-
                            {$xtitlea}增加</a></li>
                    </ul>
                    <div class="x_content">
                        <br/>
                        <form class="form-horizontal form-label-left input_mask" method="post"
                              action="{php echo $this->createWebUrl($do, array('op'=>'save'));}" id="xc_form">
                            <input type="hidden" name="id" value="{$id}">
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">活动名称</label>
                                <div class="col-xs-12 col-sm-3">
                                    <input type="text" name="xc[name]" class="form-control" value="{$xc['name']}"
                                           placeholder="名称"/>
                                </div>
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">活动说明</label>
                                <div class="col-xs-12 col-sm-3">
                                    <textarea class="form-control" rows="4" placeholder="包括活动规则和奖品介绍,最多250个字"
                                              name="xc[tip]">{$xc['tip']}</textarea>
                                    <p class="help-block">250字内</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">活动时间</label>
                                <div class="col-xs-12 col-sm-3">
                                    {php echo tpl_form_field_daterange('xc[daterange]', $value=array('start'=>$xc['startdate'],'end'=>$xc['enddate']), $time = true)}
                                </div>
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">背景图片()</label>
                                <div class="col-xs-12 col-sm-3">
                                    {php echo tpl_form_field_image('xc[bg]', $xc['bg'])}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">兑奖方式</label>
                                <div class="col-xs-12 col-sm-8">
                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[ticketway]" value="1"
                                               data-value="{$xc['ticketway']}" checked>快递
                                    </label>
                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[ticketway]" value="2"
                                               data-value="{$xc['ticketway']}">到店
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">抽奖形式</label>
                                <div class="col-xs-12 col-sm-8">
                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[type]" value="1"
                                               data-value="{$xc['type']}" checked>九宫格
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[type]" value="2"
                                               data-value="{$xc['type']}">转盘
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[type]" value="3"
                                               data-value="{$xc['type']}">摇奖
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[type]" value="4"
                                               data-value="{$xc['type']}">刮刮卡
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[type]" value="5"
                                               data-value="{$xc['type']}">拼图
                                    </label>
                                </div>
                            </div>

                            <div id="type_5" style="display: none">
                                <div class="form-group">
                                    <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">拼图图片(方图)</label>
                                    <div class="col-xs-12 col-sm-3">
                                        {php echo tpl_form_field_image('xc[puzzleimg]',$xc['puzzle']['img'])}
                                    </div>

                                    <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分割行数</label>
                                    <div class="col-xs-12 col-sm-3">
                                        <input type="number" name="xc[puzzlerow]" class="form-control" value="{if !empty($xc['puzzle']['row'])}{$xc['puzzle']['row']}{else}4{/if}"/>
                                    </div>
                                </div>

                                <div class="form-group">

                                    <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">记图时间</label>
                                    <div class="col-xs-12 col-sm-3">
                                        <div class="input-group">
                                            <input type="number" name="xc[puzzlememory]" class="form-control" value="{if !empty($xc['puzzle']['memory_time'])}{$xc['puzzle']['memory_time']}{else}10{/if}"/>
                                            <span class="input-group-addon">秒</span>
                                        </div>
                                    </div>

                                    <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">拼图时间</label>
                                    <div class="col-xs-12 col-sm-3">
                                        <div class="input-group">
                                            <input type="number" name="xc[puzzleplay]" class="form-control" value="{if !empty($xc['puzzle']['play_time'])}{$xc['puzzle']['play_time']}{else}10{/if}"/>
                                            <span class="input-group-addon">秒</span>
                                        </div>
                                    </div>
                                </div>



                            </div>

                            <script>
                                $(function () {
                                    if($('input[name="xc[type]"]:checked').val() == 5){
                                        $('#type_5').show();
                                    }
                                    $('input[name="xc[type]"]').change(function () {
                                        if($(this).val() == 5){
                                            $('#type_5').show();
                                        }else{
                                            $('#type_5').hide();
                                        }
                                    })
                                })
                            </script>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">展示渠道</label>
                                <div class="col-xs-12 col-sm-8">
                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[showtype]" value="1"
                                               data-value="{$xc['showtype']}" checked>自主推广
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[showtype]" value="1"
                                               data-value="{$xc['showtype']}">购买成功页
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">参与次数</label>
                                <div class="col-xs-12 col-sm-8">
                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[parttype]" value="1"
                                               data-value="{$xc['parttype']}" checked>一共N次/人
                                    </label>

                                    <label class="radio inline">
                                        <input class="ui-radio" type="radio" name="xc[parttype]" value="2"
                                               data-value="{$xc['parttype']}">每天N次/人
                                    </label>

                                    <label class="checkbox inline">
                                        <input class="ui-checkbox" type="checkbox" name="xc[scoredraw]" value="1"
                                               data-value="{$xc['scoredraw']}">积分抽奖
                                    </label>

                                    <label class="checkbox inline hide" >
                                        <input class="ui-checkbox" type="checkbox" name="xc[sharedraw]" value="1"
                                               data-value="{$xc['sharedraw']}">用户分享再获一次抽奖机会
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-1 control-label"></label>
                                <div class="col-xs-12 col-sm-10">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">值</label>
                                        <div class="col-xs-12 col-sm-3">
                                            <div class="input-group">
                                                <input type="number" name="xc[times]" class="form-control"
                                                       value="{$xc['times']}" placeholder="名称"/>
                                                <span class="input-group-addon">次</span>
                                            </div>
                                        </div>

                                        <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">积分</label>
                                        <div class="col-xs-12 col-sm-3">
                                            <input type="number" name="xc[score]" class="form-control"
                                                   value="{$xc['score']}" placeholder="名称"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script type="text/javascript">
                                function showImageDialog(elm, opts, options) {
                                    require(["util"], function (util) {
                                        var btn = $(elm);
                                        var ipt = btn.parent().prev();
                                        var val = ipt.val();
                                        var img = ipt.parent().next().children();
                                        options = {
                                            'global': false,
                                            'class_extra': '',
                                            'direct': true,
                                            'multiple': false,
                                            'fileSizeLimit': 5120000
                                        };
                                        util.image(val, function (url) {
                                            if (url.url) {
                                                if (img.length > 0) {
                                                    img.get(0).src = url.url;
                                                }
                                                ipt.val(url.attachment);
                                                ipt.attr("filename", url.filename);
                                                ipt.attr("url", url.url);
                                            }
                                            if (url.media_id) {
                                                if (img.length > 0) {
                                                    img.get(0).src = "";
                                                }
                                                ipt.val(url.media_id);
                                            }
                                        }, options);
                                    });
                                }
                                function deleteImage(elm) {
                                    $(elm).prev().attr("src", "./resource/images/nopic.jpg");
                                    $(elm).parent().prev().find("input").val("");
                                }
                            </script>


                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">奖品设置</label>
                                <div class="col-xs-12 col-sm-8">
                                    <ul class="nav nav-tabs" id="awardteb">
                                        {if !empty($xc['contents'])}
                                        {loop $xc['contents'] $index $aa}
                                        <li role="presentation" class="{if $index == 0}active{/if}"><a
                                                href="javascript:void (0);">奖品<span
                                        >{php echo $index + 1}</span></a><i class="fa fa-times-circle fa-lg"
                                                                            aria-hidden="true"></i></li>
                                        {/loop}
                                        {/if}
                                    </ul>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"></label>
                                <div class="col-xs-12 col-sm-9" id="award">
                                    {if !empty($xc['contents'])}
                                    {loop $xc['contents'] $i $vo}
                                    <div class="award-item" style="display: {if $i == 0}block{else}none{/if}">
                                        <div class="form-group">
                                            <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                    class="red">*</span>奖品类型</label>
                                            <div class="col-xs-12 col-sm-8">
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype" type="radio" name="awardtype{$i}" value="1" checked
                                                           data-value="{$vo['type']}">真实物品
                                                </label>
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype" type="radio" value="2" name="awardtype{$i}"
                                                           data-value="{$vo['type']}">虚拟物品
                                                </label>
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype" type="radio" value="3" name="awardtype{$i}"
                                                           data-value="{$vo['type']}">积分
                                                </label>
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype  " type="radio" value="4" name="awardtype{$i}"
                                                           data-value="{$vo['type']}">余额
                                                </label>
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype" type="radio" value="5" name="awardtype{$i}"
                                                           data-value="{$vo['type']}">空奖
                                                </label>
                                                <label class="radio inline">
                                                    <input class="ui-radio awardtype" type="radio" value="6" name="awardtype{$i}"
                                                           data-value="{$vo['type']}">再来一次
                                                </label>
                                            </div>
                                        </div>
                                        <div class="award-item-area">

                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>奖品等级</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <input type="text" class="form-control awardgrade"
                                                           value="{$vo['grade']}"/>
                                                </div>

                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>奖品数量</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control awardnumber"
                                                               value="{$vo['num']}"/>
                                                        <span class="input-group-addon">份</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>奖品名称</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <input type="text" class="form-control awardname"
                                                           value="{$vo['name']}"/>
                                                </div>


                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>中奖概率</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <div class="input-group">
                                                        <input type="number" class="form-control awardprobably"
                                                               value="{$vo['probably']}"/>
                                                        <span class="input-group-addon">%</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {if $vo['type'] == 1 || $vo['type'] == 2 || $vo['type'] == 3 || $vo['type'] == 4}

                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>每人中奖</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">每人最多</span>
                                                        <input type="number" class="form-control awardtotaltimes" value="{$vo['totaltimes']}"/>
                                                        <span class="input-group-addon">个;0为不限制</span>
                                                    </div>
                                                </div>


                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>每天发奖</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">每天最多</span>
                                                        <input type="number" class="form-control awarddaytimes" value="{$vo['daytimes']}"/>
                                                        <span class="input-group-addon">个;0为不限制</span>
                                                    </div>
                                                </div>
                                            </div>
                                            {/if}

                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>奖品图片</label>
                                                <div class="col-xs-12 col-sm-8">
                                                    <div class="input-group ">
                                                        <input type="text" class="form-control awardimg"
                                                               autocomplete="off" value="{$vo['img']}">
                                                        <span class="input-group-btn">
                                            <button class="btn btn-default" type="button"
                                                    onclick="showImageDialog(this);">选择图片</button>
                                            </span>
                                                    </div>
                                                    <div class="input-group " style="margin-top:.5em;">
                                                        <img src="{php echo tomedia($vo['img'])}"
                                                             onerror="this.src='./resource/images/nopic.jpg'; this.title='图片未找到.'"
                                                             class="img-responsive img-thumbnail" width="150"/>
                                                        <em class="close"
                                                            style="position:absolute; top: 0px; right: -14px;"
                                                            title="删除这张图片" onclick="deleteImage(this)">×</em>
                                                    </div>
                                                </div>

                                            </div>
                                            {if $vo['type'] == 2}
                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>优惠券ID</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <input type="number" class="form-control voucherid" value="{$vo['value']}"/>
                                                </div>
                                            </div>
                                            {/if}
                                            {if $vo['type'] == 3}
                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>积分值</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <input type="number" class="form-control scorevalue" value="{$vo['value']}"/>
                                                </div>
                                            </div>
                                            {/if}


                                            {if $vo['type'] == 4}
                                            <div class="form-group">
                                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span
                                                        class="red">*</span>余额值</label>
                                                <div class="col-xs-12 col-sm-3">
                                                    <input type="number" class="form-control balancevalue" value="{$vo['value']}"/>
                                                </div>
                                            </div>
                                            {/if}



                                        </div>


                                    </div>
                                    {/loop}
                                    {/if}
                                    <!--<div class="award-item">-->
                                    <!--<div class="form-group">-->
                                    <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品类型</label>-->
                                    <!--<div class="col-xs-12 col-sm-8">-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype" type="radio"  value="1"  checked>真实物品-->
                                    <!--</label>-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype" type="radio" value="2" >虚拟物品-->
                                    <!--</label>-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype" type="radio"  value="3" >积分-->
                                    <!--</label>-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype  " type="radio"  value="4" >余额-->
                                    <!--</label>-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype" type="radio"  value="5" >空奖-->
                                    <!--</label>-->
                                    <!--<label class="radio inline">-->
                                    <!--<input class="ui-radio awardtype" type="radio"  value="6">再来一次-->
                                    <!--</label>-->
                                    <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="award-item-area">-->

                                    <!--<div class="form-group">-->
                                    <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label>-->
                                    <!--<div class="col-xs-12 col-sm-3">-->
                                    <!--<input type="text" class="form-control awardgrade" />-->
                                    <!--</div>-->

                                    <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label>-->
                                    <!--<div class="col-xs-12 col-sm-3">-->
                                    <!--<div class="input-group">-->
                                    <!--<input type="number"  class="form-control awardnumber" />-->
                                    <!--<span class="input-group-addon">份</span>-->
                                    <!--</div>-->
                                    <!--</div>-->
                                    <!--</div>-->

                                    <!--<div class="form-group">-->
                                    <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label>-->
                                    <!--<div class="col-xs-12 col-sm-3">-->
                                    <!--<input type="text" class="form-control awardname" />-->
                                    <!--</div>-->


                                    <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label>-->
                                    <!--<div class="col-xs-12 col-sm-3">-->
                                    <!--<div class="input-group">-->
                                    <!--<input type="number"  class="form-control awardprobably" />-->
                                    <!--<span class="input-group-addon">%</span>-->
                                    <!--</div>-->
                                    <!--</div>-->
                                    <!--</div>-->


                                    <!--</div>-->


                                    <!--</div>-->
                                </div>
                            </div>
                            <!--<div class="form-group">-->
                            <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每人中奖</label>-->
                            <!--<div class="col-xs-12 col-sm-3">-->
                            <!--<div class="input-group">-->
                            <!--<span class="input-group-addon">每人最多</span>-->
                            <!--<input type="number"  class="form-control awardtotaltimes" />-->
                            <!--<span class="input-group-addon">个;0为不限制</span>-->
                            <!--</div>-->
                            <!--</div>-->


                            <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每天发奖</label>-->
                            <!--<div class="col-xs-12 col-sm-3">-->
                            <!--<div class="input-group">-->
                            <!--<span class="input-group-addon">每天最多</span>-->
                            <!--<input type="number" class="form-control awarddaytimes"/>-->
                            <!--<span class="input-group-addon">个;0为不限制</span>-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--</div>-->

                            <!--<div class="form-group">-->
                            <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>余额值</label>-->
                            <!--<div class="col-xs-12 col-sm-3">-->
                            <!--<input type="number" class="form-control balancevalue" />-->
                            <!--</div>-->

                            <!--</div>-->

                            <!--<div class="form-group">-->
                            <!--<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label>-->
                            <!--<div class="col-xs-12 col-sm-8">-->
                            <!--<div class="input-group ">-->
                            <!--<input type="text"  class="form-control awardimg" autocomplete="off">-->
                            <!--<span class="input-group-btn">-->
                            <!--<button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button>-->
                            <!--</span>-->
                            <!--</div>-->
                            <!--<div class="input-group " style="margin-top:.5em;">-->
                            <!--<img src="./resource/images/nopic.jpg" onerror="this.src='./resource/images/nopic.jpg'; this.title='图片未找到.'" class="img-responsive img-thumbnail"  width="150" />-->
                            <!--<em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em>-->
                            <!--</div>-->
                            <!--</div>-->

                            <!--</div>-->

                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"></label>
                                <div class="col-xs-12 col-sm-3">
                                    <p class="btn btn-info" id="add-item">添加奖品</p>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">状态</label>
                                <div class="col-xs-12 col-sm-3">
                                    <input type="checkbox" class="js-switch" value="1" name="xc[status]"
                                           data-value="{$xc['status']}" data-field="status">
                                </div>
                            </div>

                            <div class="page-hader">
                                <h3>分享设置</h3>
                            </div>


                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享海报</label>
                                <div class="col-xs-12 col-sm-8">
                                    <select class="form-control ui-select" name="xc[poster]" data-select="{$xc[poster]}">
                                        <option value="0">请选择分类</option>
                                        {loop $newclasslist $index $newclassitem}
                                        <option value='{$newclassitem["id"]}'>{$newclassitem["name"]}</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>

                            <div class="row xc_btnmar"></div>
                            <div class="form-group xc_btn_row">
                                <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-5 col-sm-offset-5  col-md-xs-5 ">
                                    <button type="submit" class="btn btn-primary" id="btsave">确认</button>
                                    <a type="button" class="btn btn-default"
                                       href="{php echo $this->createWebUrl($do, array('op'=>'list','xtitleb'=> urlencode($xtitleb),'xtitlea'=>urlencode($xtitlea)));}">返回</a>

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{template 'common/editfoot'}
<script>
    function sortAwardTab() {
        $('#awardteb li').each(function (i) {
            $(this).find('span').text(i + 1)
        });
        $('#award .award-item').each(function (i) {
            $(this).find('.awardtype').attr('name', 'awardtype' + i);
        })
    }

    $(function () {

        $('#awardteb ').on('click', 'li a', function () {
            $(this).parent().addClass('active').siblings().removeClass('active');

            $('#award .award-item').eq($('#awardteb a').index(this)).show().siblings().hide();

        });
        $('#awardteb ').on('click', 'li i', function () {
            $(this).parents('li').remove();
            $('#award .award-item').eq($('#awardtab a').index(this)).remove();
            sortAwardTab();
        });

        $('#add-item').click(function () {
            var html1 = '<li role="presentation" class="active"><a href="javascript:void (0);">奖品<span ></span></a><i class="fa fa-times-circle fa-lg" aria-hidden="true"></i></li>';
            $('#awardteb li').removeClass('active');
            $('#awardteb').append(html1);

            var html2 = '<div class="award-item"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品类型</label> <div class="col-xs-12 col-sm-8"> <label class="radio inline"> <input class="ui-radio awardtype" type="radio"  value="1" >真实物品 </label> <label class="radio inline"> <input class="ui-radio awardtype" type="radio" value="2" >优惠券 </label> <label class="radio inline"> <input class="ui-radio awardtype" type="radio"  value="3" >积分 </label> <label class="radio inline"> <input class="ui-radio awardtype  " type="radio"  value="4" >余额 </label> <label class="radio inline"> <input class="ui-radio awardtype" type="radio"  value="5" >空奖 </label> <label class="radio inline"> <input class="ui-radio awardtype" type="radio"  value="6">再来一次 </label> </div> </div><div class="award-item-area"></div></div></div>';
            $('#award .award-item').hide();
            $('#award').append(html2);
            sortAwardTab();
        });

        $('#award ').on('change', '.award-item  .awardtype', function () {
            var val = $(this).val();
            var html = '';
            var html1 = ' <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每人中奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每人最多</span> <input type="number"  class="form-control awardtotaltimes" /> <span class="input-group-addon">个;0为不限制</span> </div> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每天发奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每天最多</span> <input type="number" class="form-control awarddaytimes"/> <span class="input-group-addon">个;0为不限制</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px;right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div>';
            var html2 = '<div class="award-item-area"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每人中奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每人最多</span> <input type="number"  class="form-control awardtotaltimes" /> <span class="input-group-addon">个;0为不限制</span> </div> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每天发奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每天最多</span> <input type="number" class="form-control awarddaytimes"/> <span class="input-group-addon">个;0为不限制</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>优惠券ID</label> <div class="col-xs-12 col-sm-3"> <input type="number" class="form-control voucherid" /> </div> </div> </div>';
            var html3 = '<div class="award-item-area"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每人中奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每人最多</span> <input type="number"  class="form-control awardtotaltimes" /> <span class="input-group-addon">个;0为不限制</span> </div> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每天发奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每天最多</span> <input type="number" class="form-control awarddaytimes"/> <span class="input-group-addon">个;0为不限制</span> </div> </div> </div><div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>积分值</label> <div class="col-xs-12 col-sm-3"> <input type="number" class="form-control scorevalue" /> </div> </div> </div>';
            var html4 = '<div class="award-item-area"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每人中奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每人最多</span> <input type="number"  class="form-control awardtotaltimes" /> <span class="input-group-addon">个;0为不限制</span> </div> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>每天发奖</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <span class="input-group-addon">每天最多</span> <input type="number" class="form-control awarddaytimes"/> <span class="input-group-addon">个;0为不限制</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div><div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>余额值</label> <div class="col-xs-12 col-sm-3"> <input type="number" class="form-control balancevalue" /> </div> </div> </div>';
            var html5 = '<div class="award-item-area"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> </div><div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div>';
            var html6 = '<div class="award-item-area"> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品等级</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardgrade" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品数量</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardnumber" /> <span class="input-group-addon">份</span> </div> </div> </div> <div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品名称</label> <div class="col-xs-12 col-sm-3"> <input type="text" class="form-control awardname" /> </div> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>中奖概率</label> <div class="col-xs-12 col-sm-3"> <div class="input-group"> <input type="number"  class="form-control awardprobably" /> <span class="input-group-addon">%</span> </div> </div> </div> </div><div class="form-group"> <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label"><span class="red">*</span>奖品图片</label> <div class="col-xs-12 col-sm-8"> <div class="input-group "> <input type="text"  class="form-control awardimg" autocomplete="off"> <span class="input-group-btn"> <button class="btn btn-default" type="button" onclick="showImageDialog(this);">选择图片</button> </span> </div> <div class="input-group " style="margin-top:.5em;"> <img src="./resource/images/nopic.jpg" onerror="this.src=' + "./resource/images/nopic.jpg" + '; this.title=' + "图片未找到." + '" class="img-responsive img-thumbnail"  width="150" /> <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" onclick="deleteImage(this)">×</em> </div> </div> </div>';
            switch (val) {
                case '1': {
                    html = html1;
                    break;
                }
                case '2': {
                    html = html2;
                    break;
                }
                case '3': {
                    html = html3;
                    break;
                }
                case '4': {
                    html = html4;
                    break;
                }
                case '5': {
                    html = html5;
                    break;
                }
                case '6': {
                    html = html6;
                    break;
                }
            }
            $(this).parents('.award-item').find('.award-item-area').empty().append(html);
        })
    })
</script>
<script>


    var xvalidator = null;
    $.validator.setDefaults({
        highlight: function (e) {
            $(e).closest(".col-xs-12").removeClass("has-success").addClass("has-error")
        }, success: function (e) {
            e.closest(".col-xs-12").removeClass("has-error").addClass("has-success")
        }, errorClass: "help-block m-b-none", validClass: "help-block m-b-none"
    }), $().ready(function () {
        var e = "<i class='fa fa-times-circle'></i> ";
        var vlidp = {
            rules: {
                "xc[bg]": {url: false},
                "xc[puzzleimg]":{url:false}
            },
            messages: {

            },
            submitHandler: function (form) {
                //手动验证所以这里不需要执行
                xajaxfrom(form);
                return false;
            }
        };
        xvalidator = $("#xc_form").validate(vlidp);
    });
    $("#btsave").click(function () {
        $brvalue = $("#xc_form").valid();
        if ($brvalue) {
            xajaxfrom("#xc_form");
        }
        return false;
    });

    function message(data) {
        $mesoption = {};
        if (data["status"] === 1) {
            if ($('[name="id"]').val() == "" || $('[name="id"]').val() == "0") {
                xc_form.reset();
//                    $(".container").find(".img-thumbnail").attr("src", "./resource/images/nopic.jpg");

                $(".container").find(".multi-img-details").empty();
                if (urobj.length > 0) {
                    for (var i = 0; i < urobj.length; i++) {
                        urobj[i].setContent("");
                    }
                }
                if ($(".js-select2").length > 0) {
                    $('.js-select2').val(null).trigger("change");
                }
                if ($(".ajax-select").length > 0) {
                    $('.ajax-select').val(null).trigger("change");
                }
            }
            $mesoption["timer"] = 1000;
            $mesoption["type"] = replyrdata[data["status"]];
        }
        $mesoption["title"] = data["message"];
        $mesoption["text"] = data["message"];
        swal($mesoption);
    }
    function xajaxfrom(form) {
        var _podata = {};
        _podata['name'] = $('input[name="xc[name]"]').val();
        _podata['tip'] = $('textarea[name="xc[tip]"]').val();
        _podata['startdate'] = $('input[name="xc[daterange][start]"]').val();
        _podata['enddate'] = $('input[name="xc[daterange][end]"]').val();
        _podata['ticketway'] = $('input[name="xc[ticketway]"]:checked').val();
        _podata['type'] = $('input[name="xc[type]"]:checked').val();
        _podata['showtype'] = $('input[name="xc[showtype]"]:checked').val();
        _podata['parttype'] = $('input[name="xc[parttype]"]:checked').val();
        _podata['times'] = $('input[name="xc[times]"]').val();
        _podata['score'] = $('input[name="xc[score]"]').val();
        _podata['scoredraw'] = $('input[name="xc[scoredraw]"]').is(":checked") ? '1' : '-1';
        _podata['sharedraw'] = $('input[name="xc[sharedraw]"]').is(":checked") ? '1' : '-1';
        _podata['status'] = $('input[name="xc[status]"]').is(":checked") ? '1' : '-1';
        _podata['poster'] = $('select[name="xc[poster]"]').val();
        _podata['bg'] = $('input[name="xc[bg]"]').val();



        /*拼图*/
        if(_podata['type'] == 5){
            var puzzle = {};
            puzzle['img'] = $('input[name="xc[puzzleimg]"]').val();
            puzzle['row'] = $('input[name="xc[puzzlerow]"]').val();
            puzzle['memory_time'] = $('input[name="xc[puzzlememory]"]').val();
            puzzle['play_time'] = $('input[name="xc[puzzleplay]"]').val();
            _podata['puzzle'] = puzzle;
        }
        var list = {};
        $('#award .award-item').each(function (i) {
            var type = $(this).find('input[name="awardtype' + i + '"]:checked').val();
            var arr = {};
            arr['type'] = type;
            arr['name'] = $(this).find('.awardname').val();
            arr['grade'] = $(this).find('.awardgrade').val();
            arr['num'] = $(this).find('.awardnumber').val();
            arr['probably'] = $(this).find('.awardprobably').val();
            arr['img'] = $(this).find('.awardimg').val();
            if (type == 1) {
                arr['totaltimes'] = $(this).find('.awardtotaltimes').val();
                arr['daytimes'] = $(this).find('.awarddaytimes').val();
            }
            if (type == 2) {
                arr['totaltimes'] = $(this).find('.awardtotaltimes').val();
                arr['daytimes'] = $(this).find('.awarddaytimes').val();
                arr['value'] = $(this).find('.voucherid').val();
            }
            if (type == 3) {
                arr['totaltimes'] = $(this).find('.awardtotaltimes').val();
                arr['daytimes'] = $(this).find('.awarddaytimes').val();
                arr['value'] = $(this).find('.scorevalue').val();
            }
            if (type == 4) {
                arr['totaltimes'] = $(this).find('.awardtotaltimes').val();
                arr['daytimes'] = $(this).find('.awarddaytimes').val();
                arr['value'] = $(this).find('.balancevalue').val();
            }
            list[i] = arr;
        });
        _podata['contents'] = list;
        $postdata = {};
        $postdata['xc'] = JSON.stringify(_podata);
        $postdata['id'] = $('input[name="id"]').val();
        console.log($postdata);
        xpagecss.xload();
        $.ajax({
            type: $(form).attr("method"),
            url: $(form).attr("action"),
            dataType: "json",
            data: $postdata,
            success: function (msg) {
                message(msg)
            }
        });
    }
</script>
</body>
</html>

