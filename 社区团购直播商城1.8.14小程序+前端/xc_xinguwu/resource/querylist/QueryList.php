<?php
 namespace QL; use phpQuery, Exception, ReflectionClass; use Monolog\Logger; use Monolog\Handler\StreamHandler; class QueryList { public $data; public $html; private $page; private $pqHtml; private $outputEncoding = false; private $inputEncoding = false; private $htmlEncoding; public static $logger = null; public static $instances; public function __construct() { } public static function Query($page, array $rules, $range = '', $outputEncoding = null, $inputEncoding = null, $removeHead = false) { return self::getInstance()->_query($page, $rules, $range, $outputEncoding, $inputEncoding, $removeHead); } public static function run($class, $args = array()) { $extension = self::getInstance("\x51\114\x5c\105\170\164\x5c{$class}"); return $extension->run($args); } public static function setLog($handler) { goto tvOeG; UmVe5: dKXG0: goto TqbeL; ydcdI: throw new Exception("\131\x6f\165\x20\156\x65\x65\x64\x20\164\157\x20\x69\x6e\x73\164\x61\154\154\x20\164\x68\145\40\160\141\143\153\141\x67\145\40\133\x6d\157\156\x6f\x6c\x6f\147\57\x6d\157\156\157\x6c\157\147\x5d"); goto uux2h; TqbeL: self::$logger = new Logger("\x51\x75\x65\x72\171\114\151\x73\x74"); goto cel6q; XixmQ: pqpS5: goto mUzag; cel6q: self::$logger->pushHandler($handler); goto XixmQ; MRgfy: if (!is_string($handler)) { goto dKXG0; } goto HqnCr; HqnCr: $handler = new StreamHandler($handler, Logger::INFO); goto UmVe5; tvOeG: if (class_exists("\x4d\x6f\156\157\x6c\157\x67\x5c\114\x6f\147\x67\145\x72")) { goto j4PSE; } goto ydcdI; uux2h: goto pqpS5; goto EIOIu; EIOIu: j4PSE: goto MRgfy; mUzag: } public static function getInstance() { goto ykfs0; bUXig: if (class_exists($className)) { goto HJKYP; } goto WU0mt; NyKhm: $className = array_shift($args); goto bUXig; O7f7c: $rc = new ReflectionClass($className); goto RAlqv; bppI7: $key = md5(serialize($args)); goto NyKhm; e321t: count($args) || ($args = array("\x51\x4c\x5c\x51\165\145\162\x79\114\151\x73\x74")); goto bppI7; ykfs0: $args = func_get_args(); goto e321t; fv1Fz: HJKYP: goto Lyxi2; RAlqv: self::$instances[$key] = $rc->newInstanceArgs($args); goto w22iH; WU0mt: throw new Exception("\156\157\x20\x63\154\x61\163\163\40{$className}"); goto fv1Fz; w22iH: zdedy: goto Zdf0Q; Zdf0Q: return self::$instances[$key]; goto lvqxP; Lyxi2: if (isset(self::$instances[$key])) { goto zdedy; } goto O7f7c; lvqxP: } public function getHtml($rel = true) { return $rel ? $this->qpHtml : $this->html; } public function getData($callback = null) { goto bEtyJ; mPDss: return $this->data; goto GtNxF; jFXf0: return array_map($callback, $this->data); goto Veu2h; bEtyJ: if (!is_callable($callback)) { goto PFZ7D; } goto jFXf0; Veu2h: PFZ7D: goto mPDss; GtNxF: } public function setQuery(array $rules, $range = '', $outputEncoding = null, $inputEncoding = null, $removeHead = false) { return $this->_query($this->html, $rules, $range, $outputEncoding, $inputEncoding, $removeHead); } private function _query($page, array $rules, $range, $outputEncoding, $inputEncoding, $removeHead) { goto x8d8Q; i4ySW: $this->regArr = $rules; goto cQq_G; h0QYx: $outputEncoding && ($this->outputEncoding = $outputEncoding); goto WeQdC; WQ1BC: $this->pqHtml = ''; goto Ff1GH; enl_6: $this->page = $page; goto M9alm; M9alm: $this->html = $this->_isURL($this->page) ? $this->_request($this->page) : $this->page; goto h0QYx; JReaw: trigger_error("\x54\150\145\x20\x72\145\143\145\x69\x76\145\144\x20\143\x6f\x6e\x74\145\156\x74\x20\151\163\x20\x65\155\160\x74\x79\41", E_USER_NOTICE); goto jr_rI; GjuLP: $this->_log("\124\x68\x65\40\x72\145\143\x65\151\x76\145\x64\x20\x63\157\x6e\x74\145\156\164\x20\151\163\40\x65\x6d\160\164\x79\x21", "\x65\162\162\x6f\x72"); goto JReaw; b5rKi: $removeHead && ($this->html = $this->_removeHead($this->html)); goto WQ1BC; jr_rI: NjZ_4: goto ZxE4V; techG: $this->_log(); goto xuaKg; xuaKg: return $this; goto ZWuOe; cQq_G: $this->regRange = $range; goto OL3ST; x8d8Q: $this->data = array(); goto enl_6; OL3ST: $this->_getList(); goto techG; ZxE4V: $this->htmlEncoding = $this->inputEncoding ? $this->inputEncoding : $this->_getEncode($this->html); goto i4ySW; WeQdC: $inputEncoding && ($this->inputEncoding = $inputEncoding); goto b5rKi; Ff1GH: if (!empty($this->html)) { goto NjZ_4; } goto GjuLP; ZWuOe: } private function _getList() { goto uF7F2; tz87p: if (!(list($key, $reg_value) = each($this->regArr))) { goto mZC0G; } goto L3lk1; KqwV4: if (!$this->outputEncoding) { goto cNwmu; } goto qPhAg; b0spv: foreach ($lobj as $item) { goto iDj1a; iDj1a: switch ($reg_value[1]) { case "\x74\145\170\164": $this->data[$i][$key] = $this->_allowTags(pq($item)->html(), $tags); goto zM5rX; case "\x68\x74\x6d\154": $this->data[$i][$key] = $this->_stripTags(pq($item)->html(), $tags); goto zM5rX; default: $this->data[$i][$key] = pq($item)->attr($reg_value[1]); goto zM5rX; } goto M2tz0; AI_u1: zM5rX: goto UtLlz; bBlPu: $this->data[$i][$key] = call_user_func($this->regArr["\143\141\x6c\x6c\142\x61\143\x6b"], $this->data[$i][$key], $key); goto avOg_; Rs7E1: eO5Dw: goto xy0Rg; M2tz0: mFAj6: goto AI_u1; UtLlz: if (isset($reg_value[3])) { goto eO5Dw; } goto aSkDg; azFCu: $i++; goto VzUeM; U_Fo7: dlDQk: goto azFCu; xy0Rg: $this->data[$i][$key] = call_user_func($reg_value[3], $this->data[$i][$key], $key); goto U_Fo7; aSkDg: if (!isset($this->regArr["\143\141\154\154\142\x61\x63\153"])) { goto vl1lA; } goto bBlPu; VzUeM: m8IIz: goto ISzUW; Xo6fG: goto dlDQk; goto Rs7E1; avOg_: vl1lA: goto Xo6fG; ISzUW: } goto u0I3O; Vkcmg: $robj = pq($document)->find($this->regRange); goto eLa5M; mFiRc: $tags = isset($reg_value[2]) ? $reg_value[2] : ''; goto AFW0k; OH6RR: YEzro: goto j7jX4; u0I3O: VCyBw: goto ytkNS; uF7F2: $this->inputEncoding && (phpQuery::$defaultCharset = $this->inputEncoding); goto mFogr; eQRXb: $this->qpHtml = $document->htmlOuter(); goto cI0gI; ytkNS: goto IS51G; goto VJJu8; VJJu8: mZC0G: goto zG0Z2; nCQ0w: VHN8J: goto KqwV4; qPhAg: $this->data = $this->_arrayConvertEncoding($this->data, $this->outputEncoding, $this->htmlEncoding); goto uePtB; j7jX4: $document = phpQuery::newDocumentHTML($this->html); goto mFiRc; SfviK: XZft2: goto Vkcmg; uePtB: cNwmu: goto pXKbE; W5P12: foreach ($robj as $item) { goto P2yrY; W2s72: DbwJu: goto UHFZO; Be9Pp: reset($this->regArr); goto Iw9Cf; JPWe7: $tags = isset($reg_value[2]) ? $reg_value[2] : ''; goto VGlWs; Kzo9D: if (!(list($key, $reg_value) = each($this->regArr))) { goto lzwEh; } goto Kxoaa; BZ8JK: N7ZHX: goto v1Jgj; QD79g: $this->data[$i][$key] = call_user_func($this->regArr["\x63\x61\154\x6c\142\141\x63\153"], $this->data[$i][$key], $key); goto W2s72; lK1Jo: switch ($reg_value[1]) { case "\x74\x65\170\x74": $this->data[$i][$key] = $this->_allowTags(pq($iobj)->html(), $tags); goto BAP5e; case "\150\164\x6d\154": $this->data[$i][$key] = $this->_stripTags(pq($iobj)->html(), $tags); goto BAP5e; default: $this->data[$i][$key] = pq($iobj)->attr($reg_value[1]); goto BAP5e; } goto rz1E4; xY5Jx: if (!isset($this->regArr["\143\141\154\154\x62\x61\143\153"])) { goto DbwJu; } goto QD79g; Kxoaa: if (!($key == "\143\x61\154\154\142\141\143\x6b")) { goto SS0T2; } goto JrwoQ; v1Jgj: $this->data[$i][$key] = call_user_func($reg_value[3], $this->data[$i][$key], $key); goto XVQWn; yTaz2: goto vQ9SL; goto dm1TF; rz1E4: M905Z: goto KzVQB; UHFZO: goto Rf2OK; goto BZ8JK; KzVQB: BAP5e: goto rkPM1; h3Ap2: SS0T2: goto JPWe7; wL9xP: HHxoZ: goto z62Xh; rkPM1: if (isset($reg_value[3])) { goto N7ZHX; } goto xY5Jx; dm1TF: lzwEh: goto Be9Pp; P2yrY: vQ9SL: goto Kzo9D; Iw9Cf: $i++; goto wL9xP; VGlWs: $iobj = pq($item)->find($reg_value[0]); goto lK1Jo; JrwoQ: goto vQ9SL; goto h3Ap2; XVQWn: Rf2OK: goto yTaz2; z62Xh: } goto TeMae; eLa5M: $i = 0; goto W5P12; vhpu2: $i = 0; goto b0spv; MSR3N: goto IS51G; goto OH6RR; AFW0k: $lobj = pq($document)->find($reg_value[0]); goto vhpu2; cI0gI: if (!empty($this->regRange)) { goto XZft2; } goto N2Xpg; mFogr: $document = phpQuery::newDocumentHTML($this->html); goto eQRXb; N2Xpg: IS51G: goto tz87p; zG0Z2: goto VHN8J; goto SfviK; TeMae: lufIJ: goto nCQ0w; pXKbE: phpQuery::$documents = array(); goto OwZXg; L3lk1: if (!($key == "\x63\x61\154\x6c\142\x61\143\153")) { goto YEzro; } goto MSR3N; OwZXg: } private function _request($url) { goto hN8uJ; L18UB: curl_close($ch); goto UZry1; UZry1: goto ZqXRS; goto UJQKA; NNVkW: $opts = array("\150\x74\x74\x70" => array("\x68\145\141\144\x65\x72" => "\x52\145\x66\x65\162\x65\162\72{$url}")); goto UxP_2; hN8uJ: if (function_exists("\143\165\162\154\x5f\151\156\x69\164") && false) { goto xrHHq; } goto PbFmk; PbFmk: if (version_compare(PHP_VERSION, "\65\x2e\60\56\x30") >= 0) { goto T2gzs; } goto yZZ8m; KqYil: xrHHq: goto WAGNl; WAGNl: $ch = curl_init(); goto xuVVU; NT_1v: curl_setopt($ch, CURLOPT_REFERER, $url); goto Xu9Ib; R8UpY: $result = curl_exec($ch); goto L18UB; UJQKA: T2gzs: goto NNVkW; F4BdH: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto TuPQ6; Xu9Ib: curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); goto JhhC6; wg9bQ: ZqXRS: goto YAzVH; yZZ8m: $result = file_get_contents($url); goto MsLHN; UxP_2: $result = file_get_contents($url, false, stream_context_create($opts)); goto wg9bQ; dVsWR: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto F4BdH; YAzVH: return $result; goto TknKt; SYvr7: curl_setopt($ch, CURLOPT_AUTOREFERER, true); goto NT_1v; JhhC6: curl_setopt($ch, CURLOPT_USERAGENT, "\x4d\157\x7a\151\154\x6c\141\x2f\x35\56\x30\x20\50\x57\151\x6e\144\157\x77\163\x20\116\124\x20\x36\x2e\x31\73\40\127\117\x57\66\64\51\40\x41\x70\x70\x6c\145\127\145\x62\x4b\151\x74\57\x35\63\x37\x2e\63\x36\40\x28\113\110\124\115\x4c\x2c\40\154\x69\x6b\x65\x20\x47\145\x63\x6b\157\51\x20\103\x68\x72\157\155\x65\x2f\x34\x36\x2e\60\x2e\62\64\71\60\x2e\x37\61\x20\123\x61\146\141\x72\151\x2f\65\63\x37\56\63\x36"); goto R8UpY; MsLHN: goto ZqXRS; goto KqYil; TuPQ6: curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); goto SYvr7; xuVVU: curl_setopt($ch, CURLOPT_URL, $url); goto dVsWR; TknKt: } private function _removeHead($html) { return preg_replace("\x2f\74\150\x65\141\144\x2e\x2b\x3f\76\x2e\x2b\74\x5c\57\x68\145\141\144\x3e\57\x69\163", "\x3c\150\x65\141\x64\76\74\57\150\145\x61\144\76", $html); } private function _getEncode($string) { return mb_detect_encoding($string, array("\101\123\103\x49\111", "\107\x42\x32\x33\x31\x32", "\x47\x42\113", "\125\x54\x46\x2d\x38")); } private function _arrayConvertEncoding($arr, $toEncoding, $fromEncoding) { return $arr; } private function _isURL($str) { goto adjQD; KQ4hW: oBoOq: goto ec_gP; adjQD: if (!preg_match("\x2f\x5e\x68\164\164\160\50\163\51\x3f\x3a\134\57\134\x2f\56\x2b\x2f", $str)) { goto oBoOq; } goto DlKe7; DlKe7: return true; goto KQ4hW; ec_gP: return false; goto Qu7N3; Qu7N3: } private function _stripTags($html, $tags_str) { goto gS8R2; oa2SA: $p = array(); goto y1u_O; ypLto: return $html; goto dHGxH; Xqljk: $html = preg_replace($p, '', trim($html)); goto ypLto; y1u_O: foreach ($tagsArr[0] as $tag) { $p[] = "\x2f\50\x3c\50\x3f\72\134\x2f" . $tag . "\x7c" . $tag . "\51\133\136\76\135\52\x3e\51\x2f\x69"; hyY47: } goto AG926; AG926: eiBds: goto Xqljk; gS8R2: $tagsArr = $this->_tag($tags_str); goto AwDAj; AwDAj: $html = $this->_removeTags($html, $tagsArr[1]); goto oa2SA; dHGxH: } private function _allowTags($html, $tags_str) { goto Ou9vs; ZsLRm: $allow = ''; goto qmwC5; H_TMO: tKuOD: goto A2xZo; qmwC5: foreach ($tagsArr[0] as $tag) { $allow .= "\x3c{$tag}\x3e\40"; HWN8o: } goto H_TMO; A2xZo: return strip_tags(trim($html), $allow); goto SHp3v; Ou9vs: $tagsArr = $this->_tag($tags_str); goto Rpx2i; Rpx2i: $html = $this->_removeTags($html, $tagsArr[1]); goto ZsLRm; SHp3v: } private function _tag($tags_str) { goto P6t77; AIQl6: t8vpK: goto Kw5fr; P6t77: $tagArr = preg_split("\x2f\x5c\x73\53\x2f", $tags_str, -1, PREG_SPLIT_NO_EMPTY); goto GMEaY; D9upC: foreach ($tagArr as $tag) { goto ukFXM; sulPP: wQWbd: goto Tpr_R; Tpr_R: Lxbic: goto zmiPA; glF0D: SxONi: goto iirgt; U_HiP: goto wQWbd; goto glF0D; iirgt: array_push($tags[1], $arr[1]); goto sulPP; FTfJr: array_push($tags[0], $tag); goto U_HiP; ukFXM: if (preg_match("\x2f\55\x28\56\53\x29\57", $tag, $arr)) { goto SxONi; } goto FTfJr; zmiPA: } goto AIQl6; GMEaY: $tags = array(array(), array()); goto D9upC; Kw5fr: return $tags; goto A1urw; A1urw: } private function _removeTags($html, $tags) { goto wR7JC; bF20Y: if (!count($tags)) { goto dwQaT; } goto j6SUm; wR7JC: $tag_str = ''; goto bF20Y; UbP5o: phpQuery::$defaultCharset = $this->inputEncoding ? $this->inputEncoding : $this->htmlEncoding; goto h1eFG; OteG4: $html = pq($doc)->htmlOuter(); goto QlhrL; H4nTl: return $html; goto Bj6o0; QlhrL: $doc->unloadDocument(); goto jPD9Y; j6SUm: foreach ($tags as $tag) { $tag_str .= $tag_str ? "\54" . $tag : $tag; euR_K: } goto Fg0ad; h1eFG: $doc = phpQuery::newDocumentHTML($html); goto rBInP; rBInP: pq($doc)->find($tag_str)->remove(); goto OteG4; Fg0ad: xeXwl: goto UbP5o; jPD9Y: dwQaT: goto H4nTl; Bj6o0: } private function _log($message = '', $level = "\151\156\x66\x6f") { goto jsqs9; iO7N1: $url = $this->_isURL($this->page) ? $this->page : "\133\x68\164\155\x6c\135"; goto pg8w8; WpXNP: self::$logger->{$level}($message, array("\160\141\147\145" => $url, "\143\157\x75\156\164" => $count)); goto xi28I; xi28I: z_7WH: goto ZEK9a; tC55d: $message = empty($message) ? $count ? "\107\x65\x74\x20\x64\x61\x74\141\40\x73\165\x63\143\145\163\x73\x66\165\x6c\x6c\x79" : "\107\145\164\40\x64\141\x74\x61\x20\x66\141\x69\x6c\x65\144" : $message; goto WpXNP; pg8w8: $count = count($this->data); goto FN9qm; FN9qm: $level = empty($level) ? $count ? "\x69\156\146\157" : "\x77\141\x72\x6e\151\x6e\x67" : $level; goto tC55d; jsqs9: if (is_null(self::$logger)) { goto z_7WH; } goto iO7N1; ZEK9a: } }