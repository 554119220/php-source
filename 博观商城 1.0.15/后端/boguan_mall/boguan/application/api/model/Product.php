<?php
 namespace app\api\model; use app\api\service\Product as ProductService; use app\api\service\Order as OrderService; use app\api\model\Collect as CollectModel; use app\api\service\Token as TokenService; use app\api\model\Cart as CartModel; use app\api\model\User as UserModel; use app\api\model\Category as CategoryModel; class Product extends BaseModel { protected $hidden = array("\144\145\154\145\164\145\x5f\164\151\x6d\145", "\155\x61\x69\x6e\137\x69\155\x67\x5f\151\144", "\146\162\x6f\155", "\x70\151\x76\157\x74", "\143\x72\145\141\x74\x65\x5f\x74\151\x6d\x65", "\x63\x61\x74\x65\x67\157\162\x79\137\x69\x64", "\x75\x70\x64\x61\x74\x65\137\x74\x69\155\x65"); public static function getCartProduct($cartId, $productId, $attrIds) { goto Th416; Zlwnx: $product["\155\x73\147"] = "\xe5\225\x86\345\223\201\345\267\xb2\xe4\xb8\213\xe6\236\266"; goto e5lmE; vQB1c: $attr = $productService->getAttrInfo($productId, $attrIds, "\143\x61\x72\x74"); goto gK6A4; snlpA: LJXhL: goto fvzjb; t3VN4: xhsob: goto tH02B; zLKES: $product["\166\151\x70\137\160\x72\151\x63\x65"] = doubleval(sprintf("\45\x2e\x32\x66", $productService->getAttrVipPrice($productId, $cart["\x61\164\x74\162\137\151\x64\x5f\154\x69\x73\164"], $attr["\160\x72\x69\x63\x65"], $userInfo["\166\151\x70\137\151\144"]))); goto zr4Wj; DfO3e: $product["\x6d\x73\147"] = ''; goto AUxzy; JHKvg: $stock = getProductStock($productId); goto jhyEA; zr4Wj: $product["\x70\x72\151\x63\145"] = doubleval(sprintf("\45\x2e\x32\x66", $attr["\160\x72\x69\x63\x65"])); goto QMUFc; uEdgb: goto xhsob; goto OiAiZ; nAFQw: $product["\x70\162\151\x63\x65"] = doubleval(sprintf("\45\x2e\x32\146", $product["\160\x72\x69\143\x65"])); goto uEdgb; Zcm8M: XFK0k: goto t3VN4; pzhR4: $product["\x62\x75\171\x5f\x6c\x69\x6d\151\x74\137\x6e\165\155"] = $orderService->sumUserOrderProduct($product["\151\x64"]); goto QH25e; tH02B: if (!($product["\163\164\141\164\x75\163"] == 0)) { goto m6eCU; } goto lQTuL; Y6ega: chdw3: goto jVtlX; s1EN9: $product["\164\150\x75\x6d\142"] = $attr["\x69\155\x61\147\x65"]; goto ihJ_c; k45tR: $product["\155\x73\x67"] = "\350\xa7\204\346\xa0\xbc\344\xb8\215\xe5\255\230\xe5\x9c\250"; goto Zcm8M; t2j10: $userInfo = UserModel::getUserLevel(); goto GFAG8; gK6A4: $product["\141\x74\x74\162"] = $attr["\x61\x74\x74\x72\x5f\x6c\151\163\x74"]; goto zLKES; D8qqV: if (!($product["\151\163\x5f\x64\x65\154\x65\x74\x65"] == 1)) { goto N1QpA; } goto Pw1AH; Pw1AH: $product["\143\x61\156\137\142\x75\x79"] = 0; goto GR3a3; OiAiZ: gmI4m: goto vBKrX; AUxzy: U1MYF: goto Wnazl; QH25e: return $product; goto mEDUD; e5lmE: m6eCU: goto D8qqV; Th416: $productService = new ProductService(); goto N7_R0; Cv6FQ: N1QpA: goto pzhR4; mpQWi: goto U1MYF; goto Y6ega; WY1tt: $product["\x63\x61\156\137\x62\x75\171"] = 0; goto cjg4s; ihJ_c: goto XFK0k; goto snlpA; fvzjb: $product["\x63\141\156\137\x62\165\171"] = 0; goto k45tR; GR3a3: $product["\x6d\163\147"] = "\xe5\225\206\345\x93\x81\xe5\xb7\262\xe5\244\261\346\225\210"; goto Cv6FQ; MaOFF: $product = self::where("\151\x64", "\75", $productId)->field("\x69\x64\x2c\x74\150\x75\x6d\x62\x2c\x6e\x61\155\x65\54\151\163\137\x61\164\x74\x72\54\x70\x72\x69\x63\145\54\x73\165\x6d\155\141\x72\171\x2c\x73\x74\x6f\143\153\54\x73\x65\x6e\x64\137\x74\x79\160\x65\54\164\157\x74\141\x6c\137\x73\x74\157\143\153\54\x6c\151\155\151\164\137\x6e\165\155\x2c\x69\163\x5f\154\x69\155\x69\164\x2c\x69\163\x5f\144\x65\154\x65\164\x65\x2c\x73\164\141\164\165\163")->find(); goto JHKvg; GFAG8: $attrIds = str_replace("\x22", '', $attrIds); goto MaOFF; znrAb: if (!$attr) { goto LJXhL; } goto s1EN9; lQTuL: $product["\x63\x61\156\x5f\x62\x75\x79"] = 0; goto Zlwnx; vBKrX: $cart = CartModel::get($cartId); goto vQB1c; cWDQ8: $product["\141\x74\x74\x72"] = []; goto LQM_h; Wnazl: if ($product["\151\x73\x5f\x61\x74\x74\162"] == 1) { goto gmI4m; } goto cWDQ8; jhyEA: if ($stock > 0) { goto chdw3; } goto WY1tt; LQM_h: $product["\x76\x69\160\137\160\162\x69\x63\145"] = doubleval(sprintf("\45\56\62\x66", $productService->getNotAttrVipPrice($productId, $product["\x70\162\151\x63\x65"], $userInfo["\166\151\160\137\x69\x64"]))); goto nAFQw; QMUFc: $product["\x73\164\157\x63\x6b"] = $attr["\163\x74\x6f\143\x6b"]; goto znrAb; jVtlX: $product["\x63\x61\156\137\142\x75\x79"] = 1; goto DfO3e; N7_R0: $orderService = new OrderService(); goto t2j10; cjg4s: $product["\x6d\x73\x67"] = "\xe5\272\x93\345\255\x98\xe9\207\217\344\xb8\215\350\xb6\263"; goto mpQWi; mEDUD: } public function getMainImgUrlAttr($value, $data) { return $this->prefixImgUrl($value, $data); } public function getImageAttr($value) { goto jOdKs; Nx_v4: pOE4h: goto iF_R3; iF_R3: return json_decode($value, true); goto MpCJX; DmSK7: return null; goto Nx_v4; jOdKs: if (!empty($value)) { goto pOE4h; } goto DmSK7; MpCJX: } public function getSendTypeAttr($value) { goto R08Xf; b2es2: return null; goto fdIBC; R08Xf: if (!empty($value)) { goto H6PeO; } goto b2es2; fdIBC: H6PeO: goto BOhvk; BOhvk: return json_decode($value, true); goto RIlb2; RIlb2: } public function getTagAttr($value) { goto WAnAJ; J0_o9: return null; goto FRd33; F50Fu: return json_decode($value); goto oDqGk; FRd33: T1J0B: goto F50Fu; WAnAJ: if (!empty($value)) { goto T1J0B; } goto J0_o9; oDqGk: } public static function updateStock() { goto DQTI_; T4njK: joAAP: goto UZsps; DQTI_: $product = self::all(); goto n3jmH; n3jmH: foreach ($product as $key => $value) { goto KP_QS; zEfVZ: tUI9N: goto Zh7DW; UBCzT: self::update(["\x69\x64" => $value["\x69\x64"], "\x74\157\164\x61\x6c\137\x73\164\x6f\143\x6b" => $stock]); goto zEfVZ; KP_QS: $stock = getProductStock($value["\151\144"]); goto UBCzT; Zh7DW: } goto T4njK; UZsps: } public static function getMostRecent($count) { $products = self::limit($count)->order("\x63\162\x65\x61\x74\x65\137\x74\151\155\145\x20\144\x65\163\x63")->select(); return $products; } public static function getProductsByCategoryID($cateId, $page, $size) { goto F46kf; NFewJ: $cateId = getChildCate($cateId); goto zRobR; r6Vu_: return $products; goto EDjI9; K70V9: RRyJQ: goto MSWxT; QmGYH: foreach ($products as $key => $value) { goto d6gMq; o1qe7: $products[$key]["\141\x74\x74\x72"] = $productService->getAttrGroupList($value["\x69\144"]); goto yFe40; d6gMq: $products[$key]["\x76\x69\x70\137\160\162\151\143\x65"] = $productService->getProductVipPrice($value["\151\x64"], $value["\160\162\x69\143\145"], $value["\x69\x73\137\x61\164\164\x72"]); goto o1qe7; yFe40: rC6OI: goto jsmdP; jsmdP: } goto K70V9; F46kf: $productService = new ProductService(); goto NFewJ; MJfiC: $products = self::where("\x75\x6e\151\x61\143\x69\144", session("\x75\156\x69\x61\143\x69\x64"))->where($where)->where("\151\x73\x5f\144\145\x6c\145\164\145", "\75", 0)->where("\x73\x74\141\x74\x75\x73", "\x3d", 1)->order("\x73\x6f\x72\164", "\144\x65\163\143")->field("\x69\x64\x2c\x74\150\165\155\x62\x2c\156\x61\x6d\x65\54\x70\162\151\143\x65\x2c\157\x5f\x70\162\151\x63\145\54\x73\x75\155\155\x61\162\171\x2c\151\163\x5f\141\x74\164\162\54\143\x61\164\x65\137\x69\x64")->paginate($size, true, ["\x70\x61\x67\x65" => $page]); goto yKEA1; zRobR: $where = "\143\141\x74\x65\x5f\151\x64\x20\151\156\x28{$cateId}\x29"; goto MJfiC; MSWxT: RxRaf: goto r6Vu_; yKEA1: if (empty($products)) { goto RxRaf; } goto QmGYH; EDjI9: } public static function getProductsByCategoryHot($cateId, $page, $size) { goto USPKj; gPqTK: $where = "\x63\141\164\145\137\x69\144\x20\x69\156\x28{$cateId}\x29"; goto JgNkI; Wohck: AA5AV: goto xoFeK; IrHDp: if (empty($products)) { goto AA5AV; } goto MrF5C; xoFeK: return $products; goto rUZxN; USPKj: $productService = new ProductService(); goto gPqTK; JgNkI: $products = self::where($where)->where("\151\x73\x5f\144\x65\x6c\145\x74\x65", "\x3d", 0)->where("\x73\x74\x61\164\165\163", "\75", 1)->order("\163\x61\154\145\163\x20\x64\x65\163\x63")->field("\151\x64\x2c\x74\x68\x75\x6d\x62\54\156\141\155\145\54\160\x72\151\143\145\x2c\x6f\137\x70\162\x69\143\145\54\x73\165\x6d\x6d\141\x72\171\54\151\x73\x5f\x61\164\164\162\54\x73\141\154\145\x73")->paginate($size, true, ["\160\141\x67\x65" => $page]); goto IrHDp; MrF5C: foreach ($products as $key => $value) { $products[$key]["\166\x69\160\137\160\x72\x69\143\x65"] = $productService->getProductVipPrice($value["\x69\144"], $value["\160\162\x69\x63\145"], $value["\151\163\x5f\141\x74\x74\x72"]); dffLZ: } goto E4Hrm; E4Hrm: yG2Bg: goto Wohck; rUZxN: } public static function getProductDetail($productId) { goto uES6T; kfsgz: $product["\143\157\155\x6d\x65\156\164"]["\165\163\145\162"]["\x70\x72\141\151\163\x65"] = $user_praise; goto yUSa2; C8FZ6: KFnig: goto NTV_p; PUy03: rUsQG: goto bBoFy; F71nL: l6YZV: goto nvoBg; dDjwq: $praise = Comment::userPraise($product["\143\157\155\155\145\x6e\x74"]["\x75\163\145\x72"]["\151\144"]) * 100 . "\x25"; goto Oclmb; Ob87o: if (empty($promises)) { goto yGQX1; } goto qHppM; NTV_p: $comment = Comment::with("\165\163\145\162")->where(["\x75\156\x69\141\143\151\144" => session("\165\x6e\x69\141\x63\x69\x64"), "\x70\x72\157\x64\165\x63\164\137\x69\x64" => $productId, "\163\164\141\x74\x75\163" => 1])->order("\x69\144", "\x64\x65\x73\x63")->find(); goto bZjbT; BQlHf: $send_type[2] = 1; goto k7di3; l2Zre: $product["\166\x69\x70\137\x70\x72\x69\x63\145"] = $productService->getProductVipPrice($productId, $product["\x70\x72\151\143\145"], $product["\x69\163\137\x61\x74\164\x72"]); goto GpDmW; bBoFy: $product["\143\x6f\x6d\x6d\145\x6e\164"] = $comment; goto hMeZc; Oclmb: $user_praise = $praise ? $praise : "\61\x30\60\45"; goto kfsgz; qVtTB: if (!($product["\151\x73\x5f\141\x74\164\x72"] == 1)) { goto xOdKW; } goto YojQi; gq3An: if (!($product["\163\145\156\144\x5f\164\x79\x70\x65"] != '')) { goto l6YZV; } goto DVWBz; dkkxB: if ($comment["\x75\x73\145\x72\x5f\151\x64"]) { goto GEcXT; } goto NGn01; KCcDl: lvdnU: goto F71nL; OSJmV: xOdKW: goto reiRK; mTqr5: $product = self::where("\x75\156\151\141\x63\151\x64", session("\x75\156\x69\x61\x63\x69\x64"))->where("\151\x64", "\75", $productId)->field("\x69\x64\x2c\x6e\141\155\145\54\x74\150\165\155\x62\54\160\x72\151\x63\145\x2c\157\x5f\160\x72\x69\143\x65\54\x76\151\x70\137\160\x72\151\143\x65\54\163\x61\x6c\x65\x73\54\x73\x75\x6d\x6d\x61\x72\171\x2c\x63\x6f\156\164\x65\156\164\54\163\x70\x65\143\54\x61\146\164\x65\162\x2c\151\x6d\141\147\145\54\164\141\x67\x2c\163\164\157\143\x6b\54\x69\163\137\x61\164\164\x72\54\x73\x65\x6e\x64\x5f\164\171\x70\x65\54\160\x72\157\155\151\163\x65\54\x74\157\164\141\154\x5f\163\164\x6f\x63\153\x2c\x76\151\x64\145\157\137\x75\162\x6c\x2c\x6c\x69\155\151\x74\137\x6e\x75\x6d\54\x69\x73\137\154\151\155\151\164\54\163\x74\x61\x74\165\163")->find(); goto Jn4I4; YojQi: $product["\x70\162\151\x63\x65\x5f\x61\162\x65\x61"] = self::getAttrPriceArea($product["\x69\144"]); goto OSJmV; KsfKb: GEcXT: goto Mbo0_; KUYzJ: if (!($platform["\151\x73\x5f\x70\x69\x63\x6b"] == 1 && in_array("\62", $product["\x73\x65\x6e\144\x5f\164\171\160\x65"]))) { goto tyb3D; } goto TDveJ; yUSa2: if ($product["\160\162\157\155\x69\x73\145"] != '') { goto uQefp; } goto eLxCi; DVWBz: $platform = PlatformSettings::where("\165\156\151\141\143\x69\x64", session("\x75\156\151\141\x63\x69\144"))->field("\x69\x73\x5f\160\151\143\x6b\54\151\163\x5f\144\145\x6c\151\166\145\x72\x79\54\x69\x73\137\x65\170\x70\x72\145\x73\x73")->find(); goto KUYzJ; NGn01: $comment["\165\x73\145\x72"] = ["\141\x76\x61\164\141\162" => $comment["\x61\166\x61\x74\x61\162"], "\156\x69\143\x6b\156\141\x6d\x65" => $comment["\156\x69\143\153\x6e\141\155\145"]]; goto KsfKb; nvoBg: $collected = CollectModel::where(["\165\x73\x65\x72\x5f\x69\144" => $uid, "\x70\162\157\144\165\x63\x74\x5f\x69\144" => $productId])->find(); goto XZ6RG; eLxCi: $product["\x70\162\x6f\155\151\163\x65\x73"] = []; goto Bk5R_; Jn4I4: if (!empty($product)) { goto EVkMX; } goto dcblj; TDveJ: $send_type[0] = 3; goto zQ22i; zQ22i: tyb3D: goto aJsdd; wVMyN: O5PHf: goto vSkYV; XZ6RG: if ($collected) { goto IXJeu; } goto oPyFr; Bk5R_: goto hCfnl; goto f_wnN; qHppM: foreach ($promises as $key => $value) { goto JumS4; mrMDc: $promises[$key]["\151\x63\157\156"] = str_replace("\57\x2f", "\x68\164\x74\160\163\72\x2f\x2f", $value["\151\143\157\x6e"]); goto uGijW; zGQkU: lyKKg: goto AbmRy; uGijW: CkUwK: goto zGQkU; JumS4: if (!(strpos($value["\151\x63\x6f\x6e"], "\57\57") == 0)) { goto CkUwK; } goto mrMDc; AbmRy: } goto wVMyN; cr3ZZ: $product["\160\x72\x6f\155\x69\x73\x65\163"] = $promises; goto vumky; zo6V1: $product["\x61\x74\x74\x72"] = $productService->getAttrGroupList($productId); goto l2Zre; uES6T: $productService = new ProductService(); goto Yn_0z; aJsdd: if (!($platform["\x69\163\x5f\144\145\x6c\151\x76\x65\x72\x79"] == 1 && in_array("\63", $product["\163\x65\156\144\x5f\x74\171\160\145"]))) { goto Va4A6; } goto Rm1NE; vumky: hCfnl: goto VAIAU; k7di3: wakUA: goto e7ZZ5; vSkYV: yGQX1: goto cr3ZZ; bZjbT: if (empty($comment)) { goto rUsQG; } goto dkkxB; quqmB: goto KFnig; goto CPYTH; tas83: return $product; goto uVLh9; GpDmW: $product["\143\x6f\x75\160\x6f\x6e"] = Coupon::getCouponByProduct($productId); goto Mqi2j; hMeZc: $product["\x63\157\x6d\155\x65\x6e\x74\x5f\x63\x6f\165\156\x74"] = Comment::where(["\165\x6e\151\x61\143\151\x64" => session("\x75\156\151\x61\143\151\144"), "\x70\x72\x6f\x64\165\143\164\x5f\151\x64" => $productId, "\x73\164\141\164\165\x73" => 1])->count(); goto dDjwq; oPyFr: $product["\x69\x73\137\143\x6f\x6c\154\x65\143\164"] = 0; goto quqmB; Mqi2j: $send_type = []; goto gq3An; XnVJ8: if (!($platform["\x69\163\x5f\x65\170\160\162\x65\x73\163"] == 1 && in_array("\61", $product["\x73\145\x6e\x64\137\164\x79\160\x65"]))) { goto wakUA; } goto BQlHf; Mbo0_: unset($comment["\x61\166\x61\x74\141\x72"]); goto Wiiar; OCCB9: Footprint::addFootprint($footData); goto tas83; fXy0A: $product["\163\x65\x6e\x64\x5f\164\171\x70\x65"] = json_encode(array_values($send_type)); goto KCcDl; Yn_0z: $orderService = new OrderService(); goto Kjw7F; Kjw7F: $uid = TokenService::getCurrentUid(); goto mTqr5; mR95R: $footData = ["\164\x79\160\145" => 1, "\x70\x72\x6f\x64\x75\143\164\137\151\144" => $productId]; goto OCCB9; CPYTH: IXJeu: goto mWhKh; O2_1M: EVkMX: goto zo6V1; e7ZZ5: if (empty($send_type)) { goto lvdnU; } goto fXy0A; mWhKh: $product["\151\163\x5f\143\157\154\x6c\x65\143\164"] = 1; goto C8FZ6; Wiiar: unset($comment["\156\x69\143\x6b\x6e\x61\x6d\145"]); goto PUy03; Rm1NE: $send_type[1] = 2; goto tYGA2; tYGA2: Va4A6: goto XnVJ8; etZ2T: $promises = Promise::where(["\165\x6e\151\x61\x63\x69\144" => session("\165\156\x69\141\x63\x69\144"), "\163\x74\141\164\x75\163" => 1])->where("\x69\144\x20\151\x6e\50{$product["\160\x72\x6f\x6d\151\x73\x65"]}\51")->select(); goto Ob87o; dcblj: return; goto O2_1M; f_wnN: uQefp: goto etZ2T; VAIAU: unset($product["\160\x72\x6f\x6d\x69\163\x65"]); goto qVtTB; reiRK: $product["\x62\x75\171\x5f\x6c\151\155\x69\164\137\156\165\x6d"] = $orderService->sumUserOrderProduct($product["\x69\x64"]); goto mR95R; uVLh9: } private function getAttrPriceArea($productId) { goto n0402; m3kLc: $priceArr = []; goto rS0WP; LZpje: return ["\x6d\x69\156\x5f\x70\162\x69\143\145" => min($priceArr), "\155\x61\170\137\x70\x72\x69\x63\x65" => max($priceArr)]; goto hxelk; BK_zN: ohsZT: goto LZpje; rS0WP: foreach ($attrValue as $key => $value) { $priceArr[] = $value["\160\162\x69\143\x65"]; VJp2q: } goto BK_zN; n0402: $attrValue = AttrValue::where("\165\x6e\x69\141\143\151\144", session("\x75\x6e\151\141\x63\151\144"))->where(["\x70\x72\157\x64\x75\143\x74\137\x69\x64" => $productId])->select(); goto m3kLc; hxelk: } }