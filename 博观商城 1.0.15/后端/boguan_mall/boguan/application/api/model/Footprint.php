<?php
 namespace app\api\model; use app\api\service\Token as TokenService; use app\api\model\Content as ContentModel; use app\api\model\Product as ProductModel; use app\api\service\Product as ProductService; use think\db\Expression; class Footprint extends BaseModel { public static function addFootprint($data) { goto XC4yh; ovQt5: goto tedMR; goto Zlg_v; rnCyP: if ($data["\164\171\x70\x65"] == 1) { goto rSO14; } goto M5Rgw; tOk14: self::create($data); goto QYYH4; yuAaR: lkYWk: goto gjx00; XC4yh: $uid = TokenService::getCurrentUid(); goto eyuTt; fOu8r: if (!$haveFootprint) { goto a3axR; } goto M5rti; hOeCN: $haveFootprint->update(["\x69\x64" => $haveFootprint["\151\x64"], "\154\x61\x73\164\x5f\x74\x69\155\x65" => time()]); goto ovQt5; X0ilv: if (!$haveFootprint) { goto MnOgO; } goto hOeCN; vwljF: goto lkYWk; goto UkXvb; VxYmE: goto vtGE6; goto ZRcgG; eyuTt: $data["\x75\x6e\151\141\x63\151\144"] = session("\165\x6e\151\141\143\151\x64"); goto olnUo; QYYH4: vtGE6: goto vwljF; UkXvb: rSO14: goto rwJ2j; olnUo: $data["\165\x73\x65\162\x5f\151\144"] = $uid; goto rnCyP; La46u: tedMR: goto yuAaR; wivKJ: self::create($data); goto La46u; M5rti: $haveFootprint->update(["\151\x64" => $haveFootprint["\x69\144"], "\154\141\163\x74\x5f\164\x69\155\145" => time()]); goto VxYmE; Zlg_v: MnOgO: goto wivKJ; M5Rgw: $haveFootprint = self::where(["\165\x73\145\x72\x5f\x69\x64" => $uid, "\x63\x6f\x6e\x74\x65\156\164\137\151\x64" => $data["\x63\157\156\164\x65\156\x74\137\151\144"], "\x69\x73\137\144\x65\154\145\164\145" => 0])->find(); goto fOu8r; ZRcgG: a3axR: goto tOk14; rwJ2j: $haveFootprint = self::where(["\x75\156\x69\141\143\151\144" => session("\165\156\x69\x61\x63\x69\144"), "\165\x73\145\x72\137\151\x64" => $uid, "\160\x72\x6f\144\x75\x63\x74\x5f\x69\x64" => $data["\x70\162\x6f\144\165\x63\x74\137\151\x64"], "\151\163\x5f\x64\145\154\145\164\145" => 0])->whereTime("\143\162\145\141\164\x65\137\x74\151\x6d\145", "\x64")->find(); goto X0ilv; gjx00: } public static function getFootprintDays($type, $uid, $page, $size) { goto bJxgY; bJxgY: $footprint = self::where(["\x75\x6e\x69\x61\143\x69\144" => session("\x75\x6e\x69\141\x63\151\x64"), "\x75\x73\145\162\x5f\x69\x64" => $uid, "\x74\x79\x70\145" => $type, "\151\163\137\144\145\154\145\164\145" => 0])->order("\x63\162\x65\141\x74\145\x5f\164\151\155\x65", "\144\x65\x73\x63")->paginate($size, true, ["\160\141\x67\x65" => $page]); goto Y3VNq; jBTja: wsbIY: goto lnSFT; lnSFT: return $date; goto coyiz; yL3WP: foreach ($footprint as $key => $value) { goto goqre; goqre: $create_time = date("\x59\x2d\x6d\x2d\x64", strtotime($value["\x63\x72\x65\x61\164\x65\x5f\164\x69\x6d\x65"])); goto DgO9H; DgO9H: if (in_array($create_time, $date)) { goto wgtiv; } goto yMIXc; ne4_n: wgtiv: goto CRrbW; yMIXc: $date[$key] = date("\x59\55\155\x2d\144", strtotime($value["\143\x72\x65\x61\x74\x65\x5f\x74\x69\x6d\x65"])); goto ne4_n; CRrbW: d7SOA: goto Ui8LO; Ui8LO: } goto jBTja; Y3VNq: $date = []; goto yL3WP; coyiz: } public static function getFootprintData($uid, $type, $data) { goto IJtGN; DyZDm: return array_values($footprint); goto Osu2j; IJtGN: $footprint = $productId = $contentId = $product = $content = []; goto pX7Qw; pX7Qw: foreach ($data as $key => $value) { goto gHAkl; S3eWk: $product = []; goto NQiLH; t5PwN: $footprint[$key]["\x66\157\x6f\164\x70\x72\x69\156\x74"] = $product; goto POBie; sQA3a: array_unique($contentId); goto ljQlX; fabxu: $footprintData = self::where(["\165\156\151\x61\x63\x69\x64" => session("\165\156\151\141\143\x69\144"), "\x75\163\145\x72\137\x69\144" => $uid, "\x74\171\x70\145" => $type, "\151\x73\x5f\144\x65\x6c\145\164\x65" => 0])->whereTime("\143\162\x65\x61\x74\145\x5f\x74\151\155\x65", "\x62\x65\x74\167\x65\x65\156", [$value . "\x20\60\60\72\60\60\72\x30\60", $value . "\x20\x32\63\72\x35\x39\72\65\x39"])->order("\x63\x72\145\x61\x74\145\137\164\x69\155\145", "\x64\145\163\x63")->select(); goto wUCLF; NQiLH: if (!($productIds != '')) { goto G8gIK; } goto MxYmu; ghqcd: $exp = new Expression("\146\x69\x65\x6c\144\x28\x69\x64\54{$productIds}\x29"); goto S3eWk; YkqdO: array_unique($productId); goto sQA3a; lRFUO: G8gIK: goto t5PwN; x5hJ5: $where = "\151\144\40\x69\156\50{$productIds}\x29"; goto ghqcd; UWskp: IjUYg: goto YkqdO; l9HpP: $content = []; goto JlpTq; ScDi5: if ($type == 1) { goto ryusO; } goto l9HpP; B4149: $footprint[$key]["\x66\x6f\157\x74\160\162\x69\x6e\x74"] = $content; goto gOduM; POBie: ybHAP: goto f682t; aOL9d: ApAjd: goto lRFUO; CardI: $where = "\151\x64\x20\x69\156\50{$contentIds}\51"; goto GTiUY; JlpTq: if (!($contentIds != '')) { goto sG6oU; } goto CardI; f682t: D43KT: goto sCKoX; gHAkl: $footprint[$key]["\x64\141\164\x65"] = $value; goto fabxu; wUCLF: foreach ($footprintData as $k => $v) { goto CMVQZ; CMVQZ: $productId[$k] = $v["\160\x72\x6f\144\165\x63\x74\x5f\151\144"]; goto wHvFp; wHvFp: $contentId[$k] = $v["\x63\x6f\x6e\164\x65\156\x74\137\x69\x64"]; goto YZdRE; YZdRE: N2kdF: goto oImdd; oImdd: } goto UWskp; AoLDQ: $contentIds = implode("\x2c", $contentId); goto ScDi5; pCvU2: sG6oU: goto B4149; q3_cl: if (empty($product)) { goto ApAjd; } goto rVpVi; rVpVi: $productService = new ProductService(); goto s7t1v; A8cED: ryusO: goto x5hJ5; cqpqI: uM5Is: goto aOL9d; MxYmu: $product = ProductModel::where(["\165\x6e\151\x61\143\x69\x64" => session("\x75\156\x69\141\x63\151\x64"), "\x69\163\137\x64\145\x6c\145\x74\x65" => 0])->where($where)->field("\x69\x64\54\x70\162\151\143\145\x2c\157\137\160\162\151\143\x65\x2c\156\141\x6d\145\x2c\x74\150\x75\155\x62\x2c\163\x75\x6d\x6d\141\162\x79\54\x69\163\x5f\x61\x74\x74\x72")->order($exp)->select(); goto q3_cl; s7t1v: foreach ($product as $kk => $vv) { $product[$kk]["\166\151\160\137\160\162\x69\143\145"] = $productService->getProductVipPrice($vv["\x69\x64"], $vv["\160\162\x69\143\x65"], $vv["\151\163\x5f\x61\x74\x74\162"]); ASz1a: } goto cqpqI; GTiUY: $ContentExp = new Expression("\x66\x69\x65\x6c\x64\x28\151\x64\x2c{$contentIds}\x29"); goto RSR4H; RSR4H: $content = ContentModel::where("\165\156\x69\x61\x63\151\x64", "\x3d", session("\165\x6e\x69\141\143\151\144"))->where($where)->field("\x69\x64\x2c\x74\x69\164\154\x65\x2c\154\x69\153\145\x73\x2c\x76\x69\x65\x77\163\54\163\157\162\x74\54\x69\x6d\141\147\145\x2c\143\x72\x65\141\x74\x65\x5f\164\151\155\145")->order($ContentExp)->select(); goto pCvU2; gOduM: goto ybHAP; goto A8cED; ljQlX: $productIds = implode("\54", $productId); goto AoLDQ; sCKoX: } goto BWd3s; BWd3s: cPFdV: goto DyZDm; Osu2j: } public static function countFootprintByUid($uid) { goto nv8jj; Xbmrn: bFrHi: goto JwNRX; Q3ph8: return $count; goto nUZhy; yGdZg: $contentData = []; goto WwGXu; btboX: foreach ($productFoot as $key => $value) { goto oaBHg; FSc2Q: if (!($product["\x69\163\x5f\144\x65\154\145\x74\145"] == 0 && !empty($product))) { goto Vqtq3; } goto QjRu9; sAbUx: Vqtq3: goto O0aSv; QjRu9: $productData[] = $product["\x69\144"]; goto sAbUx; O0aSv: mcmDs: goto NJ9UJ; oaBHg: $product = ProductModel::get($value["\160\162\x6f\x64\165\x63\164\137\151\144"]); goto FSc2Q; NJ9UJ: } goto Xbmrn; tbl8j: $count = count($productFoot) + count($contentFoot); goto Q3ph8; WwGXu: foreach ($contentFoot as $key => $value) { goto HSweD; ij65e: if (empty($content)) { goto OnoHb; } goto SW8fA; YVXD7: Mxngx: goto BzVsg; FqJco: OnoHb: goto YVXD7; HSweD: $content = ContentModel::get($value["\143\x6f\156\164\145\156\164\137\x69\144"]); goto ij65e; SW8fA: $contentData[] = $content["\x69\144"]; goto FqJco; BzVsg: } goto l3ZSl; I2Zla: $productData = []; goto btboX; l3ZSl: WiHD7: goto tbl8j; nv8jj: $productFoot = self::where(["\165\x6e\151\141\143\151\144" => session("\165\156\151\141\143\x69\x64"), "\165\163\145\x72\x5f\x69\144" => $uid, "\x74\171\160\145" => 1, "\x69\163\x5f\144\x65\154\x65\164\145" => 0])->select(); goto I2Zla; JwNRX: $contentFoot = self::where(["\165\x6e\151\141\x63\151\x64" => session("\x75\156\x69\x61\143\x69\x64"), "\x75\163\x65\x72\x5f\151\x64" => $uid, "\x74\x79\160\x65" => 2, "\x69\163\137\144\145\x6c\x65\164\x65" => 0])->select(); goto yGdZg; nUZhy: } }