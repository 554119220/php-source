<?php
 namespace app\api\service; use app\api\model\Cart; use app\api\model\Coupon; use app\api\model\Integral; use app\api\model\UserAddress; use app\api\model\UserCoupon; use app\api\model\UserShareMoney; use app\lib\enum\OrderStatusEnum; use app\lib\exception\OrderException; use app\api\model\Order as OrderModel; use app\api\service\Token as TokenService; use app\api\service\Product as ProductService; use app\api\model\Product as ProductModel; use app\api\model\User as UserModel; use app\api\model\UserShareMoney as UserShareMoneyModel; use think\Db; use app\api\model\Cart as CartModel; use app\api\model\PlatformSettings; use think\Exception; use app\api\model\UserCoupon as UserCouponModel; use app\api\model\UserAddress as UserAddressModel; use app\api\model\PickPoint as PickPointModel; use app\api\model\Delivery as DeliveryModel; use app\api\model\IntegralDetail; use app\api\service\Wechat as WechatService; class Order { protected $data; protected $freight_price; protected $delivery_price; protected $coupon_price; protected $coupon_min_price; protected $coupon_type; protected $coupon_discount; protected $uid; public function place($uid, $data) { goto M1HnR; Q2bc8: tL_wn: goto ZpEwH; FDqy8: RSuil: goto eRG_G; g1Btb: if (!($delivery["\151\163\137\x74\151\x6d\x69\156\x67"] == 1 && $this->data["\144\x65\x6c\151\166\x65\x72\x79\137\164\151\x6d\x65"] == '')) { goto SG0Ko; } goto Da1TI; ixSNr: WV85_: goto peflo; OGdn0: if (!($this->data["\157\162\x64\x65\162\x5f\164\x79\160\145"] != "\x33")) { goto fToiI; } goto lLkw2; KyJUy: eP1xX: goto fh0Ql; M1HnR: $this->data = $data; goto zdR08; bAXgv: if (!(empty($pickPoint) || $platformSetting["\x69\x73\137\160\151\x63\x6b"] == "\60")) { goto cZhlS; } goto DCbYy; AIYzY: ItrSW: goto jAXEu; WORKx: bjX2_: goto F22U3; hNkYY: return ["\x6d\x73\147" => "\xe5\x95\x86\xe5\xae\xb6\346\234\xaa\345\274\x80\xe5\x90\257\xe5\xbf\253\xe9\x80\x92\345\217\x91\xe8\xb4\xa7", "\145\x72\162\x6f\x72\x43\157\x64\x65" => 0]; goto KXdat; HrsF5: $freightPrice = $productService->getFreightPrice($data); goto QAwLg; zhiBj: return ["\x6d\163\x67" => "\xe8\257\267\351\x80\211\xe6\x8b\251\xe4\274\x98\xe6\203\240\345\x88\270", "\145\162\162\157\162\103\157\x64\145" => 0]; goto FrBa7; zid3A: return ["\x6d\163\x67" => "\xe6\x9a\x82\xe6\x97\240\xe5\x8f\xaf\xe7\x94\250\xe4\274\230\346\203\240\345\210\270", "\145\162\x72\157\x72\103\x6f\144\x65" => 0]; goto LTQac; wVqSJ: if (!(empty($userCoupon) || empty($coupon))) { goto lX1v0; } goto zid3A; AcOD6: if ($haveStock["\x73\x74\x61\x74\165\163"]) { goto RSuil; } goto Ipyx0; vmCeW: if (!($this->data["\x6f\162\x64\145\162\x5f\164\x79\160\145"] == "\x33")) { goto MNstR; } goto CC226; dEvsn: $coupon = Coupon::where(["\165\x6e\151\x61\143\151\x64" => session("\165\156\151\141\143\151\x64")])->field("\151\x64\54\x74\x79\x70\x65\x2c\163\x75\142\x5f\160\162\151\x63\145\54\144\151\x73\143\157\165\156\164\54\155\x69\x6e\137\160\162\151\143\145")->find($this->data["\143\157\165\x70\157\156\x49\144"]); goto wVqSJ; LTQac: lX1v0: goto tutH_; Vjorm: if ($this->data["\157\162\x64\145\x72\137\164\171\160\x65"] == "\61") { goto muLI5; } goto cQMX9; QV_r6: return ["\155\163\x67" => "\xe5\x95\206\345\256\xb6\346\234\252\345\274\200\xe5\220\257\xe5\x90\214\xe5\237\216\351\x85\x8d\xe9\x80\x81", "\x65\162\162\157\162\x43\157\x64\145" => 0]; goto AAdyv; pUJ96: $this->freight_price = $freightPrice; goto vmCeW; dtuL7: cZhlS: goto MCKHk; yUjVv: uqL8c: goto ucsMR; NVThj: muLI5: goto qZAI1; F22U3: MNstR: goto Qvks_; Ipyx0: return ["\155\x73\x67" => $haveStock["\155\163\x67"], "\x65\x72\x72\157\x72\x43\x6f\144\x65" => 0]; goto FDqy8; AAdyv: ymSj1: goto g1Btb; ucsMR: return ["\x6d\163\147" => "\xe8\257\267\345\241\253\xe5\x86\x99\346\x8f\x90\xe8\xb4\247\344\272\272", "\x65\162\162\157\x72\x43\x6f\144\x65" => 0]; goto VagyM; CC226: $pickPoint = PickPointModel::where(["\x75\156\x69\141\143\x69\144" => session("\165\x6e\x69\x61\x63\x69\144")])->find($this->data["\160\151\x63\153\137\x69\156\x66\x6f"]["\x70\151\143\153\x49\144"]); goto bAXgv; Da1TI: return ["\155\163\147" => "\xe8\xaf\267\xe9\200\x89\xe6\x8b\xa9\xe9\x80\x81\350\xbe\xbe\xe6\x97\266\351\x97\264", "\x65\x72\x72\x6f\162\103\157\x64\145" => 0]; goto rdHSY; m439J: return ["\155\163\x67" => $haveStock["\x6d\163\x67"], "\144\141\164\x61" => $haveStock["\x64\x61\x74\141"], "\x65\x72\162\157\x72\103\157\144\145" => 1]; goto rfSZk; mon8f: goto bjX2_; goto yUjVv; QAwLg: goto errVI; goto Q2bc8; rdHSY: SG0Ko: goto aathP; qZAI1: if (!($platformSetting["\151\163\x5f\145\170\x70\162\145\163\163"] == "\60")) { goto sbj29; } goto hNkYY; a_93U: P0Ywd: goto pUSF_; kbv2R: goto bjX2_; goto a_93U; disad: if ($this->data["\160\151\143\153\137\x69\156\146\x6f"]["\156\141\155\145"] == '') { goto uqL8c; } goto THYPL; dJt1k: errVI: goto pUJ96; THYPL: if ($this->data["\160\151\143\153\137\151\x6e\146\x6f"]["\160\150\157\156\x65"] == '') { goto a0rR7; } goto mskxF; CNl1M: $platformSetting = PlatformSettings::where(["\165\x6e\x69\x61\143\x69\144" => session("\x75\x6e\151\141\143\x69\x64")])->find(); goto LuykP; x0kxy: if (!empty($userAddress)) { goto eP1xX; } goto PGInl; FrBa7: goto Lq7yM; goto z5SJd; tfuOy: return ["\x6d\x73\x67" => "\350\xaf\267\xe5\241\253\345\206\231\xe6\211\213\xe6\x9c\xba\xe5\217\267\347\xa0\201", "\x65\162\162\x6f\x72\x43\157\x64\x65" => 0]; goto YOTiH; VagyM: goto bjX2_; goto wE599; DCbYy: return ["\x6d\163\147" => "\345\x95\x86\345\xae\xb6\346\234\xaa\345\xbc\x80\xe5\220\xaf\xe4\xb8\x8a\xe9\227\xa8\346\x8f\220\xe8\264\xa7", "\145\x72\x72\x6f\x72\103\x6f\144\145" => 0]; goto dtuL7; cQMX9: if ($this->data["\x6f\162\144\x65\162\137\164\x79\160\145"] == "\62") { goto tL_wn; } goto n8n5i; fh0Ql: fToiI: goto Vjorm; wE599: a0rR7: goto tfuOy; n8n5i: goto errVI; goto NVThj; aathP: $freightPrice = DeliveryModel::deliveryPrice($data["\141\144\144\x72\x65\x73\163\111\x64"], $this->uid); goto dJt1k; lLkw2: $userAddress = UserAddressModel::where(["\x75\x6e\x69\141\143\151\x64" => session("\x75\156\x69\x61\143\x69\144"), "\165\x73\145\162\137\151\x64" => $uid])->find($data["\x61\144\x64\162\x65\163\163\x49\x64"]); goto x0kxy; fjSwa: if ($this->data["\x70\151\143\x6b\x5f\x69\156\146\157"]["\x74\x69\155\x65"] == '' && $pickPoint["\x69\x73\137\160\x69\143\x6b"] == 1) { goto P0Ywd; } goto mon8f; YOTiH: goto bjX2_; goto ixSNr; pUSF_: return ["\x6d\x73\x67" => "\xe8\xaf\xb7\351\200\x89\346\x8b\xa9\346\x8f\x90\xe8\xb4\247\xe6\x97\xb6\xe9\x97\264", "\145\162\162\157\162\103\157\144\145" => 0]; goto WORKx; zdR08: $this->uid = $uid; goto N3iTZ; yRGHv: return ["\x6d\163\147" => "\345\x95\x86\345\xae\266\344\xbc\221\346\201\257\344\xb8\xad\357\274\214\350\257\267\351\200\x89\xe6\213\xa9\xe5\x85\266\344\273\x96\xe8\207\252\xe6\217\x90\347\202\xb9\xe6\210\226\351\205\x8d\351\x80\201\346\x96\xb9\xe5\xbc\x8f", "\145\x72\162\157\162\103\x6f\x64\x65" => 0]; goto nrqBp; K_Wvi: if ($this->data["\x63\x6f\165\160\157\156\x49\144"] != '') { goto eyX1w; } goto zhiBj; KXdat: sbj29: goto HrsF5; nrqBp: T0md8: goto disad; peflo: return ["\x6d\x73\147" => "\xe8\257\267\xe9\x80\x89\xe6\213\251\xe6\x8f\220\xe8\xb4\xa7\345\x9c\xb0\xe5\235\200", "\x65\x72\x72\157\162\103\157\144\x65" => 0]; goto kbv2R; ZpEwH: $delivery = DeliveryModel::where(["\x75\156\x69\x61\143\x69\144" => session("\165\156\x69\141\143\151\144")])->find(); goto mbhK5; PGInl: return ["\x6d\163\147" => "\xe6\x9a\x82\346\x97\240\xe6\xad\xa4\xe6\224\xb6\xe8\264\xa7\345\234\xb0\345\235\200", "\x65\162\x72\x6f\162\x43\157\144\145" => 0]; goto KyJUy; LuykP: $freightPrice = $couponDiscount = $couponMinPrice = 0; goto OGdn0; jAXEu: $haveStock = $this->checkStockAndPlaceOrder(); goto AcOD6; z5SJd: eyX1w: goto X6p29; MCKHk: if (!($pickPoint["\151\x73\137\144\141\171\157\x66\x66"] == 1)) { goto T0md8; } goto yRGHv; eRG_G: $this->delCartProduct($haveStock["\144\141\x74\141"]); goto m439J; X6p29: $userCoupon = UserCoupon::getUserCoupon($this->uid, $this->data["\x63\x6f\165\x70\x6f\156\x49\x64"]); goto dEvsn; mbhK5: if (!($platformSetting["\151\163\137\x64\145\154\151\166\x65\x72\x79"] == "\60")) { goto ymSj1; } goto QV_r6; Qvks_: if (!($this->data["\151\163\x5f\x63\x6f\x75\x70\x6f\156"] == "\x31")) { goto ItrSW; } goto K_Wvi; tutH_: Lq7yM: goto AIYzY; mskxF: if ($this->data["\160\151\143\x6b\x5f\x69\x6e\x66\x6f"]["\x61\144\144\162\x65\163\163"] == '') { goto WV85_; } goto fjSwa; N3iTZ: $productService = new ProductService(); goto CNl1M; rfSZk: } private function checkStockAndPlaceOrder() { goto BfOIc; a2r30: pafEu: goto cjZ1x; xxq1k: bAU4A: goto ghH3P; DlZdE: if (!($order["\x61\155\x6f\165\156\164"] < $delivery["\x6d\151\x6e\137\160\162\x69\x63\145"] && $delivery["\155\x69\156\x5f\160\162\151\143\145"] > 0)) { goto Na1Gy; } goto SVRYl; kUDCv: $order["\144\151\163\143\157\165\x6e\x74"] = $integral["\155\x6f\x6e\145\171"]; goto NTqOi; P4f3H: $userInfo->integral -= $integral["\x69\156\x74\145\147\x72\x61\154"]; goto TBmX0; J0KFr: yTc54: goto vHlc8; QF6Ki: MdgTI: goto arH2Y; BfOIc: $productService = new ProductService(); goto bwMMT; R7y5k: $res = ["\146\157\162\145\150\x65\141\144\x5f\151\x6e\164\145\147\162\141\x6c" => 0, "\x66\157\x72\x65\150\x65\x61\x64" => 0]; goto evBhD; t1jYh: Na1Gy: goto mNl2o; sn25H: return ["\x6d\163\147" => "\344\xb8\x8b\345\x8d\225\346\210\x90\xe5\x8a\x9f", "\x73\x74\x61\164\x75\x73" => true, "\x64\141\164\x61" => $orderId, "\x65\x72\x72\157\162\x43\x6f\144\145" => 1]; goto QF6Ki; nEF1A: $order["\x6f\137\141\155\x6f\x75\x6e\164"] = $lastAmount - $coupon_price + $this->freight_price - $discount; goto TGI3q; luNFE: $order["\163\x6e\x61\160\x5f\x6e\141\155\x65"] = $snap_name[0]; goto k7Swz; n49JP: $discount = $integral["\x6d\157\x6e\145\x79"]; goto aXFLW; rFY16: $delivery = DeliveryModel::where(["\x75\156\x69\x61\x63\x69\144" => session("\165\x6e\151\x61\143\151\144")])->find(); goto DlZdE; kbJrX: UCFtL: goto urG_U; Fm7XQ: a70AX: goto IXa0_; TTGXB: $order["\143\157\x75\x70\157\x6e\137\144\x69\x73\143\157\165\156\164"] = $coupon["\x64\151\163\143\x6f\x75\x6e\164"]; goto nEF1A; Xz5Pg: $userShareMoney->calcShareMoney($orderId, $order["\157\137\141\x6d\x6f\165\156\164"]); goto apOlJ; npzA3: return ["\155\163\147" => "\xe6\x93\215\344\xbd\234\xe9\xa2\x91\347\271\x81\357\xbc\214\350\257\xb7\xe7\250\215\345\x80\231\345\206\215\350\xaf\225", "\x65\x72\x72\157\162\x43\x6f\x64\x65" => 0]; goto Fm7XQ; apOlJ: H4cE9: goto jciuF; IdvRO: $orderId = $this->saveOrder($order); goto j3QS8; yqvtS: $userShareMoney = new UserShareMoney(); goto Xz5Pg; DW2qi: $order["\165\163\145\x72\151\x6e\x66\x6f"] = json_encode($userinfo, JSON_UNESCAPED_UNICODE); goto KR8A3; VCfOJ: $savePath = "\160\x75\142\x6c\x69\x63" . DS . "\163\164\x61\164\x69\x63" . DS . "\161\162\143\x6f\144\145" . DS . "\x73\164\157\x72\x65\x5f" . session("\165\156\x69\x61\143\151\144") . DS; goto mpk45; IXa0_: $userinfo = ["\x6e\141\x6d\145" => $address["\156\141\x6d\145"], "\x70\150\157\156\x65" => $address["\x70\150\x6f\156\145"], "\141\144\144\162\x65\x73\163" => $address["\x70\x72\x6f\x76\x69\156\x63\x65"] . $address["\x63\151\x74\171"] . $address["\x63\x6f\x75\x6e\x74\x72\171"] . $address["\144\x65\x74\141\151\x6c"]]; goto aN880; ksD5N: $order["\143\x6f\x75\160\x6f\156\137\160\162\x69\143\x65"] = $coupon_price; goto TTGXB; CPFzP: $coupon = Coupon::get($this->data["\x63\x6f\x75\x70\157\156\111\144"]); goto R7y5k; KR8A3: $order["\x70\162\157\x64\165\x63\164\163"] = json_encode($productIds); goto SsjVN; SQe7e: $order["\144\145\x6c\151\x76\x65\162\x79\137\164\x69\155\145"] = $this->data["\144\145\x6c\x69\x76\x65\x72\x79\x5f\x74\151\x6d\145"]; goto hQP8_; y4UqN: nIjNC: goto o4gLd; F75is: $productService->reduceStock($newOrder["\x73\156\x61\160\137\x69\x6e\x66\157"]); goto sn25H; wbJMW: $order["\x69\163\x5f\x69\156\x74\145\147\x72\x61\x6c"] = 1; goto toycg; evBhD: $isRepeat = false; goto NKYTk; OTd7F: $order["\160\151\143\x6b\137\x74\x69\x6d\145"] = $this->data["\x70\x69\x63\x6b\x5f\x69\156\x66\x6f"]["\x74\151\155\x65"]; goto o0tz0; j3QS8: if ($orderId) { goto fyGv4; } goto MhwDK; MhwDK: return ["\x6d\163\x67" => "\xe4\270\213\xe5\x8d\225\345\xa4\xb1\350\264\xa5", "\x73\x74\141\164\x75\163" => false, "\x65\162\162\157\x72\103\x6f\144\145" => 0]; goto F_EGG; oMZEU: $newOrder = OrderModel::get($orderId); goto O1zvn; feRBL: $order["\143\x6f\x75\x70\157\156\x5f\151\x64"] = $this->data["\143\157\165\160\157\156\111\x64"]; goto ksD5N; W1N8I: gIroM: goto rFY16; Gr7wL: $integralDetail = ["\165\x73\145\162\137\151\144" => $userInfo->id, "\x6f\162\x64\x65\162\x5f\151\x64" => $orderId, "\x69\x6e\164\x65\147\162\141\x6c" => $integral["\x69\x6e\164\x65\147\x72\x61\x6c"], "\x74\171\x70\x65" => 2, "\x6b\151\156\144" => 2]; goto EXcmZ; p0Nsh: $count = 0; goto q9rAW; b7a4B: $lastAmount = doubleval(sprintf("\45\56\x32\146", array_sum($o_amount))); goto n49JP; T3WYI: if (count($snap_name) > 1) { goto u3YBD; } goto luNFE; dZlBo: $order["\x73\156\141\x70\137\x6e\141\x6d\x65"] = $snap_name[0] . "\40\xe7\255\x89\xe5\244\232\344\xbb\xb6"; goto xxq1k; bwMMT: $userInfo = UserModel::get($this->uid); goto d11rr; D_pTU: $coupon->save(); goto jffuJ; k7Swz: goto bAU4A; goto FACD2; u3dSt: $coupon->use_num += 1; goto D_pTU; XOvKX: $order["\157\137\x61\x6d\157\x75\156\164"] = 0.01; goto khi02; ZmBOz: xBIb8: goto OM3HO; o4gLd: $coupon_price = $productService->getCouponPriceInProduct($this->data); goto feRBL; MiMFq: $order["\x6c\x61\x74\151\x74\x75\x64\x65"] = $pickPoint["\154\x61\x74\151\164\x75\144\x65"]; goto cEzXK; OM3HO: if (!($userInfo["\151\163\137\x64\x69\x73\x74\x72\x69\x62\x75\164\x6f\x72"] == 1)) { goto H4cE9; } goto yqvtS; C6O9O: if ($this->data["\x6f\x72\x64\x65\162\x5f\x74\x79\x70\x65"] == "\63") { goto yTc54; } goto jBEDE; WHDiK: ZGaOZ: goto AJzwj; kE5mK: $setting = PlatformSettings::where("\x75\x6e\x69\x61\x63\x69\144", session("\165\x6e\151\x61\x63\x69\x64"))->find(); goto aCm8j; nz2OB: $order["\163\x6e\141\160\137\151\156\146\157"] = json_encode($snap_info, JSON_UNESCAPED_UNICODE); goto DW2qi; AJzwj: if (!($lastAmount < $coupon["\x6d\x69\x6e\137\160\x72\x69\143\x65"])) { goto nIjNC; } goto aP9Od; Gr3o1: AXiSc: goto TZZ85; tnIZ_: $newOrder->save(); goto ZmBOz; mNl2o: $order["\x64\145\x6c\151\x76\145\x72\x79\137\160\x72\x69\143\x65"] = $this->freight_price; goto SQe7e; o0tz0: $pickPoint = PickPointModel::get($this->data["\x70\151\x63\x6b\137\x69\x6e\146\x6f"]["\x70\151\143\x6b\111\x64"]); goto f2K18; SVRYl: $more = doubleval(sprintf("\x25\56\x32\146", $delivery["\x6d\151\x6e\137\160\162\x69\x63\x65"] - $order["\x61\x6d\x6f\x75\x6e\x74"])); goto J_JMD; FACD2: u3YBD: goto dZlBo; EXcmZ: IntegralDetail::setIntegralDetail($integralDetail); goto Gr3o1; aP9Od: return ["\155\163\147" => "\xe5\275\x93\xe5\x89\215\xe4\xbc\230\346\203\240\xe5\210\270\351\x9c\x80\346\273\241" . $coupon["\155\x69\x6e\x5f\160\x72\151\x63\145"] . "\345\x85\203\xe6\211\x8d\350\203\275\xe4\xbd\xbf\347\224\250", "\x65\162\x72\x6f\x72\103\157\x64\x65" => 0]; goto y4UqN; vi612: goto KvQe5; goto W1N8I; mpk45: $newOrder->clerk_code = WE7_PATH . $savePath . $qrCode; goto tnIZ_; d11rr: $address = UserAddress::get($this->data["\x61\x64\144\162\145\163\163\x49\x64"]); goto kE5mK; k6bNH: $order["\x6f\137\141\x6d\x6f\x75\156\x74"] = $lastAmount + $this->freight_price - $discount; goto iSQlv; og7vG: $qrCode = WechatService::createQrCode($newOrder["\x69\x64"], '', "\x63\x6c\x65\162\153"); goto VCfOJ; L_UDJ: UserCoupon::updateUserCouponUsed($this->uid, $this->data["\x63\157\x75\160\157\x6e\x49\144"]); goto u3dSt; cnZxa: $order["\141\x6d\157\x75\156\x74"] = $order["\157\137\x61\x6d\x6f\x75\x6e\164"] - $this->freight_price; goto oSuCG; hQP8_: goto KvQe5; goto J0KFr; wca2G: foreach ($this->data["\160\162\x6f\144\x75\143\164"] as $key => $value) { goto W4n_l; Qkh4d: $attr_id_list = json_encode($value["\141\x74\164\162\x5f\151\x64\x5f\154\151\x73\164"]); goto TiIEY; rMA2Q: jUvlH: goto Qkh4d; Gg6gp: $snap_name[$key] = $product["\156\x61\155\x65"]; goto Xxlfi; CK2S1: if ($product["\x69\163\137\x61\x74\x74\162"] == 1) { goto jUvlH; } goto NBP5i; Utevy: $weight = $attr["\x77\x65\x69\147\x68\164"]; goto aYmjB; TiIEY: $attr = $productService->getAttrInfo($value["\x70\x72\x6f\x64\x75\143\164\111\144"], $attr_id_list); goto hvkld; k_Ibc: fu353: goto CK2S1; RteEy: $price = $productService->getNotAttrVipPrice($product["\151\x64"], $product["\x70\162\151\143\x65"], $userInfo["\166\151\160\x5f\151\x64"]); goto PR20V; hvkld: foreach ($attr["\141\164\x74\162\137\x6c\151\x73\164"] as $k => $v) { $attrName[$k] = $v["\x61\164\x74\x72\137\156\141\x6d\x65"]; drObu: } goto qmdHQ; iEssm: $res = $productService->integral($new_item, $setting["\144\x65\144\165\143\164\x69\x6f\x6e"]); goto GmwcS; W4n_l: $attr_id_list = ''; goto mBgwa; mB9GB: foreach ($checkBuy as $kk => $vv) { goto V1OhC; V3syJ: if (!($vv["\x63\141\x6e\x5f\142\165\171"] == 0 && $vv["\160\162\157\x64\165\143\164\x49\144"] == $value["\160\162\x6f\144\165\x63\x74\111\144"])) { goto LkgCg; } goto c2nNZ; gNxTY: $this->can_buy = $vv["\143\141\x6e\137\142\165\x79"]; goto RVvXo; RVvXo: $this->can_buy_id = $vv["\x70\x72\157\144\x75\x63\164\111\144"]; goto puNUM; V1OhC: if (!(count($checkBuy) == 1 && $vv["\143\x61\156\x5f\x62\x75\171"] == 0)) { goto WMnZS; } goto nDWWm; H8cxn: WMnZS: goto V3syJ; nDWWm: return ["\x6d\x73\x67" => "\xe6\232\x82\xe6\x97\xa0\345\225\206\345\x93\201\xe5\217\xaf\350\264\255\xe4\271\260", "\x65\162\162\157\x72\103\x6f\x64\x65" => 0]; goto H8cxn; puNUM: Llk4Q: goto KKNxV; dYurQ: LkgCg: goto gNxTY; c2nNZ: goto BtKWR; goto dYurQ; KKNxV: } goto k_Ibc; ymLcf: if (!(isset($this->data["\151\x73\x5f\151\156\x74\145\x67\x72\141\x6c"]) && $this->data["\x69\163\137\151\156\164\x65\147\162\141\154"] == "\61")) { goto GJkKA; } goto ZEV1v; NBP5i: $attrName = []; goto RteEy; Hs4re: if (!($value["\156\x75\155"] > $product["\154\151\x6d\x69\164\x5f\156\x75\155"] || $orderCount > $product["\154\x69\x6d\x69\164\x5f\x6e\x75\x6d"] || $value["\156\165\x6d"] + $orderCount > $product["\x6c\151\155\x69\164\137\156\165\x6d"])) { goto BDLUd; } goto hGgee; Hk8XZ: $no = $product["\156\157"]; goto AqZVR; WdmTu: $o_amount[] = $price * $value["\156\165\155"]; goto BYzhy; aYmjB: $no = $attr["\156\x6f"]; goto KsQNr; J90ID: $orderCount = $this->sumUserOrderProduct($product["\151\x64"]); goto Hs4re; mU53c: $isRepeat = $this->checkRepeatSubmit($value["\x70\x72\157\144\x75\x63\164\111\x64"], $attr_id_list, $value["\x6e\x75\155"]); goto Ri6EX; j7cJk: G1PVV: goto mU53c; Fi6yJ: $weight = $product["\167\x65\151\x67\x68\164"]; goto Hk8XZ; Lk0O_: BDLUd: goto j7cJk; BYzhy: $count += $value["\x6e\165\155"]; goto VcmKF; KMgn2: $checkBuy = $productService->checkSendType($this->data); goto mB9GB; PR20V: $image = $product["\164\150\165\x6d\x62"]; goto Fi6yJ; KsQNr: zXA61: goto Gg6gp; ZSVS7: $image = $attr["\x69\x6d\141\147\x65"]; goto Utevy; hGgee: return ["\155\163\147" => "\xe5\x95\206\xe5\223\x81\xef\xbc\x9a" . $product["\156\141\x6d\145"] . "\xef\274\x8c\346\x9c\x80\xe5\244\x9a\xe5\x8f\xaf\350\xb4\255\xe4\271\260{$product["\x6c\151\155\x69\x74\137\x6e\165\155"]}\xe4\273\xb6", "\145\x72\x72\157\162\103\x6f\x64\145" => 0]; goto Lk0O_; qmdHQ: hSv_E: goto wbcxz; AqZVR: goto zXA61; goto rMA2Q; mBgwa: $product = ProductModel::get($value["\160\x72\157\x64\x75\143\x74\x49\144"]); goto KMgn2; wbcxz: $price = $attr["\x70\x72\x69\143\145"]; goto ZSVS7; Ri6EX: BtKWR: goto B0s6g; ZEV1v: $new_item = (object) ["\151\144" => $value["\x70\x72\x6f\144\x75\x63\x74\111\x64"], "\x6e\x75\x6d" => $value["\156\x75\x6d"], "\x70\x72\151\143\145" => $price * $value["\156\x75\155"], "\x73\151\156\x67\154\x65\137\x70\x72\x69\143\145" => $price, "\151\156\x74\145\147\x72\141\x6c" => $product["\x69\156\x74\x65\147\x72\x61\x6c"]]; goto iEssm; Xxlfi: $snap_img[$key] = $image; goto ymLcf; GmwcS: GJkKA: goto Bar09; Bar09: $snap_info[$key] = ["\160\162\157\x64\x75\143\164\x49\x64" => $product["\151\144"], "\156\x61\155\145" => $product["\x6e\x61\x6d\x65"], "\163\165\x6d\155\x61\162\x79" => $product["\x73\x75\x6d\155\x61\162\x79"], "\x70\x72\151\x63\x65" => $price, "\x77\145\151\147\x68\164" => $weight, "\156\157" => $no, "\x6e\165\x6d" => $value["\x6e\165\x6d"], "\144\x69\163\x63\157\x75\x6e\x74" => $res["\146\x6f\x72\x65\150\x65\x61\144"], "\151\x6e\164\x65\x67\162\141\x6c" => $res["\146\x6f\162\145\x68\x65\141\x64\137\151\x6e\x74\145\147\162\x61\x6c"], "\141\x74\x74\162\x5f\x69\144\x5f\154\x69\x73\164" => $value["\x61\x74\x74\162\x5f\x69\144\137\x6c\151\163\x74"], "\x61\164\x74\x72\137\x6e\x61\155\x65" => $attrName, "\151\155\141\147\x65" => $image, "\151\x73\137\x72\145\x66\x75\156\144" => 0, "\151\x73\x5f\x63\157\x6d\x6d\x65\156\x74" => 0]; goto WdmTu; xhQPE: if (!($product["\151\x73\137\x6c\x69\x6d\151\x74"] == 1)) { goto G1PVV; } goto J90ID; VcmKF: $productIds[$key] = $product["\151\144"]; goto xhQPE; B0s6g: } goto kbJrX; TZZ85: if (!($newOrder["\157\162\x64\145\162\x5f\164\x79\160\145"] == 3)) { goto xBIb8; } goto og7vG; J_JMD: return ["\x6d\x73\x67" => "\xe8\xbf\x98\345\267\xae\40" . $more . "\xe5\205\x83\40\345\xb0\261\350\x83\xbd\350\xb5\267\351\200\201", "\145\x72\x72\157\x72\x43\x6f\144\x65" => 0]; goto t1jYh; O1zvn: if (!($integral["\x69\x6e\164\145\147\x72\x61\x6c"] > 0 && $this->data["\151\163\x5f\x69\x6e\x74\x65\x67\162\x61\x6c"] == "\61")) { goto AXiSc; } goto P4f3H; TGI3q: EQr7z: goto cnZxa; NTqOi: $order["\164\157\164\x61\x6c\137\x63\x6f\x75\x6e\x74"] = $count; goto T3WYI; tMx2u: fyGv4: goto oMZEU; jffuJ: j2y38: goto F75is; cjZ1x: $order["\164\157\x74\x61\154\137\x61\x6d\x6f\165\156\x74"] = $lastAmount + $this->freight_price; goto aBLqj; SW5T6: if (!(isset($this->data["\151\x73\137\x69\156\164\x65\x67\162\141\x6c"]) && $this->data["\x69\163\x5f\151\156\x74\x65\147\162\141\154"] == "\x31")) { goto w7afk; } goto Q6LqO; toycg: w7afk: goto b7a4B; vHlc8: $order["\160\x69\x63\153\137\151\x6e\146\157"] = json_encode($this->data["\x70\x69\x63\x6b\137\151\156\146\x6f"], JSON_UNESCAPED_UNICODE); goto OTd7F; dXnDW: $order["\x6f\x72\144\x65\162\x5f\x74\171\160\x65"] = $this->data["\157\x72\144\x65\162\137\164\171\160\145"]; goto u9iAD; SsjVN: $integral = ["\x69\156\164\x65\x67\x72\x61\x6c" => 0, "\x6d\157\156\145\x79" => 0]; goto SW5T6; u9iAD: $order["\x70\141\162\x65\x6e\164\137\151\x64"] = $userInfo["\160\x61\x72\x65\x6e\164\x5f\151\x64"]; goto D1RSI; jBEDE: $order["\x65\170\x70\x72\x65\x73\163\x5f\x70\x72\x69\143\x65"] = $this->freight_price; goto vi612; aXFLW: if (!empty($coupon)) { goto ZGaOZ; } goto k6bNH; aCm8j: $attrName = $snap_info = $order = $o_amount = $snap_name = $snap_img = []; goto p0Nsh; Q6LqO: $integral = $productService->integralExchange($this->data); goto wbJMW; f2K18: $order["\x6c\x6f\x6e\x67\x69\164\x75\x64\x65"] = $pickPoint["\154\157\x6e\147\x69\164\165\144\x65"]; goto MiMFq; aN880: $order["\x63\x69\x74\171"] = $address["\x63\151\x74\171"]; goto nz2OB; F_EGG: goto MdgTI; goto tMx2u; khi02: return ["\x6d\x73\147" => "\345\x95\x86\345\x93\x81\344\xbf\241\346\201\257\xe6\234\x89\350\257\257\xef\xbc\214\xe8\257\267\xe7\250\x8d\345\200\231\xe5\x86\215\350\257\225", "\145\x72\162\x6f\x72\103\x6f\144\x65" => 0]; goto a2r30; jciuF: if (!($this->data["\x69\x73\137\x63\157\165\x70\x6f\156"] == "\61")) { goto j2y38; } goto L_UDJ; h479x: $coupon_price = 0; goto wca2G; cEzXK: KvQe5: goto IdvRO; NKYTk: $productIds = []; goto h479x; aBLqj: $order["\x69\x6e\164\x65\147\x72\x61\154"] = $integral["\x69\x6e\164\x65\147\x72\x61\x6c"]; goto kUDCv; oSuCG: if (!($order["\157\x5f\x61\155\x6f\165\x6e\164"] <= 0)) { goto pafEu; } goto XOvKX; D1RSI: if ($this->data["\x6f\162\144\145\x72\137\x74\171\160\x65"] == "\x32") { goto gIroM; } goto C6O9O; iSQlv: goto EQr7z; goto WHDiK; ghH3P: $order["\x73\156\x61\160\x5f\x69\155\147"] = $snap_img[0]; goto dXnDW; TBmX0: $userInfo->save(); goto Gr7wL; urG_U: if (!($isRepeat == true)) { goto a70AX; } goto npzA3; q9rAW: $this->data["\160\162\157\x64\x75\x63\x74"] = array_values($this->data["\x70\162\157\144\165\143\x74"]); goto CPFzP; arH2Y: } private function checkStock($data = array()) { goto GLREZ; pxeWU: foreach ($data as $key => $value) { goto Y_Zs0; FFN2c: uHXxE: goto N3iSK; Hatq1: $this->str = $str; goto XyT6w; FwhDl: goto HYk19; goto o70y4; tYVYh: $haveStock = false; goto Hatq1; Y_Zs0: $product = ProductModel::get($value["\x70\x72\x6f\x64\165\x63\164\111\144"]); goto bVSUs; N3iSK: HYk19: goto Jpy9D; cKMQy: $attr = $productService->getAttrInfo($value["\160\x72\x6f\x64\x75\x63\x74\111\x64"], $attr_id_list); goto Mhp5R; K50l1: if (!($product["\163\164\157\x63\x6b"] - $value["\x6e\x75\155"] < 0)) { goto dZ62i; } goto tYVYh; NFwFC: $haveStock = false; goto t37os; o70y4: jhfDD: goto cKMQy; efthD: $str = $product["\156\141\x6d\145"] . "\345\272\223\345\xad\x98\351\x87\217\xe4\270\x8d\xe8\xb6\263"; goto U1gtR; Mhp5R: if (!($attr["\x73\x74\x6f\143\153"] - $value["\156\x75\155"] < 0)) { goto uHXxE; } goto NFwFC; XyT6w: dZ62i: goto FwhDl; bVSUs: $attr_id_list = json_encode($value["\x61\164\164\162\x5f\x69\144\x5f\154\151\163\164"]); goto efthD; U1gtR: if ($product["\151\163\137\141\164\164\162"] == 1) { goto jhfDD; } goto K50l1; Jpy9D: uHViA: goto rEmx9; t37os: $this->str = $str; goto FFN2c; rEmx9: } goto d52WV; Rw92c: return ["\163\x74\x61\164\x75\163" => true]; goto LBbLx; GLREZ: $productService = new ProductService(); goto M2DnU; UK9iN: if ($haveStock !== true) { goto HYzqy; } goto Rw92c; d52WV: ST1do: goto UK9iN; tNQrm: return ["\155\163\147" => $this->str, "\x73\x74\x61\164\x75\x73" => false]; goto VsN4V; VsN4V: FMnLC: goto Qf8uu; LBbLx: goto FMnLC; goto YkfyQ; M2DnU: $haveStock = true; goto pxeWU; YkfyQ: HYzqy: goto tNQrm; Qf8uu: } private function checkRepeatSubmit($productId, $attr_id_list, $num) { goto yXi_B; fObMV: foreach ($order["\163\156\x61\160\137\x69\x6e\146\157"] as $key => $value) { goto FodiM; dfp4t: ypfm0: goto ZPtZ1; p77YN: W07Iq: goto TS3DX; WJo12: if (!($value["\160\x72\x6f\144\x75\x63\x74\111\x64"] == $productId && json_encode($value["\x61\x74\164\162\x5f\151\x64\137\154\151\163\164"]) == $attr_id_list && $value["\x6e\x75\155"] == $num && $second <= 5)) { goto aDc_y; } goto O0Ywm; FodiM: $second = floor((time() - strtotime($order["\x63\x72\145\141\x74\x65\137\x74\x69\155\x65"])) % 86400 % 60); goto uL8LV; uL8LV: if ($attr_id_list == '' && $second <= 5) { goto ypfm0; } goto WJo12; j9cBb: $result = true; goto DhwW7; Ae5vr: aDc_y: goto N1jrg; TS3DX: mbJQR: goto g3NG2; O0Ywm: $result = true; goto Ae5vr; ZPtZ1: if (!($value["\x70\162\157\x64\x75\143\x74\111\x64"] == $productId && $value["\x6e\165\x6d"] == $num)) { goto oeGOw; } goto j9cBb; N1jrg: goto W07Iq; goto dfp4t; DhwW7: oeGOw: goto p77YN; g3NG2: } goto YjodZ; Xs3IG: if (!empty($order)) { goto ZsJg1; } goto ZTzSc; yXi_B: $order = OrderModel::where(["\165\156\151\141\x63\151\144" => session("\x75\x6e\x69\141\143\151\x64"), "\x75\x73\x65\162\x5f\151\144" => $this->uid, "\163\x74\141\164\x75\163" => 0, "\x69\x73\137\143\141\156\x63\145\x6c" => 0, "\151\x73\x5f\x64\x65\154\x65\x74\x65" => 0])->order("\151\144", "\x64\145\163\x63")->find(); goto Xs3IG; cVIFt: return $result; goto GC5x4; gCFcu: ZsJg1: goto W91EB; W91EB: $result = false; goto fObMV; YjodZ: Xzq7B: goto cVIFt; ZTzSc: return false; goto gCFcu; GC5x4: } public function saveOrder($order) { Db::startTrans(); try { goto mtqEK; qncig: $order["\x75\x6e\151\x61\143\x69\144"] = session("\165\x6e\x69\141\x63\151\x64"); goto AJ50Q; AJ50Q: $order["\x75\x73\145\x72\137\x69\x64"] = $uid; goto A_qK3; H134q: $orderID = OrderModel::insertGetId($order); goto Pjy3z; UXIAz: $order["\157\154\144\x5f\x6f\x72\144\x65\162\x5f\x6e\157"] = $order["\157\x72\x64\145\162\137\156\157"]; goto XIFLx; wvNfh: return $orderID; goto qDKd4; XIFLx: $order["\143\x72\145\x61\164\x65\137\164\x69\155\x65"] = time(); goto H134q; mtqEK: $uid = TokenService::getCurrentUid(); goto qncig; Pjy3z: Db::commit(); goto wvNfh; A_qK3: $order["\157\162\x64\x65\x72\137\x6e\157"] = $this->createOrderNo(); goto UXIAz; qDKd4: } catch (Exception $e) { Db::rollback(); return false; } } public function delCartProduct($orderId) { goto pbZHx; nODJ0: foreach ($order["\x73\156\141\x70\137\x69\156\146\x6f"] as $key => $value) { goto vdnu9; bg4TK: goto uF37E; goto o3MIz; Y4iTd: $attr_id_list = json_encode($value["\x61\x74\164\x72\137\151\x64\137\154\151\163\164"], true); goto VPnwD; hpUid: rtX3U: goto dG1iZ; o3MIz: pjkzg: goto Y4iTd; oDM6h: $attr_id_list = ''; goto bg4TK; Rd3Bc: if (!$cart) { goto WSeVQ; } goto JWD9k; vdnu9: if ($value["\x61\x74\164\x72\x5f\151\x64\x5f\154\151\x73\164"]) { goto pjkzg; } goto oDM6h; VPnwD: $attr_id_list = str_replace("\42", '', $attr_id_list); goto OeEC6; m9qSd: $cart = CartModel::where(["\165\x6e\151\x61\143\151\144" => session("\165\x6e\151\141\x63\151\x64"), "\x75\x73\145\x72\137\151\x64" => $uid, "\x70\162\x6f\144\165\x63\164\x5f\151\x64" => $value["\x70\x72\157\144\165\x63\164\111\x64"], "\151\163\137\x64\145\x6c\x65\x74\x65" => 0])->where("\141\x74\x74\x72\137\x69\x64\137\x6c\x69\163\164", "\x3d", $attr_id_list)->find(); goto Rd3Bc; w7w0q: $result = true; goto hVvYK; JWD9k: $cart->is_delete = 1; goto KSqAK; hVvYK: WSeVQ: goto hpUid; KSqAK: $cart->save(); goto w7w0q; OeEC6: uF37E: goto m9qSd; dG1iZ: } goto ApT3l; L5WHV: $uid = TokenService::getCurrentUid(); goto nODJ0; wuwXL: if (!(!empty($order) || is_array($order["\x73\156\x61\x70\x5f\x69\156\146\x6f"]))) { goto SkXEl; } goto L5WHV; zEcI6: $result = false; goto wuwXL; pbZHx: $order = OrderModel::get($orderId); goto zEcI6; ApT3l: VXlDy: goto BQdq3; BQdq3: SkXEl: goto u65DK; u65DK: return $result; goto kiKZV; kiKZV: } public static function autoConfirm() { goto m1bJH; l0cU7: $uid = TokenService::getCurrentUid(); goto QISka; JRIjL: if (!($setting["\x63\157\x6e\146\x69\162\155\x5f\164\x69\155\x65"] > 0)) { goto eMBdm; } goto l0cU7; EkbW9: return true; goto NDLRq; ZDCaf: foreach ($order as $key => $value) { goto UAJam; gioFt: vuddY: goto TIyMW; Im9yf: OrderModel::update($data); goto PaI5M; c_q79: if (!(time() > $ent_time)) { goto o3l97; } goto ldI_H; kpszR: o3l97: goto gioFt; ldI_H: $data["\x69\x64"] = $value["\x69\x64"]; goto jh6h3; vGyYK: $data["\x73\x74\141\164\x75\163"] = 3; goto Im9yf; ZJvl3: Integral::giveIntegral($integralData, 1); goto kpszR; UAJam: $ent_time = strtotime("\x2b{$setting["\143\x6f\x6e\x66\151\162\155\x5f\164\151\x6d\145"]}\x20\144\x61\171", $value["\163\x65\156\144\x5f\164\x69\155\x65"]); goto c_q79; PaI5M: $integralData = ["\165\163\x65\162\x5f\x69\x64" => $value["\x75\x73\145\x72\137\151\x64"], "\157\x72\144\x65\x72\137\151\x64" => $value["\x69\x64"], "\157\137\141\x6d\157\165\x6e\164" => $value["\157\137\141\x6d\157\x75\x6e\x74"]]; goto ZJvl3; jh6h3: $data["\151\x73\x5f\143\157\156\146\151\x72\155"] = 1; goto poQJd; poQJd: $data["\x63\x6f\156\x66\151\x72\155\137\164\151\x6d\x65"] = time(); goto vGyYK; TIyMW: } goto HxV30; m1bJH: $setting = PlatformSettings::where("\x75\x6e\151\141\143\151\144", session("\165\x6e\x69\141\143\151\144"))->find(); goto JRIjL; q4xgK: if (!$order) { goto s_sVK; } goto ZDCaf; Y2PNa: eMBdm: goto EkbW9; QISka: $order = OrderModel::where(["\x75\x73\145\162\x5f\151\x64" => $uid, "\x69\x73\x5f\x63\157\x6e\146\x69\x72\x6d" => 0, "\151\163\137\144\x65\154\145\164\x65" => 0, "\x69\x73\137\x63\141\156\x63\145\154" => 0, "\x69\163\137\163\145\156\x64" => 1, "\163\x74\x61\x74\x75\x73" => 2])->select(); goto q4xgK; HxV30: OOfEb: goto Slgzx; Slgzx: s_sVK: goto Y2PNa; NDLRq: } public static function autoCancel() { goto LMVVG; BpXiv: foreach ($order as $key => $value) { goto lnZRC; DyHtv: SDU24: goto xoXfp; u7CeG: Integral::returnIntegral($integral); goto YYVNG; rqewi: $user->integral += $value["\151\x6e\x74\145\x67\162\x61\154"]; goto rmZHz; N22Zm: VKqm5: goto eqJn5; YYVNG: n56kq: goto HZTbh; GsqPi: if (!($value["\x69\163\x5f\151\x6e\x74\145\147\162\141\x6c"] == 1)) { goto n56kq; } goto bYflt; lnZRC: if (!($setting["\x6f\x72\144\145\x72\x5f\164\151\155\x65"] != '' && $setting["\x6f\x72\144\145\162\137\x74\151\155\x65"] > 0)) { goto Gi7JH; } goto qj478; xoXfp: Gi7JH: goto N22Zm; iQkU7: OrderModel::update($data); goto GsqPi; rmZHz: $user->save(); goto mzRrq; qj478: $overdue = floor((time() - strtotime($value["\143\162\145\141\164\145\137\164\151\155\x65"])) % 86400 / 60); goto Bg658; HZTbh: $productService->addStock($value["\163\x6e\141\x70\x5f\x69\156\146\157"]); goto DyHtv; mzRrq: $integral = ["\165\163\x65\162\137\x69\x64" => $value["\x75\163\x65\162\x5f\x69\x64"], "\157\x72\144\145\162\x5f\x69\x64" => $value["\x69\x64"], "\151\156\164\145\x67\162\x61\x6c" => $value["\x69\x6e\x74\x65\x67\162\x61\x6c"]]; goto u7CeG; x_OkZ: $data["\x63\x61\x6e\143\x65\154\137\164\151\155\x65"] = time(); goto iQkU7; bYflt: $user = UserModel::get($value["\165\x73\x65\162\137\151\144"]); goto rqewi; ATeDE: $data["\151\144"] = $value["\151\144"]; goto GDeuc; Bg658: if (!($overdue >= $setting["\157\162\144\x65\162\x5f\164\151\x6d\x65"])) { goto SDU24; } goto ATeDE; GDeuc: $data["\151\x73\x5f\x63\141\156\x63\x65\x6c"] = 1; goto x_OkZ; eqJn5: } goto Dy3MT; QMSug: return true; goto B8QV_; AAy9W: $uid = TokenService::getCurrentUid(); goto IDqQm; IDqQm: $order = OrderModel::where(["\165\x73\145\x72\x5f\151\x64" => $uid, "\x69\163\x5f\143\157\156\x66\x69\162\155" => 0, "\151\x73\x5f\x64\x65\154\145\x74\x65" => 0, "\151\163\x5f\143\x61\156\x63\145\154" => 0, "\151\x73\137\163\145\156\144" => 0, "\163\164\141\164\x75\163" => 0])->select(); goto GUnal; FPZFE: if (!($setting["\x6f\162\x64\145\x72\x5f\164\x69\155\x65"] > 0)) { goto T00vW; } goto AAy9W; E8zsy: C0Pn9: goto jZlQH; GUnal: if (!$order) { goto C0Pn9; } goto jIfpF; jIfpF: $productService = new ProductService(); goto BpXiv; LMVVG: $setting = PlatformSettings::where("\165\156\151\x61\x63\x69\144", session("\x75\156\x69\141\143\151\144"))->find(); goto FPZFE; jZlQH: T00vW: goto QMSug; Dy3MT: zhvt2: goto E8zsy; B8QV_: } public function updateSnapInfo($orderId, $productId, $attr_id_list) { goto pbmZl; duNl9: return $result !== false ? true : false; goto jaX1k; f_3pr: $snapInfo = $order["\x73\x6e\x61\x70\x5f\151\156\x66\x6f"]; goto SlzeQ; eoNOa: iPU6o: goto VkzQG; AEsB1: $result = $order->save(); goto duNl9; SlzeQ: if (!($attr_id_list == null)) { goto oT5ZC; } goto rTxyt; Rrzo6: foreach ($snapInfo as $key => $value) { goto WsKaB; DXogC: $value["\141\164\164\x72\x5f\151\x64\137\x6c\151\x73\x74"] = json_encode($value["\x61\x74\164\x72\137\151\144\137\x6c\x69\x73\x74"]); goto Yhbo8; pInUz: XvEGM: goto gbv1u; WsKaB: if (!($value["\x61\x74\x74\162\137\151\144\137\154\x69\163\x74"] != '')) { goto mtzFR; } goto DXogC; yRGRT: $snapInfo[$key]["\151\x73\137\x72\145\146\165\x6e\x64"] = 1; goto pInUz; Yhbo8: $value["\141\164\164\162\137\151\144\137\x6c\x69\x73\164"] = str_replace("\x22", '', $value["\141\x74\x74\162\x5f\151\144\x5f\154\151\163\164"]); goto IRiPK; gbv1u: TA_8X: goto eJuCO; IRiPK: mtzFR: goto Vz104; Vz104: if (!($value["\x70\x72\157\144\165\x63\x74\111\x64"] == $productId && $value["\141\x74\x74\x72\x5f\151\x64\x5f\x6c\x69\163\x74"] == $attr_id_list)) { goto XvEGM; } goto yRGRT; eJuCO: } goto eoNOa; pbmZl: $order = OrderModel::get($orderId); goto f_3pr; PcXZ3: oT5ZC: goto Rrzo6; VkzQG: $order->snap_info = json_encode($snapInfo, JSON_UNESCAPED_UNICODE); goto AEsB1; rTxyt: $attr_id_list = ''; goto PcXZ3; jaX1k: } public function updateSnapInfoCommentStatus($orderId, $productId, $attr_id_list) { goto UhGSC; ZLqn3: $attr_id_list = ''; goto KCKRD; LsJxM: return $result !== false ? true : false; goto DHN_j; UhGSC: $order = OrderModel::get($orderId); goto okWwg; okWwg: $snapInfo = $order["\x73\156\141\160\137\151\156\146\x6f"]; goto RU4bi; mH2vv: $result = $order->save(); goto LsJxM; MofFv: $order->snap_info = json_encode($snapInfo, JSON_UNESCAPED_UNICODE); goto mH2vv; RU4bi: if (!($attr_id_list == null)) { goto j5bTJ; } goto ZLqn3; LkC_O: foreach ($snapInfo as $key => $value) { goto evQa3; W5r8V: if (!($value["\x70\162\157\x64\165\143\164\x49\x64"] == $productId && $value["\x61\x74\164\x72\137\x69\144\137\x6c\x69\x73\164"] == $attr_id_list)) { goto FS9zb; } goto vB1ss; dyeVb: FS9zb: goto SHJDU; lvx50: $value["\x61\x74\x74\162\137\x69\x64\x5f\154\x69\163\164"] = json_encode($value["\141\x74\164\162\137\151\x64\x5f\154\x69\163\164"]); goto gT5bb; evQa3: if (!($value["\x61\164\164\x72\x5f\x69\144\137\x6c\151\163\x74"] != '')) { goto kBZyX; } goto lvx50; vB1ss: $snapInfo[$key]["\x69\163\137\x63\157\155\x6d\x65\x6e\164"] = 1; goto dyeVb; SHJDU: r0ZAW: goto IxtUu; WFm3j: kBZyX: goto W5r8V; gT5bb: $value["\x61\164\164\x72\137\151\x64\x5f\154\x69\163\x74"] = str_replace("\42", '', $value["\x61\x74\164\x72\x5f\x69\144\137\154\x69\163\x74"]); goto WFm3j; IxtUu: } goto fkpWh; fkpWh: p3bLB: goto MofFv; KCKRD: j5bTJ: goto LkC_O; DHN_j: } public function getOneSnapInfo($orderId, $productId, $attr_id_list) { goto Cji_G; Nre7B: foreach ($snapInfo as $key => $value) { goto cWBGM; ywUeu: $data["\144\151\x73\143\157\165\x6e\x74"] = $value["\144\x69\163\143\157\165\x6e\164"]; goto P9trg; C664j: $value["\x61\164\x74\162\137\151\144\x5f\x6c\151\x73\164"] = null; goto rq3V4; GlboU: $value["\x61\x74\x74\x72\x5f\151\x64\137\154\x69\x73\164"] = json_encode($value["\x61\164\x74\162\x5f\151\144\x5f\154\151\163\x74"]); goto WhIbO; cWBGM: if ($value["\141\x74\164\162\x5f\x69\144\x5f\154\x69\x73\x74"] == '') { goto xT1cE; } goto GlboU; V2KSs: $data["\151\156\x66\157"] = $value; goto qCibC; gFHbn: goto nHuAO; goto OQ7Bu; WhIbO: $value["\x61\164\164\x72\x5f\x69\144\x5f\154\x69\x73\x74"] = str_replace("\42", '', $value["\141\x74\x74\x72\x5f\x69\144\x5f\x6c\151\x73\x74"]); goto gFHbn; P9trg: sqvae: goto CP02V; CP02V: y6Uig: goto KP01k; yaV0V: if (!($value["\x70\162\x6f\x64\165\x63\164\x49\144"] == $productId && $value["\x61\164\x74\162\137\x69\144\x5f\154\151\163\x74"] == $attr_id_list)) { goto sqvae; } goto V2KSs; rq3V4: nHuAO: goto yaV0V; OQ7Bu: xT1cE: goto C664j; qCibC: $data["\x70\x72\151\x63\145"] = $value["\x70\x72\x69\x63\145"] * $value["\x6e\165\x6d"]; goto ywUeu; KP01k: } goto yzNd5; NbZW2: return $data; goto MgRdM; mVV84: $data = ["\x69\x6e\146\x6f" => '', "\160\162\151\143\145" => 0, "\144\151\163\143\x6f\165\x6e\164" => 0]; goto Nre7B; ZE6ad: $snapInfo = $order["\163\x6e\x61\160\137\x69\x6e\146\x6f"]; goto mVV84; yzNd5: Bxar1: goto NbZW2; Cji_G: $order = OrderModel::get($orderId); goto ZE6ad; MgRdM: } public static function getDealOrderByCity($city, $where = '') { goto DT9eX; Ov1dJ: $setting = PlatformSettings::order("\x69\x64", "\x64\x65\x73\143")->find(); goto pLPMU; VfOO2: UJkVp: goto Ov1dJ; QbeU1: return $result; goto Aqz6q; zLHBf: cSrc9: goto QbeU1; pLPMU: $order = OrderModel::where(["\151\163\137\143\157\156\x66\151\162\x6d" => 1, "\151\163\137\x64\145\154\145\164\x65" => 0, "\x69\x73\x5f\x63\x61\156\x63\x65\x6c" => 0, "\x73\x74\x61\164\x75\x73" => 3])->where("\x63\x69\x74\171", "\75", $city)->where($where)->select(); goto QTgcS; rmqDp: pJ1NZ: goto zLHBf; DT9eX: if (!($where == '')) { goto UJkVp; } goto fVz7A; fVz7A: $where = 1; goto VfOO2; hBzgH: foreach ($order as $key => $value) { goto cmqs4; cmqs4: $ent_time = strtotime("\x2b{$setting["\141\146\x74\145\162\x5f\x74\151\x6d\x65"]}\40\144\x61\171", $value["\x63\x6f\x6e\146\x69\x72\155\137\164\151\x6d\145"]); goto gtONt; N4m23: kWz_j: goto WHsq7; WHsq7: Nyu06: goto N_gO3; c5v3K: $result[] = $order[$key]; goto N4m23; gtONt: if (!(time() > $ent_time)) { goto kWz_j; } goto c5v3K; N_gO3: } goto rmqDp; QTgcS: $result = []; goto jjEy4; jjEy4: if (!$order) { goto cSrc9; } goto hBzgH; Aqz6q: } public static function getDealOrderByUser($uid) { goto p45O8; jQMUG: $order = OrderModel::where(["\x75\163\145\x72\x5f\x69\144" => $uid, "\x69\x73\x5f\143\157\x6e\146\151\162\x6d" => 1, "\151\163\x5f\144\145\154\145\164\x65" => 0, "\151\x73\137\x72\x65\146\165\156\144" => 0, "\151\x73\x5f\x63\x61\x6e\x63\145\x6c" => 0, "\x73\164\141\164\165\163" => 3])->select(); goto XHtjr; CTQw6: foreach ($order as $key => $value) { goto VxYaL; b86x6: MBVOc: goto x_X0Y; iVOqp: if (!(time() > $ent_time)) { goto jEAL5; } goto HhZcw; HhZcw: $result[] = $order[$key]; goto l5hCP; l5hCP: jEAL5: goto b86x6; VxYaL: $ent_time = strtotime("\x2b{$setting["\141\146\x74\x65\162\137\164\151\155\145"]}\x20\x64\x61\x79", $value["\143\157\156\146\x69\x72\155\137\164\151\x6d\x65"]); goto iVOqp; x_X0Y: } goto NDge0; njFOQ: return $result; goto HUi2r; ph8CN: if (!$order) { goto sEBOo; } goto CTQw6; S4I7U: sEBOo: goto njFOQ; XHtjr: $result = []; goto ph8CN; NDge0: ocs3R: goto S4I7U; p45O8: $setting = PlatformSettings::where("\165\156\x69\141\x63\x69\x64", "\75", session("\165\x6e\x69\141\143\x69\x64"))->find(); goto jQMUG; HUi2r: } public function saveUnionOrder($order) { goto wUvCg; JYqOW: $orderID = OrderUnionModel::insertGetId($order); goto mRWOL; wUvCg: $order["\157\x72\x64\x65\x72\137\x6e\x6f"] = $this->createOrderNo(); goto CpRyz; mRWOL: return $orderID; goto WdFYt; CpRyz: $order["\143\162\145\x61\164\x65\x5f\164\151\155\145"] = time(); goto JYqOW; WdFYt: } public function createOrderNo() { $orderNo = date("\131\155\144") . substr(time(), -4) . substr(microtime(), 2, 4) . sprintf("\x25\60\x32\144", rand(0, 99)); return $orderNo; } public function delivery($orderID, $jumpPage = '') { goto NtgUY; VYqOE: $message = new DeliveryMessage(); goto Gj1s0; SsIAy: if (!($order->status != OrderStatusEnum::PAID)) { goto s4D46; } goto OFxqo; c_ehB: $order->save(); goto VYqOE; kJLkT: throw new OrderException(); goto HaDbz; OFxqo: throw new OrderException(["\x6d\163\147" => "\xe8\257\xb7\345\x85\210\xe4\273\230\xe6\254\xbe\346\x88\226\xe8\200\x85\xe6\x9b\xb4\xe6\226\xb0\350\xae\242\345\215\225", "\145\162\x72\x6f\x72\103\157\x64\x65" => 80002, "\143\157\144\145" => 403]); goto v_PPR; lg4W5: if ($order) { goto eB0ti; } goto kJLkT; Gj1s0: return $message->sendDeliveryMessage($order, $jumpPage); goto Cv7Ct; v_PPR: s4D46: goto ykbO5; HaDbz: eB0ti: goto SsIAy; ykbO5: $order->status = OrderStatusEnum::DELIVERED; goto c_ehB; NtgUY: $order = OrderModel::where("\151\144", "\x3d", $orderID)->find(); goto lg4W5; Cv7Ct: } public function sumUserOrderProduct($productId) { goto ZzXT9; y84fC: tfVn2: goto whr_e; cm84w: $order = OrderModel::where(["\165\156\x69\x61\143\151\x64" => session("\x75\156\151\x61\143\151\144"), "\x75\163\x65\162\137\x69\144" => $uid, "\x69\163\x5f\143\x61\156\143\x65\154" => 0, "\151\163\137\x64\145\x6c\x65\164\145" => 0])->select(); goto jkpiX; ZzXT9: $uid = TokenService::getCurrentUid(); goto cm84w; cJF5Y: foreach ($order as $key => $value) { goto WCjvE; JUlbu: if (!in_array($productId, $productIds)) { goto x0j2S; } goto gSF37; I4OdR: bT70Z: goto gQRuO; WCjvE: $productIds = json_decode($value["\x70\162\157\144\x75\143\164\x73"], true); goto JUlbu; gSF37: $sum[$key] = $value["\x74\157\164\x61\154\137\143\157\x75\x6e\164"]; goto PELUd; PELUd: x0j2S: goto I4OdR; gQRuO: } goto y84fC; whr_e: return array_sum($sum); goto ccYsF; jkpiX: $sum = []; goto cJF5Y; ccYsF: } }