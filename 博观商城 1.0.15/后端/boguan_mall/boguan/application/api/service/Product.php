<?php
 namespace app\api\service; use app\api\model\Attr; use app\api\model\AttrValue as AttrValueModel; use app\api\model\User as UserModel; use app\api\model\Vip as VipModel; use app\api\model\Product as ProductModel; use app\api\model\Freight as FreightModel; use app\api\model\UserAddress as UserAddressModel; use app\lib\exception\DefaultException; use app\api\model\PlatformSettings; use app\api\service\Wechat as WechatService; use app\api\model\Coupon as CouponModel; use app\api\service\Token as TokenService; class Product { public function getCouponPriceInProduct($data) { goto AzSoB; b6jg0: goto vhFdj; goto C28E7; NQc5C: foreach ($data["\x70\x72\157\144\165\143\x74"] as $key => $value) { goto YzRR3; deYSt: if (!in_array($product["\x69\144"], json_decode($coupon["\160\162\x6f\x64\165\x63\x74\137\151\x64"], true))) { goto bAPwc; } goto c7bvw; NuhNv: njych: goto deYSt; cKnEW: if (!in_array($product["\x63\141\164\x65\x5f\x69\x64"], json_decode($coupon["\143\141\x74\145\137\151\144"], true))) { goto xDGbc; } goto PmiAD; LR_PC: if ($coupon["\141\160\x70\154\x79"] == 1) { goto JEI51; } goto rmM6K; VoXso: vEYZ3: goto LR_PC; ZuGhf: $total_price[] = $vip_price * $value["\x6e\x75\x6d"]; goto XNXNh; hzAwR: goto TiWS2; goto NuhNv; vPeSv: goto vEYZ3; goto GkRAk; YzRR3: $product = ProductModel::get($value["\160\162\x6f\144\x75\143\x74\111\x64"]); goto FduLV; GWgdI: JEI51: goto cKnEW; DxZ23: $attr_id_list = json_encode($value["\x61\x74\x74\162\x5f\x69\144\x5f\x6c\151\163\164"], true); goto YSlQJ; LGYIM: xDGbc: goto hzAwR; aqhXe: TiWS2: goto dDSE1; GRpjW: $vip_price = $this->getNotAttrVipPrice($value["\x70\x72\x6f\144\x75\x63\164\x49\x64"], $product["\x70\162\151\143\x65"], $userInfo["\x76\x69\x70\137\151\144"]); goto vPeSv; d3Grq: $attrValue = AttrValueModel::where(["\x70\162\157\144\x75\x63\164\x5f\x69\x64" => $value["\x70\162\x6f\x64\165\x63\164\111\x64"], "\153\145\x79" => $key])->find(); goto DxZ23; dDSE1: eBfd0: goto Nqg1L; c7bvw: $total_price[] = $vip_price * $value["\x6e\x75\155"]; goto T5YlQ; FduLV: if ($product["\x69\163\x5f\141\x74\x74\162"] == "\x31") { goto C7XAm; } goto GRpjW; XNXNh: goto TiWS2; goto GWgdI; rmM6K: if ($coupon["\141\x70\160\x6c\171"] == 2) { goto njych; } goto ZuGhf; PmiAD: $total_price[] = $vip_price * $value["\x6e\165\x6d"]; goto LGYIM; YSlQJ: $vip_price = $this->getAttrVipPrice($value["\160\162\157\x64\x75\x63\164\x49\144"], $attr_id_list, $attrValue["\160\162\151\x63\145"], $userInfo["\166\151\x70\137\x69\x64"]); goto VoXso; GkRAk: C7XAm: goto qvVBn; qvVBn: $key = implode("\54", $value["\x61\x74\164\162\x5f\x69\144\137\x6c\x69\x73\164"]); goto d3Grq; T5YlQ: bAPwc: goto aqhXe; Nqg1L: } goto bmSV_; bmSV_: TdfCh: goto wEm3M; TlKa4: $price = 0; goto OTaQQ; PTeJH: $coupon = CouponModel::where("\165\156\151\141\x63\151\144", "\75", session("\x75\x6e\151\x61\x63\x69\144"))->find($data["\x63\x6f\165\160\157\x6e\x49\x64"]); goto YXOTl; W0TBT: CFW2I: goto XxiOd; NsXVO: if ($coupon["\x6d\151\156\x5f\x70\x72\151\x63\x65"] > 0 && $total_price < $coupon["\x6d\x69\156\137\x70\x72\x69\x63\x65"]) { goto YfN2s; } goto yjXtY; fILqe: MBxM0: goto jNjxB; XxiOd: goto MBxM0; goto uF562; jkjEC: $price = $total_price; goto DzUjl; OTaQQ: vhFdj: goto dbCvz; C28E7: r_PjH: goto TlKa4; G54wW: if ($coupon["\155\x69\156\137\x70\162\x69\143\145"] > 0 && $total_price < $coupon["\x6d\x69\x6e\137\x70\x72\x69\143\x65"]) { goto JBNMB; } goto ae8Up; DzUjl: lt0JV: goto fILqe; QWqS8: JBNMB: goto jkjEC; wEm3M: $total_price = array_sum($total_price); goto wwW0S; wwW0S: if ($coupon["\164\171\160\x65"] == 1) { goto CapBy; } goto NsXVO; M60EU: YfN2s: goto EmLEJ; wNTxc: goto CFW2I; goto M60EU; YXOTl: $total_price = []; goto NQc5C; AWwDf: $userInfo = UserModel::get($uid); goto PTeJH; yjXtY: $price = $total_price * ($coupon["\x64\x69\x73\143\x6f\165\156\164"] / 10); goto wNTxc; dbCvz: goto lt0JV; goto QWqS8; EmLEJ: $price = $total_price; goto W0TBT; kTDPY: return doubleval(sprintf("\45\56\x32\146", $sub_price)); goto n7hS9; uF562: CapBy: goto G54wW; AzSoB: $uid = TokenService::getCurrentUid(); goto AWwDf; jNjxB: $sub_price = $total_price - $price; goto kTDPY; ae8Up: if ($total_price < $coupon["\x73\x75\142\137\x70\162\151\143\145"]) { goto r_PjH; } goto TW3AH; TW3AH: $price = $total_price - $coupon["\163\165\142\137\160\162\151\x63\x65"]; goto b6jg0; n7hS9: } public function checkSendType($data) { goto YWKm4; y9__X: foreach ($data["\160\x72\x6f\144\x75\x63\x74"] as $key => $value) { goto k25eM; OrmOd: $can_buy = 0; goto pYNXB; iHU_t: goto RfxfI; goto OUGlJ; KdOHU: if (!($data["\x6f\x72\144\x65\x72\x5f\x74\171\x70\x65"] == "\61")) { goto YCQ9f; } goto vuV8t; j1hhK: RfxfI: goto O98uZ; QMwyy: if ($product["\x69\163\137\141\164\164\x72"] == 1) { goto xxY53; } goto FwhQa; IWi8r: if ($platformSetting["\x69\163\x5f\144\145\x6c\151\166\x65\162\171"] == 1) { goto Ksw28; } goto TMC9e; fpbHe: if (!($data["\x6f\162\144\x65\162\x5f\164\171\x70\145"] == "\63")) { goto cUKW1; } goto nh3Pw; ROt6F: CE6Pz: goto JDVo1; fEdIv: ULfI6: goto hucSh; neRPh: $msg = "\350\xa7\x84\xe6\240\xbc\344\xb8\215\xe5\255\230\345\234\250"; goto Jr12C; w322M: $can_buy = 0; goto neRPh; k25eM: $can_buy = 0; goto jhRrH; uJfmb: if (in_array(1, $product["\x73\x65\156\144\137\164\171\x70\145"]) || in_array(2, $product["\x73\x65\156\x64\x5f\164\x79\x70\145"])) { goto xIO_X; } goto sq6ut; TMC9e: $msg = "\345\225\206\345\256\266\344\xb8\215\346\x94\257\xe6\x8c\x81\xe5\x90\x8c\xe5\237\x8e\351\x85\215\xe9\x80\201"; goto iHU_t; EsEOS: $attr = $this->getAttrInfo($value["\x70\x72\x6f\x64\x75\143\164\x49\144"], $attr_id_list); goto FD9VC; CTrkr: EzEOY: goto w4vHR; jhRrH: $msg = ''; goto CdhYp; Qx2P2: if ($attr) { goto MByl8; } goto w322M; q4jpy: opDIL: goto s7r1l; Hr9Dd: goto dplpS; goto syt8f; XC8FA: $can_buy = 1; goto ROt6F; FwhQa: if (!($product["\x73\x74\157\x63\153"] - $value["\x6e\x75\x6d"] < 0)) { goto DHZEW; } goto jRlYb; FWprK: $msg = "\345\x95\206\345\x93\201\xe5\xb7\262\xe5\244\xb1\346\x95\210"; goto DKN5p; d1k4c: $msg = "\xe4\xb8\x8d\xe6\224\257\346\x8c\201\xe5\277\xab\xe9\x80\222\xe5\x8f\221\350\xb4\247"; goto GGTre; KnHww: if (in_array(1, $product["\x73\x65\156\144\137\x74\171\160\x65"])) { goto ULfI6; } goto d1k4c; w4vHR: YCQ9f: goto V1eIq; Jr12C: MByl8: goto O648g; tmFem: if (!($product["\x73\164\141\x74\165\163"] == 0)) { goto s4QJD; } goto tUY4u; TV2U2: s4QJD: goto gtVD6; hMfli: xxY53: goto EsEOS; yGbf3: $str = "\345\xba\x93\345\xad\230\xe9\207\217\344\xb8\215\350\266\xb3"; goto QMwyy; gtVD6: if (!($product["\x69\163\x5f\144\145\x6c\145\x74\145"] == 1)) { goto tZoG0; } goto AEp0x; keTP_: UZrPU: goto CTrkr; CGZgA: dplpS: goto j1hhK; ddbHu: $setData[$key] = ["\x70\162\x6f\x64\x75\143\x74\111\144" => $value["\160\x72\157\144\x75\143\164\111\x64"], "\x61\x74\164\162\137\151\144\137\x6c\x69\163\164" => $value["\x61\164\x74\162\137\151\144\x5f\x6c\151\x73\x74"] ? $value["\x61\x74\x74\x72\x5f\x69\144\137\x6c\x69\163\x74"] : '', "\x63\x61\x6e\137\x62\165\171" => $can_buy, "\x6d\x73\x67" => $msg]; goto q4jpy; FD9VC: if (!($attr["\163\164\x6f\x63\153"] - $value["\x6e\x75\x6d"] < 0)) { goto SD7fn; } goto OrmOd; bEm14: goto EzEOY; goto vlU9C; vuV8t: if ($platformSetting["\x69\x73\137\x65\x78\x70\x72\145\x73\163"] == 1) { goto hBwCW; } goto RFlnk; ljrzw: $attr_id_list = json_encode($value["\141\164\x74\162\x5f\x69\x64\x5f\154\x69\x73\x74"]); goto yGbf3; vlU9C: hBwCW: goto KnHww; AEp0x: $can_buy = 0; goto FWprK; x9cJ8: goto bTd7w; goto hMfli; tUY4u: $can_buy = 0; goto CGumW; E2e_s: $can_buy = 1; goto CGZgA; jRlYb: $can_buy = 0; goto or2oe; JDVo1: q5S3m: goto URi9V; C2aQz: $msg = "\xe4\270\215\346\x94\xaf\346\x8c\x81\345\210\260\xe5\xba\227\xe8\207\xaa\346\217\220"; goto j0fcL; RFlnk: $msg = "\345\x95\x86\xe5\xae\266\344\xb8\x8d\xe6\224\257\346\x8c\x81\345\277\253\351\x80\x92\345\217\221\350\xb4\247"; goto bEm14; GGTre: goto UZrPU; goto fEdIv; OUGlJ: Ksw28: goto uJfmb; DKN5p: tZoG0: goto ddbHu; syt8f: xIO_X: goto E2e_s; CdhYp: $product = ProductModel::get($value["\160\x72\157\x64\165\143\x74\x49\x64"]); goto KdOHU; ge3io: if (in_array(1, $product["\163\145\156\144\137\164\171\160\x65"]) || in_array(3, $product["\163\x65\156\144\137\164\171\x70\145"])) { goto nfDx5; } goto C2aQz; O98uZ: Cvc8c: goto fpbHe; OqDaT: $msg = "\xe5\x95\x86\xe5\256\xb6\xe4\270\215\xe6\x94\xaf\xe6\214\201\345\210\xb0\xe5\xba\227\350\207\xaa\xe6\217\220"; goto PcLH9; nh3Pw: if ($platformSetting["\x69\163\x5f\x70\x69\x63\x6b"] == 1) { goto XS3zB; } goto OqDaT; hucSh: $can_buy = 1; goto keTP_; O62vm: nfDx5: goto XC8FA; or2oe: $msg = $str; goto cdb2L; CGumW: $msg = "\xe5\x95\x86\xe5\x93\x81\345\xb7\262\344\xb8\x8b\xe6\x9e\xb6"; goto TV2U2; sq6ut: $msg = "\xe4\xb8\x8d\xe6\x94\xaf\346\x8c\x81\345\x90\214\345\237\x8e\351\205\215\xe9\200\201"; goto Hr9Dd; cdb2L: DHZEW: goto x9cJ8; cR_Sh: XS3zB: goto ge3io; j0fcL: goto CE6Pz; goto O62vm; V1eIq: if (!($data["\157\162\144\x65\162\137\164\x79\x70\145"] == "\62")) { goto Cvc8c; } goto IWi8r; PcLH9: goto q5S3m; goto cR_Sh; O648g: bTd7w: goto tmFem; W9oeP: SD7fn: goto Qx2P2; pYNXB: $msg = $str; goto W9oeP; URi9V: cUKW1: goto ljrzw; s7r1l: } goto j7zbH; YWKm4: $setData = []; goto efz90; j7zbH: Uvyk4: goto n6XvO; efz90: $platformSetting = PlatformSettings::where(["\x75\156\151\141\x63\151\x64" => session("\x75\x6e\151\141\143\x69\144")])->find(); goto y9__X; n6XvO: return $setData; goto MGcoy; MGcoy: } public function getProductsCoupon($data) { goto kePBJ; ZUvOH: return $couponsData; goto XluZD; w7DH9: NR5V7: goto ZUvOH; OxpFb: $user = UserModel::get($uid); goto h3U1E; Zqbit: foreach ($data["\160\x72\x6f\x64\165\143\x74"] as $key => $value) { goto s4JGe; aQc63: $attr = $this->getAttrInfo($value["\160\162\x6f\x64\165\x63\164\111\x64"], $attr_id_list); goto F1Lza; Inkhw: REEtx: goto F39ei; F39ei: $couponIds = array_values(array_unique($couponIds)); goto qKoSj; XD0rd: jfHBf: goto gHtsc; dDPXa: if ($product["\x69\x73\137\141\x74\164\x72"] == 1) { goto dA90W; } goto Oba1S; Oba1S: $price = $this->getNotAttrVipPrice($product["\151\x64"], $product["\x70\x72\x69\x63\145"], $user["\166\x69\160\x5f\x69\x64"]); goto krf3L; lKaCN: foreach ($coupons as $k => $v) { goto MJW3z; MJW3z: if ($v["\x6d\x69\x6e\137\x70\162\151\143\145"] > 0 && $price >= $v["\155\151\156\x5f\160\x72\151\x63\145"]) { goto b7QQt; } goto oC9BH; r9h1r: miNex: goto EUh_F; Kw38B: b7QQt: goto pYfM3; FIb3S: goto miNex; goto Kw38B; pYfM3: $couponsData[$k] = $coupons[$k]; goto r9h1r; oC9BH: $couponsData[$k] = $coupons[$k]; goto FIb3S; EUh_F: QIehW: goto VllAa; VllAa: } goto Nflrw; krf3L: goto WjtxB; goto glO30; glO30: dA90W: goto lpub3; qKoSj: if (empty($couponIds)) { goto p0I_t; } goto FxeWD; UP5mQ: $coupon = CouponModel::getCouponByProduct($value["\x70\x72\157\x64\x75\x63\x74\111\144"], "\x63\150\145\x63\x6b"); goto PjRh5; s4JGe: $product = ProductModel::get($value["\x70\x72\157\x64\x75\143\164\x49\144"]); goto dDPXa; Nflrw: kJf6b: goto qqbaL; Mc0iR: $price = $price * $value["\x6e\x75\x6d"]; goto UP5mQ; F1Lza: $price = $attr["\x70\162\x69\143\145"]; goto dszO9; lpub3: $attr_id_list = json_encode($value["\x61\x74\164\x72\x5f\x69\144\137\154\x69\x73\164"]); goto aQc63; qqbaL: p0I_t: goto XD0rd; dszO9: WjtxB: goto Mc0iR; PjRh5: foreach ($coupon as $kk => $vv) { $couponIds[] = $vv["\151\144"]; zoKXB: } goto Inkhw; FxeWD: $coupons = CouponModel::all($couponIds); goto lKaCN; gHtsc: } goto w7DH9; h3U1E: $couponIds = $coupons = $couponsData = []; goto Zqbit; kePBJ: $uid = TokenService::getCurrentUid(); goto OxpFb; XluZD: } public function integralExchange($data) { goto bhxiA; m9SbL: return $integral; goto Yjv8J; vLHQM: foreach ($data["\x70\x72\157\144\165\x63\x74"] as $key => $value) { goto t3jGE; BZlCM: $vip_price = $this->getNotAttrVipPrice($value["\x70\x72\x6f\144\x75\143\x74\111\x64"], $product["\x70\x72\x69\x63\x65"], $userInfo["\166\x69\x70\x5f\151\144"]); goto mFlh0; kv8aW: goto vBdVP; goto mF_fM; mF_fM: okBlP: goto jypcD; z_Rh2: if ($product["\151\163\x5f\141\x74\164\162"] == "\x31") { goto NZj9s; } goto BZlCM; zoVzh: $product = ProductModel::get($value["\x70\x72\x6f\x64\x75\x63\164\x49\x64"]); goto Ano3T; dmk2s: $new_item = (object) ["\x69\x64" => $value["\x70\x72\157\x64\165\x63\x74\x49\x64"], "\156\165\155" => $value["\x6e\x75\x6d"], "\160\162\x69\x63\x65" => $vip_price * $value["\x6e\165\155"], "\163\x69\x6e\x67\x6c\x65\137\160\x72\151\x63\x65" => $vip_price, "\151\156\x74\145\147\x72\141\154" => $product["\151\156\x74\145\147\x72\141\154"]]; goto CM9c0; A9dLp: NZj9s: goto EdjLg; jypcD: $userInfo = UserModel::getUserLevel(); goto z_Rh2; oHBb9: $attrValue = AttrValueModel::where(["\160\162\157\144\x75\x63\x74\x5f\151\x64" => $value["\160\162\157\144\x75\143\164\x49\x64"], "\x6b\x65\x79" => $key])->find(); goto vfXFr; Ano3T: if (!($product["\151\x73\x5f\151\156\x74\145\x67\x72\141\x6c"] == "\60")) { goto okBlP; } goto kv8aW; al12o: vBdVP: goto cR6V7; yq0HK: $vip_price = $this->getAttrVipPrice($value["\x70\162\x6f\x64\165\x63\164\111\144"], $attr_id_list, $attrValue["\160\162\x69\143\145"], $userInfo["\166\x69\x70\x5f\151\144"]); goto VJqdQ; EdjLg: $key = implode("\54", $value["\x61\x74\164\162\137\151\x64\137\x6c\151\163\x74"]); goto oHBb9; t3jGE: $productIds[] = $value["\160\162\x6f\x64\x75\x63\x74\x49\x64"]; goto zoVzh; VJqdQ: XE10W: goto dmk2s; CM9c0: $res[] = $this->integral($new_item, $setting["\144\x65\144\x75\143\x74\x69\x6f\x6e"], $productIds); goto al12o; vfXFr: $attr_id_list = json_encode($value["\x61\164\164\162\x5f\151\144\x5f\154\151\163\164"], true); goto yq0HK; mFlh0: goto XE10W; goto A9dLp; cR6V7: } goto w4g6P; bhxiA: $setting = PlatformSettings::where("\x75\156\x69\141\143\x69\x64", session("\x75\x6e\151\141\143\151\144"))->field("\x69\x64\x2c\144\145\x64\x75\x63\164\x69\157\156")->order("\x69\144", "\x64\145\x73\x63")->find(); goto BVX2P; I_0LZ: if (!($user->integral < $integral["\151\156\x74\145\x67\162\141\154"])) { goto hcGGb; } goto GgW3o; GgW3o: $integral["\151\156\x74\x65\147\x72\x61\x6c"] = $user->integral; goto FCLjt; WZhPX: $forehead_integral = 0; goto i2KRF; Yjv8J: C0y0o: goto vLHQM; E0Hwz: hcGGb: goto da9PM; BVX2P: $res = []; goto R96aD; FCLjt: $integral["\x6d\x6f\156\x65\171"] = sprintf("\45\56\x32\146", $user->integral / $setting["\x64\x65\x64\165\143\x74\151\x6f\156"]); goto E0Hwz; ETfvr: $integral["\155\x6f\x6e\145\171"] = $forehead; goto NxoR1; NxoR1: $uid = Token::getCurrentUid(); goto xHFQE; lmUX1: $integral["\x69\x6e\164\145\147\162\x61\154"] = $forehead_integral; goto ETfvr; R96aD: $integral = ["\x69\156\164\x65\x67\162\141\154" => 0, "\x6d\157\x6e\x65\x79" => 0]; goto SJwiV; SJwiV: if (!($setting["\144\x65\144\x75\143\x74\151\157\x6e"] < 1)) { goto C0y0o; } goto m9SbL; xHFQE: $user = UserModel::where(["\151\144" => $uid, "\x69\163\137\x64\x65\154\145\164\145" => 0])->find(); goto I_0LZ; kgbTj: g8uZT: goto lmUX1; w4g6P: ZQVFr: goto WZhPX; m1SM1: foreach ($res as $k => $v) { goto XEHp3; Zx2mi: mKBrx: goto AfUtQ; Vv1mM: $forehead += $v["\x66\157\162\145\x68\145\141\x64"]; goto Zx2mi; XEHp3: $forehead_integral += $v["\x66\157\x72\x65\x68\145\x61\x64\x5f\151\x6e\x74\145\x67\162\141\x6c"]; goto Vv1mM; AfUtQ: } goto kgbTj; da9PM: return $integral; goto XBObM; i2KRF: $forehead = 0; goto m1SM1; XBObM: } public function integral($products, $store_integral, $productIds = array()) { goto d1uj8; lSzgs: if ($integral["\155\157\x72\x65"] == "\61") { goto MM_DX; } goto tOmwH; HmtMK: goto oKTCN; goto nweY0; tQpvt: goto pTttz; goto sccsB; pB1oI: return $resIntegral; goto y0lRe; uMwBZ: if (!($goodsPrice > $forehead)) { goto H5qJ8; } goto H0nYN; AqsYF: nnAtv: goto rAzWn; w8O_t: $resIntegral["\x66\x6f\162\145\150\145\141\x64\x5f\151\156\x74\x65\147\x72\141\154"] = (int) ($store_integral * $goodsPrice); goto uMwBZ; nweY0: MM_DX: goto PaYDH; d1uj8: $integral = json_decode($products->integral, true); goto cYMOH; LFY2E: $resIntegral["\146\x6f\162\x65\x68\145\x61\144\137\x69\156\164\x65\x67\162\141\154"] = (int) ($forehead * $products->num * $store_integral); goto FPk1Z; cYMOH: $resIntegral = ["\x66\x6f\162\145\150\145\x61\x64" => 0, "\x66\157\x72\145\x68\145\x61\x64\x5f\x69\156\x74\145\x67\162\x61\154" => 0]; goto xsH2U; tiYTa: goto riIAm; goto AqsYF; lJQLT: if (!($forehead >= 100)) { goto hHEbq; } goto gKn5p; xsH2U: if (!$integral) { goto eoJ47; } goto hxDd5; JVky1: pTttz: goto vQXVg; FPk1Z: uY_nH: goto P6poD; hxDd5: $forehead = $integral["\x66\157\162\x65\x68\x65\x61\144"]; goto hUqo2; sccsB: VM3UK: goto MYD3C; PaYDH: $resIntegral["\146\157\162\x65\150\145\141\144\x5f\151\x6e\x74\x65\x67\162\x61\x6c"] = (int) ($store_integral * $products->price); goto SRgkJ; XdyqR: hHEbq: goto l1YAO; MYD3C: $resIntegral["\x66\x6f\162\x65\150\145\x61\144\x5f\x69\x6e\164\x65\147\162\141\x6c"] = (int) ($forehead / 100 * $products->price * $store_integral); goto JVky1; C19Yp: $resIntegral["\146\x6f\162\x65\150\145\x61\144\137\151\x6e\x74\x65\147\x72\x61\154"] = (int) ($forehead / 100 * $products->single_price * $store_integral); goto tQpvt; sYSG6: if (!($store_integral > 0)) { goto TvCnx; } goto fJwbB; FKP0x: H5qJ8: goto HmtMK; tOmwH: $goodsPrice = $products->single_price; goto w8O_t; vQXVg: riIAm: goto sYSG6; rAzWn: $forehead = trim($forehead, "\x25"); goto lJQLT; SRgkJ: if (!($products->price > $forehead * $products->num)) { goto uY_nH; } goto LFY2E; zZN43: TvCnx: goto Uxjs4; H0nYN: $resIntegral["\146\157\162\x65\150\145\141\x64\137\x69\156\164\x65\147\x72\x61\x6c"] = (int) ($forehead * $store_integral); goto FKP0x; fJwbB: $resIntegral["\x66\157\162\x65\x68\x65\141\144"] = sprintf("\45\x2e\62\146", $resIntegral["\146\x6f\x72\145\x68\x65\141\144\137\x69\156\x74\x65\147\162\x61\154"] / $store_integral); goto zZN43; hUqo2: if (strpos($forehead, "\x25") !== false) { goto nnAtv; } goto lSzgs; l1YAO: if ($integral["\155\157\162\145"] == "\61") { goto VM3UK; } goto C19Yp; P6poD: oKTCN: goto tiYTa; gKn5p: $forehead = 100; goto XdyqR; Uxjs4: eoJ47: goto pB1oI; y0lRe: } public function reduceStock($snap_info) { goto kDcz5; F__uv: foreach ($products as $key => $value) { goto taK3w; GUZBn: IQtph: goto U1Xxu; gCZYG: goto mnKqt; goto XIsnM; nrdWi: if ($product) { goto o6p7O; } goto qS61s; m6PGw: $product->save(); goto xjNTr; rLQGh: fVbr1: goto CVS5v; xjNTr: mnKqt: goto GUZBn; H5f7n: goto EpDYS; goto rLQGh; vhxrq: $this->NotAttrNumSub($product["\x69\x64"], $value["\x6e\x75\x6d"]); goto H5f7n; DzWij: $product->sales = $product->sales + $value["\156\165\155"]; goto m6PGw; qS61s: return false; goto gCZYG; XIsnM: o6p7O: goto nP3kl; CVS5v: $this->AttrNumSub($product["\x69\144"], $value["\141\164\x74\162\137\151\x64\x5f\x6c\x69\163\x74"], $value["\156\165\x6d"]); goto TdD15; nP3kl: if ($product["\x69\163\137\x61\x74\x74\162"] == 1) { goto fVbr1; } goto vhxrq; TdD15: EpDYS: goto DzWij; taK3w: $product = ProductModel::get($value["\160\x72\157\x64\x75\x63\164\x49\x64"]); goto nrdWi; U1Xxu: } goto vSpha; UDSwJ: if (!is_array($products)) { goto Ule9W; } goto F__uv; O00Uz: Ule9W: goto qFHNd; kDcz5: $products = $snap_info; goto UDSwJ; vSpha: T6Buc: goto O00Uz; qFHNd: } public function AttrNumSub($productId, $attr_id_list, $num) { goto UNnZ1; S5efT: $attrValue = AttrValueModel::where(["\160\x72\x6f\144\165\143\164\x5f\x69\x64" => $productId, "\x6b\x65\171" => $keys])->find(); goto NJlob; UNnZ1: $keys = implode("\54", $attr_id_list); goto S5efT; NJlob: $stock = intval($attrValue["\x73\164\157\143\153"]) - $num; goto XvDRv; OBe5l: $result = $attrValue->save(); goto MD9IA; XvDRv: $attrValue->stock = $stock; goto OBe5l; MD9IA: return $result ? true : false; goto ALHNv; ALHNv: } public function NotAttrNumSub($productId, $num) { goto ozDTS; ozDTS: $product = ProductModel::get($productId); goto fPAtq; PxN3U: $result = $product->save(); goto oWLyl; cTvJX: $product->stock = $stock; goto PxN3U; fPAtq: $stock = intval($product["\x73\164\157\x63\153"]) - $num; goto cTvJX; oWLyl: return $result ? true : false; goto pFa1N; pFa1N: } public function addStock($snap_info) { goto zPyAb; PRH5m: lM7Jx: goto O33Yw; SHjwl: foreach ($products as $key => $value) { goto GplW3; nui6T: goto WJj93; goto Vz5te; ZRwv5: if ($product["\x69\x73\137\141\x74\x74\x72"] == 1) { goto Psqsz; } goto aYIRU; Vz5te: najHs: goto ZRwv5; aYIRU: $this->NotAttrNumAdd($product["\x69\144"], $value["\x6e\165\155"]); goto c4eUU; RTQjj: return false; goto nui6T; ZZdbo: nnxJF: goto F7uKD; GplW3: $product = ProductModel::get($value["\160\x72\157\144\x75\143\164\111\144"]); goto mBG28; c4eUU: goto nnxJF; goto qgs24; mCLAH: wgM3p: goto ScvIZ; qgs24: Psqsz: goto E7KkI; F7uKD: WJj93: goto mCLAH; E7KkI: $this->AttrNumAdd($product["\151\144"], $value["\141\x74\164\x72\x5f\151\144\137\x6c\151\x73\164"], $value["\x6e\x75\155"]); goto ZZdbo; mBG28: if ($product) { goto najHs; } goto RTQjj; ScvIZ: } goto PRH5m; O33Yw: oUqtb: goto jTgn_; zPyAb: $products = $snap_info; goto EWig2; EWig2: if (!is_array($products)) { goto oUqtb; } goto SHjwl; jTgn_: } public function AttrNumAdd($productId, $attr_id_list, $num) { goto wHyGC; hzSBO: $result = $attrValue->save(); goto Bu1ka; wHyGC: $keys = implode("\54", $attr_id_list); goto mXCUX; mXCUX: $attrValue = AttrValueModel::where(["\160\162\157\144\165\x63\164\137\x69\144" => $productId, "\x6b\145\x79" => $keys])->find(); goto dogpB; Bu1ka: return $result ? true : false; goto qTAA7; dogpB: $stock = intval($attrValue["\163\x74\157\x63\x6b"]) + $num; goto dVW4C; dVW4C: $attrValue->stock = $stock; goto hzSBO; qTAA7: } public function NotAttrNumAdd($productId, $num) { goto Pq0sj; DwwDW: return $result ? true : false; goto p8T1r; Pq0sj: $product = ProductModel::get($productId); goto THEKf; THEKf: $stock = intval($product["\163\x74\x6f\x63\x6b"]) + $num; goto J8hNa; J8hNa: $product->stock = $stock; goto cgvgU; cgvgU: $result = $product->save(); goto DwwDW; p8T1r: } public function getFreightPrice($data) { goto Bj0A9; N004x: olPgR: goto wPsub; XSKEg: QKWnn: goto BmUzv; BmUzv: $totalUnifyExpress = max($unifyExpress); goto NgpBw; NgpBw: $freightPrice = array_sum($freightPrice); goto oZ18h; FQ4CK: throw new DefaultException(["\155\163\x67" => "\346\232\202\346\x97\xa0\xe5\225\206\345\x93\201\xe5\217\257\350\264\xad\xe4\271\xb0", "\x65\x72\x72\x6f\x72\143\x6f\x64\145" => 0, "\x63\x6f\x64\x65" => 200]); goto N004x; RkjZA: $address = UserAddressModel::where(["\151\144" => $data["\141\x64\x64\162\x65\x73\x73\111\144"], "\165\163\x65\x72\137\x69\144" => $uid])->find(); goto x2SIH; X59Ze: if (!empty($data["\x70\x72\157\x64\165\143\164"])) { goto olPgR; } goto FQ4CK; x2SIH: $area = [$address["\160\x72\157\166\x69\156\x63\x65"], $address["\143\151\x74\x79"]]; goto ZNpFj; wPsub: if (!(!empty($data["\160\x72\157\x64\x75\143\164"]) && is_array($data["\160\x72\157\x64\165\143\x74"]))) { goto y3XPm; } goto yDuQP; yDuQP: $unifyExpress = []; goto Xhg_l; u8o_e: $totalUnifyExpress = 0; goto X59Ze; Xhg_l: foreach ($data["\160\x72\x6f\x64\165\143\x74"] as $key => $value) { goto q203F; u34JY: M3OMn: goto aZrOG; iRers: mOtWk: goto nxOpE; g1gi3: WZtZO: goto QQ3vd; nAW4k: if ($product) { goto OlHcj; } goto dkKqc; MPVE7: n4yx8: goto QnmBN; Gtk2J: $unifyExpress[] = $product["\165\x6e\x69\146\x79\137\145\170\160\162\x65\x73\x73"]; goto MPVE7; aZrOG: $freightPrice[] = $this->calcFreight($area, $product["\x66\162\x65\x69\x67\150\164\137\151\144"], $weight, $value["\x6e\x75\x6d"]); goto lto9F; oOYkL: if749: goto Gtk2J; h1tsk: if ($product["\x69\x73\x5f\x61\x74\164\x72"] == 1) { goto mOtWk; } goto rzwjC; TMcmd: if (!($value["\x6e\165\x6d"] <= 0 || $value["\156\x75\155"] == '')) { goto UaL4I; } goto ombcA; MdkWg: $attrValue = $this->getAttrInfo($value["\x70\162\157\144\x75\x63\x74\x49\144"], $attr_id_list); goto QutXr; ombcA: throw new DefaultException(["\155\x73\x67" => "\350\257\267\350\276\x93\xe5\x85\xa5\345\225\x86\xe5\x93\201\346\225\xb0\xe9\x87\217", "\145\162\x72\157\x72\x63\x6f\144\x65" => 0, "\x63\x6f\x64\x65" => 200]); goto Y3MgY; rzwjC: $weight = $product["\x77\145\x69\x67\x68\164"] * $value["\x6e\x75\155"]; goto x3rc7; QutXr: $weight = $attrValue["\167\x65\x69\147\x68\164"] * $value["\156\165\x6d"]; goto u34JY; jbWSP: if (!($value["\x61\x74\164\x72\137\x69\x64\x5f\x6c\x69\x73\x74"] == '' && $product["\x69\x73\x5f\141\164\164\162"] == 1)) { goto WZtZO; } goto QIQiO; x3rc7: goto M3OMn; goto iRers; nxOpE: $attr_id_list = json_encode($value["\141\164\x74\x72\137\x69\144\137\x6c\151\163\x74"]); goto MdkWg; QQ3vd: if (!$product["\146\x72\x65\x69\147\x68\164\x5f\151\144"] && $product["\151\x73\137\x75\156\151\x66\x79"] == 1) { goto if749; } goto h1tsk; QIQiO: throw new DefaultException(["\155\x73\147" => "\x69\x64\xe4\xb8\xba{$value["\x70\162\157\144\x75\143\x74\x49\144"]}\347\x9a\x84\345\x95\206\xe5\x93\201\344\270\xba\xe5\244\x9a\350\247\x84\346\xa0\274\xef\274\x8c\350\257\267\351\200\211\xe6\213\xa9\xe8\xa7\x84\xe6\xa0\xbc", "\145\162\x72\x6f\162\143\157\x64\145" => 0, "\x63\157\x64\x65" => 200]); goto g1gi3; Y3MgY: UaL4I: goto jbWSP; lto9F: goto n4yx8; goto oOYkL; dkKqc: throw new DefaultException(["\x6d\163\x67" => "\151\144\xe4\xb8\272{$value["\x70\162\x6f\x64\x75\143\164\111\x64"]}\347\x9a\x84\xe5\x95\206\345\x93\x81\xe4\270\215\xe5\xad\x98\xe5\x9c\250", "\145\162\162\157\x72\x63\157\144\145" => 0, "\x63\157\x64\x65" => 200]); goto SEa6A; q203F: $product = ProductModel::get($value["\160\x72\x6f\144\165\x63\164\111\x64"]); goto nAW4k; SEa6A: OlHcj: goto TMcmd; QnmBN: J8JdE: goto CNN3X; CNN3X: } goto XSKEg; kBT5u: $freightPrice = []; goto RkjZA; F7_gl: return $freightPrice + $totalUnifyExpress; goto tMnyT; Bj0A9: $uid = Token::getCurrentUid(); goto kBT5u; sxbxT: throw new DefaultException(["\155\163\x67" => "\347\x94\xa8\346\x88\xb7\xe5\x9c\xb0\345\235\200\xe4\xb8\215\345\xad\230\345\234\xa8", "\145\x72\162\157\x72\143\157\144\145" => 0]); goto ivpFu; oZ18h: y3XPm: goto F7_gl; ivpFu: L322F: goto u8o_e; ZNpFj: if ($address) { goto L322F; } goto sxbxT; tMnyT: } public function calcFreight($area, $freightId, $weight, $num) { goto WNLGE; LGZoH: eL17u: goto soEFf; cpMUQ: goto VZzs1; goto WJX5S; o_3L6: $freightPrice = $setting["\146\151\x72\163\164\x5f\x70\162\151\143\x65"]; goto qunq1; soEFf: $freightPrice = ceil(($num - $setting["\146\x69\162\x73\164\x5f\167\x65\x69\x67\150\x74"]) / $setting["\163\145\x63\x6f\156\144\x5f\167\x65\151\147\150\x74"]) * $setting["\x73\x65\143\x6f\x6e\144\137\x70\162\151\x63\x65"] + $setting["\146\x69\162\163\164\x5f\160\162\x69\143\145"]; goto ewG2D; LV568: VZzs1: goto ea975; WYm2i: return doubleval(sprintf("\x25\56\62\x66", $freightPrice)); goto uKyug; mPKRZ: $freightPrice = ($weight - $setting["\x66\x69\x72\163\164\137\167\145\x69\147\x68\x74"]) / $setting["\163\145\x63\157\x6e\144\x5f\x77\x65\x69\147\x68\164"] * $setting["\x73\x65\143\157\x6e\144\137\x70\x72\151\x63\145"] + $setting["\146\x69\162\163\x74\137\160\162\151\143\145"]; goto LV568; WJX5S: QxF04: goto mPKRZ; WNLGE: $freight = FreightModel::get($freightId); goto jDnYG; HCL_I: eD56o: goto O10wS; T22hG: if (!$setting) { goto erkSb; } goto tWHBo; tWHBo: if ($freight["\x74\x79\x70\145"] == 1) { goto eD56o; } goto eF1lZ; ewG2D: AVbqe: goto oemr2; oemr2: goto q5MLg; goto HCL_I; eF1lZ: if ($num >= $setting["\146\151\x72\x73\x74\137\167\145\151\x67\x68\x74"] && $setting["\163\145\143\x6f\156\x64\137\167\x65\151\147\x68\x74"] > 0) { goto eL17u; } goto o_3L6; t8c2X: $freightPrice = $setting["\146\x69\162\163\164\137\160\x72\x69\x63\x65"]; goto cpMUQ; kwIwH: return null; goto O6jjc; ea975: q5MLg: goto WYm2i; qunq1: goto AVbqe; goto LGZoH; O10wS: if ($weight >= $setting["\146\x69\x72\163\x74\x5f\x77\145\x69\x67\150\x74"] && $setting["\163\145\143\157\156\x64\x5f\167\145\151\x67\150\164"] > 0) { goto QxF04; } goto t8c2X; jDnYG: $setting = $this->areaFreightSetting($area, $freight); goto T22hG; uKyug: erkSb: goto kwIwH; O6jjc: } public function areaFreightSetting($area, $freight) { goto wGiHz; OSkD1: aDq0E: goto z_tgD; z_tgD: return $data["\144\x65\146\x61\165\154\164"]; goto Im_RW; wGiHz: $data = json_decode($freight["\144\145\164\141\151\x6c"], true); goto NeX7a; NeX7a: foreach ($area as $key => $value) { goto uWKLz; eR53B: foreach ((array) $data["\x72\165\154\145\x73"] as $k => $v) { goto SMkSX; nZrZa: return $v["\155\x6f\144\x65"]; goto gih4n; SMkSX: if (!in_array($value, $v["\x61\x72\x65\x61"])) { goto O18yb; } goto nZrZa; zmBW3: va8N7: goto Emigh; gih4n: O18yb: goto zmBW3; Emigh: } goto T5t32; uWKLz: if (!isset($data["\162\165\154\x65\x73"])) { goto rWLWE; } goto eR53B; T5t32: ht0ay: goto vn5Ih; PvGh9: eOJzu: goto ynM3b; vn5Ih: rWLWE: goto PvGh9; ynM3b: } goto OSkD1; Im_RW: } public function getProductVipPrice($productId, $price, $is_attr) { goto WwRj3; r3O6p: $vipPrice = min($vipPriceArr); goto xsZtj; ttGD5: $vipPriceArr = []; goto x3pmJ; QL3oD: return doubleval(sprintf("\x25\x2e\62\x66", $vipPrice)); goto d6_eW; cwWnC: $attrValue = AttrValueModel::where("\165\156\151\x61\x63\x69\144", session("\165\x6e\151\x61\x63\151\144"))->where(["\x70\x72\x6f\x64\x75\x63\164\x5f\151\x64" => $productId])->select(); goto ttGD5; xsZtj: ws5DV: goto QL3oD; WwRj3: $userInfo = UserModel::getUserLevel(); goto pyION; U1qWP: $vipPrice = $this->getNotAttrVipPrice($productId, $price, $userInfo["\166\151\x70\x5f\151\x64"]); goto uQZ7S; pyION: if ($is_attr == 1) { goto bD7qh; } goto U1qWP; x3pmJ: if (empty($attrValue)) { goto A11ho; } goto DaZ2H; uQZ7S: goto ws5DV; goto O89cJ; O89cJ: bD7qh: goto cwWnC; Vmn3l: K3se7: goto KtTo4; KtTo4: A11ho: goto r3O6p; DaZ2H: foreach ($attrValue as $key => $value) { goto NdvYD; e2xCb: cWVDN: goto X24cS; mBlu7: $vipPriceArr[] = $this->getAttrVipPrice($productId, $attr_id_list, $value["\160\162\x69\143\145"], $userInfo["\x76\151\160\137\x69\144"]); goto e2xCb; NdvYD: $attr_id_list = json_encode(explode("\54", $value["\153\x65\171"])); goto mBlu7; X24cS: } goto Vmn3l; d6_eW: } public function getNotAttrVipPrice($productId, $o_price, $vipId) { goto O8S9L; WhnMw: $setting = json_decode($product["\x73\x65\x74\164\x69\156\147"]); goto g9tEp; WW_57: $price = $o_price; goto wjvJA; us12D: vO7CZ: goto aGWMU; wjvJA: $vip = VipModel::where(["\x75\x6e\151\141\x63\151\144" => session("\x75\x6e\x69\141\x63\x69\144"), "\151\x64" => $vipId])->find($vipId); goto WhnMw; TyU6P: ZFoZL: goto ZS7C2; aGWMU: E3u1k: goto M8gG1; hrDPG: foreach ($setting as $key => $value) { goto Q1OhI; f_PX3: $price = $o_price * ($vip["\144\x69\163\x63\x6f\165\156\164"] / 10); goto Dh7me; vJaq6: tKPpe: goto gYXNq; Q1OhI: if (!($value->vip_id == $vip["\x69\144"] && !empty($vip))) { goto VXyBm; } goto cFwxf; Jldii: $price = $value->vip_price; goto vJaq6; Dh7me: goto tKPpe; goto XOAMC; MPW6z: OFB47: goto tlZIi; cFwxf: if ($value->vip_price) { goto TKrbK; } goto f_PX3; gYXNq: VXyBm: goto MPW6z; XOAMC: TKrbK: goto Jldii; tlZIi: } goto us12D; g9tEp: if (!empty($setting)) { goto Oe1S6; } goto tCIcb; M8gG1: return $price; goto R1C2T; O8S9L: $product = ProductModel::get($productId); goto WW_57; s23wJ: Oe1S6: goto hrDPG; ZS7C2: goto E3u1k; goto s23wJ; tCIcb: if (!($vipId != '' && $vipId == $vip["\x69\144"] && !empty($vip))) { goto ZFoZL; } goto ntfpj; ntfpj: $price = $o_price * ($vip["\144\x69\163\x63\x6f\165\156\164"] / 10); goto TyU6P; R1C2T: } public function getAttrVipPrice($productId, $attr_id_list, $o_price, $vipId) { goto F127t; s_9GY: $vip = VipModel::where(["\165\x6e\151\141\143\x69\144" => session("\x75\x6e\x69\141\x63\151\144"), "\151\144" => $vipId])->find(); goto NNJpk; NNJpk: $setting = json_decode($attrValue["\x73\145\164\164\151\156\x67"], true); goto Xycm4; Xycm4: if (!empty($setting)) { goto gAoAO; } goto nl5rZ; t0AnW: foreach ($setting as $key => $value) { goto a3oWn; GnUmZ: $price = $o_price * ($vip["\144\x69\x73\143\x6f\x75\156\x74"] / 10); goto f3sbI; AGIUC: wttV8: goto u0xKv; VXtd7: goto bNbOm; goto HmaiL; erBvV: $price = $value["\166\151\160\x5f\x70\x72\151\143\145"]; goto TEnAk; HmaiL: sMEGS: goto erBvV; TEnAk: goto u3SRK; goto N3p1o; t1TfM: HJk1b: goto AGIUC; N3p1o: bNbOm: goto t1TfM; a3oWn: if (!($value["\166\151\x70\x5f\151\x64"] == $vip["\151\144"] && !empty($vip))) { goto HJk1b; } goto YqTJx; f3sbI: goto u3SRK; goto VXtd7; YqTJx: if ($value["\166\151\x70\x5f\160\162\151\x63\145"]) { goto sMEGS; } goto GnUmZ; u0xKv: } goto eB717; tgM6w: ZNkqU: goto DVIDN; y33Un: gAoAO: goto t0AnW; F127t: $attr_id_list = implode("\x2c", json_decode($attr_id_list, true)); goto WgsX2; WgsX2: $attrValue = AttrValueModel::where(["\165\156\x69\141\x63\151\144" => session("\x75\156\151\141\143\151\144"), "\x70\162\x6f\x64\x75\x63\164\x5f\151\x64" => $productId, "\x6b\145\x79" => $attr_id_list])->find(); goto MnpfS; eB717: u3SRK: goto tgM6w; hGe64: goto ZNkqU; goto y33Un; DVIDN: return $price; goto NNv_m; nl5rZ: if (!($vipId != '' && $vipId == $vip["\x69\x64"] && !empty($vip))) { goto PvpLG; } goto A2ksq; A2ksq: $price = $o_price * ($vip["\x64\x69\163\143\x6f\x75\x6e\164"] / 10); goto mA8dG; MnpfS: $price = $o_price; goto s_9GY; mA8dG: PvpLG: goto hGe64; NNv_m: } public function getAttrGroupList($productId) { goto spqLu; ysaNq: $keys = implode("\54", $keys); goto t38tK; ytd7r: return $attr; goto gl253; No40g: if (empty($attrValue)) { goto ny8Gf; } goto uOQUr; U9Z6E: OIXat: goto ytd7r; vSHk2: foreach ($attrGroup as $key => $val) { $attr[$val["\x67\162\x6f\165\x70\x5f\x6e\141\155\145"]][] = array("\141\164\164\x72\x5f\151\144" => $val["\151\144"], "\141\164\164\x72\x5f\156\141\x6d\145" => $val["\x61\x74\x74\162\137\156\x61\155\x65"]); OzhJC: } goto vpHRl; tL7g_: $attrGroup = db("\x61\x74\164\x72\x5f\147\x72\157\165\x70")->alias("\141")->join("\x61\x74\164\x72\40\x62", "\x61\56\x69\144\40\x3d\x20\142\x2e\x67\162\x6f\165\160\x5f\x69\x64")->where("\x61\x2e\x75\156\151\141\143\x69\x64", session("\x75\x6e\151\x61\x63\x69\x64"))->where("\142\56\x69\x64\x20\151\x6e\50{$keys}\x29")->field("\x61\x2e\147\162\x6f\x75\x70\x5f\x6e\141\155\145\x2c\x62\56\52")->select(); goto vSHk2; uOQUr: foreach ($attrValue as $k => $v) { $keys[] = $v["\x6b\145\171"]; EOt1q: } goto nqfxF; nqfxF: dP3WK: goto NB36q; NB36q: ny8Gf: goto ysaNq; N4R0q: $keys = $attr = []; goto No40g; vpHRl: evRX6: goto U9Z6E; spqLu: $attrValue = AttrValueModel::where(["\160\162\x6f\x64\165\143\164\137\x69\144" => $productId, "\165\156\x69\141\x63\x69\x64" => session("\x75\156\151\141\143\x69\x64")])->field("\x6b\x65\x79")->select(); goto N4R0q; t38tK: if (!$keys) { goto OIXat; } goto tL7g_; gl253: } public function getAttrInfo($productId, $attr_id_list, $type = '') { goto ulZ8G; KCDn7: g6azl: goto x1z_O; SqBUo: $price = $attrValue["\x70\162\x69\143\145"]; goto qzJ4J; VhCuR: $attrValue = AttrValueModel::where("\x75\156\x69\141\x63\151\x64", session("\x75\156\x69\141\x63\x69\x64"))->where(["\x70\162\157\144\165\143\164\x5f\151\144" => $productId, "\153\x65\171" => $keys])->find(); goto au6r0; c72rW: $keys = implode("\54", $attr_id_list); goto g25QA; wtn0w: goto ARpW3; goto b7p5a; hq04r: $data["\x70\162\151\143\x65"] = $attrValue["\160\162\x69\x63\x65"]; goto mSUdG; AwgS4: $data["\151\x64"] = $product["\151\x64"]; goto pXk7X; P3YNI: $data["\164\x68\x75\155\x62"] = $attrValue["\151\155\x61\x67\x65"] ? $attrValue["\x69\x6d\x61\x67\145"] : $product["\164\150\165\x6d\142"]; goto x7534; b7p5a: QavIR: goto G1pML; AIhHN: m2ZT9: goto wtn0w; k1SJJ: $data["\x61\164\x74\x72\x5f\x6c\151\163\x74"] = $attr_list; goto c1D6N; dzFRI: $attrs = Attr::where("\165\156\151\x61\143\x69\144", session("\165\156\151\x61\143\x69\144"))->where($where)->field("\x69\144\x2c\x61\x74\x74\x72\x5f\156\x61\x6d\145")->select(); goto K672D; A72HZ: if (empty($attrs)) { goto V0znO; } goto eUzW2; F6Yss: Bz8MD: goto GYiwd; IaOPP: $user = UserModel::get($uid); goto QYJS8; qzJ4J: $setting = json_decode($attrValue["\163\x65\164\x74\151\x6e\147"], true); goto DV7CR; ofhlW: goto Bz8MD; goto dbRzr; K672D: $data = $attr_list = []; goto A72HZ; Rlei3: if (!($user["\166\x69\160\x5f\151\x64"] != '' && $user["\166\x69\160\x5f\x69\144"] == $vip["\151\x64"] && !empty($vip))) { goto m2ZT9; } goto wxplu; a8Xdd: lJrVm: goto qqixR; ElLLa: ARpW3: goto Te3mu; DV7CR: if (!empty($setting)) { goto QavIR; } goto Rlei3; hExKu: if ($attrValue) { goto Ko3Wg; } goto bfZK2; qqixR: return $data; goto F6Yss; Te3mu: $data["\160\162\151\143\x65"] = $price; goto a8Xdd; dbRzr: Ko3Wg: goto AwgS4; g25QA: $where = "\x69\x64\x20\111\116\x28{$keys}\51"; goto dzFRI; ulZ8G: $attr_id_list = json_decode($attr_id_list, true); goto c72rW; kG2U3: if ($type != "\143\141\162\164") { goto g6azl; } goto hq04r; QYJS8: $vip = VipModel::get($user["\x76\x69\160\x5f\x69\x64"]); goto SqBUo; x1z_O: $uid = Token::getCurrentUid(); goto IaOPP; pXk7X: $data["\x6e\141\x6d\145"] = $product["\x6e\x61\155\145"]; goto bu8oo; mSUdG: goto lJrVm; goto KCDn7; c1D6N: $data["\151\x6d\141\147\145"] = $attrValue["\x69\x6d\141\147\x65"] ? $attrValue["\151\x6d\141\x67\145"] : $product["\164\x68\x75\155\142"]; goto P3YNI; bfZK2: return null; goto ofhlW; FUA13: V0znO: goto VhCuR; G1pML: foreach ($setting as $key => $value) { goto Kd4kd; qTasg: if (!($value["\166\151\160\x5f\151\144"] == $vip["\x69\x64"] || $value["\166\x69\160\x5f\154\145\166\145\154"] == $vip["\x6c\x65\166\145\x6c"])) { goto OkL0g; } goto IZS78; z0Fn3: goto fnd7g; goto RKma8; RKma8: KBRZR: goto bvSVx; TtAMd: $price = $price * ($vip["\x64\151\x73\143\157\x75\156\x74"] / 10); goto AwFBa; ammpv: OkL0g: goto iZjWK; gfyOi: tvYiI: goto EJH_x; N2Cle: fnd7g: goto ammpv; HvT0d: goto e3ptf; goto N2Cle; Kd4kd: if (empty($vip)) { goto oA4sq; } goto qTasg; IZS78: if ($value["\166\x69\160\137\160\162\x69\143\x65"]) { goto KBRZR; } goto TtAMd; AwFBa: goto e3ptf; goto z0Fn3; bvSVx: $price = $value["\x76\x69\x70\x5f\x70\162\x69\143\x65"]; goto HvT0d; iZjWK: oA4sq: goto gfyOi; EJH_x: } goto aH_K9; jlWO0: $data["\167\145\x69\147\x68\x74"] = $attrValue["\167\x65\x69\x67\150\x74"]; goto apzgg; bu8oo: $data["\x73\x65\156\144\137\x74\x79\160\145"] = $product["\x73\145\x6e\x64\137\x74\171\x70\x65"]; goto k1SJJ; x7534: $data["\x73\164\x6f\x63\x6b"] = $attrValue["\163\x74\157\143\153"]; goto jlWO0; wxplu: $price = $price * ($vip["\144\151\x73\143\157\x75\156\164"] / 10); goto AIhHN; au6r0: $product = ProductModel::get($productId); goto hExKu; eUzW2: foreach ($attrs as $key => $attr) { (array) ($attr_list[] = ["\x61\164\x74\x72\x5f\151\x64" => $attr["\x69\144"], "\x61\164\x74\x72\x5f\x6e\141\155\145" => $attr["\x61\164\x74\162\x5f\156\141\x6d\x65"]]); nhdmo: } goto G3D86; G3D86: MhK4A: goto FUA13; aH_K9: e3ptf: goto ElLLa; apzgg: $data["\x6e\157"] = $attrValue["\156\x6f"]; goto kG2U3; GYiwd: } public function getAttrList($attr_id_list) { goto jLK74; jLK74: $attr_id_list = json_decode($attr_id_list, true); goto q6wEn; ZaWTl: foreach ($attrs as $key => $attr) { (array) ($attr_list[] = ["\x6e\x61\155\x65" => $attr["\151\144"], "\166\141\x6c\165\x65" => $attr["\141\x74\x74\x72\x5f\x6e\141\x6d\x65"]]); j3K7k: } goto enrtR; c7FUf: $where = "\x69\x64\40\111\116\x28{$keys}\x29"; goto ZIPId; enrtR: VrWGD: goto RXxLF; q6wEn: $keys = implode("\54", $attr_id_list); goto c7FUf; Krp0w: return $attr_list; goto Tc1p0; RXxLF: T01pY: goto Krp0w; Cubq0: $attr_list = []; goto r4xA5; ZIPId: $attrs = Attr::where("\165\x6e\x69\x61\x63\151\x64", session("\165\156\151\141\x63\x69\x64"))->where($where)->field("\x69\144\54\141\x74\x74\x72\x5f\x6e\x61\155\x65")->select(); goto Cubq0; r4xA5: if (empty($attrs)) { goto T01pY; } goto ZaWTl; Tc1p0: } public function getProductShareQrCode($productId) { goto UyK5b; iKDkW: if (!file_exists($saveRoot . $productThumbName)) { goto a0qxu; } goto iTIQB; kGolk: YeSti: goto uTyr4; eCEG0: if (!file_exists($saveRoot . $qrCode)) { goto YeSti; } goto wCZuf; CCPV4: $thumb = \think\Image::open($saveRoot . $qrCode); goto FkMK0; UyK5b: $setting = PlatformSettings::where("\x75\156\x69\x61\143\151\144", session("\165\156\151\x61\x63\x69\144"))->order("\151\x64", "\144\145\163\x63")->find(); goto DTLQ0; bJ1ek: CZOCF: goto kdGaF; fEYTN: $productThumb = \think\Image::open($productThumbSrc); goto ErtAy; iTIQB: unlink($saveRoot . $productThumbName); goto iQbV6; nNO52: J8iMZ: goto OQW10; M9Nso: $productThumbName = uniqid() . "\56\160\x6e\147"; goto fO_C5; kdGaF: if (!(strlen($product["\163\x75\x6d\x6d\141\162\x79"]) >= 62)) { goto FLZwE; } goto oAR2A; s0VPJ: $background = "\x70\x75\142\154\151\x63\57\x73\164\141\x74\x69\x63\x2f\x69\155\141\x67\x65\57\163\150\x61\162\145\x5f\x62\147\x2e\x6a\160\147"; goto U0lqW; uTiTJ: return; goto KaQsQ; ErtAy: $productThumb->thumb(760, 780, \think\Image::THUMB_FIXED)->save($saveRoot . $productThumbName); goto s0VPJ; bI5Nx: $product["\x6e\x61\x6d\x65"] = mb_strcut($product["\x6e\141\x6d\145"], "\60", "\x34\61") . "\x2e\x2e\x2e"; goto bJ1ek; JfAXi: $saveRoot = "\x70\165\142\x6c\151\143" . DS . "\163\x74\141\164\151\x63" . DS . "\161\x72\x63\x6f\144\x65" . DS . "\x73\x74\x6f\x72\x65\x5f" . session("\165\x6e\x69\x61\x63\x69\144") . DS; goto CNyWA; wCZuf: unlink($saveRoot . $qrCode); goto kGolk; s_ZNT: return $qrCodeUrl; goto CrPSX; R71Ih: if (!file_exists($saveRoot . $fileNames)) { goto J8iMZ; } goto aeBJM; DTLQ0: $product = ProductModel::get($productId); goto OF4RB; o97Lv: FLZwE: goto UVBYW; OF4RB: if (!empty($product)) { goto coAyK; } goto uTiTJ; QuE5v: unlink($saveRoot . $fileName); goto ulX4B; U0lqW: $image = \think\Image::open($background); goto JJDy1; sdEym: $productThumbSrc = str_replace("\x68\164\x74\x70\x73\72", '', $productThumbSrc); goto fEYTN; ulX4B: o1SMM: goto iKDkW; KaQsQ: coAyK: goto s9SHs; UVBYW: $image->water($saveRoot . $fileName, array(136, 1190))->water($saveRoot . $productThumbName, array(113, 100))->text($product["\156\x61\x6d\145"], $fontRoot, 26, "\x23\60\x30\60\60\60\60", array(80, 1034))->text($product["\163\165\x6d\x6d\141\162\x79"], $fontRoot, 20, "\43\66\66\x36\66\x36\x36", array(80, 1088))->text("\357\xbf\245" . $product["\x70\162\151\x63\145"], $fontRoot, 32, "\43\105\x31\66\102\64\71", array(724, 1034))->text("\xe9\x95\xbf\xe6\x8c\x89\344\272\214\347\273\264\347\xa0\x81\xe6\x9f\xa5\347\234\213\350\xaf\xa6\xe6\x83\x85", $fontRoot, 18, "\x23\x30\60\60\60\x30\x30", array(502, 1300))->text("\346\x9b\264\xe5\244\232\344\272\247\xe5\223\x81\xe8\xaf\xa6\350\247\x81" . $setting["\x6e\141\x6d\145"], $fontRoot, 18, "\x23\60\x30\60\x30\60\60", array(502, 1346))->save($saveRoot . $fileNames); goto a7T5m; JJDy1: $fileNames = "\x70\162\157\144\x75\143\164\137" . $productId . "\137\x73\150\141\x72\145\x5f\x69\155\x67\56\160\156\x67"; goto R71Ih; FkMK0: $thumb->thumb(300, 300, \think\Image::THUMB_FIXED)->save($saveRoot . $fileName); goto M9Nso; oAR2A: $product["\x73\165\155\155\141\x72\171"] = mb_strcut($product["\163\x75\x6d\x6d\141\x72\171"], "\60", "\66\x32") . "\x2e\56\x2e"; goto o97Lv; iQbV6: a0qxu: goto s_ZNT; zMqKL: $qrCode = WechatService::createQrCode($productId, $uid, "\x70\x72\157\144\x75\143\164"); goto JfAXi; uTyr4: if (!file_exists($saveRoot . $fileName)) { goto o1SMM; } goto QuE5v; OQW10: if (!(strlen($product["\156\x61\x6d\145"]) >= 41)) { goto CZOCF; } goto bI5Nx; ov1Jr: $productThumbSrc = str_replace("\150\164\164\x70\x3a", '', $productThumbSrc); goto sdEym; fO_C5: $productThumbSrc = str_replace(WE7_PATH, '', $product["\x74\x68\165\155\x62"]); goto ov1Jr; Qpuej: $fileName = uniqid() . "\x2e\160\x6e\x67"; goto CCPV4; s9SHs: $uid = TokenService::getCurrentUid(); goto zMqKL; a7T5m: $qrCodeUrl = MINI_WE7_PATH . $saveRoot . $fileNames; goto eCEG0; aeBJM: unlink($saveRoot . $fileNames); goto nNO52; CNyWA: $fontRoot = "\x70\x75\142\x6c\x69\x63\57\142\157\x67\165\141\156\57\x66\x6f\156\x74\163\x2f\x41\x61\x42\141\x6e\123\x6f\x6e\147\x2e\164\x74\x66"; goto Qpuej; CrPSX: } }