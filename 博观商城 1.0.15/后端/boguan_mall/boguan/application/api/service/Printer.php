<?php
 namespace app\api\service; use app\boguan\service\FeiePrinter as FeiePrinterService; use app\api\model\Printer as PrinterModel; use app\api\model\PlatformSettings; use app\api\model\Order as OrderModel; use think\Exception; use think\Log; use app\api\model\Product as ProductModel; class Printer { private $uniacid; public function __construct($uniacid = '') { goto YZhuB; YZhuB: if ($uniacid == '') { goto mvoic; } goto HbjCU; CvKjL: JTnrh: goto cvWGA; HbjCU: $this->uniacid = $uniacid; goto Jy7g7; xOukG: $this->uniacid = session("\x75\x6e\x69\141\x63\151\x64"); goto CvKjL; Jy7g7: goto JTnrh; goto xFjvr; xFjvr: mvoic: goto xOukG; cvWGA: } public function printReceiptAtPaid($orderId, $type) { goto mL7pp; lTWrt: xQ2Sd: goto iJ0X0; gBkqO: Eadmj: goto kIDJj; pxKkI: return false; goto gn9CZ; lun7i: foreach ($printers as $key => $printer) { goto FG34E; aMWpE: $res = true; goto QFtUb; QFtUb: ZTAvX: goto kgA1e; vjzmh: if ($result["\162\x65\x74"] == "\60") { goto vZfT3; } goto Y0JtY; smgIG: Log::record($result); goto Tkx77; WCGIW: vZfT3: goto aMWpE; kgA1e: Nk5x3: goto F6bgW; zM2Iw: $result = json_decode($feieService->wp_print($feieData), true); goto XvYDE; Y0JtY: $res = false; goto smgIG; dc2I8: $feieData = ["\x75\x73\145\162" => $config["\165\163\x65\162"], "\165\x6b\145\x79" => $config["\x75\x6b\145\x79"], "\x73\156" => $config["\163\156"], "\153\x65\x79" => $config["\x6b\145\171"], "\x70\x61\x67\x65" => $printer["\160\141\147\x65"], "\x63\x6f\x6e\164\x65\x6e\x74" => $this->setPrinterData($orderId, $printer, $type)]; goto zM2Iw; Tkx77: goto ZTAvX; goto WCGIW; XvYDE: Log::record($result); goto vjzmh; FG34E: $config = $printer["\163\x65\164\x74\x69\156\x67"]["\x63\157\x6e\x66\151\x67"]; goto dc2I8; F6bgW: } goto lTWrt; s6UIA: $printers = PrinterModel::where(["\165\156\151\141\143\151\x64" => $this->uniacid, "\163\x74\141\164\165\163" => 1])->select(); goto CjxgI; E3bf_: if (in_array($type, $when)) { goto ZBkuN; } goto jlnWu; CjxgI: if (!$printers->isEmpty()) { goto ZXy27; } goto wkcMi; mL7pp: $when = ["\x70\141\151\144", "\x73\x65\156\x64", "\x63\x6f\156\146\151\x72\x6d", "\x63\154\x65\x72\x6b"]; goto E3bf_; wkcMi: return false; goto n5dqh; Fil4X: return true; goto gBkqO; VARDb: $feieService = new FeiePrinterService(); goto s6UIA; jlnWu: return false; goto BpY17; FO74x: Z_vTA: goto Fil4X; gn9CZ: goto Eadmj; goto FO74x; BpY17: ZBkuN: goto VARDb; iJ0X0: if ($res !== false) { goto Z_vTA; } goto pxKkI; n5dqh: ZXy27: goto jiL_r; jiL_r: $res = true; goto lun7i; kIDJj: } private function setPrinterData($orderId, $printer, $type) { goto cb6fT; wyL3s: mIdKE: goto O31ar; C7nff: if (!$order["\144\145\x6c\151\x76\x65\162\171\137\x74\x69\x6d\x65"]) { goto ZyLxs; } goto ANhlr; T1Rk7: goto xvODi; goto UOHt4; vZYqd: glcql: goto tNpSv; Trumz: $orderInfo .= "\53\x2d\x2d\x2d\55\55\x2d\55\55\55\x2d\55\55\55\x2d\x2d\55\x2d\x2d\55\55\x2d\x2d\x2d\x2d\x2d\x2d\55\x2d\x2d\55\53\74\102\x52\76"; goto AIWNw; Sxt_T: $orderInfo .= "\344\270\213\xe5\215\225\346\227\xb6\351\x97\264\xef\xbc\x9a" . $order["\143\162\x65\x61\164\145\x5f\164\151\x6d\145"] . "\74\x42\x52\76"; goto PsJ_i; U0ZfL: ZyLxs: goto nGAhl; dxTbC: p2mv1: goto b0rKX; rnjf8: $order = OrderModel::get($orderId); goto xAY2W; McgHg: $count = []; goto NyCu2; tYLn_: $orderInfo .= "\xe7\224\xa8\346\210\267\345\x90\215\347\xa7\260\357\274\x9a" . $order["\x75\163\145\162\x69\x6e\146\x6f"]["\156\141\x6d\x65"] . "\74\102\x52\x3e"; goto YTUBy; b0rKX: if (!(count($count) <= 0)) { goto glcql; } goto uyaOz; J3QHW: $orderInfo .= "\346\x94\266\xe8\xb4\xa7\345\x9c\xb0\345\x9d\x80\357\xbc\x9a" . $order["\x75\163\145\x72\151\x6e\x66\157"]["\141\144\144\162\145\163\x73"] . "\74\102\x52\x3e"; goto tYLn_; q7tmB: if ($order["\x6f\x72\x64\x65\x72\137\x74\171\160\x65"] == 2) { goto ovuDH; } goto J3QHW; BDKp_: $orderInfo .= "\xe8\201\x94\xe7\xb3\273\347\x94\265\350\xaf\x9d\xef\274\x9a" . $order["\x75\163\145\162\151\x6e\x66\x6f"]["\160\x68\157\156\145"] . "\74\x42\x52\x3e"; goto V3Gj_; O31ar: $orderInfo .= "\xe8\x87\xaa\xe6\217\220\347\202\xb9\xef\xbc\x9a" . $order["\160\151\143\153\x5f\151\156\146\157"]["\141\144\144\162\145\x73\163"] . "\x3c\102\x52\76"; goto mQerm; VlH1I: $orderInfo .= "\347\224\250\xe6\x88\xb7\345\x90\x8d\xe7\xa7\xb0\357\xbc\x9a" . $order["\x75\163\145\162\151\x6e\x66\x6f"]["\156\x61\x6d\145"] . "\x3c\x42\x52\x3e"; goto BDKp_; HUQi_: goto xvODi; goto C1sF0; tNpSv: $orderInfo .= "\x2b\55\x2d\x2d\x2d\55\x2d\55\x2d\x2d\55\x2d\x2d\55\55\55\55\x2d\55\x2d\55\x2d\x2d\55\x2d\x2d\x2d\55\55\x2d\x2d\53\74\x42\x52\x3e"; goto rLgxn; ocz1o: if (!$order["\x70\151\x63\153\x5f\x74\151\155\x65"]) { goto mIdKE; } goto A1JST; uyaOz: return false; goto vZYqd; PsJ_i: return $orderInfo; goto O4Lo5; A1JST: $orderInfo .= "\xe6\217\x90\xe8\264\xa7\xe6\227\266\351\227\xb4\357\xbc\x9a" . $order["\x70\x69\143\153\137\x74\x69\x6d\x65"] . "\74\102\122\x3e"; goto wyL3s; a1kVL: if ($order["\157\162\144\145\162\137\164\x79\x70\x65"] == 3) { goto VjgNC; } goto q7tmB; YTUBy: $orderInfo .= "\xe8\x81\224\xe7\263\273\347\x94\265\350\xaf\x9d\357\xbc\x9a" . $order["\x75\x73\145\162\x69\x6e\x66\x6f"]["\x70\x68\x6f\x6e\145"] . "\x3c\102\x52\x3e"; goto T1Rk7; rLgxn: $orderInfo .= "\345\220\210\350\xae\241\xef\274\232" . $order["\x61\x6d\x6f\165\x6e\x74"] . "\345\x85\203\x3c\102\122\x3e"; goto a1kVL; xAY2W: Log::record($orderId); goto EFNzn; B5xDy: $orderInfo .= "\xe5\x90\x8d\xe7\247\xb0\40\343\x80\200\xe3\x80\x80\40\40\xe3\x80\x80\xe3\200\x80\xe5\215\x95\344\273\xb7\x20\40\x20\346\x95\xb0\xe9\207\217\x20\40\351\x87\221\351\242\x9d\74\102\122\76"; goto Trumz; ANhlr: $orderInfo .= "\351\200\201\xe8\xbe\xbe\346\227\xb6\351\227\xb4\357\xbc\x9a" . $order["\144\145\154\x69\x76\x65\x72\x79\137\x74\151\x6d\x65"] . "\x3c\102\x52\x3e"; goto U0ZfL; UOHt4: VjgNC: goto ocz1o; C1sF0: ovuDH: goto C7nff; nGAhl: $orderInfo .= "\xe9\205\x8d\351\200\x81\345\x9c\260\xe5\x9d\200\357\xbc\232" . $order["\x75\x73\145\x72\151\156\x66\x6f"]["\x61\144\144\162\145\x73\163"] . "\74\102\122\76"; goto VlH1I; l8iYu: $orderInfo .= "\350\201\x94\347\263\xbb\347\224\265\xe8\xaf\235\xef\xbc\x9a" . $order["\160\x69\143\153\137\151\156\146\x6f"]["\160\150\157\x6e\x65"] . "\74\x42\x52\76"; goto HUQi_; V3Gj_: xvODi: goto Sxt_T; NyCu2: $orderInfo = "\74\103\x42\x3e" . $platform["\x6e\x61\x6d\x65"] . "\x3c\x2f\103\102\76\74\x42\122\x3e"; goto B5xDy; mQerm: $orderInfo .= "\347\224\xa8\346\x88\xb7\345\220\x8d\xe7\xa7\260\357\xbc\x9a" . $order["\160\151\x63\x6b\137\x69\x6e\146\157"]["\156\x61\x6d\145"] . "\x3c\x42\x52\x3e"; goto l8iYu; AIWNw: foreach ($order["\x73\x6e\141\160\137\x69\x6e\146\157"] as $k => $v) { goto D0FN4; jm7xh: $set = $this->setStatus($order, $type, $config); goto lJeYh; D0FN4: if ($printer["\141\160\x70\x6c\x79"] == 1) { goto QGBZp; } goto OnPlO; YLoIo: $count[] = $k; goto IYNRc; IYNRc: $orderInfo .= $v["\x6e\141\x6d\x65"] . "\40" . $v["\x70\x72\151\143\145"] . "\x20" . $v["\x6e\x75\x6d"] . "\40" . $v["\160\162\x69\x63\145"] * $v["\x6e\165\155"] . "\x3c\102\x52\x3e"; goto RlX7l; wlD3u: yN1aQ: goto rqW9L; qTT3c: KYve4: goto aNw8A; Js2uS: QGBZp: goto DVrNt; b6BkW: foreach ($printer["\x63\141\164\145\137\151\x64"] as $key => $value) { $allCateId .= "\54" . getChildCate($value); DWXYb: } goto wlD3u; Pi5Jy: Bpwef: goto ReLRT; WCogh: $count[] = $k; goto Dhe2C; OnPlO: $allCateId = ''; goto b6BkW; DVrNt: $set = $this->setStatus($order, $type, $config); goto nzGJM; aNw8A: goto CQy7v; goto Js2uS; IR4Km: $product = ProductModel::get($v["\160\162\x6f\144\x75\143\164\111\144"]); goto L0fHh; nzGJM: if (!$set) { goto N1Ayq; } goto YLoIo; RlX7l: N1Ayq: goto t6WBt; rqW9L: $allCateIds = MergeArrayElements($allCateId); goto IR4Km; L0fHh: if (!in_array($product["\143\141\x74\145\137\151\x64"], $allCateIds)) { goto KYve4; } goto jm7xh; lJeYh: if (!$set) { goto UysZ3; } goto WCogh; t6WBt: CQy7v: goto Pi5Jy; i5RdQ: UysZ3: goto qTT3c; Dhe2C: $orderInfo .= $v["\x6e\x61\x6d\145"] . "\x20" . $v["\x70\162\x69\x63\x65"] . "\40" . $v["\156\165\x6d"] . "\x20" . $v["\160\x72\151\143\145"] * $v["\x6e\x75\155"] . "\74\102\x52\76"; goto i5RdQ; ReLRT: } goto dxTbC; EFNzn: $config = $printer["\x73\145\x74\164\151\x6e\x67"]; goto McgHg; cb6fT: $platform = PlatformSettings::where("\165\156\151\141\x63\151\144", "\x3d", $this->uniacid)->field("\x6e\x61\x6d\x65")->find(); goto rnjf8; O4Lo5: } private function setStatus($order, $type, $config) { goto cmu_u; cgeHb: hgi2R: goto GcbG3; cmu_u: $set = false; goto qWjDh; GcbG3: return $set; goto lLFMA; PE59F: o5WMo: goto cgeHb; qWjDh: switch ($order["\157\162\x64\x65\162\x5f\x74\x79\x70\145"]) { case 1: goto sLivW; JAfQJ: $set = true; goto Dzw3N; ABIO0: if (!($config["\145\170\160\162\145\x73\163"]["\163\164\141\164\x75\x73"] == "\61" && $type == "\163\145\156\144" && $config["\145\x78\160\162\x65\163\x73"]["\163\x65\x6e\x64"] == "\61")) { goto YREMW; } goto IRZP6; Dzw3N: CHSJj: goto ABIO0; sLivW: if (!($config["\x65\170\160\x72\145\163\x73"]["\163\x74\141\164\x75\x73"] == "\61" && $type == "\x70\141\x69\x64" && $config["\145\x78\160\162\145\x73\x73"]["\x70\141\x79"] == "\x31")) { goto CHSJj; } goto JAfQJ; N3ig5: YREMW: goto sJYbO; sJYbO: goto hgi2R; goto n8fsG; IRZP6: $set = true; goto N3ig5; n8fsG: case 2: goto rL8Gu; rL8Gu: if (!($config["\x64\145\x6c\151\166\145\x72\171"]["\x73\x74\x61\164\x75\x73"] == "\x31" && $type == "\x70\141\x69\x64" && $config["\x64\145\154\151\x76\145\x72\171"]["\160\141\x79"] == "\61")) { goto tGTyu; } goto n2s0b; icGDU: if (!($config["\x64\x65\x6c\x69\x76\145\x72\x79"]["\x73\x74\141\164\165\163"] == "\x31" && $type == "\x63\157\156\146\151\162\155" && $config["\144\x65\154\151\x76\x65\162\171"]["\143\157\x6e\146\151\x72\x6d"] == "\x31")) { goto ROBsw; } goto QhzOF; S3p04: ROBsw: goto WxCG_; n2s0b: $set = true; goto ZewXJ; QhzOF: $set = true; goto S3p04; WxCG_: goto hgi2R; goto bBcyP; ZewXJ: tGTyu: goto icGDU; bBcyP: case 3: goto CCBfK; CCBfK: if (!($config["\160\151\x63\153"]["\x73\164\141\x74\x75\163"] == "\61" && $type == "\x70\x61\x69\x64" && $config["\160\x69\143\x6b"]["\160\141\171"] == "\61")) { goto tEkbY; } goto EPCsL; s_AIR: goto hgi2R; goto Jqutp; AiHcA: $set = true; goto TizaP; EPCsL: $set = true; goto aeWRD; rUoo5: if (!($config["\x70\151\143\x6b"]["\163\164\x61\x74\165\x73"] == "\x31" && $type == "\x63\154\x65\162\153" && $config["\x70\151\x63\153"]["\x63\154\x65\162\153"] == "\61")) { goto rR8wd; } goto AiHcA; TizaP: rR8wd: goto s_AIR; aeWRD: tEkbY: goto rUoo5; Jqutp: } goto PE59F; lLFMA: } }