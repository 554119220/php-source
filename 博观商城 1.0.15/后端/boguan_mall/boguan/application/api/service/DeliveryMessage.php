<?php
 namespace app\api\service; use app\api\model\User; use app\lib\exception\OrderException; use app\lib\exception\UserException; class DeliveryMessage extends WxMessage { const DELIVERY_MSG_ID = "\x51\x75\x6b\151\x76\70\166\x77\x4e\x41\x7a\x47\x69\163\x67\103\172\115\x38\71\116\x53\x49\143\152\x69\x67\x5a\x78\156\122\147\x66\x61\71\144\113\x68\64\x77\64\164\x59"; public function sendDeliveryMessage($order, $tplJumpPage) { goto mSG8D; WL_2y: $this->emphasisKeyWord = "\153\x65\171\x77\157\x72\144\x32\56\104\101\x54\101"; goto o55r0; ID_UD: $this->tplID = self::DELIVERY_MSG_ID; goto DFqKM; mSG8D: if ($order) { goto WJdYa; } goto mwDeo; mwDeo: throw new OrderException(); goto U0699; CbR0u: $this->page = $tplJumpPage; goto B50tK; B50tK: $this->prepareMessageData($order); goto WL_2y; U0699: WJdYa: goto ID_UD; o55r0: return parent::sendMessage($this->getUserOpenID($order->user_id)); goto efFao; DFqKM: $this->formID = $order->prepay_id; goto CbR0u; efFao: } private function prepareMessageData($order) { goto G9yA6; xsyU3: $this->data = $data; goto gVc9X; K8DOe: $data = ["\153\x65\x79\x77\x6f\x72\x64\x31" => ["\x76\x61\154\x75\145" => $order->snap_name, "\x63\157\x6c\157\162" => "\x23\62\x37\x34\60\x38\x38"], "\x6b\x65\171\x77\157\162\x64\62" => ["\x76\x61\154\x75\x65" => $order->order_no], "\x6b\x65\171\x77\157\x72\144\x33" => ["\x76\141\154\165\x65" => $dt->format("\x59\x2d\155\x2d\144\x20\110\72\x69")], "\x6b\145\171\x77\x6f\162\144\64" => ["\x76\x61\x6c\165\x65" => "\xe9\xa1\272\xe4\270\xb0\xe9\200\237\350\xbf\x90"]]; goto xsyU3; G9yA6: $dt = new \DateTime(); goto K8DOe; gVc9X: } private function getUserOpenID($uid) { goto Hb2GW; kyE0Y: e2xJN: goto Yqr7Z; vmpQ6: if ($user) { goto e2xJN; } goto YzI_K; Yqr7Z: return $user->openid; goto ztgeu; YzI_K: throw new UserException(); goto kyE0Y; Hb2GW: $user = User::get($uid); goto vmpQ6; ztgeu: } }