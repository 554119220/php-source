<?php
 namespace app\api\controller\v1; use app\api\controller\BaseController; use app\api\model\ShareSetting; use app\api\model\User as UserModel; use app\api\model\Collect as CollectModel; use app\api\model\ContentCollect as ContentCollectModel; use app\api\model\Content as ContentModel; use app\api\model\Product as ProductModel; use app\api\service\Product as ProductService; use app\api\service\Token as TokenService; use think\Log; use think\Request; use app\api\model\Coupon as CouponModel; use app\api\model\Order as OrderModel; use app\api\model\PlatformSettings; use app\api\service\Order as OrderService; use app\api\model\Share as ShareModel; class User extends BaseController { public $uid; function __construct(Request $request = null) { goto v6fgv; xU8Z7: UserModel::updateUser(); goto MeGUX; kxwxc: $uid = TokenService::getCurrentUid(); goto KDfW8; v6fgv: parent::__construct($request); goto kxwxc; KDfW8: $this->uid = $uid; goto iB0Rk; iB0Rk: UserModel::checkCoupon(); goto xU8Z7; MeGUX: OrderService::autoConfirm(); goto OD8LY; Q1f8k: ShareModel::checkDistributor(); goto k9mqw; OD8LY: OrderService::autoCancel(); goto Q1f8k; k9mqw: } public function getUserCoupon() { goto X3EXu; X3EXu: $canUseWhere = "\x73\164\x61\164\165\x73\x20\75\x20\61\40\141\x6e\x64\40\151\x73\x5f\165\163\145\40\x3d\x20\x30"; goto UigAh; UigAh: $userCoupon["\143\141\x6e\x5f\165\x73\145"] = CouponModel::getCouponByUid($this->uid, $canUseWhere); goto DvF6G; V321K: $userCoupon["\150\x61\x76\x65\x5f\145\x78\160\x69\x72\145"] = CouponModel::getCouponByUid($this->uid, $haveExpireWhere); goto NHhVY; KiBVN: $userCoupon["\150\141\x76\x65\137\x75\x73\x65"] = CouponModel::getCouponByUid($this->uid, $haveUseWhere); goto JTiSk; NHhVY: return ["\155\x73\147" => "\xe8\216\xb7\345\217\226\346\x88\220\xe5\x8a\237", "\144\x61\164\141" => $userCoupon, "\x65\x72\162\157\162\103\x6f\144\145" => 1]; goto dxxoX; JTiSk: $haveExpireWhere = "\x73\x74\x61\164\165\x73\x20\75\40\60"; goto V321K; DvF6G: $haveUseWhere = "\x69\163\x5f\x75\163\145\40\75\40\x31"; goto KiBVN; dxxoX: } public function getCollectProductAndContent($page = 0, $size = 12) { goto akpxe; IZ9FW: if (!(empty($product) && empty($content))) { goto vcylI; } goto UHn61; MNMgH: $product = ProductModel::where("\x75\156\151\141\143\x69\x64", "\x3d", $this->uniacid)->where($where)->field("\151\x64\54\160\x72\151\143\x65\x2c\157\x5f\160\x72\151\x63\145\54\156\141\x6d\x65\54\x74\x68\x75\x6d\142\54\x73\165\155\155\141\x72\x79\54\151\x73\137\141\164\x74\162")->order("\143\x72\145\141\x74\x65\x5f\x74\151\155\x65", "\x64\145\x73\x63")->paginate($size, true, ["\160\x61\x67\145" => $page]); goto P0PDe; mzB_1: $productId = $product["\144\141\x74\x61"] = $content["\x64\x61\x74\141"] = $contentId = []; goto bXblp; x5fpT: $contentId = implode("\x2c", $contentId); goto LVC9i; XRXaB: foreach ($collect as $key => $value) { $productId[] = $value["\160\162\157\x64\x75\143\x74\x5f\x69\x64"]; AfdlQ: } goto T1FPF; HdSok: $where = "\151\144\x20\x69\156\x28{$productId}\51"; goto IFq4J; T1FPF: qVQOM: goto kM1ch; s5HiI: if (empty($collectContent)) { goto iA5BX; } goto qUJig; Hys72: vcylI: goto jAZQC; jAZQC: $userCollect = ["\155\x73\x67" => "\350\x8e\267\345\x8f\226\346\x88\x90\345\212\x9f", "\x70\162\x6f\x64\x75\143\x74" => $product, "\143\157\x6e\x74\145\156\x74" => $content, "\145\162\162\x6f\162\103\x6f\144\x65" => 1]; goto k8gVB; IFq4J: if (!($productId != '')) { goto He9FE; } goto MNMgH; abFXx: $productId = implode("\x2c", $productId); goto HdSok; DQw4r: V6tF9: goto DrlqC; bXblp: if (empty($collect)) { goto E8cc2; } goto XRXaB; EJz5B: array_unique($contentId); goto x5fpT; LVC9i: if (!($contentId != '')) { goto ClmQw; } goto Vk9hf; P0PDe: if (empty($product)) { goto V6tF9; } goto vXVql; g3WGs: $collectContent = ContentCollectModel::where("\x75\156\x69\x61\x63\151\x64", "\x3d", $this->uniacid)->where(["\x75\x73\x65\x72\137\x69\x64" => $this->uid])->select(); goto mzB_1; akpxe: $collect = CollectModel::where("\x75\156\x69\141\143\x69\x64", "\75", $this->uniacid)->where(["\165\x73\145\x72\137\151\144" => $this->uid])->select(); goto g3WGs; aa5UC: rCQIT: goto EJz5B; UHn61: return ["\x6d\x73\147" => "\xe8\216\267\xe5\x8f\226\345\244\xb1\350\264\xa5", "\145\x72\162\157\x72\103\157\x64\x65" => 0]; goto Hys72; kM1ch: array_unique($productId); goto abFXx; DrlqC: He9FE: goto k1zW2; fyNtu: iA5BX: goto IZ9FW; txCie: $content = ContentModel::where("\165\x6e\x69\141\x63\151\144", "\x3d", $this->uniacid)->where($where)->field("\151\x64\54\x74\x69\164\154\145\54\x6c\151\x6b\x65\x73\x2c\166\x69\x65\167\x73\x2c\163\x6f\162\164\x2c\151\155\141\147\x65\x2c\x63\162\145\141\x74\145\x5f\164\x69\155\x65")->order("\x63\162\x65\x61\x74\145\137\164\151\x6d\145", "\144\x65\x73\143")->paginate($size, true, ["\x70\x61\147\145" => $page]); goto Zqy8u; wpV5K: foreach ($product as $key => $value) { $product[$key]["\x76\x69\160\x5f\x70\162\151\143\145"] = $productService->getProductVipPrice($value["\151\x64"], $value["\160\x72\151\x63\x65"], $value["\151\163\137\141\x74\x74\162"]); A2K9X: } goto jurD5; qUJig: foreach ($collectContent as $key => $value) { $contentId[] = $value["\143\x6f\x6e\x74\145\156\164\x5f\x69\144"]; tw8Tp: } goto aa5UC; jurD5: CigL_: goto DQw4r; Vk9hf: $where = "\151\x64\x20\x69\x6e\50{$contentId}\51"; goto txCie; k8gVB: return $userCollect; goto R6C4b; vXVql: $productService = new ProductService(); goto wpV5K; k1zW2: E8cc2: goto s5HiI; Zqy8u: ClmQw: goto fyNtu; R6C4b: } public function updateUserInfo() { goto B8SGN; QflQ9: if (!($data["\160\x68\x6f\x6e\145"] == '')) { goto V07Ez; } goto oDagB; FIgE7: NnoRb: goto QflQ9; CRBwB: hF5WF: goto NtjsJ; hzRV6: V07Ez: goto n3pMa; B8SGN: $user = UserModel::get($this->uid); goto XZsrG; TponG: goto hF5WF; goto p__1_; zMiIh: $data["\x70\x68\x6f\156\x65"] = input("\x70\150\157\x6e\x65"); goto izLpf; vXuEv: $result = UserModel::update($data); goto RfYpI; izLpf: if (!($data["\x6e\x69\143\x6b\156\141\155\145"] == '')) { goto wGoDH; } goto P2oaF; XZsrG: $data["\x6e\151\x63\x6b\156\x61\x6d\145"] = input("\156\151\x63\153\156\141\155\145"); goto IXWwS; RfYpI: if ($result !== false) { goto hMyOt; } goto QmtTF; b27Ze: return ["\155\163\147" => "\xe4\xbf\xae\xe6\x94\xb9\xe6\210\220\xe5\x8a\x9f", "\x65\x72\162\x6f\162\x43\157\144\x65" => 1]; goto CRBwB; QmtTF: return ["\x6d\163\x67" => "\347\275\221\347\273\234\xe5\xbc\202\345\270\270", "\x65\162\x72\157\x72\103\157\x64\x65" => 0]; goto TponG; oDagB: $data["\160\x68\157\156\x65"] = $user["\x70\150\157\x6e\x65"]; goto hzRV6; V3cmM: if (!($data["\141\x76\x61\x74\141\x72"] == '')) { goto NnoRb; } goto KuCwx; IXWwS: $data["\141\166\141\x74\x61\162"] = input("\x61\166\x61\164\x61\162"); goto zMiIh; p__1_: hMyOt: goto b27Ze; P2oaF: $data["\x6e\x69\x63\x6b\x6e\x61\155\145"] = $user["\156\151\x63\x6b\156\141\x6d\x65"]; goto VsnfD; KuCwx: $data["\141\166\x61\164\141\x72"] = $user["\141\166\x61\164\x61\162"]; goto FIgE7; VsnfD: wGoDH: goto V3cmM; n3pMa: $data["\151\x64"] = $this->uid; goto vXuEv; NtjsJ: } public function getUserInfo() { goto sLvO9; dVyEN: $data = ["\145\x72\162\x6f\x72\x43\x6f\x64\145" => 1, "\x75\163\145\x72\x5f\x69\156\x66\x6f" => $userInfo, "\x6f\162\x64\x65\162\x5f\143\157\165\156\x74" => OrderModel::countUserAllStatus($this->uid), "\160\x6c\x61\x74\x66\x6f\x72\155\x5f\x74\x65\154" => $platform["\x74\145\x6c"], "\143\157\156\x64\x69\x74\x69\x6f\x6e" => $condition, "\163\x68\141\162\x65" => ["\x61\x70\160\154\x79\x5f\x69\x6d\x61\x67\145" => $shareSetting["\x61\160\x70\x6c\171\x5f\151\155\x61\147\145"], "\x77\x69\x74\x68\144\162\x61\x77\x5f\x74\x79\160\x65" => $shareSetting["\167\x69\164\150\x64\x72\x61\167\x5f\x74\171\160\145"]], "\157\162\x64\x65\162\137\x6d\x65\x6e\165" => ["\x73\164\x61\164\165\163\137\x30" => ["\x74\x65\170\164" => "\345\276\205\xe4\xbb\230\346\254\276", "\x69\x63\157\x6e" => $iconRoot . "\x77\141\151\x74\120\x61\171\56\160\x6e\x67"], "\163\x74\x61\164\165\163\137\x31" => ["\164\145\170\164" => "\xe5\276\x85\345\x8f\x91\xe8\xb4\xa7", "\151\143\157\156" => $iconRoot . "\x77\141\151\x74\x53\145\x6e\x64\56\x70\x6e\x67"], "\x73\164\141\164\165\x73\x5f\62" => ["\164\145\170\x74" => "\345\276\205\xe6\x94\xb6\350\xb4\247", "\151\x63\157\x6e" => $iconRoot . "\x77\141\x69\x74\x52\145\x63\145\151\x76\145\56\x70\x6e\147"], "\163\x74\x61\x74\x75\x73\137\63" => ["\x74\145\170\164" => "\345\267\262\345\256\214\346\210\x90", "\x69\x63\157\156" => $iconRoot . "\x6d\x79\x4f\x72\144\x65\x72\x2e\160\156\147"]], "\x73\x65\162\x76\x69\143\x65\x5f\x6d\x65\156\x75" => ["\60" => ["\x69\144" => "\143\x6f\165\160\x6f\156", "\x74\x65\170\164" => "\344\274\x98\xe6\203\240\345\x88\xb8", "\x69\143\157\156" => $iconRoot . "\143\x6f\x75\160\157\x6e\56\x70\x6e\x67", "\154\151\156\153" => "\x2e\56\x2f\x2e\x2e\57\x48\x6f\x6d\145\x2f\143\157\x75\x70\x6f\x6e\57\x63\157\x75\160\157\156\x2f\x63\x6f\x75\160\x6f\156"], "\x31" => ["\x69\144" => "\x69\156\x74\x65\x67\162\141\x6c", "\x74\x65\x78\164" => "\347\247\xaf\345\210\206", "\151\143\157\x6e" => $iconRoot . "\151\156\164\145\x67\x72\x61\154\56\x70\x6e\x67", "\154\151\156\153" => "\56\56\57\56\56\x2f\x55\x73\x65\162\x2f\151\x6e\164\145\147\x72\x61\154\x2f\x69\x6e\164\x65\147\162\x61\154\x5f\x6f\162\x64\x65\162\57\151\156\164\x65\147\x72\141\x6c\x5f\157\x72\x64\145\x72\77\166\151\160\111\x6e\x74\x65\x67\x72\x61\x6c\x3d" . $userInfo["\x69\x6e\164\x65\x67\162\x61\x6c"]], "\x32" => ["\x69\144" => "\166\151\x70", "\164\145\170\x74" => "\xe4\274\232\345\221\230", "\x69\x63\x6f\x6e" => $iconRoot . "\166\x69\160\56\160\156\x67", "\x6c\151\156\153" => "\x2e\x2e\57\56\x2e\57\x55\x73\145\x72\x2f\166\x69\160\57\155\145\155\x62\145\x72\x2f\155\x65\x6d\x62\x65\x72\x3f\x76\151\160\x49\156\x74\145\x67\162\141\x6c\x3d" . $userInfo["\x69\156\164\x65\147\x72\141\x6c"]], "\x33" => ["\151\x64" => "\163\150\x61\x72\145", "\x74\x65\170\164" => "\346\216\xa8\xe5\xb9\xbf\344\270\xad\xe5\277\x83", "\x69\x63\x6f\156" => $iconRoot . "\x73\150\x61\x72\145\137\143\x65\156\164\145\162\56\160\x6e\x67", "\x6c\x69\x6e\x6b" => "\x2e\x2e\57\56\56\x2f\x55\163\x65\162\57\163\150\141\x72\145\x2f\163\x68\x61\x72\x65\x2f\x73\x68\141\162\145"], "\64" => ["\151\x64" => "\x61\x64\x64\x72\145\163\x73", "\164\x65\x78\164" => "\xe5\234\260\345\x9d\200", "\x69\143\x6f\156" => $iconRoot . "\x61\144\144\162\145\x73\163\56\x70\156\147", "\x6c\x69\x6e\153" => "\56\56\x2f\x2e\56\x2f\x48\157\x6d\x65\x2f\x61\x64\x64\x72\145\163\x73\57\141\144\x64\162\145\x73\163"], "\65" => ["\151\144" => "\x63\x75\x73\164\x6f\155\145\162", "\x74\145\x78\x74" => "\345\256\xa2\xe6\x9c\215", "\151\x63\157\156" => $iconRoot . "\x63\165\x73\x74\x6f\155\x2e\x70\156\147", "\154\x69\156\x6b" => '']]]; goto XSVNi; XK0ow: $condition = $shareSetting["\x64\151\x73\x74\x72\151\142\x75\164\157\162\137\x63\x6f\x6e\x64\x69\164\x69\x6f\x6e"]; goto EXkqp; UiEOe: $condition = 0; goto MOD77; sLvO9: $platform = PlatformSettings::where(["\165\x6e\x69\x61\143\151\x64" => session("\x75\x6e\x69\141\143\x69\x64")])->find(); goto xRyFS; MOD77: L2ip8: goto sEWiK; pZDMv: if (empty($shareSetting) || $shareSetting["\x73\167\x69\x74\143\x68"] == 0) { goto qLPCV; } goto XK0ow; EXkqp: goto L2ip8; goto krkyX; sEWiK: $iconRoot = WE7_PATH . "\160\165\142\154\151\143\57\167\170\x61\160\160\57\151\155\141\x67\145\163\57\165\x73\145\x72\x2f"; goto NWPBd; XSVNi: return $data; goto qd0Md; NWPBd: $userInfo = UserModel::userInfo(); goto dVyEN; xRyFS: $shareSetting = ShareSetting::where(["\165\156\151\141\x63\151\144" => session("\165\x6e\x69\141\143\x69\144")])->find(); goto pZDMv; krkyX: qLPCV: goto UiEOe; qd0Md: } }