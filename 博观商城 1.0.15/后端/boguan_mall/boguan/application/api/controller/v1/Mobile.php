<?php
 namespace app\api\controller\v1; use app\api\controller\BaseController; use app\api\model\UserAccess as UserAccessModel; use app\api\model\Order as OrderModel; use app\api\model\OrderRefund; use app\boguan\model\WxTemplate; use app\boguan\controller\SendMessage; use app\api\model\PickPoint as PickPointModel; use app\api\service\Token as TokenService; use app\api\model\User as UserModel; use app\lib\exception\DefaultException; use think\db\exception\DataNotFoundException; use think\db\exception\ModelNotFoundException; use think\exception\DbException; use think\Request; use app\api\model\Express as ExpressModel; use app\api\model\RefundAddress; use app\api\service\Wechat as WechatService; use app\boguan\model\PlatformSettings; use app\boguan\model\IntegralDetail; use app\api\service\Printer as PrinterService; class Mobile extends BaseController { public $user; public function __construct(Request $request = null) { goto Z3FKd; TLQMt: if (!($this->user["\x69\x73\137\155\x6f\x62\151\154\x65"] != 1)) { goto TiT6K; } goto YUV5O; ykrNn: $this->user = $user; goto TLQMt; DJP5G: $user = UserModel::get($uid); goto ykrNn; Z3FKd: parent::__construct($request); goto dFP7T; YUV5O: throw new DefaultException(["\155\163\x67" => "\346\202\250\xe4\270\215\xe6\x98\xaf\xe6\211\213\346\x9c\xba\347\256\241\xe7\x90\206\xe5\x91\230", "\x65\162\x72\157\x72\x63\157\x64\145" => 0]); goto gzq3R; dFP7T: $uid = TokenService::getCurrentUid(); goto DJP5G; gzq3R: TiT6K: goto LMZOe; LMZOe: } public function getIndexData() { goto RSS4r; t6zDU: $visit = UserAccessModel::where(["\165\x6e\151\141\x63\x69\144" => session("\165\x6e\x69\x61\143\x69\144")])->where("\143\x72\x65\x61\x74\145\x5f\164\x69\x6d\x65", "\x62\x65\x74\167\x65\145\x6e\x20\x74\x69\x6d\145", [$date . "\x20\60\60\x3a\x30\60\72\x30\x30", $date . "\40\x32\63\x3a\65\x39\72\x35\x39"])->count(); goto FDOGt; jNPXc: $wait_refund = OrderRefund::where(["\165\x6e\x69\x61\143\x69\144" => session("\165\156\x69\x61\143\151\144"), "\x69\x73\137\144\x65\x6c\x65\x74\x65" => 0])->where("\163\164\x61\x74\165\x73\x20\75\x20\x30\40\x6f\x72\x20\163\x74\141\x74\165\x73\x20\x3d\x20\61")->count(); goto GMzky; RSS4r: $date = date("\131\55\155\55\x64"); goto t6zDU; OCgbT: $today_order = OrderModel::where(["\x75\156\151\141\143\x69\144" => session("\165\x6e\x69\141\x63\x69\x64"), "\x69\x73\x5f\144\x65\x6c\x65\x74\x65" => 0, "\151\x73\137\143\141\x6e\x63\145\154" => 0])->where("\x73\x74\x61\164\165\x73\40\75\x20\61\40\x6f\162\x20\x73\x74\141\x74\165\x73\x20\75\x20\62")->where("\x63\x72\145\141\164\145\x5f\164\x69\155\145", "\x62\x65\164\167\x65\x65\x6e\40\x74\x69\155\x65", [$date . "\40\60\x30\72\60\60\x3a\60\x30", $date . "\x20\62\63\72\x35\71\x3a\x35\x39"])->count(); goto cPoLZ; AEbcv: return ["\x64\141\x74\x61" => $data, "\145\x72\162\x6f\x72\103\157\x64\x65" => 1]; goto Dnd4U; cPoLZ: $wait_send = OrderModel::where(["\165\x6e\x69\141\143\151\x64" => session("\165\x6e\151\141\143\x69\x64"), "\151\163\x5f\144\145\x6c\145\x74\x65" => 0, "\x69\163\137\x63\x61\156\143\145\154" => 0, "\163\x74\x61\164\165\x73" => 1, "\x69\163\x5f\x73\x65\156\x64" => 0])->count(); goto jNPXc; FDOGt: $today_pay = OrderModel::where(["\165\156\151\x61\143\x69\x64" => session("\165\x6e\x69\141\143\151\144"), "\151\163\137\x64\x65\x6c\x65\x74\x65" => 0, "\151\x73\137\143\x61\156\143\x65\154" => 0])->where("\163\164\x61\x74\x75\x73\40\75\40\x31\x20\157\162\40\x73\x74\x61\164\x75\x73\x20\75\x20\x32\40\157\x72\40\x73\x74\x61\x74\165\163\x20\x3d\40\63")->where("\143\x72\x65\141\x74\x65\137\164\151\x6d\145", "\142\x65\164\167\145\x65\x6e\x20\164\x69\x6d\x65", [$date . "\x20\60\60\x3a\x30\x30\72\x30\60", $date . "\x20\x32\x33\72\65\71\x3a\65\x39"])->sum("\x6f\x5f\141\x6d\x6f\165\x6e\164"); goto OCgbT; GMzky: $data = ["\x76\151\163\x69\164" => $visit, "\164\x6f\x64\141\x79\x5f\x70\x61\171" => $today_pay ? $today_pay : "\60\x2e\60\x30", "\164\x6f\144\141\x79\x5f\157\162\x64\x65\162" => $today_order, "\167\x61\x69\x74\x5f\x73\x65\x6e\x64" => $wait_send, "\x77\x61\151\x74\137\x72\x65\x66\x75\156\144" => $wait_refund]; goto AEbcv; Dnd4U: } public function getOrderList($kind = '', $page = 0, $size = 12) { goto Dh_j5; lsReM: if (!($kind == '' || !in_array($kind, $kinds))) { goto f1opy; } goto DMHnV; KbQkv: wtr7k: goto zFeu3; F_IQj: $where = "\x73\x74\141\164\x75\163\40\x3d\x20\60"; goto Ls99K; vWOgq: return ["\155\163\147" => "\xe6\x9a\x82\xe6\227\240\346\x95\xb0\xe6\215\256", "\x65\x72\x72\157\162\x43\157\144\x65" => 0]; goto AQniq; TwcZ6: goto c4tFC; goto fk8iP; KAax3: UVTJY: goto jS4Lm; y3Y0N: c4tFC: goto gqc_q; XP0uY: if (!$order->isEmpty()) { goto QIlDR; } goto vWOgq; jX5C3: return ["\144\x61\x74\141" => $order, "\x65\162\162\157\162\x43\157\x64\x65" => 1]; goto sjPqd; Z8lt2: goto c4tFC; goto KbQkv; o_3aj: $where = 1; goto TwcZ6; gqc_q: $order = OrderModel::where(["\x75\156\x69\x61\x63\151\x64" => session("\x75\156\151\141\x63\151\x64"), "\151\163\x5f\144\x65\154\x65\164\x65" => 0, "\x69\x73\137\143\x61\156\143\x65\x6c" => 0])->where($where)->order("\143\162\x65\141\x74\145\137\x74\x69\155\145", "\x64\x65\163\143")->paginate($size, false, ["\x71\x75\145\x72\x79" => $page]); goto XP0uY; DqA63: goto c4tFC; goto KAax3; Dh_j5: $kinds = ["\141\154\x6c", "\167\141\151\164", "\163\x65\156\x64", "\x63\x6f\156\x66\151\162\155", "\143\x6f\155\160\154\145\x74\145\x64", "\141\x66\x74\145\x72"]; goto lsReM; zFeu3: $where = "\x69\163\x5f\143\x6f\x6e\146\x69\162\x6d\40\75\40\61\x20\x61\156\x64\x20\x73\x74\141\164\165\x73\x20\75\40\x33"; goto y3Y0N; fk8iP: i4rbW: goto F_IQj; jS4Lm: $where = "\x69\x73\x5f\143\157\156\146\x69\x72\x6d\x20\x3d\x20\60\x20\x61\156\144\x20\151\x73\137\x73\x65\156\x64\40\x3d\40\x31\x20\141\156\144\x20\x73\164\141\164\x75\163\x20\75\40\62"; goto Z8lt2; XWs7w: if ($kind == "\x73\x65\x6e\x64") { goto uxHbm; } goto U99ym; Ls99K: goto c4tFC; goto YVBFx; U99ym: if ($kind == "\x63\x6f\x6e\146\151\x72\155") { goto UVTJY; } goto VxmgT; VxmgT: if ($kind == "\143\157\155\160\x6c\x65\164\x65\144") { goto wtr7k; } goto o_3aj; jaV6c: f1opy: goto D0hTi; YVBFx: uxHbm: goto vF4bn; AQniq: QIlDR: goto jX5C3; D0hTi: if ($kind == "\x77\141\x69\x74") { goto i4rbW; } goto XWs7w; DMHnV: return ["\155\x73\147" => "\xe7\xb1\xbb\345\x9e\213\351\224\231\xe8\257\xaf", "\x65\162\162\x6f\162\103\x6f\x64\x65" => 0]; goto jaV6c; vF4bn: $where = "\x73\164\141\x74\x75\x73\x20\x3d\40\61\x20\x61\156\x64\40\151\x73\x5f\x73\145\x6e\x64\x20\x3d\x20\x30"; goto DqA63; sjPqd: } public function searchOrder($keyword = '', $page = 0, $size = 12) { goto j6m0K; dZKzq: return ["\x6d\163\x67" => "\xe5\205\263\351\224\256\xe8\257\215\344\xb8\215\xe8\x83\xbd\xe4\xb8\272\xe7\xa9\272", "\x65\x72\162\x6f\x72\103\x6f\144\145" => 0]; goto ZJW6u; QGqSb: goto bNFnC; goto a6k7M; vvVRA: return ["\x6d\163\x67" => "\xe6\232\x82\xe6\227\240\xe6\225\xb0\346\215\xae", "\144\141\x74\141" => [], "\145\162\x72\x6f\x72\x43\x6f\144\x65" => 0]; goto QGqSb; sBy8U: return ["\155\163\147" => "\xe8\216\267\345\x8f\x96\346\x88\220\345\x8a\237", "\144\x61\164\141" => $order, "\145\x72\x72\157\x72\103\x6f\x64\145" => 1]; goto l6Gs6; j6m0K: if ($keyword) { goto WjKMu; } goto dZKzq; I2Ts3: $order = OrderModel::where(["\x75\x6e\x69\x61\143\151\x64" => session("\165\156\x69\141\x63\151\x64"), "\151\x73\137\144\145\154\x65\164\x65" => 0, "\x69\163\137\x63\x61\x6e\143\145\x6c" => 0])->where("\x6f\x6c\x64\x5f\157\x72\x64\145\162\137\156\157\x7c\165\x73\x65\162\151\156\x66\x6f\174\163\156\x61\x70\x5f\x69\156\146\157", "\x6c\x69\x6b\x65", "\x25{$keyword}\x25")->order("\143\162\145\x61\x74\145\137\164\x69\155\145", "\x64\x65\x73\143")->paginate($size, false, ["\161\x75\145\162\x79" => $page]); goto Ejbdy; ZJW6u: WjKMu: goto I2Ts3; Ejbdy: if (!$order->isEmpty()) { goto ZG_ls; } goto vvVRA; l6Gs6: bNFnC: goto Z3Kvw; a6k7M: ZG_ls: goto sBy8U; Z3Kvw: } public function delivery() { goto NTD12; LBu_x: $printer_type = ''; goto Au_D4; WggHv: return ["\x6d\x73\x67" => "\350\257\267\350\xbe\x93\xe5\x85\xa5\xe5\xbf\253\351\200\222\xe5\x8d\x95\xe5\217\xb7", "\x65\162\162\x6f\x72\103\x6f\x64\x65" => 0]; goto zYL36; CWkIF: return ["\155\163\147" => "\xe6\x93\x8d\344\xbd\x9c\345\244\261\350\264\xa5\357\274\x8c\xe8\xaf\267\xe7\250\215\345\x80\231\345\206\215\350\257\225", "\x65\x72\162\x6f\162\103\157\144\145" => 0]; goto JUEbA; F1evP: if (!($order["\151\163\137\163\x65\x6e\144"] == 1)) { goto BD7d9; } goto EC5IC; qNts7: return ["\x6d\163\147" => "\xe6\x95\260\346\x8d\256\345\xbc\202\345\270\xb8\357\xbc\x8c\xe8\257\xb7\347\xa8\x8d\xe5\200\231\345\206\215\xe8\257\225", "\145\162\162\157\162\x43\157\144\145" => 0]; goto JRzH1; y8Eri: $order = OrderModel::get($data["\157\x72\x64\x65\162\111\144"]); goto wi3rm; GPXaQ: $keyword2 = "\xe6\227\xa0\xe9\x9c\200\xe7\211\xa9\346\265\x81"; goto d8jhC; X2K0e: return ["\x6d\x73\x67" => "\350\257\xb7\351\200\x89\346\213\251\345\x8f\221\xe8\264\xa7\346\226\xb9\xe5\xbc\x8f\344\xb8\xba\346\x97\xa0\xe9\x9c\x80\347\x89\251\346\xb5\201", "\145\x72\162\x6f\x72\x43\x6f\144\x65" => 0]; goto TAo09; CPOtd: $keyword2 = "\345\210\xb0\xe5\xba\227\xe8\x87\xaa\xe6\217\220"; goto Z_SRi; JRzH1: FnVSf: goto F1evP; PcYeq: PpbIU: goto KEMLJ; lIfm3: goto k6lbW; goto fiM1_; q0DpX: goto PpbIU; goto vbLHz; HZ22k: $printer_type = "\143\157\x6e\x66\x69\x72\155"; goto PcYeq; JTIAh: goto xRblT; goto EM0zt; tIGqd: $printer->printReceiptAtPaid($order["\x69\144"], $printer_type); goto nsrmL; ymS7B: BUf1W: goto SdcTE; jvBZs: $orderPost["\x73\x65\156\x64\137\x74\171\160\x65"] = 1; goto O4PxV; dkQBk: $sendData = ["\x74\160\x6c\x49\144" => $template, "\x70\x72\145\x70\141\171\x5f\151\x64" => $order["\x70\162\145\160\x61\171\137\151\x64"], "\165\151\x64" => $order["\x75\x73\145\x72\137\151\144"], "\x6b\145\x79\167\157\x72\x64\x31" => $order["\x73\x6e\141\x70\x5f\x6e\141\x6d\x65"], "\153\145\x79\x77\157\162\144\62" => $keyword2, "\153\145\x79\x77\157\x72\x64\63" => $keyword3]; goto ToLjU; TAo09: oORfG: goto zNKxY; CQ0fm: $orderPost["\145\170\x70\162\145\x73\163\x5f\156\157"] = $data["\145\170\160\x72\x65\x73\x73\x4e\157"]; goto jvBZs; wJC5I: if ($order["\x6f\x72\x64\145\162\137\x74\x79\x70\x65"] == 1) { goto auPhM; } goto XFwh2; Au_D4: goto PpbIU; goto Xo8rf; mEsf0: $send->sendTplMessage($sendData, "\57" . MODEL . "\x2f\x70\141\x67\145\x73\x2f\125\163\145\x72\57\157\162\144\x65\162\x2f\x6f\x72\x64\x65\x72\x2f\x6f\x72\144\x65\162"); goto Bg40k; ToLjU: $send = new SendMessage(); goto mEsf0; JUEbA: goto tPvtV; goto ymS7B; KEMLJ: $res = OrderModel::update($orderPost); goto hWWsO; zYL36: b6GxJ: goto dRTVY; Z_SRi: $pickId = $order["\x70\151\143\x6b\x5f\151\x6e\x66\157"]["\160\x69\x63\153\111\144"]; goto gcMVu; EZ9Zx: $wxTemplate = new WxTemplate(); goto J9v9S; EC5IC: return ["\155\x73\147" => "\350\257\xa5\xe8\xae\xa2\345\x8d\x95\345\xb7\262\xe5\x8f\x91\350\264\xa7", "\145\162\162\x6f\x72\x43\157\144\145" => 0]; goto RqE2O; hWWsO: if ($res !== false) { goto BUf1W; } goto CWkIF; XFwh2: if ($order["\157\x72\144\145\x72\137\x74\x79\x70\145"] == 2) { goto iItDM; } goto jfoK2; TFJM1: return ["\155\163\147" => "\xe8\257\xb7\351\x80\x89\xe6\x8b\xa9\xe8\256\242\xe5\x8d\225", "\x65\162\x72\x6f\x72\x43\x6f\x64\x65" => 0]; goto PzGX0; NWPnZ: if (!(!isset($data["\x74\x79\160\x65"]) || $data["\x74\x79\x70\145"] == '')) { goto Hf7jG; } goto SSXPE; nsrmL: T92M2: goto z4JxA; rjxI3: if (!($printer_type != '')) { goto T92M2; } goto e0G9e; IfAs6: Hf7jG: goto y8Eri; O4PxV: $keyword2 = $data["\145\x78\160\162\145\163\163"]; goto F0Uv3; GgrCS: if (!(!isset($data["\145\170\x70\x72\x65\x73\163\116\x6f"]) || $data["\145\x78\160\x72\x65\163\163\116\157"] == '')) { goto b6GxJ; } goto WggHv; Xo8rf: auPhM: goto QwUr2; dRTVY: $orderPost["\x65\170\x70\162\x65\x73\x73"] = $data["\145\170\160\x72\145\163\163"]; goto CQ0fm; e0G9e: $printer = new PrinterService(); goto tIGqd; gcMVu: $pickPoint = PickPointModel::get($pickId); goto ac_JL; SdcTE: $template = $wxTemplate->getTemplateById("\x41\x54\x30\x30\60\x37"); goto R1Xtz; JZ_Z0: $orderPost["\163\145\156\144\x5f\x74\x79\160\145"] = 3; goto njR2t; R1Xtz: if (!($template && $order["\x70\x72\145\160\x61\171\x5f\151\x64"] && $order["\151\163\x5f\163\x65\156\x64"] == 0 && $order["\x73\164\x61\x74\165\x73"] == 1)) { goto ufGHB; } goto dkQBk; mE_7f: $keyword3 = "\xe8\257\xa5\350\xae\242\345\x8d\x95\xe7\x94\261\xe5\x95\206\xe5\256\xb6\xe8\207\xaa\350\xa1\x8c\351\205\x8d\xe9\x80\x81\357\274\214\xe9\242\204\xe8\256\xa1\xe9\x80\x81\350\xbe\276\xe6\227\xb6\xe9\227\264\xef\xbc\232" . $order["\x64\145\x6c\x69\166\x65\x72\x79\137\164\151\x6d\145"] . "\357\274\x8c\xe8\257\267\346\263\250\xe6\204\217\xe6\237\xa5\346\224\266\343\x80\x82"; goto HZ22k; uU5sE: $orderPost["\x69\163\x5f\x73\x65\156\144"] = 1; goto jYNzb; PWQvN: if (!(!isset($data["\x65\170\160\162\x65\x73\x73"]) || $data["\x65\170\x70\x72\x65\x73\x73"] == '')) { goto VF9Dl; } goto bwupJ; A5rqU: VF9Dl: goto GgrCS; Bg40k: ufGHB: goto rjxI3; jfoK2: if (!($sendType != "\x32")) { goto oORfG; } goto X2K0e; vbLHz: iItDM: goto JZ_Z0; fiM1_: P4JLp: goto LIrw0; LIrw0: $keyword3 = "\xe5\x95\x86\xe5\256\266\xe5\xb7\xb2\xe5\xa4\x87\xe5\xa5\275\xe8\xb4\xa7\357\xbc\214\xe8\xaf\xb7\345\234\250\346\x8f\x90\350\xb4\xa7\346\227\xb6\351\x97\xb4\xef\274\232" . $order["\160\151\x63\x6b\137\x74\151\155\145"] . "\xe5\x86\x85\xe5\210\xb0\xe8\x87\xaa\346\217\x90\347\x82\xb9\346\217\220\350\xb4\247\xe3\x80\202"; goto fKwPh; SSXPE: return ["\x6d\x73\x67" => "\xe8\xaf\xb7\351\x80\x89\xe6\213\xa9\xe4\270\x80\347\247\215\345\x8f\x91\350\264\xa7\346\x96\271\xe5\xbc\217", "\x65\162\162\x6f\x72\103\x6f\x64\145" => 0]; goto IfAs6; d8jhC: $keyword3 = "\xe6\x97\240\xe9\x9c\x80\xe7\x89\xa9\346\265\201"; goto JTIAh; hiqgz: $orderPost["\151\x64"] = $order->id; goto uU5sE; RqE2O: BD7d9: goto EZ9Zx; EM0zt: w3aTN: goto PWQvN; fKwPh: k6lbW: goto LBu_x; NTD12: $data = input("\x70\x6f\x73\164\56"); goto wOtJl; mDuHD: $keyword3 = "\345\225\x86\xe5\xae\266\xe5\xb7\xb2\345\244\207\xe5\245\xbd\xe8\xb4\xa7\xef\xbc\214\xe8\257\267\xe5\260\xbd\xe5\xbf\xab\345\210\260\350\207\252\xe6\x8f\x90\347\202\271\346\217\220\xe8\264\247\343\200\x82"; goto lIfm3; Vxf9o: $orderPost["\143\x6c\x65\x72\x6b\137\x74\151\x6d\145"] = time(); goto CPOtd; PzGX0: JqKJ5: goto NWPnZ; DCm35: $orderPost["\163\x65\x6e\x64\137\x74\x79\x70\145"] = 2; goto GPXaQ; Vbr65: tPvtV: goto rjum1; z4JxA: return ["\x6d\163\147" => "\xe5\217\x91\xe8\xb4\xa7\xe6\210\x90\xe5\212\x9f", "\145\x72\x72\x6f\x72\103\x6f\144\x65" => 1]; goto Vbr65; QqDhC: $printer_type = "\163\145\156\144"; goto q0DpX; wOtJl: if (!(!isset($data["\157\162\144\x65\162\x49\x64"]) || $data["\157\x72\x64\x65\x72\111\144"] == '')) { goto JqKJ5; } goto TFJM1; zNKxY: $orderPost["\x73\145\156\x64\x5f\164\171\x70\x65"] = 2; goto Vxf9o; VC1ZX: $orderPost["\x73\164\x61\164\165\x73"] = 2; goto wJC5I; njR2t: $keyword2 = "\345\225\206\xe5\256\266\xe9\205\215\351\200\x81"; goto mE_7f; QwUr2: if ($sendType == "\61") { goto w3aTN; } goto DCm35; J9v9S: $sendType = $data["\x74\171\x70\145"]; goto hiqgz; jYNzb: $orderPost["\x73\x65\x6e\144\x5f\164\x69\155\145"] = time(); goto VC1ZX; wi3rm: if (!empty($order)) { goto FnVSf; } goto qNts7; ac_JL: if ($pickPoint["\x69\163\x5f\x70\x69\x63\x6b"] == 1) { goto P4JLp; } goto mDuHD; c4c4o: xRblT: goto QqDhC; F0Uv3: $keyword3 = $data["\x65\170\x70\162\145\163\163\116\x6f"]; goto c4c4o; bwupJ: return ["\155\163\147" => "\350\xaf\xb7\xe9\x80\x89\xe6\x8b\251\xe5\xbf\xab\xe9\x80\x92\345\x85\254\xe5\217\270", "\145\x72\162\x6f\x72\x43\157\x64\145" => 0]; goto A5rqU; rjum1: } public function express() { goto vRf7h; vRf7h: $express = ExpressModel::where(["\x69\163\137\144\x65\x6c\145\164\x65" => 0])->order("\163\157\162\x74", "\144\145\x73\143")->select(); goto eXVVd; qwNCE: goto HWiIx; goto iK2a3; qSzmg: return ["\x6d\163\147" => "\350\x8e\267\xe5\217\226\346\x88\220\xe5\212\237", "\144\141\164\x61" => $express, "\145\162\162\157\162\103\157\144\145" => 1]; goto VmSXk; eXVVd: if (!$express->isEmpty()) { goto HrtqW; } goto h_2eZ; iK2a3: HrtqW: goto qSzmg; h_2eZ: return ["\x6d\x73\x67" => "\xe6\x9a\x82\xe6\x97\240\346\x95\260\xe6\x8d\256", "\144\x61\164\x61" => [], "\x65\x72\162\157\x72\103\157\144\x65" => 0]; goto qwNCE; VmSXk: HWiIx: goto B63Iz; B63Iz: } public function orderRefundList($type = '', $page = 0, $size = 12) { goto Nhls5; ysF11: $where = "\163\164\141\x74\165\163\x20\75\x20\60\40\157\x72\x20\x28\151\163\x5f\165\x73\145\x72\x5f\163\145\156\x64\x20\x3d\x20\x31\40\x61\156\x64\x20\163\x74\141\x74\165\163\x20\x3d\x20\x31\51"; goto R0zF7; m8lk4: if ($type == "\142\x75\171\145\162") { goto O9Nxq; } goto WA7TG; l9pi1: $order = OrderModel::where(["\165\x6e\151\141\x63\x69\x64" => session("\x75\156\151\x61\x63\x69\144"), "\x69\163\137\144\145\154\145\x74\145" => 0, "\x69\163\137\143\141\x6e\143\145\154" => 0])->where($wheres)->order("\x63\x72\x65\x61\164\x65\x5f\x74\x69\x6d\x65", "\144\145\163\x63")->paginate($size, false, ["\x71\x75\x65\162\x79" => $page]); goto RW8co; OUPQN: p0DXa: goto Dh6c_; WA7TG: if ($type == "\162\145\x66\x75\156\144") { goto ljkxH; } goto xxda3; jn_zV: if (empty($refundIds)) { goto Ocl71; } goto PSndj; hNadq: return ["\155\x73\147" => "\346\232\x82\346\227\240\346\225\xb0\346\x8d\256", "\144\141\164\x61" => [], "\145\162\x72\x6f\162\x43\157\x64\x65" => 0]; goto zqo7o; CLQ_7: O9Nxq: goto opupF; XRMER: goto AScHz; goto WsmSr; Kgu5j: foreach ($refund as $key => $value) { $refundIds[] = $value["\x6f\x72\144\145\162\137\x69\144"]; t2gDl: } goto OUPQN; j89n9: $where = "\163\x74\141\164\165\163\40\x3d\40\x32"; goto vwutk; RW8co: Ocl71: goto BcRFE; EXYmW: $refundIds = []; goto Kgu5j; nsubo: $ids = implode("\54", $ids); goto ljp8O; ZnJaq: return ["\x6d\163\x67" => "\346\232\202\346\x97\xa0\xe6\x95\260\346\x8d\256", "\x64\141\164\141" => [], "\145\162\x72\x6f\162\103\x6f\144\x65" => 0]; goto ntTe7; BcRFE: if (!$order->isEmpty()) { goto V423q; } goto ZnJaq; Nhls5: if ($type == "\163\145\154\154\145\x72") { goto e5YWx; } goto m8lk4; opupF: $where = "\x73\x74\x61\164\165\163\40\75\x20\x31\x20\141\x6e\144\x20\151\x73\x5f\x75\163\145\x72\137\x73\145\x6e\x64\x20\x3d\40\x30"; goto WfBHJ; ntTe7: V423q: goto QtC8Y; ljp8O: $wheres = "\x69\144\40\x69\156\50{$ids}\51"; goto l9pi1; WfBHJ: goto AScHz; goto cyh8K; Dh6c_: $order = []; goto jn_zV; PSndj: $ids = array_unique($refundIds); goto nsubo; vwutk: AScHz: goto G8VIt; R0zF7: goto AScHz; goto CLQ_7; QtC8Y: return ["\x6d\163\x67" => "\350\216\xb7\xe5\217\x96\346\x88\x90\xe5\x8a\x9f", "\x64\141\164\141" => $order, "\x65\162\x72\157\x72\x43\x6f\x64\145" => 1]; goto LxbY4; zqo7o: y68xz: goto EXYmW; WsmSr: e5YWx: goto ysF11; cyh8K: ljkxH: goto j89n9; tHf7D: if (!$refund->isEmpty()) { goto y68xz; } goto hNadq; G8VIt: $refund = OrderRefund::where(["\165\x6e\x69\141\143\151\144" => session("\165\156\x69\x61\x63\x69\144"), "\151\x73\x5f\x64\145\154\x65\164\145" => 0])->where($where)->select(); goto tHf7D; xxda3: $where = 1; goto XRMER; LxbY4: } public function orderRefundDetail() { goto paKc7; nIKKX: $refundAddress = RefundAddress::where(["\165\x6e\151\141\143\151\x64" => session("\x75\x6e\x69\141\143\x69\x64"), "\x73\x74\x61\x74\x75\163" => 1])->order("\143\x72\x65\141\164\145\137\x74\151\x6d\145", "\x64\x65\163\143")->field("\x69\x64\54\141\x64\144\162\x65\163\x73")->select(); goto Mr1wo; gxjFX: wGDbQ: goto hYSZF; NPKqe: if (!empty($refund)) { goto u4oIu; } goto bFedn; paKc7: $data = input("\160\157\x73\x74\x2e"); goto GJ2uA; V6yjz: $refund = OrderRefund::getOrderRefundByData($data); goto NPKqe; Mr1wo: $refund["\141\x64\x64\162\145\163\163\137\154\151\x73\164"] = $refundAddress; goto XGhvp; z29tF: u4oIu: goto nIKKX; hYSZF: if (!(!isset($data["\x6f\162\x64\x65\x72\x49\144"]) || $data["\x6f\162\x64\x65\162\111\x64"] == '' || !isset($data["\160\162\157\x64\x75\x63\164\x49\x64"]) || $data["\160\162\157\x64\x75\143\x74\x49\144"] == '' || !isset($data["\141\x74\164\x72\137\151\144\137\154\151\x73\164"]))) { goto Nf13X; } goto gldOz; GJ2uA: if (!empty($data)) { goto wGDbQ; } goto gZaBc; bFedn: return ["\x6d\163\x67" => "\xe6\232\202\346\227\240\346\225\260\xe6\x8d\xae", "\144\x61\164\141" => [], "\145\162\x72\x6f\162\x43\x6f\x64\x65" => 0]; goto z29tF; gZaBc: return ["\155\x73\x67" => "\xe8\xaf\267\351\200\211\346\213\251\xe9\200\x80\xe6\xac\xbe\xe8\256\242\345\215\225", "\x65\x72\x72\x6f\162\x43\x6f\144\x65" => 0]; goto gxjFX; XGhvp: return ["\x6d\163\x67" => "\350\216\xb7\345\217\x96\xe6\210\x90\345\212\237", "\144\x61\164\x61" => $refund, "\x65\x72\162\x6f\162\103\x6f\x64\145" => 1]; goto Brf4O; JnKjd: Nf13X: goto V6yjz; gldOz: return ["\x6d\x73\x67" => "\xe5\x8f\202\346\x95\260\xe9\x94\231\xe8\257\xaf", "\x65\x72\162\x6f\x72\103\x6f\144\x65" => 0]; goto JnKjd; Brf4O: } public function refuseRefundApply($refundId = 0) { goto V__t7; TzhKe: goto I_UVA; goto So57s; Im3f1: $wxTemplate = new WxTemplate(); goto ExLuU; h2K2y: return ["\155\x73\147" => "\xe8\xaf\267\351\200\x89\xe6\x8b\251\350\246\201\xe6\x93\215\344\275\234\xe7\232\204\xe9\200\x80\xe6\254\xbe\xe8\xae\242\345\215\x95", "\x65\162\x72\x6f\162\103\x6f\x64\145" => 0]; goto S2hL2; m52vo: $data["\162\x65\146\165\x73\145\137\x74\x69\155\145"] = time(); goto rIoKu; mVFt8: if (!($template && $refundOrder["\160\x72\x65\x70\141\x79\x5f\151\144"])) { goto q9wRF; } goto j0yVc; zVTR0: I_UVA: goto gNeJN; YhUwz: return ["\x6d\163\x67" => "\350\257\xa5\351\x80\x80\xe6\xac\xbe\350\256\xa2\xe5\x8d\225\xe7\212\xb6\346\200\x81\xe4\270\215\346\x94\257\xe6\214\x81\346\213\x92\xe7\xbb\235", "\x65\x72\x72\x6f\x72\103\157\x64\145" => 0]; goto I2hKr; ou0mR: $send->sendTplMessage($sendData, "\57" . MODEL . "\x2f\x70\x61\147\145\163\x2f\125\163\145\162\57\157\x72\144\x65\162\57\x6f\x72\x64\145\x72\x2f\x6f\x72\x64\x65\x72"); goto guN_V; IMG38: if (!empty($refundOrder)) { goto HS1kY; } goto yeNsV; S2hL2: B8RH2: goto LY1gZ; zSt98: $data["\x73\x74\141\164\165\163"] = 3; goto m52vo; LY1gZ: $refundOrder = OrderRefund::get($refundId); goto IMG38; aDN1R: if (!($refundOrder["\x73\x74\141\x74\165\x73"] != 0)) { goto mKUih; } goto YhUwz; j0yVc: $sendData = ["\164\160\154\x49\144" => $template, "\x70\x72\x65\160\141\171\137\151\144" => $refundOrder["\x70\x72\145\160\x61\171\137\151\144"], "\x75\x69\x64" => $refundOrder["\x75\163\145\x72\137\x69\144"], "\x6b\145\171\x77\x6f\x72\144\61" => $refundOrder["\143\x72\x65\x61\x74\x65\137\164\x69\155\x65"], "\x6b\x65\x79\x77\x6f\162\144\62" => "\xe6\x82\xa8\346\x8f\220\xe4\272\xa4\347\232\204\xe5\x94\xae\xe5\x90\x8e\xe7\224\xb3\xe8\xaf\267\xe5\267\xb2\350\xa2\xab\xe6\x8b\x92\347\xbb\235\357\xbc\x8c\xe8\257\246\xe6\x83\x85\xe8\257\xb7\345\222\250\350\257\242\345\256\xa2\346\x9c\x8d"]; goto Icwdn; rZFQ6: HS1kY: goto aDN1R; guN_V: q9wRF: goto KbS8n; So57s: ce7fi: goto Im3f1; IKIwW: $data["\151\x64"] = $refundId; goto zSt98; I2hKr: mKUih: goto IKIwW; Icwdn: $send = new SendMessage(); goto ou0mR; rIoKu: $result = OrderRefund::update($data); goto VesoT; V__t7: if (!($refundId == 0 || $refundId == '')) { goto B8RH2; } goto h2K2y; yeNsV: return ["\x6d\x73\x67" => "\350\257\245\xe9\x80\x80\xe6\254\276\350\256\242\xe5\x8d\x95\xe4\xb8\x8d\345\255\x98\345\x9c\250", "\x65\x72\162\x6f\x72\103\x6f\x64\x65" => 0]; goto rZFQ6; KbS8n: return ["\x6d\163\x67" => "\346\x8b\222\xe7\273\235\346\x88\x90\345\x8a\237", "\x65\162\162\x6f\x72\103\157\x64\145" => 1]; goto zVTR0; ExLuU: $template = $wxTemplate->getTemplateById("\101\124\x30\x37\63\67"); goto mVFt8; VesoT: if ($result !== false) { goto ce7fi; } goto YYrAM; YYrAM: return ["\155\x73\x67" => "\346\213\222\xe7\xbb\235\xe5\244\261\xe8\264\xa5\357\xbc\214\xe8\xaf\267\347\250\215\xe5\x80\x99\345\x86\x8d\xe8\257\225", "\x65\162\162\x6f\x72\103\157\x64\x65" => 0]; goto TzhKe; gNeJN: } public function agreeRefundApply($refundId = 0, $addressId = 0) { goto OjaUp; Vwz7p: $leftMoney = $this->getRefundOrderLeftMoney($refundOrder["\157\x72\144\x65\162\137\x69\144"], $order["\157\x5f\x61\155\157\165\156\164"]); goto ubecq; G7y7C: if (!($template && $refundOrder["\160\162\x65\160\x61\x79\137\x69\x64"])) { goto fyHyh; } goto A991q; r8CIZ: return ["\155\163\147" => "\xe8\xaf\xa5\350\256\xa2\345\215\225\xe8\277\x98\345\x89\251" . $leftMoney . "\345\x85\x83\345\x8f\xaf\351\x80\x80", "\145\x72\x72\x6f\162\103\157\x64\145" => 0]; goto OQpJO; yZD0P: $data["\x61\147\x72\145\145\x5f\164\151\x6d\145"] = time(); goto g8a1h; U9jDp: if (!($refundId == 0 || $refundId == '')) { goto Jsveb; } goto yWj3O; OqJys: fyHyh: goto Mq28z; jgf8M: $data["\x73\x74\x61\164\165\163"] = 1; goto yZD0P; ttDZe: Jsveb: goto p6uFi; p6uFi: $refundOrder = OrderRefund::get($refundId); goto Y7xr_; TRAaH: if (!empty($address)) { goto xY8_i; } goto eEcf4; qaGBu: return ["\155\x73\147" => "\xe5\x90\x8c\xe6\204\217\xe7\224\xb3\xe8\xaf\267\345\244\xb1\350\xb4\xa5\xef\274\214\350\257\xb7\347\xa8\x8d\345\220\216\xe5\x86\215\350\xaf\x95", "\145\x72\162\157\x72\103\157\x64\x65" => 0]; goto WKzFy; A991q: $sendData = ["\164\160\154\x49\144" => $template, "\x70\162\x65\x70\x61\171\137\151\144" => $refundOrder["\160\162\x65\160\141\171\x5f\151\x64"], "\x75\x69\x64" => $refundOrder["\165\x73\145\x72\137\x69\x64"], "\x6b\x65\x79\167\x6f\x72\144\61" => $refundOrder["\x63\162\145\141\164\145\137\x74\151\x6d\145"], "\153\x65\171\x77\x6f\162\x64\x32" => "\xe6\202\250\xe6\x8f\220\xe4\272\xa4\347\x9a\x84\xe5\224\xae\xe5\220\x8e\xe7\224\263\350\257\xb7\xe5\xb7\262\xe9\200\232\350\xbf\x87\357\274\214\350\257\267\345\260\275\345\xbf\xab\345\xaf\204\345\233\x9e\xe5\225\206\345\223\x81\345\217\x8a\345\xa1\253\345\x86\231\347\211\251\346\265\x81\xe4\xbf\xa1\xe6\201\257"]; goto meDAF; ubecq: if (!($leftMoney <= 0)) { goto q7T3a; } goto EiBu0; NXV5N: q7T3a: goto JJVlI; JJVlI: if (!($refundOrder["\162\x65\x66\165\156\x64\137\160\x72\151\x63\145"] > $leftMoney)) { goto rya_Q; } goto r8CIZ; AqkYj: fuPkq: goto T_bJh; Jr5lX: $data["\x69\144"] = $refundId; goto s9GFF; g8a1h: $result = OrderRefund::update($data); goto kV4jb; CalS1: return ["\x6d\x73\x67" => "\xe9\x80\200\346\xac\xbe\351\207\221\xe9\242\x9d\351\x9c\200\xe5\xa4\247\344\272\216\x30", "\x65\162\x72\157\162\103\x6f\x64\x65" => 0]; goto k8qY_; h7OG6: return ["\155\x73\147" => "\351\x80\x80\xe6\254\276\xe9\207\x91\351\242\x9d\xe4\270\x8d\xe8\203\275\xe5\xa4\247\xe4\272\216\346\x94\xaf\xe4\xbb\230\351\x87\x91\xe9\242\235{$order["\157\137\141\155\x6f\x75\156\164"]}\345\x85\203", "\145\x72\x72\x6f\162\103\x6f\144\x65" => 0]; goto vpSgY; meDAF: $send = new SendMessage(); goto qd8RO; T_bJh: $template = $wxTemplate->getTemplateById("\101\x54\x30\61\71\x37"); goto G7y7C; oJFy_: KSkrE: goto eR1JX; OjaUp: $wxTemplate = new WxTemplate(); goto U9jDp; s5GbS: if (!($refundOrder["\x72\145\x66\x75\x6e\144\137\x70\x72\x69\x63\145"] > $order["\157\x5f\141\x6d\x6f\165\x6e\164"])) { goto H_0UC; } goto h7OG6; RD2Dq: return ["\x6d\163\x67" => "\350\xaf\267\xe9\x80\211\xe6\213\xa9\346\x94\xb6\350\xb4\xa7\345\x9c\xb0\xe5\x9d\x80", "\145\162\x72\x6f\x72\x43\157\x64\x65" => 0]; goto cz9jc; oSSm1: $data["\x72\x65\146\165\x6e\144\137\141\x64\x64\x72\x65\163\x73"] = $address["\141\x64\144\162\x65\163\163"]; goto jgf8M; OvtQx: xY8_i: goto H9RfY; yWj3O: return ["\x6d\163\147" => "\350\xaf\xb7\351\200\211\346\213\xa9\350\246\201\xe6\223\215\xe4\275\234\347\232\204\xe9\x80\x80\346\xac\276\xe8\xae\xa2\xe5\x8d\225", "\145\162\162\157\x72\103\x6f\144\x65" => 0]; goto ttDZe; Y7xr_: if (!($refundOrder["\162\x65\x66\165\156\144\x5f\x70\162\x69\143\x65"] <= 0)) { goto jX6In; } goto CalS1; vpSgY: H_0UC: goto Vwz7p; D1QFm: $address = RefundAddress::get($addressId); goto TRAaH; Mq28z: return ["\x6d\x73\x67" => "\xe5\x90\x8c\xe6\x84\217\xe7\x94\xb3\350\xaf\267\xe6\210\220\xe5\x8a\237", "\145\162\162\157\162\x43\x6f\144\x65" => 1]; goto oJFy_; WKzFy: goto KSkrE; goto AqkYj; gPndL: if (!($addressId == 0 || $addressId == '')) { goto cOpOZ; } goto RD2Dq; EiBu0: return ["\x6d\163\147" => "\xe8\xaf\245\350\256\xa2\xe5\x8d\225\347\232\204\346\x94\xaf\xe4\273\x98\351\x87\221\351\242\x9d\345\267\262\xe9\x80\x80\345\256\x8c", "\x65\162\x72\x6f\162\x43\x6f\x64\145" => 0]; goto NXV5N; OQpJO: rya_Q: goto Jr5lX; s9GFF: $data["\x61\x64\144\x72\x65\x73\x73\x5f\151\144"] = $addressId; goto oSSm1; eEcf4: return ["\x6d\163\x67" => "\346\224\266\xe8\xb4\xa7\xe5\x9c\260\xe5\235\x80\xe4\270\215\xe5\xad\x98\xe5\234\250", "\145\x72\x72\157\x72\103\x6f\144\145" => 0]; goto OvtQx; cz9jc: cOpOZ: goto D1QFm; k8qY_: jX6In: goto gPndL; H9RfY: $order = OrderModel::get($refundOrder["\157\x72\144\x65\162\137\x69\144"]); goto s5GbS; qd8RO: $send->sendTplMessage($sendData, "\57" . MODEL . "\x2f\160\x61\147\x65\x73\x2f\x55\x73\x65\162\x2f\x6f\x72\x64\145\x72\57\157\162\144\x65\x72\x2f\x6f\x72\144\x65\162"); goto OqJys; kV4jb: if ($result !== false) { goto fuPkq; } goto qaGBu; eR1JX: } private function getRefundOrderLeftMoney($orderId, $o_amount) { goto Axg31; Axg31: $sameOrder = OrderRefund::where(["\157\x72\144\x65\x72\137\x69\x64" => $orderId, "\165\x6e\151\141\143\x69\144" => session("\x75\156\x69\x61\143\151\x64"), "\x73\164\141\x74\x75\x73" => 2])->select(); goto xvTrf; xvTrf: $allMoneyArr = []; goto rErZd; gHgnk: $leftMoney = $o_amount - $allMoney; goto lI2Ic; rErZd: foreach ($sameOrder as $key => $value) { $allMoneyArr[$key] = $value["\162\x65\146\165\x6e\x64\x5f\x70\x72\151\x63\x65"]; I9zKs: } goto urA6a; lI2Ic: return $leftMoney; goto LzUE7; m1YuC: $allMoney = array_sum($allMoneyArr); goto gHgnk; urA6a: kHd3t: goto m1YuC; LzUE7: } public function PayRefund($refundId = 0) { goto g_vVO; rF2kD: Pc2I0: goto ho7DY; j2obn: $refund["\x6f\165\164\x5f\164\162\141\144\145\137\156\157"] = $refundOrder["\x6f\162\144\145\x72\137\x6e\x6f"]; goto dHNte; Q4caR: if ($res["\162\x65\x74\x75\162\156\137\143\157\144\145"] == "\123\125\103\x43\x45\123\123" && $res["\162\x65\x73\x75\154\x74\137\x63\x6f\x64\145"] == "\123\x55\103\103\105\123\x53") { goto lH_cp; } goto HITPa; b13A_: IntegralDetail::setIntegralDetail($integralDetail); goto nrBJL; Epsav: if (!($leftMoney <= 0)) { goto Pc2I0; } goto TI8zI; Kx7X9: M_aFb: goto m94E4; x8Zng: MQZ4B: goto q4pvo; HITPa: if ($res["\x72\x65\x74\x75\x72\x6e\x5f\x6d\163\x67"] == "\x4f\113") { goto tvkGf; } goto aNge1; b9RhK: if (empty($isIntegralDetail)) { goto l7mH8; } goto OFqxN; mxAN1: lH_cp: goto mF0d4; kJJu5: if (!($refundOrder["\162\x65\x66\x75\x6e\144\137\160\162\151\x63\x65"] <= 0)) { goto CtweE; } goto EOfyG; pxnXm: return ["\155\x73\x67" => $error_msg, "\145\162\x72\157\162\x43\x6f\x64\145" => 0]; goto QjZMJ; sesGh: return ["\x6d\163\147" => "\xe8\257\245\350\xae\242\345\215\x95\350\277\230\345\x89\xa9" . $leftMoney . "\345\x85\x83\345\x8f\xaf\351\200\x80", "\145\162\x72\157\162\x43\x6f\x64\145" => 0]; goto Cs091; mDNvW: $user->save(); goto pISmV; ho7DY: if (!($refundOrder["\162\145\146\x75\156\144\x5f\x70\x72\x69\143\145"] > $leftMoney)) { goto TBrBM; } goto sesGh; g5qAr: return ["\155\x73\x67" => "\xe9\x80\x80\346\xac\276\xe9\x87\221\351\xa2\x9d\344\270\215\xe8\203\xbd\345\xa4\xa7\xe4\xba\x8e\346\x94\257\344\xbb\230\xe9\x87\x91\xe9\xa2\235{$order["\157\x5f\141\x6d\157\165\156\164"]}\345\205\203", "\x65\x72\162\157\x72\103\157\x64\145" => 0]; goto x8Zng; mF0d4: $refundOrder->agree_refund_time = time(); goto HJ2jp; g_vVO: if (!($refundId == 0 || $refundId == '')) { goto awH0O; } goto FqX2b; zmG_4: $error_msg = $res["\x65\162\x72\137\x63\x6f\144\145\x5f\144\x65\x73"]; goto yiypj; Cs091: TBrBM: goto j2obn; nYa9R: awH0O: goto MC1FM; aNge1: if ($res["\162\145\x74\x75\x72\156\x5f\155\163\147"] == "\116\x4f\x54\105\116\117\125\x47\x48") { goto rZGGR; } goto Q2Vyw; PlnYg: if (!($refundOrder["\x73\x74\x61\x74\165\163"] != 1)) { goto f5Nmp; } goto RTVrv; ePve_: goto E5iLt; goto E5yHG; WVCtZ: $refundOrder->save(); goto Se3h5; aeCqH: $refund["\x74\x6f\x74\x61\x6c\x5f\146\145\x65"] = $order["\x6f\137\x61\x6d\157\165\156\x74"] * 100; goto N7GSp; AR7ni: return ["\155\x73\x67" => "\351\200\x80\346\xac\xbe\346\210\x90\xe5\x8a\x9f", "\145\x72\162\157\162\x43\157\144\145" => 1]; goto QjBe3; dEuUG: $ent_time = strtotime("\53{$setting["\x61\146\164\145\x72\137\x74\151\x6d\x65"]}\x20\x64\141\x79", $refundOrder["\x63\x6f\x6e\146\151\x72\155\137\164\151\155\145"]); goto gfDyu; gfDyu: if (!(time() > $ent_time)) { goto UnHBF; } goto lq_p3; kuA14: if (!($integral <= 0)) { goto M_aFb; } goto b2lGC; Q2Vyw: $error_msg = $res["\x72\145\164\x75\162\x6e\x5f\x6d\x73\147"]; goto ePve_; rIkdM: f5Nmp: goto kJJu5; b2lGC: $integral = 0; goto Kx7X9; FqX2b: return ["\x6d\x73\x67" => "\350\257\xb7\351\200\211\346\x8b\251\350\xa6\x81\xe6\223\x8d\xe4\275\234\xe7\x9a\204\351\x80\200\xe6\254\xbe\350\xae\xa2\xe5\x8d\225", "\145\x72\x72\157\162\x43\x6f\144\x65" => 0]; goto nYa9R; N1PGg: $user->save(); goto hxxkP; N7GSp: $refund["\162\145\x66\x75\x6e\144\x5f\146\145\145"] = $refundOrder["\x72\x65\146\x75\156\x64\137\x70\x72\x69\x63\145"] * 100; goto WjqmX; Pr0LZ: if (!($total_money <= 0)) { goto cSKLt; } goto PorGI; q4pvo: $leftMoney = $this->getRefundOrderLeftMoney($refundOrder["\157\162\x64\145\x72\137\151\x64"], $order["\157\x5f\x61\155\157\165\x6e\164"]); goto Epsav; VmXQm: $integralDetail = ["\165\163\145\162\x5f\x69\x64" => $refundOrder["\165\163\145\x72\137\151\144"], "\x6f\162\144\x65\162\x5f\151\144" => $refundOrder["\x6f\162\x64\145\162\x5f\x69\144"], "\x74\171\x70\x65" => 2, "\153\151\x6e\x64" => 3, "\x69\156\164\x65\x67\x72\x61\x6c" => $isIntegralDetail["\x69\156\x74\x65\147\162\x61\x6c"]]; goto b13A_; Se3h5: $user = UserModel::get($refundOrder["\x75\163\x65\x72\x5f\151\144"]); goto dEuUG; TI8zI: return ["\x6d\163\147" => "\xe8\xaf\245\xe8\256\242\345\215\x95\xe7\232\x84\346\224\257\344\273\x98\351\x87\x91\351\xa2\235\345\xb7\262\351\x80\x80\xe5\xae\x8c", "\145\162\162\157\x72\103\x6f\x64\145" => 0]; goto rF2kD; QjBe3: TMPbP: goto BHO1V; m94E4: $user->integral = $integral; goto N1PGg; Psn8C: if (!($refundOrder["\x72\x65\146\x75\156\x64\x5f\x70\162\x69\x63\145"] > $order["\x6f\137\141\155\157\x75\156\x74"])) { goto MQZ4B; } goto g5qAr; A5Sea: $user->total_money = $total_money; goto PZQSb; dHNte: $refund["\157\165\164\x5f\x72\145\x66\165\x6e\x64\x5f\x6e\157"] = $refundOrder["\x72\x65\146\x75\156\x64\137\157\162\144\145\x72\137\156\x6f"]; goto aeCqH; EOfyG: return ["\x6d\163\147" => "\xe9\x80\x80\xe6\254\xbe\351\x87\x91\351\xa2\x9d\xe9\x9c\x80\345\244\xa7\xe4\272\x8e\x30", "\x65\x72\x72\157\162\103\157\144\145" => 0]; goto NDVA0; hxxkP: UnHBF: goto drq98; PorGI: $total_money = 0; goto Hmpdm; nrBJL: l7mH8: goto AR7ni; yjE6o: $order = OrderModel::get($refundOrder["\x6f\162\x64\x65\162\137\x69\144"]); goto PlnYg; Hmpdm: cSKLt: goto A5Sea; tsQZj: $refundOrder = OrderRefund::get($refundId); goto yjE6o; WjqmX: $res = WechatService::refund($refund); goto Q4caR; FN9Wl: rZGGR: goto ZrCrH; kvY7n: $user->save(); goto VmXQm; RTVrv: return ["\155\x73\147" => "\350\257\xa5\xe8\xae\xa2\345\215\225\346\232\x82\xe4\270\215\346\x94\xaf\346\214\x81\xe9\x80\200\xe6\254\xbe", "\x65\162\x72\157\162\103\157\144\x65" => 0]; goto rIkdM; HJ2jp: $refundOrder->status = 2; goto WVCtZ; NDVA0: CtweE: goto Psn8C; lq_p3: $money = $refundOrder["\x73\156\x61\x70\137\x69\156\146\157"]["\x70\x72\151\143\145"] * $refundOrder["\163\x6e\141\x70\137\x69\x6e\146\157"]["\156\165\x6d"]; goto iOSSB; PZQSb: $integral = $user->integral - round($total_money); goto kuA14; MC1FM: $setting = PlatformSettings::order("\151\144", "\144\x65\x73\143")->find(); goto tsQZj; ZrCrH: $error_msg = "\345\x95\x86\xe6\x88\267\xe5\x8f\257\xe7\x94\250\xe9\x80\x80\346\254\276\xe4\xbd\x99\351\242\x9d\xe4\xb8\x8d\xe8\266\263"; goto bNpBx; iOSSB: $total_money = $user->total_money - $money; goto Pr0LZ; yiypj: goto E5iLt; goto FN9Wl; OFqxN: $user->integral -= $isIntegralDetail["\x69\x6e\164\x65\x67\162\141\x6c"]; goto kvY7n; drq98: $user->integral = $user->integral + $refundOrder["\x73\156\141\x70\x5f\x69\156\146\x6f"]["\x69\156\x74\x65\147\x72\x61\154"]; goto mDNvW; pISmV: $isIntegralDetail = IntegralDetail::where(["\165\156\x69\141\x63\151\144" => session("\165\x6e\x69\141\x63\x69\144"), "\165\x73\x65\162\137\151\144" => $refundOrder["\165\x73\145\162\x5f\151\144"], "\157\162\x64\145\x72\x5f\x69\x64" => $refundOrder["\157\162\144\145\x72\137\x69\x64"], "\164\171\x70\x65" => 1, "\x6b\x69\x6e\x64" => 3])->find(); goto b9RhK; QjZMJ: goto TMPbP; goto mxAN1; E5yHG: tvkGf: goto zmG_4; bNpBx: E5iLt: goto pxnXm; BHO1V: } }