<?php
 namespace app\api\controller\v1; use app\api\controller\BaseController; use app\api\model\Coupon as CouponModel; use app\api\model\UserCoupon; use think\Request; use app\api\model\Product as ProductModel; use app\api\service\Product as ProductService; use app\api\service\Token as TokenService; class Coupon extends BaseController { public function __construct(Request $request = null) { parent::__construct($request); CouponModel::checkCoupon(); } public function getCouponProduct($couponId = 0) { goto Op1gh; yDId8: $productIds = json_decode($coupon["\x70\x72\x6f\144\x75\x63\164\x5f\x69\x64"], true); goto BIoYs; gAJXb: m5moC: goto XIUCV; AUD7D: return ["\155\x73\x67" => "\350\xaf\245\xe4\xbc\x98\xe6\x83\xa0\xe5\210\270\xe4\270\x8d\xe7\224\250\346\214\x87\345\256\x9a\xe5\225\206\xe5\223\x81", "\x65\162\x72\x6f\x72\103\x6f\x64\145" => 0]; goto nxfLL; ugiB2: $productService = new ProductService(); goto Bhngs; Op1gh: if (!($couponId == '' || $couponId == 0)) { goto l5cps; } goto ebGui; tRmkt: $product = ProductModel::where($where)->where("\163\x74\141\164\165\163", "\x3d", 1)->field("\151\x64\54\x70\x72\151\x63\x65\54\157\137\x70\162\x69\x63\145\54\x6e\141\155\x65\x2c\x74\x68\x75\x6d\x62\x2c\x73\x75\155\155\x61\162\x79\54\x69\163\137\x61\x74\164\x72")->select(); goto gaX9S; mnfRl: rFCAB: goto aR48X; XIUCV: if (!($coupon["\141\x70\160\154\x79"] != 2)) { goto urFEl; } goto AUD7D; UzjHd: return ["\155\x73\147" => "\xe8\216\267\xe5\x8f\226\xe5\xa4\261\350\264\xa5", "\145\162\x72\157\x72\x43\x6f\144\145" => 0]; goto aBfyt; ddXkC: $coupon = CouponModel::getCouponById($couponId); goto aJTK9; aJTK9: if (!empty($coupon)) { goto m5moC; } goto TxiB1; Bhngs: foreach ($product as $key => $value) { $product[$key]["\166\151\x70\137\x70\162\151\x63\145"] = $productService->getProductVipPrice($value["\x69\x64"], $value["\x70\x72\151\143\x65"], $value["\x69\163\137\141\164\x74\x72"]); hsk7x: } goto LT4iI; aR48X: if (!$product->isEmpty()) { goto WkdCU; } goto UzjHd; CCME2: l5cps: goto ddXkC; TxiB1: return ["\x6d\163\147" => "\344\274\x98\346\x83\240\xe5\210\xb8\344\270\x8d\345\255\230\xe5\x9c\xa8\xe6\x88\x96\345\267\262\xe8\277\x87\xe6\x9c\x9f", "\x65\162\162\157\162\x43\157\x64\145" => 0]; goto gAJXb; nxfLL: urFEl: goto yDId8; gaX9S: if (empty($product)) { goto rFCAB; } goto ugiB2; BIoYs: $productIds = implode("\54", $productIds); goto WJ22R; WJ22R: $where = "\x69\x64\40\x69\156\x28{$productIds}\51"; goto tRmkt; aBfyt: WkdCU: goto g7p3u; ebGui: return ["\155\163\147" => "\350\257\267\xe6\214\x87\345\xae\232\xe4\274\230\xe6\x83\xa0\345\210\xb8\151\144", "\145\162\162\x6f\x72\x43\157\144\x65" => 0]; goto CCME2; g7p3u: return ["\x6d\x73\147" => "\350\216\267\345\217\226\346\x88\220\345\212\237", "\x64\x61\x74\x61" => $product, "\x65\162\x72\x6f\162\103\157\x64\145" => 1]; goto C84uk; LT4iI: QUmhB: goto mnfRl; C84uk: } public function getCouponDetail($couponId = 0) { goto be_z9; xQfah: return ["\x6d\163\x67" => "\350\x8e\xb7\345\x8f\226\345\244\xb1\350\264\xa5", "\145\x72\162\x6f\162\103\157\x64\145" => 0]; goto TcIp0; Sj30z: $coupon = CouponModel::getCouponById($couponId); goto YQaFR; be_z9: if (!($couponId == '' || $couponId == 0)) { goto p2LIG; } goto TdRwG; TdRwG: return ["\155\x73\147" => "\xe8\xaf\267\xe6\x8c\207\xe5\256\232\344\xbc\x98\346\203\xa0\345\x88\270\x69\144", "\145\x72\x72\x6f\x72\103\157\144\x65" => 0]; goto W3sTE; TcIp0: XRDNt: goto LZj1P; LZj1P: return ["\155\x73\x67" => "\xe8\x8e\267\345\217\226\xe6\210\220\xe5\x8a\237", "\x64\x61\x74\141" => $coupon, "\145\x72\162\x6f\162\103\x6f\144\145" => 1]; goto tvjoQ; W3sTE: p2LIG: goto Sj30z; YQaFR: if (!empty($coupon)) { goto XRDNt; } goto xQfah; tvjoQ: } public function getUserCouponDetail($id = 0) { goto kwBej; hkTCx: QCu9q: goto YZrGH; dxx9x: $userCoupon["\x65\x6e\144\137\x74\151\x6d\145"] = date("\x59\55\155\x2d\144", $userCoupon["\x65\x6e\x64\137\x74\151\155\145"]); goto dkWt1; T4lZO: return ["\x6d\163\147" => "\350\257\267\346\x8c\207\xe5\256\x9a\151\144", "\145\162\x72\157\x72\103\x6f\x64\145" => 0]; goto aYRr1; Nb1lg: return ["\x6d\163\x67" => "\xe4\xbc\230\xe6\203\xa0\xe5\210\xb8\xe4\xb8\x8d\345\xad\x98\xe5\x9c\250\346\210\x96\xe5\xb7\262\xe8\277\207\346\x9c\x9f", "\x65\x72\x72\157\162\x43\157\144\145" => 0]; goto hkTCx; aYRr1: JvnwP: goto KCX2B; kwBej: if (!($id == '' || $id == 0)) { goto JvnwP; } goto T4lZO; YZrGH: $userCoupon["\x73\x74\x61\x72\x74\137\x74\x69\155\x65"] = date("\x59\55\x6d\55\x64", $userCoupon["\163\164\x61\162\164\137\x74\151\x6d\x65"]); goto dxx9x; KCX2B: $uid = TokenService::getCurrentUid(); goto X4O6Q; dkWt1: return ["\x6d\163\x67" => "\xe8\216\267\345\x8f\226\xe6\x88\220\xe5\x8a\237", "\x64\141\164\x61" => $userCoupon, "\x65\x72\162\x6f\162\103\x6f\144\145" => 1]; goto sOtFY; tUXYz: if (!empty($userCoupon)) { goto QCu9q; } goto Nb1lg; X4O6Q: $userCoupon = UserCoupon::with("\143\157\165\x70\157\x6e")->where(["\165\x6e\x69\141\x63\x69\144" => session("\165\x6e\151\x61\143\151\x64"), "\x75\163\145\x72\137\151\144" => $uid])->find($id); goto tUXYz; sOtFY: } public function receiveCoupon($couponId = 0) { goto x3ztk; F95Y9: return ["\155\163\147" => "\350\xaf\xb7\xe6\214\207\xe5\256\x9a\xe4\274\x98\xe6\x83\xa0\xe5\x88\270\x69\144", "\145\x72\162\157\x72\x43\157\x64\x65" => 0]; goto CcMlP; Yt9aM: $result = $couponModel->receiveCoupon($couponId); goto ek7RW; ek7RW: return $result; goto A290Y; x3ztk: if (!($couponId == '' || $couponId == 0)) { goto WHbnx; } goto F95Y9; cmJsp: $couponModel = new CouponModel(); goto Yt9aM; CcMlP: WHbnx: goto cmJsp; A290Y: } public function getCouponCenter() { goto wDz5d; wDz5d: $coupon = CouponModel::getCouponCenter(); goto Q17ds; kX1J6: return ["\x6d\163\x67" => "\350\216\267\xe5\217\x96\345\244\xb1\350\264\xa5", "\145\x72\x72\x6f\x72\103\157\144\x65" => 0]; goto AHh32; hCDOm: return ["\155\x73\x67" => "\350\216\xb7\345\x8f\226\346\x88\x90\xe5\x8a\x9f", "\144\x61\x74\141" => $coupon, "\x65\x72\162\x6f\x72\103\x6f\x64\145" => 1]; goto gtfMY; AHh32: h1XAw: goto hCDOm; Q17ds: if (!$coupon->isEmpty()) { goto h1XAw; } goto kX1J6; gtfMY: } }