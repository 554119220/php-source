{include file="common/header"}

<!--main-body-->
<section class="main-body index-body">
    <div class="main_content">
        <!--second sidebar-->
        <nav class="main_navbar main_navbar-mini">
            <div class="main_navbar-button">
                <a href="javascript:;" class="middle_center">
                    <i class="iconfont icon-richtextindent"></i>
                </a>
            </div>
            <div class="main_navbar-nav">
                <div class="navbar-nav-title">
                    门店设置
                </div>
                <div class="navbar-nav-nav">
                    <ul>
                        <li>
                            <a href="javascript:;" class="action">
                    <span class="nav-icon">
                      <i class="iconfont icon-lianjie"></i>
                    </span>
                                <span class="nav-title">
                      数据统计
                    </span>
                            </a>
                        </li>

                    </ul>
                </div>
            </div>
        </nav>
        <!--main body content-->
        <div class="main_mbody main_mbody-max">
            <div class="col-xs-12">
                <div class="main_mbody-title">
                    <h5>数据统计</h5>
                </div>
                <div class="main-con">
                    <form action="">
                        <div class="index_balance">
                            <ul>
                                <li>
                                    <div class="title">已售罄商品</div>
                                    <div class="content">
                                        <span class="data"><a style="color: #00c1de" href="{:url('boguan/platform.product/index')}?type=2">{$soldOut}</a></span>
                                        <span class="unit">件</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="title">待发货订单</div>
                                    <div class="content">
                                        <span class="data"><a style="color: #00c1de" href="{:url('boguan/platform.order/index')}?status=1&is_send=0">{$waitSend}</a></span>
                                        <span class="unit">单</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="title">维权订单</div>
                                    <div class="content">
                                        <span class="data"><a style="color: #00c1de" href="{:url('boguan/platform.after/index')}">{$refund}</a></span>
                                        <span class="unit">单</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="title">待审核提现</div>
                                    <div class="content">
                                        <span class="data"><a style="color: #00c1de" href="{:url('boguan/platform.withdraw/index')}">{$withdraw}</a></span>
                                        <span class="unit">元</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="title">用户数</div>
                                    <div class="content">
                                        <span class="data"><a style="color: #00c1de" href="{:url('boguan/platform.user/index')}">{$user}</a></span>
                                        <span class="unit">人</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="index_databox">
                            <div class="control clearit" style="">
                                <div class="date_control">
                                    <div class="input-daterange input-group" >
                                        <input type="text" class="form-control" name="begin_date" id="new_start_time" value="{:date('Y-m-d',strtotime('-1 days'))}" readonly>
                                        <span class="input-group-addon">至</span>
                                        <input type="text" class="form-control" name="end_date" id="new_end_time" value="{:date('Y-m-d',strtotime('-1 days'))}" readonly>
                                    </div>
                                </div>
                                <ul>
                                    <li class="active">
                                        <span>昨天</span>
                                    </li>
                                    <li>
                                        <span>近7天</span>
                                    </li>
                                    <li>
                                        <span>近30天</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="index_databox">
                            <div class="title">
                                <h5>转化漏斗</h5>
                            </div>
                            <div class="databox_show clearit">
                                <div class="left">
                                    <ul>
                                        <li class="visit">
                                            <p class="title">
                                                <span class="point-1 point"></span>
                                                访问人数(人)
                                            </p>
                                            <p class="num">
                                                {$data['visit']['total']}
                                            </p>
                                            <p class="per">
                                                <span class="{$data['visit']['class']}">{$data['visit']['percent'] * 100}%</span>
                                            </p>
                                        </li>
                                        <li class="order">
                                            <p class="title">
                                                <span class="point-2 point"></span>
                                                用户下单(笔)
                                            </p>
                                            <p class="num order_num">
                                                {$data['order']['total']}
                                            </p>
                                            <p class="per">
                                                <span class="{$data['order']['class']}">{$data['order']['percent'] * 100}%</span>
                                            </p>
                                        </li>
                                        <li class="pay">
                                            <p class="title">
                                                <span class="point-3 point"></span>
                                                支付订单(笔)
                                            </p>
                                            <p class="num pay_num">
                                                {$data['pay']['total']}
                                            </p>
                                            <p class="per">
                                                <span class="{$data['pay']['class']}">{$data['pay']['percent'] * 100}%</span>
                                            </p>
                                        </li>
                                        <li class="money">
                                            <p class="title">
                                                <span class="point-3 point"></span>
                                                支付金额(元)
                                            </p>
                                            <p class="num money_num">
                                                {$data['money']['total']}
                                            </p>
                                            <p class="per">
                                                <span class="{$data['money']['class']}">{$data['money']['percent'] * 100}%</span>
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                                <div class="right">
                                    <div class="databox_show-right">
                                        <ul class="title-list">
                                            <li>访问人数</li>
                                            <li>下单人数</li>
                                            <li>支付订单数</li>
                                        </ul>
                                        <div class="part1">
                                            <p>访问-支付</p>
                                            <span>转化率</span>

                                            <p class="{$data['visit_pay']['class']}">{$data['visit_pay']['percent'] * 100}%</p>

                                        </div>
                                        <div class="part2">
                                            <p>访问-下单</p>
                                            <span>转化率</span>
                                            <p class="{$data['visit_order']['class']}">{$data['visit_order']['percent'] * 100}%</p>
                                        </div>
                                        <div class="part3">
                                            <p>下单-支付</p>
                                            <span>转化率</span>
                                            <p class="{$data['order_pay']['class']}">{$data['order_pay']['percent'] * 100}%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="index_databox databox-ranking">
                            <div class="databox_show clearit">
                                <div class="left">
                                    <div class="title-ranking">
                                        <h5>商品TOP5销售排行</h5>
                                    </div>
                                    <div class="content-ranking">
                                        <div class="main-table">
                                            <table class="table table-hover table-condensed">
                                                <thead>
                                                <tr>
                                                    <th style="width: 80%;text-align: left;">商品</th>
                                                    <th style="width: 20%;">销量</th>
                                                </tr>
                                                </thead>
                                                <tbody>{volist name="productTop5" id="vo"}<tr>
                                                    <td class="sanji-pro min-pro">
                                                        <ul>
                                                            <li data-toggle="tooltip" data-placement="top" title="" data-original-title="{$vo.name}">
                                                                <div class="min-img"><img src="{$vo.thumb}" ondragstart="return false" alt="" title=""></div>
                                                                <div class="min-title">
                                                                    <div class="name"><span>{$vo.name}</span></div>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </td>
                                                    <td>{$vo.sales}</td>
                                                </tr>
                                                {/volist}</tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                                <div class="right">
                                    <div class="title-ranking">
                                        <h5>用户TOP5付款排行</h5>
                                    </div>
                                    <div class="content-ranking">
                                        <div class="main-table">
                                            <table class="table table-hover table-condensed">
                                                <thead>
                                                <tr>
                                                    <th style="width: 80%;text-align: left;">用户</th>
                                                    <th style="width: 20%;">付款金额</th>
                                                </tr>
                                                </thead>
                                                <tbody>{volist name="userTop5" id="vo"}{if $vo.user}<tr>
                                                    <td class="sanji-pro min-pro">
                                                        <ul>
                                                            <li data-toggle="tooltip" data-placement="top" title="" data-original-title="{$vo.user.nickname}">
                                                                <div class="min-img"><img src="{$vo.user.avatar}" ondragstart="return false" alt="" title=""></div>
                                                                <div class="min-title">
                                                                    <div class="name"><span>{$vo.user.nickname}</span></div>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </td>
                                                    <td>{$vo.total}</td>
                                                </tr>{/if}{/volist}</tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
            {include file="common/copyright"}
        </div>
    </div>
</section>

{include file="common/footer"}
<script>
    function getData(type,begin,end) {
        console.log(type)

        $.ajax({
            type: "post",
            url: "{:url('boguan/platform.index/getData')}",
            //dataType:"json",
            data:{
                "day": type,
                "begin": begin,
                "end": end,
            },
            beforeSend:function(){
                layui.use(['layer','form'], function(){
                    var layer = layui.layer,form = layui.form;

                    layer.load(1);

                });
            },
            success: function(data) {
                var res= data.data;

                if (data.errorCode == 1) {
                    layui.use(['layer','form'], function(){
                        var layer = layui.layer,form = layui.form;

                        layer.close(layer.index);

                    });

                    $('.visit .num').text(res.visit.total);

                    $('.visit .per span').removeAttr('class').addClass(res.visit.class).text((res.visit.percent * 100).toFixed(2) + '%');

                    $('.order .num').text(res.order.total);
                    $('.order .per span').removeAttr('class').addClass(res.order.class).text((res.order.percent * 100).toFixed(2) + '%');

                    $('.pay .num').text(res.pay.total);
                    $('.pay .per span').removeAttr('class').addClass(res.pay.class).text((res.pay.percent * 100).toFixed(2) + '%');

                    $('.money .num').text(res.money.total);
                    $('.money .per span').removeAttr('class').addClass(res.money.class).text((res.money.percent * 100).toFixed(2) + '%');

                    $('.part1 span ~p').removeAttr('class').addClass(res.visit_pay.class).text((res.visit_pay.percent * 100).toFixed(2) + '%');
                    $('.part2 span ~p').removeAttr('class').addClass(res.visit_order.class).text((res.visit_order.percent * 100).toFixed(2) + '%');
                    $('.part3 span ~p').removeAttr('class').addClass(res.order_pay.class).text((res.order_pay.percent * 100).toFixed(2) + '%');
                }
            },
            error: function (data) {
                console.log(data.responseText);
                layui.use(['layer','form'], function(){
                    var layer = layui.layer,form = layui.form;

                    layer.close(layer.index);

                });
            },

        });
    }
</script>
