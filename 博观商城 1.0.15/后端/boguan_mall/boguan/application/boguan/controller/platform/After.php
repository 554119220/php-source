<?php
 namespace app\boguan\controller\platform; use app\boguan\controller\Platform; use app\boguan\model\OrderRefund as OrderRefundModel; use app\boguan\model\Order as OrderModel; use app\boguan\model\RefundAddress; use app\boguan\model\WxTemplate; use app\boguan\controller\SendMessage; use think\Request; use app\api\service\Wechat as WechatService; use app\boguan\model\PlatformSettings; use app\boguan\model\User as UserModel; use app\boguan\model\Integral as IntegralModel; use app\boguan\model\IntegralDetail; use app\boguan\model\Message as MessageModel; class After extends Platform { public function __construct(Request $request = null) { parent::__construct($request); } public function index() { goto rDFCP; yU2yj: $end_time = date("\131\55\x6d\55\x64", time()); goto sMkHo; QKgoH: $where["\x73\164\x61\164\x75\x73"] = $status; goto z_aSK; ITyDV: dS46O: goto d6LtQ; lAt3Y: $message->save(); goto I3T1q; rDFCP: $keyword = input("\153\x65\x79\167\157\x72\x64"); goto MN7HO; d6LtQ: TSqzs: goto uujFW; ZuFbS: EmjOL: goto ZDmmK; K40P4: if ($type == "\x33") { goto ejhDB; } goto mcdgx; vyET9: $where["\x69\163\x5f\144\145\x6c\145\x74\145"] = 0; goto JNJd6; k70oG: $wheres["\x75\163\145\162\x5f\x69\144"] = ["\151\x6e", $userIds]; goto XYsmz; LZuVv: $user = UserModel::where("\165\x6e\x69\x61\x63\151\x64", session("\165\156\x69\x61\143\x69\144"))->where("\156\151\143\x6b\156\x61\x6d\145", "\154\x69\153\x65", "\45{$keyword}\x25")->select(); goto jkPIE; k13Oc: $message->is_read = 1; goto lAt3Y; s_XMs: $product = input("\x70\162\157\144\165\143\x74"); goto oM52U; XYsmz: goto p4rY3; goto rOrkf; V4jHx: $page = $order->render(); goto rb0xO; dL6UW: if ($status == "\63") { goto UBEbD; } goto Ec2Jr; EFzQG: $message = MessageModel::where(["\165\156\x69\x61\143\x69\x64" => session("\165\x6e\151\141\x63\x69\144"), "\x6f\162\144\145\162\137\x69\x64" => $after["\x69\144"], "\x69\x73\x5f\162\145\x61\x64" => 0])->find(); goto YgYfE; vB2cY: RUoRo: goto vGgnM; ulFdM: $after = OrderRefundModel::where(["\165\x6e\151\x61\143\151\144" => session("\165\x6e\x69\141\143\x69\144"), "\157\162\144\145\x72\137\156\157" => $keyword])->find(); goto UuB2L; m48eG: if ($status == "\62") { goto AoCvo; } goto dL6UW; yvufS: if (!(input("\163\x6f\165\x72\x63\x65") == "\x6d\145\x73\163\x61\x67\x65")) { goto TSqzs; } goto ulFdM; z_aSK: Puit2: goto CdlfZ; dMaaI: $wheres["\165\x73\145\162\151\156\146\157"] = ["\x6c\151\153\x65", "\45{$keyword}\x25"]; goto xpVWJ; JNJd6: if ($status == "\61") { goto LorE1; } goto m48eG; sIIZO: jpazQ: goto LZuVv; I3T1q: HX7IT: goto ITyDV; xpVWJ: p4rY3: goto twyRh; uujFW: goto p4rY3; goto sIIZO; XlMFX: $status = input("\x73\164\x61\164\x75\163"); goto vyET9; MN7HO: $type = input("\164\171\x70\145"); goto kjam2; vGgnM: $userIds = implode("\x2c", $userIds); goto k70oG; Ec2Jr: $sort = "\x63\162\x65\141\x74\145\137\x74\151\x6d\145\x20\x64\145\163\143"; goto cKIkN; oM52U: if (!$product) { goto EmjOL; } goto YUtKc; qXfky: goto InrvW; goto aKgBN; M5pie: $sort = "\141\147\x72\x65\145\137\162\x65\x66\165\156\x64\x5f\x74\151\x6d\x65\40\x64\x65\163\x63"; goto Nui0p; ZF85a: UBEbD: goto OqIHZ; Vu1Sh: goto gFwET; goto m0Qrt; OqIHZ: $sort = "\162\145\146\165\163\x65\137\164\x69\x6d\x65\x20\x64\145\163\143"; goto xLagX; Nui0p: goto gFwET; goto ZF85a; MFI4T: xnh1E: goto UApG1; YUtKc: $wheres["\x73\x6e\x61\x70\x5f\151\x6e\146\x6f"] = ["\154\151\153\x65", "\x25{$product}\45"]; goto ZuFbS; ZmP_c: $end_time = input("\145\x6e\144\137\164\151\x6d\145"); goto jEfO9; g2q1Q: LorE1: goto xqYfQ; sMkHo: BP9AW: goto s_XMs; xLagX: gFwET: goto Kq3q2; UApG1: $wheres["\x6f\162\x64\145\162\x5f\x6e\157"] = ["\x6c\x69\153\145", "\x25{$keyword}\45"]; goto yvufS; KLMs7: $order = OrderRefundModel::with("\x75\x73\x65\x72")->with("\157\x72\144\145\162")->where("\165\x6e\x69\x61\143\151\144", $this->uniacid)->where($where)->where($wheres)->where("\143\x72\145\x61\x74\145\137\164\151\155\x65", "\142\145\x74\x77\x65\145\x6e\40\x74\x69\155\x65", [$start_time . "\x20\x30\x30\x3a\x30\60\72\60\x30", $end_time . "\40\x32\x33\x3a\x35\71\72\65\71"])->order($sort)->paginate(8, false, ["\161\165\x65\x72\171" => array_merge($where, $setWhere)]); goto xH1bv; UuB2L: if (!$after) { goto dS46O; } goto EFzQG; xH1bv: InrvW: goto V4jHx; aKgBN: ki63E: goto KLMs7; m0Qrt: AoCvo: goto M5pie; jEfO9: if (!($start_time && $end_time == '')) { goto BP9AW; } goto yU2yj; ZDmmK: $setWhere = ["\x73\164\x61\x72\x74\137\164\151\155\145" => $start_time, "\x65\x6e\x64\137\x74\x69\x6d\145" => $end_time, "\x6b\x65\x79\167\x6f\x72\144" => $keyword, "\x74\171\160\145" => $type, "\160\162\157\144\165\143\164" => $product]; goto XlMFX; rb0xO: $this->assign(["\157\x72\x64\145\x72" => $order, "\x70\141\147\x65" => $page]); goto kA4rf; kA4rf: return $this->fetch(); goto hf09G; Kq3q2: if (!($status != '')) { goto Puit2; } goto QKgoH; kjam2: if ($type == "\x31") { goto xnh1E; } goto xodPr; YgYfE: if (!$message) { goto HX7IT; } goto k13Oc; cKIkN: goto gFwET; goto g2q1Q; rOrkf: ejhDB: goto dMaaI; nNBu2: $order = OrderRefundModel::with("\165\163\145\162")->with("\x6f\x72\144\145\162")->where("\165\156\151\141\x63\x69\x64", $this->uniacid)->where($where)->where($wheres)->order($sort)->paginate(8, false, ["\x71\165\x65\x72\x79" => array_merge($where, $setWhere)]); goto qXfky; mcdgx: $wheres["\165\163\x65\162\x69\x6e\x66\x6f"] = ["\x6c\151\153\145", "\45{$keyword}\x25"]; goto amsqi; twyRh: $start_time = input("\163\x74\141\x72\x74\x5f\x74\x69\x6d\x65"); goto ZmP_c; xodPr: if ($type == "\x32") { goto jpazQ; } goto K40P4; jkPIE: $userIds = []; goto NGQFA; amsqi: goto p4rY3; goto MFI4T; NGQFA: foreach ($user as $value) { $userIds[] = $value["\x69\144"]; aO0Ht: } goto vB2cY; CdlfZ: if ($start_time) { goto ki63E; } goto nNBu2; xqYfQ: $sort = "\x61\x67\162\x65\145\x5f\x74\x69\x6d\145\40\x64\145\163\143"; goto Vu1Sh; hf09G: } public function refund() { goto iGtjw; gKWBO: RHBp0: goto PX15r; acRHf: $order = OrderModel::get($refundOrder["\157\x72\x64\145\x72\x5f\x69\144"]); goto Ort2f; hoHgm: $refundOrder->save(); goto v6KBy; absRL: if (isset($data["\151\x64"])) { goto G2Qjm; } goto xiE5f; OZr9g: $user->integral = $integral; goto NUl54; L20pU: if ($res["\x72\145\164\x75\x72\156\137\155\x73\147"] == "\116\117\124\105\x4e\x4f\x55\x47\110") { goto Amgvg; } goto zWU_E; v6KBy: $user = UserModel::get($refundOrder["\x75\x73\145\162\137\x69\144"]); goto gSWWd; RFGYC: $money = $refundOrder["\163\156\x61\160\137\151\156\x66\x6f"]["\x70\x72\x69\x63\x65"] * $refundOrder["\x73\156\x61\x70\x5f\x69\156\146\x6f"]["\156\x75\x6d"]; goto rz0X3; ymBPt: J6DeV: goto AqKjP; Tuf1w: $user->integral -= $isIntegralDetail["\151\156\164\145\x67\x72\x61\154"]; goto kfrKZ; BIqaV: if ($res["\x72\x65\x74\165\x72\x6e\x5f\x6d\x73\147"] == "\x4f\x4b") { goto SwB4A; } goto L20pU; cNgX7: $refund["\157\165\x74\137\x72\145\146\165\156\144\x5f\156\157"] = $refundOrder["\x72\145\x66\165\x6e\x64\x5f\157\x72\144\145\x72\137\x6e\157"]; goto uu5s6; huaLj: Amgvg: goto Ehr6u; fxbqF: bYa0r: goto SNySV; B2ewb: return ["\155\163\x67" => "\xe8\257\245\350\256\242\345\215\225\347\232\204\xe6\224\257\344\273\230\xe9\x87\x91\351\242\235\xe5\267\xb2\351\x80\x80\345\256\x8c", "\145\162\x72\157\x72\103\157\144\145" => 0]; goto PFqoq; kfrKZ: $user->save(); goto MF97e; rz0X3: $total_money = $user->total_money - $money; goto GZbsg; gSWWd: $ent_time = strtotime("\53{$setting["\x61\146\164\x65\162\137\x74\151\x6d\145"]}\x20\x64\141\x79", $refundOrder["\143\x6f\156\146\x69\162\155\x5f\164\151\155\x65"]); goto CIxYt; GZbsg: if (!($total_money <= 0)) { goto Rr7qX; } goto NXXAh; lWxmi: if (!($integral <= 0)) { goto F3w_l; } goto PImcu; ZEAc7: DPz15: goto r5jtm; QBSjK: IntegralDetail::setIntegralDetail($integralDetail); goto ymBPt; Ehr6u: $error_msg = "\345\x95\x86\xe6\x88\267\345\x8f\xaf\347\x94\250\351\200\x80\346\254\xbe\344\275\231\351\242\x9d\xe4\xb8\215\350\xb6\263"; goto gKWBO; xucbH: return ["\x6d\x73\x67" => "\351\200\x80\xe6\xac\xbe\351\207\221\xe9\xa2\x9d\351\234\x80\xe5\244\xa7\xe4\xba\216\60", "\145\162\x72\x6f\162\103\157\144\145" => 0]; goto NIrIl; SNySV: $refund["\157\x75\x74\x5f\164\162\141\144\145\137\156\157"] = $refundOrder["\x6f\162\x64\145\x72\x5f\x6e\157"]; goto cNgX7; ex5ah: return ["\155\163\147" => "\xe8\xaf\245\xe8\xae\242\xe5\x8d\x95\350\277\230\xe5\211\251" . $leftMoney . "\345\205\x83\345\x8f\257\351\x80\x80", "\x65\162\x72\157\x72\103\x6f\144\x65" => 0]; goto fxbqF; RSvdy: goto RHBp0; goto kHA4n; L09db: $refundOrder = OrderRefundModel::get($data["\x69\x64"]); goto acRHf; nl05e: $isIntegralDetail = IntegralDetail::where(["\x75\x6e\151\x61\x63\151\144" => session("\x75\156\151\x61\143\151\144"), "\x75\x73\145\162\137\151\x64" => $refundOrder["\165\x73\x65\x72\137\151\x64"], "\x6f\x72\144\x65\x72\137\x69\x64" => $refundOrder["\157\162\144\x65\162\137\x69\144"], "\164\x79\x70\x65" => 1, "\x6b\151\x6e\x64" => 3])->find(); goto f43Xr; kHA4n: SwB4A: goto zZHr0; W7nvU: goto RHBp0; goto huaLj; Gtja2: $user->integral = $user->integral + $refundOrder["\x73\x6e\x61\160\137\151\156\x66\157"]["\151\x6e\164\x65\x67\x72\x61\x6c"]; goto EDkol; z7qK9: $leftMoney = $this->getRefundOrderLeftMoney($refundOrder["\157\x72\x64\145\162\x5f\x69\144"], $order["\157\x5f\141\155\x6f\x75\x6e\x74"]); goto D_Ed4; uu5s6: $refund["\164\x6f\164\x61\154\137\146\x65\145"] = $order["\157\137\x61\155\157\x75\156\164"] * 100; goto zB1Cj; Rz690: if ($res["\162\145\164\165\x72\156\x5f\143\157\x64\145"] == "\x53\125\103\x43\105\123\x53" && $res["\162\x65\x73\x75\x6c\164\x5f\143\x6f\x64\x65"] == "\123\125\x43\x43\x45\x53\123") { goto RF08I; } goto BIqaV; iGtjw: if (!request()->isAjax()) { goto og8Re; } goto iT6VS; PX15r: return json(["\155\x73\x67" => $error_msg, "\145\162\162\x6f\x72\x43\157\x64\145" => 0]); goto nmGVj; lRW0e: GXaB5: goto Gtja2; x1IOm: $setting = PlatformSettings::order("\x69\x64", "\144\x65\x73\x63")->find(); goto L09db; NIrIl: DjTwA: goto B8_ic; r5jtm: og8Re: goto y0Jnw; Ess_a: $refundOrder->status = 2; goto hoHgm; f43Xr: if (empty($isIntegralDetail)) { goto J6DeV; } goto Tuf1w; GEMda: cKKwi: goto z7qK9; PImcu: $integral = 0; goto udV1y; iT6VS: $data = input("\x70\157\x73\164\x2e"); goto absRL; zWU_E: $error_msg = $res["\162\145\164\x75\162\x6e\x5f\x6d\x73\x67"]; goto RSvdy; QTxr7: $user->total_money = $total_money; goto W9Z6U; NXXAh: $total_money = 0; goto iI9I3; aBoED: return ["\x6d\163\147" => "\xe9\x80\x80\346\xac\xbe\xe9\207\221\xe9\242\x9d\xe4\xb8\x8d\xe8\203\xbd\345\244\xa7\344\272\x8e\346\224\xaf\xe4\273\x98\351\x87\221\xe9\xa2\x9d{$order["\x6f\137\141\155\x6f\165\x6e\164"]}\345\x85\203", "\145\162\x72\x6f\x72\x43\157\144\x65" => 0]; goto GEMda; Ort2f: if (!($refundOrder["\163\x74\x61\164\165\163"] != 1)) { goto TXjRC; } goto Bc5KQ; UXb3h: TXjRC: goto MJsPT; nmGVj: goto DPz15; goto F1DrV; AqKjP: return json(["\155\163\147" => "\xe9\200\x80\xe6\254\xbe\346\210\x90\xe5\212\237", "\x65\162\x72\157\162\103\157\x64\x65" => 1]); goto ZEAc7; az09u: G2Qjm: goto x1IOm; rrz7b: $refundOrder->agree_refund_time = time(); goto Ess_a; zZHr0: $error_msg = $res["\x65\162\x72\137\143\x6f\x64\145\x5f\144\145\x73"]; goto W7nvU; Bc5KQ: return ["\155\163\x67" => "\350\257\245\xe8\256\242\xe5\x8d\225\346\x9a\202\xe4\270\215\xe6\224\xaf\xe6\214\201\351\x80\200\xe6\254\xbe", "\145\x72\x72\x6f\x72\x43\x6f\144\145" => 0]; goto UXb3h; MF97e: $integralDetail = ["\165\x73\145\x72\x5f\151\144" => $refundOrder["\165\x73\145\x72\x5f\151\144"], "\157\162\144\x65\162\x5f\151\x64" => $refundOrder["\x6f\162\x64\x65\162\x5f\x69\x64"], "\x74\x79\x70\145" => 2, "\153\x69\156\144" => 3, "\151\156\164\x65\x67\162\x61\154" => $isIntegralDetail["\151\x6e\164\x65\x67\162\141\154"]]; goto QBSjK; CIxYt: if (!(time() > $ent_time)) { goto GXaB5; } goto RFGYC; xiE5f: return ["\155\163\147" => "\347\xbd\221\xe7\xbb\x9c\345\xbc\x82\xe5\270\270\357\xbc\x8c\350\xaf\267\347\xa8\215\xe5\x90\216\345\x86\215\xe8\257\225", "\145\x72\162\157\162\x43\157\144\x65" => 0]; goto az09u; iI9I3: Rr7qX: goto QTxr7; B8_ic: if (!($refundOrder["\x72\145\x66\x75\x6e\144\137\160\162\x69\x63\x65"] > $order["\157\x5f\x61\x6d\157\165\156\164"])) { goto cKKwi; } goto aBoED; EDkol: $user->save(); goto nl05e; qSwyg: if (!($refundOrder["\162\x65\x66\x75\156\x64\137\x70\x72\151\143\x65"] > $leftMoney)) { goto bYa0r; } goto ex5ah; otShF: $res = WechatService::refund($refund); goto Rz690; W9Z6U: $integral = $user->integral - round($total_money); goto lWxmi; PFqoq: m2z2N: goto qSwyg; F1DrV: RF08I: goto rrz7b; NUl54: $user->save(); goto lRW0e; D_Ed4: if (!($leftMoney <= 0)) { goto m2z2N; } goto B2ewb; udV1y: F3w_l: goto OZr9g; zB1Cj: $refund["\162\x65\x66\x75\x6e\144\x5f\x66\x65\x65"] = $refundOrder["\x72\x65\x66\x75\x6e\144\x5f\160\x72\151\143\145"] * 100; goto otShF; MJsPT: if (!($refundOrder["\x72\x65\146\165\x6e\144\x5f\x70\x72\x69\143\x65"] <= 0)) { goto DjTwA; } goto xucbH; y0Jnw: } public function agree() { goto AKWSw; U_ghX: $data["\x61\x67\162\145\x65\x5f\164\151\155\x65"] = time(); goto Ny2IN; gk5Gh: return ["\x6d\x73\147" => "\xe8\257\245\xe8\xae\xa2\xe5\x8d\x95\xe7\x9a\204\xe6\x94\257\344\xbb\x98\351\x87\x91\xe9\xa2\235\345\267\xb2\351\x80\x80\345\xae\214", "\145\x72\162\157\162\103\157\144\145" => 0]; goto y0y3U; WFXhO: return ["\155\163\147" => "\xe7\275\x91\347\273\234\xe5\274\202\xe5\xb8\xb8\357\xbc\214\xe8\257\267\xe7\xa8\x8d\xe5\220\x8e\xe5\206\215\350\257\x95", "\145\x72\x72\x6f\162\103\157\x64\145" => 0]; goto jaA_a; aFyGD: return ["\x6d\x73\x67" => "\xe8\xaf\267\351\200\x89\346\x8b\xa9\346\224\xb6\350\264\xa7\345\234\xb0\xe5\235\x80", "\x65\162\x72\157\162\x43\157\x64\145" => 0]; goto Cs42C; Ny2IN: $result = OrderRefundModel::update($data); goto bbQIV; IvOpw: $send->sendTplMessage($sendData, "\57" . MODEL . "\57\x70\x61\x67\145\163\57\x55\163\145\x72\x2f\157\x72\x64\145\162\x2f\x6f\162\x64\x65\162\x2f\x6f\162\x64\145\x72"); goto b94E7; A6u83: if (!empty($refund_address)) { goto Bf4pf; } goto FkjKW; y0y3U: epUjW: goto dw9Oa; Z3LEz: return ["\x6d\163\147" => "\346\x93\x8d\344\xbd\234\345\xa4\261\xe8\xb4\xa5", "\x65\162\162\157\x72\x43\157\x64\x65" => 0]; goto kugiz; jaA_a: EbxPZ: goto zBvHU; szp1Y: ctjdU: goto Xxhrh; RmqOR: $id = input("\x69\144"); goto MMbgR; mJ5zk: if (isset($data["\x69\144"])) { goto EbxPZ; } goto WFXhO; dw9Oa: if (!($data["\x72\145\x66\x75\156\144\137\x70\162\x69\143\x65"] > $leftMoney)) { goto qBa3J; } goto BI6wq; AKWSw: $address = RefundAddress::where(["\165\x6e\x69\x61\143\151\144" => session("\165\x6e\x69\141\x63\151\x64"), "\x73\164\141\x74\165\x73" => 1])->order("\x63\162\145\141\x74\145\137\x74\x69\x6d\145", "\144\x65\x73\x63")->select(); goto RmqOR; jynvh: $refundOrder = OrderRefundModel::get($data["\151\144"]); goto Q2Ydf; DgM1I: $template = $wxTemplate->getTemplateById("\101\x54\x30\61\71\67"); goto XkT3k; H2ImC: Bf4pf: goto jynvh; RQ39V: return ["\155\x73\147" => "\xe6\x93\215\344\275\x9c\346\x88\x90\345\212\237", "\x65\x72\x72\157\162\x43\x6f\x64\x65" => 1]; goto PQWES; BI6wq: return ["\x6d\163\147" => "\xe8\xaf\xa5\xe8\xae\242\345\215\225\350\277\230\345\x89\xa9" . $leftMoney . "\345\x85\x83\345\217\257\xe9\x80\200", "\x65\x72\162\157\x72\x43\x6f\x64\x65" => 0]; goto Qb2W7; zBvHU: if (!(!isset($data["\x72\x65\x66\165\x6e\x64\137\160\x72\151\143\x65"]) || $data["\162\x65\146\165\156\144\x5f\x70\x72\151\143\x65"] <= 0)) { goto bRrkX; } goto DFUas; bbQIV: if ($result !== false) { goto ctjdU; } goto Z3LEz; Xxhrh: $newOrder = OrderRefundModel::get($data["\151\144"]); goto DgM1I; BAFzS: $data["\163\x74\141\164\165\x73"] = 1; goto G2Axp; G2Axp: $data["\162\145\x66\x75\156\144\x5f\141\x64\x64\162\x65\163\163"] = $refund_address["\141\x64\x64\162\145\163\163"]; goto U_ghX; NLaO4: bRrkX: goto AiFpy; Rx1yS: wqoHv: goto BM3j9; Qb2W7: qBa3J: goto BAFzS; zbSsL: KABkR: goto Y68Wj; FxMDQ: if (!($leftMoney <= 0)) { goto epUjW; } goto gk5Gh; BM3j9: $this->assign(["\x6f\162\144\145\162" => $refundOrder, "\141\x64\144\x72\x65\x73\x73" => $address]); goto VihPK; Y68Wj: $leftMoney = $this->getRefundOrderLeftMoney($refundOrder["\157\162\x64\145\162\x5f\151\x64"], $order["\157\137\x61\x6d\x6f\165\156\164"]); goto FxMDQ; ZmfED: $data = json_decode(input("\x64\141\164\x61"), true); goto mJ5zk; PQWES: vJ4ld: goto Rx1yS; b94E7: YPOnC: goto RQ39V; gmm1J: if (!request()->isAjax()) { goto wqoHv; } goto Lqbxp; VihPK: return $this->fetch(); goto EQc61; FkjKW: return ["\155\x73\147" => "\xe6\224\xb6\350\xb4\247\xe5\x9c\260\xe5\235\200\xe4\xb8\215\345\255\x98\xe5\234\xa8", "\145\162\x72\x6f\162\x43\157\x64\x65" => 0]; goto H2ImC; Lqbxp: $wxTemplate = new WxTemplate(); goto ZmfED; c2uJU: if (!($data["\x72\145\146\165\156\144\x5f\160\162\151\x63\145"] > $order["\157\137\141\155\x6f\x75\x6e\x74"])) { goto KABkR; } goto XToem; XkT3k: if (!($template && $newOrder["\160\162\x65\x70\x61\171\x5f\x69\x64"])) { goto YPOnC; } goto Nh1zc; Cs42C: qtowE: goto XzaML; Y99u2: $send = new SendMessage(); goto IvOpw; Nh1zc: $sendData = ["\164\x70\154\x49\144" => $template, "\160\162\x65\160\x61\x79\137\151\x64" => $newOrder["\160\162\x65\160\141\171\x5f\151\x64"], "\x75\151\144" => $newOrder["\165\x73\145\x72\x5f\151\144"], "\153\x65\171\x77\157\162\x64\61" => $newOrder["\x63\162\145\141\164\145\137\x74\151\x6d\x65"], "\153\145\171\167\x6f\162\x64\62" => "\346\202\250\346\x8f\220\344\xba\244\xe7\232\204\345\224\256\xe5\x90\216\xe7\x94\xb3\xe8\257\267\xe5\267\xb2\xe9\200\232\350\xbf\x87\xef\274\x8c\xe8\xaf\xb7\345\xb0\xbd\345\xbf\253\345\257\x84\345\233\x9e\345\225\206\xe5\223\201\xe5\x8f\212\345\241\xab\345\x86\x99\347\211\251\xe6\265\x81\xe4\xbf\xa1\346\201\257"]; goto Y99u2; Q2Ydf: $order = OrderModel::get($refundOrder["\x6f\162\144\145\x72\137\151\144"]); goto c2uJU; DFUas: return ["\155\x73\x67" => "\xe9\200\200\346\xac\xbe\351\x87\221\xe9\242\235\351\234\200\345\xa4\xa7\xe4\xba\x8e\60", "\145\162\x72\x6f\162\103\x6f\x64\145" => 0]; goto NLaO4; MMbgR: $refundOrder = OrderRefundModel::get($id); goto gmm1J; XzaML: $refund_address = RefundAddress::get($data["\x61\x64\144\x72\145\x73\163\137\151\x64"]); goto A6u83; AiFpy: if (!(!isset($data["\x61\144\x64\162\x65\163\x73\x5f\x69\144"]) || $data["\x61\x64\144\162\145\x73\x73\x5f\151\x64"] == '')) { goto qtowE; } goto aFyGD; kugiz: goto vJ4ld; goto szp1Y; XToem: return ["\x6d\x73\x67" => "\351\200\200\xe6\xac\xbe\xe9\207\x91\xe9\xa2\235\xe4\270\215\xe8\x83\xbd\345\xa4\247\344\xba\x8e\xe6\224\xaf\344\273\x98\351\207\221\351\xa2\x9d{$order["\157\x5f\x61\x6d\157\x75\x6e\164"]}\xe5\x85\x83", "\x65\x72\x72\x6f\162\103\157\144\x65" => 0]; goto zbSsL; EQc61: } private function getRefundOrderLeftMoney($orderId, $o_amount) { goto ZjK9a; TrB3k: return $leftMoney; goto GDpR4; ZjK9a: $sameOrder = OrderRefundModel::where(["\x6f\162\x64\145\162\x5f\x69\x64" => $orderId, "\x75\x6e\151\141\x63\151\x64" => session("\165\156\x69\x61\x63\x69\144"), "\x73\164\x61\164\165\163" => 2])->select(); goto bCC8W; ZW01t: $allMoney = array_sum($allMoneyArr); goto w3iHF; w9Yna: cEATy: goto ZW01t; bCC8W: $allMoneyArr = []; goto UkMSx; w3iHF: $leftMoney = $o_amount - $allMoney; goto TrB3k; UkMSx: foreach ($sameOrder as $key => $value) { $allMoneyArr[$key] = $value["\162\145\146\x75\x6e\x64\137\x70\162\151\143\145"]; NpE_K: } goto w9Yna; GDpR4: } public function refuse() { goto LmXYW; B2OV_: $wxTemplate = new WxTemplate(); goto lsVD9; P7J40: return ["\x6d\x73\147" => "\346\x93\215\344\xbd\x9c\345\244\xb1\xe8\264\245", "\145\162\162\157\x72\103\157\x64\x65" => 0]; goto TwrnW; lzB9u: return $this->fetch(); goto bgcXE; LmXYW: $id = input("\151\144"); goto gHoGD; aEuP6: $this->assign("\x6f\162\144\x65\162", $order); goto lzB9u; LbmCO: Jp6H7: goto zSDh7; c7Jvk: $send->sendTplMessage($sendData, "\x2f" . MODEL . "\x2f\160\x61\147\x65\163\x2f\125\x73\x65\x72\57\x6f\162\144\x65\162\x2f\157\x72\144\145\162\x2f\157\162\x64\x65\x72"); goto V8EtO; T4SB6: $data = json_decode(input("\144\x61\x74\141"), true); goto Ja19p; JEd7P: return json(["\x6d\163\x67" => "\xe6\225\260\xe6\x8d\256\xe5\xbc\x82\xe5\270\xb8\357\274\x8c\350\257\267\347\250\215\345\220\216\345\206\215\350\xaf\x95", "\145\x72\162\157\162\x43\157\x64\x65" => 0]); goto ybGhF; QZIRZ: $send = new SendMessage(); goto c7Jvk; W9rZn: qbPTX: goto aEuP6; vbj4G: $data["\x73\164\141\x74\x75\x73"] = 3; goto apQ2u; EOtQt: if ($res) { goto Jp6H7; } goto fEv5y; z3CI_: if (!($template && $newOrder["\x70\x72\x65\x70\141\x79\x5f\x69\x64"])) { goto sM3IE; } goto LjlcP; Ja19p: if (!($data["\151\144"] == '')) { goto U1uuI; } goto JEd7P; lsVD9: $template = $wxTemplate->getTemplateById("\x41\124\x30\x37\x33\67"); goto z3CI_; TwrnW: goto gM0bi; goto r5g5b; qp7Of: $res = OrderRefundModel::where("\x73\164\x61\x74\165\x73", "\x3c\76", "\x33")->where("\157\x72\144\x65\162\137\151\x64", "\75", $order["\157\162\x64\145\162\x5f\x69\144"])->find(); goto EOtQt; V8EtO: sM3IE: goto qp7Of; r5g5b: OLvhR: goto ZBkGt; zSDh7: return ["\x6d\x73\147" => "\346\x93\x8d\xe4\275\x9c\xe6\210\220\xe5\x8a\237", "\145\x72\x72\157\x72\103\157\144\x65" => 1]; goto mPdzG; aR1_f: $oldOrder->is_refund = "\60"; goto g0_PI; ZBkGt: $newOrder = OrderRefundModel::get($data["\151\144"]); goto B2OV_; oeBEZ: $result = OrderRefundModel::update($data); goto gP_10; apQ2u: $data["\162\x65\146\x75\x73\x65\x5f\x74\x69\x6d\145"] = time(); goto oeBEZ; gHoGD: $order = OrderRefundModel::get($id); goto h1L5y; ybGhF: U1uuI: goto vbj4G; fEv5y: $oldOrder = OrderModel::find($order["\157\162\x64\x65\162\137\151\x64"]); goto aR1_f; g0_PI: $oldOrder->save(); goto LbmCO; LjlcP: $sendData = ["\164\x70\x6c\x49\144" => $template, "\x70\x72\145\160\141\171\137\151\x64" => $newOrder["\160\x72\x65\x70\x61\x79\x5f\x69\144"], "\165\151\x64" => $newOrder["\x75\163\145\x72\137\x69\x64"], "\x6b\x65\x79\x77\157\162\144\x31" => $newOrder["\x63\x72\145\x61\164\x65\x5f\164\151\155\x65"], "\153\145\x79\x77\x6f\x72\x64\62" => "\xe6\x82\250\xe6\217\x90\xe4\272\xa4\xe7\232\204\xe5\x94\xae\xe5\220\x8e\347\x94\263\350\xaf\267\xe5\xb7\xb2\xe8\xa2\xab\346\213\x92\347\273\x9d\xef\xbc\x8c\350\xaf\xa6\xe6\203\205\xe8\xaf\267\345\222\250\xe8\257\xa2\xe5\xae\xa2\xe6\234\x8d"]; goto QZIRZ; gP_10: if ($result !== false) { goto OLvhR; } goto P7J40; mPdzG: gM0bi: goto W9rZn; h1L5y: if (!request()->isAjax()) { goto qbPTX; } goto T4SB6; bgcXE: } public function realDel() { goto lNCSh; lNCSh: $id = input("\151\144"); goto YCDBD; e4yhO: $result = $order->delete(); goto azuXQ; G2FWz: return ["\155\x73\147" => "\xe6\223\215\xe4\xbd\234\346\210\x90\345\212\x9f", "\x65\162\162\x6f\x72\x43\157\144\x65" => 1]; goto UOEFP; hxJis: if ($order) { goto Whh1k; } goto GYHjf; YCDBD: $order = OrderRefundModel::get($id); goto hxJis; azuXQ: if ($result !== false) { goto GtnTx; } goto hrqTp; GYHjf: return ["\155\x73\147" => "\350\xae\xa2\xe5\215\x95\344\xb8\x8d\345\xad\x98\xe5\234\xa8", "\x65\x72\x72\x6f\x72\x43\157\144\145" => 0]; goto ROcvd; Sc08b: return $this->fetch(); goto qpyh7; ftanB: $this->assign("\157\162\x64\x65\162", $order); goto Sc08b; aHePw: goto LGkkr; goto LBiYk; ROcvd: Whh1k: goto e4yhO; LBiYk: GtnTx: goto G2FWz; hrqTp: return ["\x6d\163\x67" => "\xe6\223\215\xe4\275\x9c\xe5\xa4\xb1\350\264\xa5", "\x65\x72\162\x6f\162\103\157\x64\145" => 0]; goto aHePw; UOEFP: LGkkr: goto ftanB; qpyh7: } }