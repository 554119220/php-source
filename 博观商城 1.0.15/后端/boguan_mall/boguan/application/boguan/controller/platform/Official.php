<?php
 namespace app\boguan\controller\platform; use app\boguan\controller\Platform; use app\boguan\model\WxTemplate; use think\Request; use app\boguan\service\Wechat as WechatService; use app\boguan\model\PublicSettings; use app\boguan\model\PublicTemplate; use app\boguan\service\Official as OfficialService; class Official extends Platform { public function __construct(Request $request = null) { goto bfTj_; iXEt7: $setting = PublicSettings::where("\x75\156\151\x61\x63\x69\x64", $this->uniacid)->find(); goto og8UC; bfTj_: parent::__construct($request); goto iXEt7; og8UC: $this->setting = $setting; goto R0ng1; R0ng1: } public function index() { goto O9yM7; pAP7f: if ($validate->scene("\167\145\x69\170\x69\x6e")->check($data)) { goto rFU7E; } goto AFTlP; WCSEL: return $this->fetch(); goto NmvJ_; jyhE4: $this->assign(["\x73\145\x74\164\x69\x6e\x67" => $this->setting]); goto WCSEL; aMoNR: return json(["\x6d\163\x67" => "\344\277\xae\346\224\xb9\345\xa4\261\xe8\264\xa5", "\x65\x72\162\157\162\x43\x6f\x64\x65" => 0]); goto Pz36j; O9yM7: if (!request()->isAjax()) { goto csX1b; } goto IvIoI; Zf5_O: $result = PublicSettings::create($data); goto b2a4Y; bnuxx: rFU7E: goto Xu235; Tbsxk: VCHHJ: goto aivNB; aivNB: $result = PublicSettings::update($data); goto OwJJL; t_ndF: csX1b: goto jyhE4; fy01I: hP0u9: goto t_ndF; X_MGc: MRJtz: goto FUAZh; Ut7XE: $validate = \think\Loader::validate("\x53\x65\x74\x74\x69\156\147"); goto pAP7f; b2a4Y: goto j99xh; goto Tbsxk; Xu235: if ($data["\151\x64"]) { goto VCHHJ; } goto A9RDN; Iesoy: if ($result !== false) { goto MRJtz; } goto aMoNR; Pz36j: goto hP0u9; goto X_MGc; FUAZh: return json(["\x6d\x73\x67" => "\344\277\256\346\224\xb9\xe6\210\220\345\x8a\237", "\145\162\x72\157\x72\x43\x6f\x64\145" => 1]); goto fy01I; AFTlP: return json(["\x6d\x73\x67" => $validate->getError(), "\145\162\x72\157\162\x43\157\144\145" => 0]); goto bnuxx; OwJJL: j99xh: goto Iesoy; A9RDN: $data["\165\x6e\151\x61\143\151\x64"] = $this->uniacid; goto Zf5_O; IvIoI: $data = input("\160\157\163\x74\56\144\x61\164\x61\x2f\141"); goto Ut7XE; NmvJ_: } public function template() { goto U1LCV; GNRSp: foreach ($template as $key => $value) { goto oVBXe; d0jJz: $template[$key]["\x74\160\x6c"] = "\55"; goto WlJYI; WlJYI: goto BAs0a; goto knN4S; iBVd0: if ($value["\151\x64"] == $wxTemplate["\x74\x70\x6c\x5f\151\144"]) { goto dCgTc; } goto d0jJz; knN4S: dCgTc: goto rIz9X; W7nmN: BAs0a: goto Wt1zT; sYEYi: qHfzS: goto m56oq; rIz9X: $template[$key]["\x74\160\x6c"] = $wxTemplate["\164\160\154"]; goto W7nmN; Wt1zT: $template[$key]["\143\x72\145\141\x74\x65\x5f\x74\151\x6d\x65"] = $wxTemplate["\x63\x72\145\x61\164\145\x5f\164\x69\155\145"] ? $wxTemplate["\x63\x72\x65\141\x74\x65\x5f\x74\x69\155\x65"] : "\55"; goto sYEYi; oVBXe: $wxTemplate = PublicTemplate::where(["\165\x6e\151\141\143\x69\144" => $this->uniacid, "\164\x70\154\x5f\151\x64" => $value["\151\144"]])->find(); goto iBVd0; m56oq: } goto U8sO7; f0TBu: X9twe: goto M6434; Ebt4_: if (!request()->isAjax()) { goto X9twe; } goto O52dE; kXHK7: return $this->fetch(); goto DI13k; U1LCV: $wechatService = new OfficialService(); goto v723q; vdhkC: ccaBk: goto f0TBu; U8sO7: RziVT: goto Ebt4_; rQCay: return json(["\155\163\147" => "\xe8\216\267\345\217\226\346\210\x90\345\212\237", "\145\x72\162\x6f\162\103\157\144\x65" => 1]); goto vdhkC; M6434: $this->assign("\x74\x65\x6d\160\x6c\x61\x74\x65", $template); goto kXHK7; I3gaS: if ($res !== false) { goto QwpXo; } goto GOW2c; v723q: $template = $this->setPublicTemplate(); goto GNRSp; GOW2c: return json(["\x6d\x73\x67" => $this->msg ? $this->msg . $this->errcode : "\xe8\x8e\xb7\345\217\226\345\244\261\350\264\xa5\357\xbc\214\350\xaf\267\347\250\215\345\200\231\345\206\x8d\350\257\225", "\x65\x72\x72\x6f\x72\x43\x6f\144\x65" => 0]); goto u6Ubz; u6Ubz: goto ccaBk; goto inhZR; lMGDQ: $res = true; goto ePArL; inhZR: QwpXo: goto rQCay; ePArL: foreach ($template as $key => $value) { goto RCGFC; sH0BA: $this->msg = "\345\205\xac\xe4\274\x97\345\217\xb7\346\266\210\346\201\xaf\xe6\xa8\241\xe6\x9d\xbf\xe8\266\205\xe5\x87\272\346\x95\xb0\xe9\x87\217\xe9\x99\x90\xe5\210\xb6\357\274\x8c\350\257\267\345\210\xa0\351\x99\xa4\345\x90\216\345\x86\x8d\xe8\257\225\343\x80\202"; goto bLoIl; OC9gk: $data["\x74\160\154\x5f\x69\144"] = $value["\x69\x64"]; goto k_FO3; uRetP: $res = PublicTemplate::update($data); goto At_gp; jJg3O: $haveTemplate = PublicTemplate::where(["\165\156\151\x61\x63\x69\x64" => $this->uniacid, "\164\x70\x6c\137\x69\x64" => $value["\151\x64"]])->find(); goto szD10; At_gp: DW3UM: goto tr3Eh; g9e75: $this->msg = $result["\x65\162\x72\155\x73\x67"]; goto bh1rh; kgK34: iOHaM: goto cUXsM; RCGFC: $result = json_decode($wechatService->getTemplateId($value), true); goto sST1H; anqD2: unset($data["\x69\144"]); goto a1OWc; zxzML: $data["\151\x64"] = $haveTemplate["\151\144"]; goto DfooP; DfooP: $wechatService->deleteTemplateId($haveTemplate); goto uRetP; szD10: if ($haveTemplate) { goto PnO4n; } goto anqD2; PFkS4: goto wefp2; goto kgK34; bh1rh: if (!($result["\145\162\x72\143\157\x64\x65"] == "\64\65\60\62\x36")) { goto c2BNF; } goto sH0BA; tr3Eh: wefp2: goto eRWwh; k_FO3: $data["\x63\162\x65\x61\164\145\137\x74\x69\155\145"] = time(); goto CrVSE; bLoIl: c2BNF: goto PFkS4; BAJbi: $res = false; goto g9e75; CrVSE: $data["\165\156\x69\x61\143\151\x64"] = $this->uniacid; goto jJg3O; eRWwh: WwMFN: goto Rn_QP; l7Wlu: PnO4n: goto zxzML; a1OWc: $res = PublicTemplate::create($data); goto jFJP4; sST1H: if ($result["\145\x72\162\x63\x6f\x64\x65"] == 0) { goto iOHaM; } goto BAJbi; cUXsM: $data["\164\x70\x6c"] = $result["\164\145\155\x70\x6c\141\164\145\137\151\144"]; goto OC9gk; jFJP4: goto DW3UM; goto l7Wlu; Rn_QP: } goto xl8hD; xl8hD: uesFh: goto I3gaS; O52dE: $template = $this->setPublicTemplate(); goto lMGDQ; DI13k: } }