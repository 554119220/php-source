<?php
 namespace app\boguan\controller\platform; use app\boguan\controller\Platform; use app\boguan\model\EmailSet; use app\boguan\model\PlatformSettings; use app\boguan\model\SmsSet; use app\boguan\model\WxTemplate; use app\boguan\model\Admin as AdminMoel; use think\Request; use app\boguan\service\Wechat as WechatService; use app\boguan\model\ShareSetting; class Setting extends Platform { public function __construct(Request $request = null) { goto sB03w; S9Bo6: $setting = PlatformSettings::where("\165\x6e\x69\x61\x63\151\x64", $this->uniacid)->find(); goto VF3yB; sB03w: parent::__construct($request); goto S9Bo6; VF3yB: $this->setting = $setting; goto wMTq5; wMTq5: } public function index() { goto UVBbj; oPQfR: if (!request()->isAjax()) { goto nDs96; } goto EqLyx; oFvfn: return json(["\x6d\163\147" => $validate->getError(), "\x65\162\x72\x6f\162\103\157\144\x65" => 0]); goto lpiyS; LnktA: if ($result !== false) { goto vpB1O; } goto NqukZ; L4X5J: goto V2Wg9; goto k83ci; Q0_mm: $location = explode("\54", $data["\154\157\143\141\164\151\157\x6e"]); goto qZxtc; bojh3: $validate = \think\Loader::validate("\123\x65\x74\x74\x69\156\x67"); goto J7I06; wvqeg: return $this->fetch(); goto ymDXx; huvuI: $data["\154\x6f\x67\x6f"] = ''; goto G53dI; wKTrO: vpB1O: goto PARV3; f1sW0: QUHe5: goto hCjjc; QwFuv: goto y0Alr; goto wKTrO; Gqe0y: $result = PlatformSettings::update($data); goto PVL5B; lpiyS: lzkgB: goto Q0_mm; PVL5B: V2Wg9: goto LnktA; CK7lY: $this->assign(["\163\x65\164\x74\151\x6e\x67" => $this->setting, "\x69\x6d\141\147\x65\x4c\151\x73\x74" => $imageList]); goto wvqeg; pGMvp: nDs96: goto CK7lY; it6Mh: if ($data["\151\144"]) { goto X5yic; } goto vpCZi; UVBbj: $imageList = json_encode($this->imageList()); goto oPQfR; k83ci: X5yic: goto Gqe0y; pWdIK: $data["\154\141\x74\151\x74\165\x64\x65"] = $location[1]; goto f1sW0; xMxxT: if (isset($data["\154\157\x67\x6f"])) { goto v93o1; } goto huvuI; Hk1hs: if (!isset($location[1])) { goto QUHe5; } goto pWdIK; qZxtc: if (!isset($location[0])) { goto M7vlz; } goto SXi0M; hCjjc: unset($data["\154\x6f\x63\x61\164\151\157\156"]); goto xMxxT; G8cma: y0Alr: goto pGMvp; EqLyx: $data = input("\x70\157\x73\x74\x2e"); goto bojh3; NqukZ: return json(["\x6d\163\x67" => "\344\277\256\xe6\x94\xb9\xe5\xa4\261\350\264\245", "\145\x72\x72\157\x72\103\157\x64\145" => 0]); goto QwFuv; VvN7w: M7vlz: goto Hk1hs; J7I06: if ($validate->scene("\151\156\144\145\x78")->check($data)) { goto lzkgB; } goto oFvfn; PARV3: return json(["\x6d\x73\x67" => "\xe4\xbf\256\xe6\224\xb9\xe6\210\220\345\x8a\x9f", "\x65\x72\x72\x6f\x72\x43\157\144\x65" => 1]); goto G8cma; G53dI: v93o1: goto it6Mh; SXi0M: $data["\x6c\157\156\147\151\x74\x75\144\x65"] = $location[0]; goto VvN7w; vpCZi: $data["\x75\x6e\151\141\x63\151\x64"] = $this->uniacid; goto QNVFa; QNVFa: $result = PlatformSettings::create($data); goto L4X5J; ymDXx: } public function general() { goto ygvaq; NWO7I: $data = input("\x70\x6f\x73\x74\x2e\x64\141\x74\x61\57\141"); goto EQblo; Y9lUt: if ($result !== false) { goto SKXVR; } goto VmMBt; MtZpQ: pTVhD: goto wz1sz; E1pF3: RVrvl: goto djCVz; vSLiu: $result = PlatformSettings::create($data); goto NFfUy; cIE1_: $this->assign(["\x73\145\x74\164\x69\156\x67" => $this->setting]); goto nEAw8; djCVz: if ($data["\151\x64"]) { goto pTVhD; } goto SrO0W; VAlym: goto uVdGl; goto v8GH8; NFfUy: goto zQjyW; goto MtZpQ; SrO0W: $data["\165\156\151\x61\143\151\x64"] = $this->uniacid; goto vSLiu; VmMBt: return json(["\155\163\147" => "\xe4\xbf\xae\346\224\xb9\345\244\261\350\xb4\xa5", "\x65\x72\162\157\x72\103\157\x64\x65" => 0]); goto VAlym; EQblo: $share = ShareSetting::where(["\x75\156\151\x61\143\151\144" => session("\x75\x6e\151\x61\143\x69\144")])->field("\x73\167\x69\164\143\150")->find(); goto K65Ka; v8GH8: SKXVR: goto k64UO; tHNDc: OsvGY: goto cIE1_; Sq100: uVdGl: goto tHNDc; wz1sz: $result = PlatformSettings::update($data); goto PKGui; HZf_B: return json(["\155\x73\147" => "\xe7\xb3\xbb\xe7\273\x9f\346\243\200\346\265\213\345\210\260\345\275\223\345\211\x8d\xe5\xb7\xb2\xe5\274\200\xe5\220\xaf\xe5\x88\x86\xe9\224\200\345\212\237\350\x83\275\xef\xbc\214\350\xaf\267\346\x89\223\xe5\274\x80\345\274\272\345\210\266\346\x8e\x88\xe6\235\x83", "\145\162\x72\x6f\162\x43\x6f\x64\x65" => 0]); goto E1pF3; K65Ka: if (!($data["\x69\x73\x5f\x74\x6f\153\x65\156"] == "\x30" && $share["\x73\167\151\164\x63\x68"] == 1)) { goto RVrvl; } goto HZf_B; ygvaq: if (!request()->isAjax()) { goto OsvGY; } goto NWO7I; PKGui: zQjyW: goto Y9lUt; nEAw8: return $this->fetch(); goto rg8yl; k64UO: return json(["\x6d\163\147" => "\344\xbf\256\346\224\xb9\346\x88\220\345\x8a\237", "\145\x72\x72\x6f\x72\103\157\x64\145" => 1]); goto Sq100; rg8yl: } public function weixin() { goto GqPeA; owR7e: goto LT61V; goto mpvRS; ZJx0W: goto Pu2uv; goto tRYNi; AfAPY: $certPath = APP_PATH . "\57\145\x78\164\x72\x61\x2f\167\x65\x69\170\151\156\x70\x65\x6d\x2f\141\160\151\x63\x6c\x69\145\156\x74\x5f\x63\x65\162\164\137{$this->uniacid}\x2e\x70\145\155"; goto s_8zy; FeZV8: return json(["\155\x73\147" => $validate->getError(), "\x65\x72\x72\157\162\x43\157\x64\x65" => 0]); goto EJWSf; fSodW: $data["\x75\x6e\151\141\x63\x69\144"] = $this->uniacid; goto Sm9Fe; O3vm2: return $this->fetch(); goto Ale0c; H1hHd: if (is_dir(dirname($keyPath))) { goto ZA346; } goto ZQVsF; GqPeA: if (!request()->isAjax()) { goto A7cVp; } goto mqyRb; qyHuq: $result = PlatformSettings::update($data); goto V3GP8; J4wPR: if ($result !== false) { goto xd6iP; } goto gyvcE; OHYCi: return json(["\x6d\x73\x67" => "\xe4\xbf\xae\346\x94\271\346\x88\220\345\x8a\x9f", "\x65\162\x72\x6f\162\103\x6f\x64\x65" => 1]); goto ArPyy; ebJxI: $keyPath = APP_PATH . "\57\145\x78\x74\x72\141\x2f\x77\145\x69\x78\151\156\x70\145\155\57\141\160\x69\143\x6c\151\145\156\164\137\153\145\x79\x5f{$this->uniacid}\x2e\160\x65\x6d"; goto H1hHd; C_9FA: A7cVp: goto BTBYB; ZQVsF: mkdir($keyPath, 0755, true); goto cEIKi; tRYNi: veH7v: goto qyHuq; EJWSf: n4HO_: goto AfAPY; V3GP8: Pu2uv: goto J4wPR; biy0P: file_put_contents($certPath, $data["\x63\145\x72\x74\137\160\x65\155"]); goto ebJxI; jEEWb: if ($data["\x69\144"]) { goto veH7v; } goto fSodW; s_8zy: if (is_dir(dirname($certPath))) { goto A3TNR; } goto G7EWq; Sm9Fe: $result = PlatformSettings::create($data); goto ZJx0W; G7EWq: mkdir($certPath, 0755, true); goto Rnw1a; cEIKi: ZA346: goto dLFfp; Q5c8g: if ($validate->scene("\167\145\151\x78\151\156")->check($data)) { goto n4HO_; } goto FeZV8; ArPyy: LT61V: goto C_9FA; mqyRb: $data = input("\160\157\163\164\x2e\x64\x61\x74\141\57\141"); goto lp21B; mpvRS: xd6iP: goto OHYCi; dLFfp: file_put_contents($keyPath, $data["\153\145\171\x5f\160\145\x6d"]); goto jEEWb; BTBYB: $this->assign(["\163\x65\164\164\x69\156\147" => $this->setting]); goto O3vm2; gyvcE: return json(["\x6d\x73\147" => "\344\277\xae\xe6\224\xb9\xe5\xa4\261\xe8\264\xa5", "\x65\x72\x72\x6f\162\x43\x6f\144\145" => 0]); goto owR7e; lp21B: $validate = \think\Loader::validate("\123\x65\164\164\151\x6e\147"); goto Q5c8g; Rnw1a: A3TNR: goto biy0P; Ale0c: } public function template() { goto rYIDo; nTQDa: l0blj: goto wPTol; wPTol: if (!request()->isAjax()) { goto JqX_C; } goto TK9JC; CE2A8: foreach ($template as $key => $value) { goto ZOYlz; UEFKn: $this->msg = "\345\260\x8f\347\250\213\345\272\x8f\xe6\xb6\x88\346\x81\257\xe6\250\241\xe6\235\277\350\266\205\xe5\207\272\xe6\225\260\351\207\x8f\xe9\x99\x90\xe5\x88\266\357\xbc\214\350\257\267\345\x88\xa0\351\231\244\345\220\216\xe5\206\x8d\350\257\x95\343\x80\202"; goto fG_s0; fG_s0: VUJAk: goto bIyCK; ftTKh: goto wNfc3; goto wT1AD; D2wl4: $res = false; goto rXBUN; vPeUF: $data["\165\156\x69\141\143\x69\x64"] = $this->uniacid; goto uqaqk; bIyCK: goto P4uSu; goto pLFN9; pLFN9: XsEXb: goto OGDlh; UON25: $data["\x69\x64"] = $haveTemplate["\151\144"]; goto f9he4; DjrLB: if ($result["\145\162\162\143\157\x64\x65"] == 0) { goto XsEXb; } goto D2wl4; wT1AD: oeN8T: goto UON25; fl1Ej: wNfc3: goto BzxCw; rXBUN: $this->msg = $result["\x65\162\162\155\163\x67"]; goto uthfq; uthfq: if (!($result["\145\x72\162\x63\x6f\144\x65"] == "\x34\65\x30\x32\x36")) { goto VUJAk; } goto UEFKn; ZOYlz: $result = json_decode($wechatService->getTemplateId($value), true); goto DjrLB; v4O1R: if ($haveTemplate) { goto oeN8T; } goto HhSEC; f9he4: $wechatService->deleteTemplateId($haveTemplate); goto fKUP8; YgJU_: $data["\143\162\145\x61\x74\x65\137\164\x69\155\x65"] = time(); goto vPeUF; BzxCw: P4uSu: goto eF_i1; yInOn: $data["\164\x70\x6c\x5f\x69\144"] = $value["\151\x64"]; goto YgJU_; HhSEC: unset($data["\x69\x64"]); goto u9rMJ; OGDlh: $data["\164\160\154"] = $result["\164\145\155\160\x6c\141\164\x65\137\151\144"]; goto yInOn; u9rMJ: $res = WxTemplate::create($data); goto ftTKh; eF_i1: jKwpM: goto szr2k; fKUP8: $res = WxTemplate::update($data); goto fl1Ej; uqaqk: $haveTemplate = WxTemplate::where(["\x75\156\x69\141\143\151\x64" => $this->uniacid, "\164\160\x6c\x5f\x69\x64" => $value["\151\x64"]])->find(); goto v4O1R; szr2k: } goto pY1kG; pY1kG: VNqzF: goto vdO7l; MOG1D: uecgd: goto oMzzY; rYIDo: $wechatService = new WechatService(); goto R3s7H; zpTao: foreach ($template as $key => $value) { goto nWTDJ; qgKUU: GNNCX: goto GTwCn; ZvzrK: $template[$key]["\143\162\145\141\164\145\137\164\151\x6d\x65"] = $wxTemplate["\x63\x72\145\141\x74\x65\x5f\x74\151\x6d\145"] ? date("\131\55\155\x2d\x64\40\x48\72\151\72\x73", $wxTemplate["\143\x72\145\141\x74\145\137\164\x69\155\145"]) : "\x2d"; goto iU5r0; WNsTz: $template[$key]["\x74\160\x6c"] = "\55"; goto N65H0; nWTDJ: $wxTemplate = WxTemplate::where(["\x75\x6e\151\x61\x63\151\144" => $this->uniacid, "\x74\x70\x6c\x5f\151\144" => $value["\x69\x64"]])->find(); goto Hmtk6; ewoQ5: juuK1: goto ZvzrK; Hmtk6: if ($value["\151\x64"] == $wxTemplate["\164\160\x6c\x5f\x69\x64"]) { goto GNNCX; } goto WNsTz; iU5r0: tvpL4: goto lyVBU; N65H0: goto juuK1; goto qgKUU; GTwCn: $template[$key]["\x74\x70\154"] = $wxTemplate["\x74\160\x6c"]; goto ewoQ5; lyVBU: } goto nTQDa; vdO7l: if ($res !== false) { goto uecgd; } goto k2hRw; G_zrI: lFjWD: goto R6Fb2; R6Fb2: JqX_C: goto WVYMw; Xuaep: goto lFjWD; goto MOG1D; mh7E7: $res = true; goto CE2A8; k2hRw: return json(["\x6d\x73\x67" => $this->msg ? $this->msg . $this->errcode : "\350\216\xb7\xe5\x8f\x96\xe5\244\261\xe8\xb4\xa5\357\xbc\x8c\xe8\xaf\267\xe7\250\215\345\x80\231\345\206\x8d\xe8\xaf\x95", "\145\x72\x72\157\x72\x43\x6f\144\145" => 0]); goto Xuaep; R3s7H: $template = $this->setTemplate(); goto zpTao; TK9JC: $template = $this->setTemplate(); goto mh7E7; M7lqv: return $this->fetch(); goto KTtdn; WVYMw: $this->assign("\x74\x65\155\x70\x6c\141\164\x65", $template); goto M7lqv; oMzzY: return json(["\155\163\x67" => "\xe8\216\xb7\xe5\x8f\226\346\210\220\xe5\x8a\x9f", "\145\x72\x72\157\x72\x43\157\x64\145" => 1]); goto G_zrI; KTtdn: } public function sms() { goto jmPVX; EYF7K: Ol29I: goto X7rbs; X7rbs: $result = SmsSet::update($data); goto Rdd39; Rdd39: UgUL3: goto K7Nf7; gVTxm: $data["\x75\x6e\151\141\143\151\144"] = $this->uniacid; goto gL9yO; bDCta: GpQWf: goto B2SKh; lgE3e: if (!request()->isAjax()) { goto lI7Rx; } goto bz1Ea; PpNOB: if ($data["\151\x64"]) { goto Ol29I; } goto gVTxm; gL9yO: $result = SmsSet::create($data); goto tTjuk; lvgUM: ALgiR: goto ex9sL; ehTXb: $this->assign(["\163\x6d\163" => $sms]); goto iS8De; K7Nf7: if ($result !== false) { goto ALgiR; } goto AtAnV; AtAnV: return json(["\x6d\x73\147" => "\344\277\256\346\x94\xb9\345\244\261\350\xb4\xa5", "\x65\162\x72\x6f\x72\x43\x6f\144\145" => 0]); goto PhuXV; B2SKh: lI7Rx: goto ehTXb; jmPVX: $sms = SmsSet::where("\x75\x6e\151\x61\x63\151\x64", $this->uniacid)->find(); goto lgE3e; iS8De: return $this->fetch(); goto GgAJr; ex9sL: return json(["\155\x73\x67" => "\xe4\277\256\xe6\224\271\xe6\x88\220\345\212\237", "\x65\162\x72\x6f\x72\x43\x6f\144\145" => 1]); goto bDCta; tTjuk: goto UgUL3; goto EYF7K; bz1Ea: $data = input("\x70\x6f\x73\x74\x2e\144\141\x74\x61\x2f\141"); goto PpNOB; PhuXV: goto GpQWf; goto lvgUM; GgAJr: } public function email() { goto fZpfH; CRQSy: te8Fz: goto OV3R0; Vy0Ip: rFJds: goto CRQSy; cUyd5: return json(["\x6d\x73\147" => "\xe4\xbf\xae\xe6\224\271\346\x88\x90\xe5\212\237", "\x65\162\162\157\162\103\157\144\x65" => 1]); goto Vy0Ip; dGwuY: goto HwSqv; goto ltjjP; Z1XAL: if (!request()->isAjax()) { goto te8Fz; } goto kl311; S1Lhg: $data["\x75\x6e\x69\141\x63\x69\x64"] = $this->uniacid; goto FOV71; qnWVg: HwSqv: goto Y2qOl; b7D0X: $result = EmailSet::update($data); goto qnWVg; FOV71: $result = EmailSet::create($data); goto dGwuY; Y2qOl: if ($result !== false) { goto bKVyH; } goto CDq0l; fZpfH: $email = EmailSet::where("\165\156\x69\x61\143\x69\x64", $this->uniacid)->find(); goto Z1XAL; ltjjP: K5rHc: goto b7D0X; X6zGL: return $this->fetch(); goto E6_Nv; Vo5vv: bKVyH: goto cUyd5; kl311: $data = input("\x70\x6f\163\x74\x2e\x64\141\x74\x61\x2f\141"); goto nXd6t; nXd6t: if ($data["\151\144"]) { goto K5rHc; } goto S1Lhg; A6D1B: goto rFJds; goto Vo5vv; CDq0l: return json(["\155\x73\147" => "\344\xbf\xae\xe6\x94\271\xe5\xa4\261\350\xb4\245", "\145\x72\162\157\x72\x43\157\x64\145" => 0]); goto A6D1B; OV3R0: $this->assign(["\x65\155\141\x69\154" => $email]); goto X6zGL; E6_Nv: } public function edit() { goto O8Ngt; m3QoT: MUg7s: goto C0RwG; C0RwG: if (!($data["\156\x61\x6d\x65"] == '')) { goto ILs20; } goto Y1N7R; KVtr3: LMFGl: goto c1MTs; O8Ngt: $id = input("\x69\144"); goto PctbI; PctbI: $admin = AdminMoel::get($id); goto d1jJk; bhDe1: HBzt5: goto XMH3N; vPK1c: if (!($data["\x69\x64"] == '')) { goto MUg7s; } goto Lpm3e; c1MTs: iTHdY: goto tasjw; bSkGr: goto LMFGl; goto fNDX7; SGxap: IjgfC: goto FA8e0; EcBqx: XCyqm: goto TJqzz; tasjw: $this->assign("\141\x64\155\x69\x6e", $admin); goto gt2kF; vNPA9: if ($result !== false) { goto fuQFK; } goto J2pMC; lJ1el: $data["\160\141\x73\163\x77\x6f\162\x64"] = $admin["\x70\x61\163\163\167\x6f\x72\144"]; goto qZUEs; gt2kF: return $this->fetch(); goto o6NY4; PNVs6: if (!($isHasAdmin && $isHasAdmin["\x69\144"] != $data["\151\x64"])) { goto DBF_J; } goto UDnq_; Lpm3e: return json(["\x6d\x73\x67" => "\x69\144\xe4\270\x8d\xe5\xad\230\xe5\x9c\xa8", "\x65\x72\x72\157\162\103\157\x64\145" => 0]); goto m3QoT; yjore: if ($data["\160\141\x73\163\x77\x6f\162\x64"] != '') { goto HBzt5; } goto lJ1el; fNDX7: fuQFK: goto jUVYy; XMH3N: $data["\x70\x61\163\163\167\157\162\x64"] = password(input("\160\x61\x73\x73\x77\x6f\x72\x64")); goto EcBqx; wzI_j: $data = input("\160\157\x73\x74\56"); goto vPK1c; TJqzz: unset($data["\x63\x68\x65\143\x6b\137\160\x61\x73\163\x77\157\162\144"]); goto kXE8m; G8_QQ: ILs20: goto QjuHz; enBOa: DBF_J: goto yjore; jUVYy: return json(["\x6d\163\x67" => "\344\277\xae\346\224\xb9\346\210\x90\345\x8a\237", "\145\162\162\x6f\x72\103\x6f\144\x65" => 1]); goto KVtr3; UDnq_: return ["\155\x73\147" => "\350\xaf\xa5\xe8\264\xa6\xe5\x8f\xb7\xe5\267\262\xe5\255\230\xe5\234\250", "\x65\162\162\x6f\x72\x43\157\144\x65" => 0]; goto enBOa; kXE8m: $result = AdminMoel::update($data); goto vNPA9; Y1N7R: return json(["\x6d\163\147" => "\xe8\xaf\xb7\xe5\241\253\345\206\231\350\xb4\xa6\345\217\xb7", "\x65\162\x72\157\x72\x43\157\144\145" => 0]); goto G8_QQ; qZUEs: goto XCyqm; goto bhDe1; d1jJk: if (!request()->isAjax()) { goto iTHdY; } goto wzI_j; Vkkun: return ["\x6d\163\147" => "\344\xb8\xa4\xe4\xb8\252\345\257\206\xe7\240\x81\344\xb8\215\xe4\xb8\200\xe8\x87\264", "\x65\x72\162\157\162\x43\x6f\x64\x65" => 0]; goto SGxap; FA8e0: $isHasAdmin = AdminMoel::where("\156\141\155\145", "\75", $data["\x6e\x61\155\x65"])->find(); goto PNVs6; J2pMC: return json(["\x6d\163\147" => "\344\277\256\xe6\x94\xb9\xe5\xa4\xb1\350\xb4\xa5", "\145\x72\162\x6f\162\103\x6f\x64\145" => 0]); goto bSkGr; QjuHz: if (!($data["\160\x61\163\163\x77\157\162\x64"] != $data["\x63\x68\x65\143\x6b\137\160\141\163\163\x77\157\162\144"])) { goto IjgfC; } goto Vkkun; o6NY4: } }