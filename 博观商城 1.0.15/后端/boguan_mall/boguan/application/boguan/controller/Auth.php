<?php
 namespace app\boguan\controller; use think\Controller; use think\Request; use app\boguan\model\PlatformSettings; class Auth extends Controller { protected $server; public function __construct(Request $request = null) { goto hUizd; UaElj: oUlPh: goto CTqSW; w9CF7: $this->webAuth(); goto BPsch; hUizd: parent::__construct($request); goto wkaek; wkaek: if ($_SERVER["\x53\105\x52\x56\105\122\x5f\116\x41\x4d\105"] != $_SERVER["\x48\x54\124\x50\137\x48\x4f\x53\x54"]) { goto ymnU0; } goto L2n0n; zaSgR: $this->server = $server; goto DAIEU; G0FJo: $pluginData = ["\x6b\x65\171" => config("\143\x6c\x6f\x75\x64\x2e\x61\x70\x69\x5f\x6b\145\x79"), "\x64\157\155\141\151\156" => $server, "\163\143\150\x65\x6d\x65" => \request()->scheme(), "\151\x70" => gethostbyname($_SERVER["\123\x45\x52\126\105\122\137\x4e\x41\115\x45"]), "\151\144" => session("\x41\125\124\x48\x5f\x49\104")]; goto N5FeX; L2n0n: $server = $_SERVER["\123\105\122\126\x45\122\x5f\x4e\x41\115\x45"]; goto cbBdx; e3qzo: $server = $_SERVER["\x48\x54\124\x50\x5f\x48\117\x53\x54"]; goto L1tia; N5FeX: $result = json_decode($this->cloud_post(config("\x63\x6c\157\165\144\56\141\165\x74\x68\137\x70\x6c\165\x67\151\156\x5f\165\x72\x6c"), $pluginData), true); goto fRTOo; cbBdx: goto v72ZY; goto KWLG4; fRTOo: session("\x50\x4c\125\107\x49\x4e\137\x44\101\124\101", $result["\144\x61\164\x61"]); goto UaElj; DAIEU: $this->pluginAuth(); goto w9CF7; BPsch: if (!(session("\111\x53\x5f\101\125\124\x48") && !session("\x50\x4c\x55\107\x49\x4e\137\x44\101\124\101"))) { goto oUlPh; } goto G0FJo; L1tia: v72ZY: goto zaSgR; KWLG4: ymnU0: goto e3qzo; CTqSW: } public function pluginAuth() { goto dhB4v; wUxY2: Zae2H: goto kQXJV; lufld: if ($res["\x65\x72\162\157\162\x43\157\144\145"] == 1 && $res["\163\164\x61\164\x75\x73"] == true) { goto NLoxQ; } goto iy_3f; YxfpL: session("\120\x4c\125\x47\x49\x4e\x5f\x41\x55\124\110", false); goto xgrXt; jZsSB: $settings = PlatformSettings::where(["\165\x6e\x69\x61\x63\x69\x64" => session("\x75\156\151\x61\x63\151\x64")])->field("\x6e\x61\155\x65\x2c\x74\x65\154\54\141\x64\x64\162\145\163\163")->find(); goto un1an; UkaK8: if (session("\x50\114\x55\x47\111\x4e\137\101\125\x54\x48")) { goto f2utX; } goto eYjU9; KUS9L: if (!(!empty($result["\144\x61\164\141"]) && in_array($ctrl, $result["\144\x61\164\x61"]))) { goto J7nSa; } goto jZsSB; Awjs2: session("\120\x4c\125\x47\111\116\x5f\x41\x55\124\110", true); goto HZ2rO; dhB4v: $request = \think\Request::instance(); goto shYjn; JOych: ALCxc: goto ald89; L1xA_: if (empty($result)) { goto Zae2H; } goto KUS9L; HYx2e: $res = json_decode($this->cloud_post(config("\x63\154\157\165\x64\56\141\x75\164\150\137\x75\162\x6c"), $data), true); goto lufld; kQXJV: f2utX: goto nZ86k; HZ2rO: goto ALCxc; goto QCWr6; ald89: J7nSa: goto wUxY2; shYjn: $ctrl = $request->controller(); goto UkaK8; aHdxH: goto ALCxc; goto ysfTD; ysfTD: NLoxQ: goto Awjs2; xgrXt: $this->error("\xe4\xba\x91\xe6\234\215\345\212\xa1\xe5\x99\250\350\277\x9e\xe6\216\245\345\x87\272\351\224\x99\357\xbc\214\xe8\xaf\xb7\347\250\215\345\x90\x8e\xe5\206\x8d\350\257\225\xef\xbc\x81"); goto aHdxH; iy_3f: if ($res["\x65\x72\162\x6f\162\x43\x6f\x64\145"] == 0 && $res["\x73\164\x61\164\165\163"] == false) { goto YWkRv; } goto YxfpL; oHAJb: session("\120\114\x55\x47\111\116\x5f\x41\x55\124\x48", false); goto omVlE; eYjU9: $pluginData = ["\x6b\x65\x79" => config("\143\154\x6f\x75\x64\x2e\141\160\x69\137\153\145\x79")]; goto y452D; un1an: $data = ["\x6b\x65\x79" => config("\x63\154\157\165\x64\x2e\x61\160\151\137\153\x65\171"), "\x69\x70" => gethostbyname($_SERVER["\123\x45\122\126\x45\x52\137\x4e\x41\115\x45"]), "\x66\x72\157\x6d\x5f\x69\x70" => \request()->ip(), "\x64\157\155\141\151\x6e" => $this->server, "\163\x63\x68\x65\155\x65" => \request()->scheme(), "\164\x79\x70\x65" => "\x32", "\x70\x6c\x75\x67\151\x6e" => $ctrl, "\141\165\164\150\137\164\171\160\x65" => 2, "\156\141\155\x65" => $settings["\156\141\x6d\x65"], "\x70\x68\x6f\156\x65" => $settings["\x74\x65\x6c"], "\141\x64\x64\162\x65\163\x73" => $settings["\x61\144\144\162\x65\163\x73"], "\x61\x63\151\144" => session("\165\156\151\x61\143\x69\x64")]; goto HYx2e; y452D: $result = json_decode($this->cloud_post(config("\143\154\157\165\144\x2e\x70\x6c\x75\x67\151\x6e\x5f\165\162\154"), $pluginData), true); goto L1xA_; QCWr6: YWkRv: goto oHAJb; omVlE: $this->error($res["\x6d\x73\x67"]); goto JOych; nZ86k: } public function webAuth() { goto hQ0Uz; UvuHE: $this->redirect("\x62\157\x67\x75\141\156\57\160\x6c\x61\164\146\x6f\x72\x6d\56\143\157\155\155\157\x6e\x2f\x6e\x6f\x74\x61\x75\x74\x68"); goto bulXQ; WWr0_: goto B2cMR; goto j_YWk; ns58E: goto B2cMR; goto Ra3Dg; lAWbQ: $settings = PlatformSettings::where(["\165\156\151\141\x63\x69\x64" => session("\x75\156\151\141\x63\151\144")])->field("\156\x61\x6d\145\x2c\164\145\154\54\141\x64\x64\x72\145\163\163")->find(); goto sr437; L0_Nm: session("\111\123\137\101\125\124\110", true); goto LcpNp; mnIk9: XEuNJ: goto Gm6wo; dAqqs: if (session("\111\123\137\x41\x55\124\110")) { goto XEuNJ; } goto lAWbQ; bulXQ: B2cMR: goto mnIk9; j_YWk: W25di: goto ESUxX; sqFX8: if ($res["\x65\x72\x72\157\162\x43\157\x64\145"] == 1 && $res["\x73\164\x61\x74\165\163"] == true) { goto jqSvt; } goto Mkq6z; Ra3Dg: jqSvt: goto L0_Nm; sr437: $data = ["\153\x65\x79" => config("\x63\x6c\x6f\x75\x64\x2e\141\x70\x69\137\x6b\x65\171"), "\x69\160" => gethostbyname($_SERVER["\x53\105\x52\126\105\x52\137\116\101\x4d\x45"]), "\x66\162\157\155\137\x69\160" => \request()->ip(), "\144\157\x6d\x61\x69\x6e" => $this->server, "\163\143\150\145\155\145" => \request()->scheme(), "\164\x79\x70\x65" => "\62", "\160\154\165\147\x69\156" => $ctrl, "\x61\165\164\x68\137\x74\x79\160\x65" => 1, "\x6e\x61\155\x65" => $settings["\x6e\x61\155\145"], "\160\x68\157\x6e\x65" => $settings["\x74\x65\x6c"], "\x61\144\144\x72\x65\163\163" => $settings["\x61\144\x64\162\x65\x73\x73"], "\141\143\x69\x64" => session("\x75\156\151\x61\143\x69\x64")]; goto mh1si; hQ0Uz: $request = \think\Request::instance(); goto ynb_o; KxO4G: $this->redirect("\x62\x6f\147\165\x61\x6e\57\x70\154\141\x74\146\157\162\155\56\143\x6f\155\155\x6f\156\57\156\157\164\141\165\x74\150"); goto ns58E; LcpNp: session("\x41\125\x54\x48\137\111\104", $res["\x69\144"]); goto WWr0_; ESUxX: session("\x49\x53\x5f\x41\x55\x54\110", false); goto MRrer; pamdT: session("\x41\x55\124\x48\x5f\x49\104", null); goto KxO4G; mh1si: $res = json_decode($this->cloud_post(config("\x63\x6c\x6f\x75\144\56\141\165\164\x68\x5f\x75\162\x6c"), $data), true); goto sqFX8; ynb_o: $ctrl = $request->controller(); goto dAqqs; Mkq6z: if ($res["\x65\x72\162\157\x72\x43\157\x64\x65"] == 0 && $res["\x73\164\x61\x74\165\163"] == false) { goto W25di; } goto W4Dsw; MRrer: session("\x41\125\124\x48\x5f\111\x44", null); goto UvuHE; W4Dsw: session("\x49\123\137\x41\x55\124\x48", false); goto pamdT; Gm6wo: } public function cloud_post($url, array $params = array()) { goto cZpj1; zXD5h: $ch = curl_init(); goto hVb6c; rGjoc: curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string); goto twFfN; MEfuk: return $data; goto T0dwB; twFfN: curl_setopt($ch, CURLOPT_HTTPHEADER, array("\x43\157\x6e\164\145\x6e\x74\55\124\x79\160\x65\x3a\x20\x61\160\x70\154\151\143\x61\164\x69\x6f\156\x2f\x6a\x73\157\x6e")); goto EYJ7D; hVb6c: curl_setopt($ch, CURLOPT_URL, $url); goto Fo4u7; EYJ7D: $data = curl_exec($ch); goto suidB; suidB: curl_close($ch); goto MEfuk; MKKGJ: curl_setopt($ch, CURLOPT_POST, 1); goto Utj2Y; Cs6Os: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto IxyRR; Fo4u7: curl_setopt($ch, CURLOPT_HEADER, 0); goto Cs6Os; IxyRR: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 10); goto MKKGJ; cZpj1: $data_string = json_encode($params); goto zXD5h; Utj2Y: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto rGjoc; T0dwB: } }