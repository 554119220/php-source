<?php
 ini_set("\x64\151\163\160\154\x61\171\x5f\145\x72\162\x6f\x72\163", "\117\146\x66"); error_reporting(0); defined("\x49\116\x5f\111\x41") or exit("\101\x63\143\145\163\163\40\x44\145\x6e\151\x65\144"); load()->classs("\x74\141\142\x6c\145"); require_once __DIR__ . "\x2f\x76\x65\x6e\144\x6f\x72\x2f\141\x75\x74\x6f\x6c\x6f\x61\144\x2e\160\150\160"; require_once __DIR__ . "\57\x77\x78\146\151\x72\155\160\141\171\x2e\160\x68\160"; require_once __DIR__ . "\57\x77\x78\160\141\x79\x2e\x70\x68\160"; require_once __DIR__ . "\57\x48\164\x74\160\103\x6c\x69\145\x6e\164\56\143\154\141\x73\163\x2e\160\150\x70"; use App\Model\User; goto Q974B; v5aaD: trait UserTrait { private function addUserFromOpenid($openid, $session_key) { goto igOBG; p8aMa: $user->save(); goto MO_5P; MO_5P: CpWua: goto nGldU; tOd8F: $user->openid = $openid; goto HEMT3; igOBG: if (!($openid && "\165\x6e\144\145\x66\x69\x6e\x65\x64" != $openid)) { goto q4k3C; } goto IBmfJ; nGldU: $this->setUid($openid); goto vqgEd; HEMT3: $user->session_key = $session_key; goto p8aMa; gDhUG: return true; goto sfilE; IBmfJ: $user = User::instance()->where("\x6f\160\x65\156\151\144", $openid)->first(); goto brDkO; vqgEd: q4k3C: goto gDhUG; brDkO: if ($user) { goto CpWua; } goto GE3ec; GE3ec: $user = User::instance(); goto tOd8F; sfilE: } public function getOpenidApi() { goto PoU7w; QuoyB: $url = sprintf("\150\164\164\x70\163\72\x2f\x2f\x61\x70\x69\x2e\167\145\x69\x78\151\x6e\x2e\x71\161\56\x63\157\x6d\x2f\163\156\x73\x2f\152\x73\x63\157\x64\145\62\x73\x65\163\163\x69\157\x6e\77\x61\160\160\x69\x64\x3d\45\x73\46\163\x65\x63\x72\x65\x74\75\45\163\x26\152\163\137\143\x6f\144\x65\75\x25\x73\x26\147\x72\x61\156\164\x5f\x74\x79\160\x65\75\141\165\164\x68\157\x72\x69\172\x61\164\151\x6f\x6e\137\143\x6f\144\x65", $sys->appid, $sys->appsecret, $this->get("\x63\157\x64\145")); goto my0La; VqxST: $openid = $res_arr["\157\160\145\x6e\x69\144"]; goto QInoU; eONsZ: $res = "\173\42\163\x65\x73\x73\x69\x6f\x6e\x5f\153\x65\171\x22\x3a\42\x73\117\112\x6c\x58\x4a\x38\x30\x4c\x62\115\x4e\x5c\x2f\x39\103\157\122\111\166\66\115\x51\75\x3d\x22\54\x22\157\x70\x65\x6e\151\144\42\x3a\42\157\102\102\110\x52\60\x67\x65\x77\101\55\x57\x4b\x78\x50\172\62\145\102\x4d\120\120\x44\110\x55\x75\71\147\x22\x7d"; goto RwlN_; WwJk2: $sys = \App\Model\SystemInfo::instance()->first(["\141\160\x70\151\144", "\x61\160\x70\163\x65\143\x72\x65\164"]); goto QuoyB; QInoU: $this->addUserFromOpenid($openid, $res_arr["\x73\x65\163\x73\151\157\x6e\137\153\145\171"]); goto YQAFq; RwlN_: QP9Mg: goto TQUK9; vyIsn: YYkuG: goto eONsZ; my0La: $res = $this->http($url); goto UO27R; TQUK9: $res_arr = json_decode($res, true); goto VqxST; UO27R: goto QP9Mg; goto vyIsn; PoU7w: if ($this->get("\x74\145\x73\x74", false)) { goto YYkuG; } goto WwJk2; YQAFq: $data = ["\x6f\x70\145\156\151\144" => $openid, "\x75\x73\x65\162\111\156\146\x6f" => ["\156\x69\x63\153\116\x61\x6d\x65" => $this->user->name, "\x61\x76\x61\164\x61\x72\125\162\154" => $this->user->avatar]]; goto GtmZX; GtmZX: return $this->success($data); goto R1MCl; R1MCl: } public function saveUserInfoApi() { goto kJYEd; r78CZ: $this->user->latitude = $latitude; goto BqEgP; j0ZJ5: $latitude = $this->get("\x6c\141\x74\151\164\x75\144\x65"); goto KpAOl; Xy5Ys: if (!$avatarUrl) { goto kHL3I; } goto X302f; GVql3: $longitude = $this->get("\154\x6f\x6e\x67\151\x74\165\x64\145"); goto i4lMT; Xu8I3: kHL3I: goto Q6in6; LaCe5: if (!$nickName) { goto kOusn; } goto HyFRT; v5vLn: k93S2: goto AYWZn; wRC1f: $this->user->longitude = $longitude; goto v5vLn; X302f: $this->user->avatar = $avatarUrl; goto Xu8I3; AYWZn: $this->user->save(); goto ZaUG4; BqEgP: MCKrf: goto GVql3; HyFRT: $this->user->name = $nickName; goto gS_mA; i4lMT: if (!$longitude) { goto k93S2; } goto wRC1f; kJYEd: $avatarUrl = $this->get("\141\166\x61\164\141\x72\125\x72\x6c"); goto Xy5Ys; ZaUG4: return $this->indexApi(); goto FCavp; KpAOl: if (!$latitude) { goto MCKrf; } goto r78CZ; gS_mA: kOusn: goto j0ZJ5; Q6in6: $nickName = $this->get("\156\x69\x63\153\x4e\x61\155\x65"); goto LaCe5; FCavp: } public function saveBaseUserInfoApi() { goto iTOxj; JzBIW: $this->user->save(); goto ZlI42; ktLv0: $nickName = $this->get("\156\151\143\x6b\116\x61\155\145"); goto HLpP0; J1Msd: $this->user->name = $nickName; goto TUmnR; HLpP0: if (!$nickName) { goto fqh9X; } goto J1Msd; TUmnR: fqh9X: goto JzBIW; M7c0n: if (!$avatarUrl) { goto RF4hM; } goto RwlGN; RwlGN: $this->user->avatar = $avatarUrl; goto wUaP9; wUaP9: RF4hM: goto ktLv0; iTOxj: $avatarUrl = $this->get("\x61\x76\x61\x74\141\162\125\162\x6c"); goto M7c0n; ZlI42: return $this->success(); goto ejW2i; ejW2i: } public function getRechargeApi() { goto R81qV; DYceL: foreach ($recharge as &$item) { goto dpZPl; dpZPl: $item->recharge = $item->money; goto s7twX; ltyQv: ji_Tt: goto cDqVo; s7twX: $item->youhui = $item->gift; goto ltyQv; cDqVo: } goto V5RKG; V5RKG: m_0CG: goto U22zO; R81qV: $recharge = \App\Model\Recharge::instance()->where("\151\163\x5f\x65\x6e\141\142\x6c\x65", true)->get(["\151\144", "\155\x6f\156\145\171", "\x67\x69\146\164"]); goto DYceL; U22zO: return $this->success($recharge); goto XtvmS; XtvmS: } public function postRechargeApi() { goto C3bUm; FhaOw: $rechargeLog->user_id = $this->user->id; goto mNizZ; q1nkk: $gift = 0; goto ZDI5p; HfG87: if ($recharge) { goto HFI1s; } goto jaz2_; J2Qz1: rq5p9: goto j1AiC; PnAHl: $this->success(["\163\156" => $rechare_sn]); goto VONnb; uLshU: JO3SL: goto J2Qz1; mi0E4: $rechargeLog->save(); goto PnAHl; SdAcS: goto JO3SL; goto Ql5NB; UPnMl: $money = $this->get("\x6d\x6f\156\145\x79", null); goto S1qU8; mNizZ: $rechargeLog->openid = $this->user->openid; goto X4R2E; hcu4p: $rechargeLog->remark = $rechare_sn; goto mi0E4; P1Nnl: $gift = 0; goto v9MIs; Xe0d7: $amount = $recharge->money; goto X9VHR; C3bUm: $recharge_id = $this->get("\x72\x65\x63\150\141\x72\147\145\x5f\151\x64"); goto UPnMl; ZDI5p: goto rq5p9; goto i5J43; j1AiC: $rechare_sn = "\61\60\60" . time(); goto b0Ern; jaz2_: return $this->response(-999, "\x72\x65\143\x68\x61\162\147\x65\40\146\141\151\x6c\41"); goto SdAcS; Ql5NB: HFI1s: goto Xe0d7; n4YS9: $rechargeLog->state = 0; goto hcu4p; v9MIs: if (is_null($money)) { goto PtEt6; } goto Tk1gw; pvLby: $rechargeLog->pay_amount = $amount; goto n4YS9; X9VHR: $gift = $recharge->gift; goto uLshU; X4R2E: $rechargeLog->amount = $amount; goto dynUq; Tk1gw: $amount = $money; goto q1nkk; i5J43: PtEt6: goto Cjtpp; dynUq: $rechargeLog->gift = $gift; goto pvLby; S1qU8: $amount = 0; goto P1Nnl; b0Ern: $rechargeLog = \App\Model\RechargeLog::instance(); goto FhaOw; Cjtpp: $recharge = \App\Model\Recharge::instance()->find($recharge_id); goto HfG87; VONnb: } public function getWeApi() { goto l_4iD; vy5ft: $couponCount = $this->getUserCouponCount(); goto piog1; l_4iD: $umoney = $this->user->amount; goto vy5ft; Y6fhq: return $this->success($data); goto k28Pb; piog1: $data = ["\x75\x6d\x6f\156\x65\x79" => $umoney, "\x63\x6f\x75\x70\x6f\156\x43\x6f\x75\x6e\x74" => $couponCount, "\x69\x73\137\144\x69\x73\x74\x72\x69\x62\x75\164\x69\x6f\156" => (bool) $this->user->is_distribution, "\x69\x73\x5f\141\x64\x6d\x69\x6e" => (bool) $this->user->is_admin]; goto Y6fhq; k28Pb: } public function getWithdrawSettingApi() { goto Asu_Y; sYZhU: reD1B: goto CM1MZ; XPxFx: $data["\162\165\154\145"] = str_replace($pattern, $replacement, $string); goto ia2Ac; i1M9E: $data = $data->toArray(); goto AtnrG; LImQ6: $pattern = "\74\151\x6d\147\x20\x73\x72\x63\75\x22\x2f\141\164\x74\x61\143\x68\155\145\156\x74\57\151\x6d\x61\147\145\x73"; goto VZNQo; fPQtu: mWv_F: goto i1M9E; kg4Wz: goto reD1B; goto fPQtu; fYjdz: $data = []; goto kg4Wz; AtnrG: $string = $data["\162\x75\154\145"]; goto LImQ6; ia2Ac: $data["\165\x73\x65\162\137\141\x6d\157\x75\156\x74"] = $this->user->dis_amount; goto sYZhU; VZNQo: $replacement = "\74\x69\x6d\x67\x20\x73\162\143\x3d\42" . getBaseUrl() . "\57\x61\x74\164\x61\143\x68\x6d\x65\x6e\x74\57\x69\x6d\141\x67\145\163"; goto XPxFx; LKcBf: if ($data) { goto mWv_F; } goto fYjdz; Asu_Y: $data = \App\Model\WithdrawSetting::instance()->first(); goto LKcBf; CM1MZ: return $this->success($data); goto bE84q; bE84q: } public function withdrawToWeixinwallet($openid, $amount) { goto YhJoO; tbnaF: try { goto mcNca; Siobr: k41zr: goto Tce2h; VlqF9: $return = $weixinfirmpay->pay(); goto QKyqi; bsMEL: return $partner_trade_no; goto Siobr; mcNca: $weixinfirmpay = new \WeixinfirmPay($mch_appid, $mchid, $key, $openid, $partner_trade_no, $re_user_name, $desc, $amount, $apiclient_cert, $apiclient_key); goto VlqF9; QKyqi: if (!($return["\x72\145\163\x75\154\x74\137\x63\157\x64\145"] == "\x53\x55\x43\103\105\x53\x53")) { goto k41zr; } goto bsMEL; Tce2h: } catch (\Exception $e) { return false; } goto zIU43; S9otC: $key = $sysinfo->wxkey; goto OYXxh; xERkD: if (!$sysinfo) { goto mmSD3; } goto slhjT; NB9FK: return false; goto jjdsl; zIU43: mmSD3: goto NB9FK; YhJoO: $sysinfo = \App\Model\SystemInfo::instance()->first(); goto xERkD; a7p9f: $re_user_name = ''; goto X9Q2_; KrWZ9: $partner_trade_no = "\63\60\x30" . time(); goto tbnaF; nqmxM: $apiclient_key = config("\x75\160\x6c\x6f\x61\144\x2e\146\151\154\x65") . $sysinfo->key_pem; goto a7p9f; slhjT: $mch_appid = $sysinfo->appid; goto bLrCW; bLrCW: $mchid = $sysinfo->mchid; goto S9otC; X9Q2_: $desc = "\346\217\x90\347\x8e\xb0"; goto KrWZ9; OYXxh: $apiclient_cert = config("\165\160\154\157\x61\x64\x2e\x66\x69\154\x65") . $sysinfo->cert_pem; goto nqmxM; jjdsl: } public function postWithdrawApi() { goto KTXZq; fZjYG: $true_amount = $this->get("\164\162\165\145\x5f\141\155\x6f\x75\156\x74"); goto chSFx; v_3lH: $phone = $this->get("\x70\150\157\x6e\x65"); goto hOHAJ; KG8aH: $withdraw->transaction_id = $partner_trade_no; goto Uev2_; GAc3y: $withdraw->status = 4; goto cuNT8; auPL9: $withdraw = \App\Model\DisWithdraw::instance(); goto NXXOw; fo5mk: jlFwR: goto pbbAM; GttGt: $partner_trade_no = $this->withdrawToWeixinwallet($this->user->openid, $true_amount); goto bEoRH; WvyS6: $withdraw->commission = $commission; goto GKtvF; cuNT8: e6epw: goto fo5mk; i0uSR: $withdraw->remark = "\xe8\207\252\345\x8a\250\xe6\211\x93\346\xac\xbe\345\xa4\xb1\xe8\264\245"; goto GAc3y; NXXOw: $withdraw->user_id = $this->user->id; goto yXhnV; UyTz0: goto e6epw; goto hGoUd; qEWaL: $this->changeDisAmount($this->user->id, 1, "\xe7\224\xb3\xe8\257\267\xe6\x8f\x90\347\x8e\xb0", -$amount); goto nSRI8; Uev2_: $withdraw->status = 3; goto UyTz0; hGoUd: nbEve: goto i0uSR; QAsSm: $withdraw->amount = $amount; goto C3_SC; Z1hl0: if (!($amount < $setting->no_verify_amount)) { goto jlFwR; } goto GttGt; pbbAM: $withdraw->save(); goto qEWaL; nSRI8: return $this->success(); goto VFd4_; GKtvF: $withdraw->true_amount = $true_amount; goto cFeLc; chSFx: $name = $this->get("\x6e\141\x6d\145"); goto v_3lH; GgEOp: $poundage = $this->get("\x70\x6f\165\156\144\141\147\x65"); goto ejt_1; cFeLc: $withdraw->name = $name; goto Mg2j9; bEoRH: if ($partner_trade_no === false) { goto nbEve; } goto KG8aH; hOHAJ: $setting = \App\Model\WithdrawSetting::instance()->first(); goto auPL9; yXhnV: $withdraw->openid = $this->user->openid; goto QAsSm; C3_SC: $withdraw->poundage = $poundage; goto WvyS6; ejt_1: $commission = $this->get("\143\157\x6d\x6d\x69\163\163\151\157\156"); goto fZjYG; Mg2j9: $withdraw->phone = $phone; goto Z1hl0; KTXZq: $amount = $this->get("\x61\x6d\157\x75\x6e\x74"); goto GgEOp; VFd4_: } } goto dI3Dx; YOntU: class yzbld_sunModuleWxapp extends BaseWxapp { use OrderTrait, UserTrait, CouponTrait, StoreTrait, GoodsTrait, DisTrait, Test; public function __call($name, $arguments) { goto O2ucq; qRksQ: M7TCD: goto w9p2E; E391m: exit("{$name}\x20\x6d\145\164\150\157\144\40\x6e\157\164\40\145\x78\151\163\164\41"); goto XAhxZ; Pnk7l: return call_user_func_array([$this, $api . "\x41\160\x69"], $arguments); goto qKH4h; O2ucq: if ("\144\157\x50\141\147\x65" == substr($name, 0, 6)) { goto M7TCD; } goto E391m; w9p2E: $api = substr($name, 6); goto Pnk7l; qKH4h: b4M2N: goto Jefjj; XAhxZ: goto b4M2N; goto qRksQ; Jefjj: } } goto XL1Nn; Q974B: class BaseWxapp extends WeModuleWxapp { protected $is_logger = true; protected $gpc; protected $w; public $uid; public $user = null; public $uniacid; public function __construct() { goto gcDne; KlJw2: $this->uniacid = $_W["\x75\x6e\x69\x61\143\151\x64"]; goto qJtfJ; QarDA: global $_GPC; goto sydpb; PucBy: $this->uid = null; goto KlJw2; gcDne: global $_W; goto QarDA; sydpb: $this->gpc = $_GPC; goto CEizl; qJtfJ: \Encore\Admin\Config::load(); goto ltQq9; CEizl: $this->w = $_W; goto PucBy; UHWdB: header("\101\x63\143\x65\x73\x73\55\103\157\156\164\x72\157\154\x2d\101\x6c\x6c\x6f\x77\55\x4f\x72\151\147\151\156\x3a\40\52"); goto nPw58; ltQq9: $this->setUid(); goto UHWdB; nPw58: } protected function setUid($openid = null) { goto O7zBI; FQwTY: IgcGW: goto u3BQ9; zgp9H: if (!$this->user) { goto oY8zv; } goto KJhL_; KJhL_: $this->uid = $this->user->id; goto LOWH0; LOWH0: oY8zv: goto FQwTY; N6V8T: if (is_null($openid)) { goto IgcGW; } goto WUOfB; UBdfj: global $_W; goto hG4Zw; WUOfB: $this->user = User::instance()->where("\157\160\x65\x6e\x69\144", $openid)->first(); goto zgp9H; hG4Zw: $_W["\x6f\x70\x65\x6e\151\144"] = $openid; goto N6V8T; O7zBI: $openid = is_null($openid) ? $this->get("\x6f\x70\x65\x6e\151\x64") : $openid; goto UBdfj; u3BQ9: } protected function before() { } protected function after() { } public function getDistance($lng1, $lat1, $lng2, $lat2) { goto Pcmfr; q2C3i: $radLng1 = deg2rad($lng1); goto YgQES; Pcmfr: $radLat1 = deg2rad($lat1); goto rK5yR; YgQES: $radLng2 = deg2rad($lng2); goto FEXhw; FEXhw: $a = $radLat1 - $radLat2; goto mHt0a; oYQJf: return intval($s); goto PVmRK; mHt0a: $b = $radLng1 - $radLng2; goto Bs19Q; rK5yR: $radLat2 = deg2rad($lat2); goto q2C3i; Bs19Q: $s = 2 * asin(sqrt(pow(sin($a / 2), 2) + cos($radLat1) * cos($radLat2) * pow(sin($b / 2), 2))) * 6378.137 * 1000; goto oYQJf; PVmRK: } protected function getStoreDistance($store_id, $disLngLat) { goto YEHmo; YEHmo: $store = \App\Model\Store::instance()->find($store_id, ["\x69\144", "\x6c\x61\164\151\x74\165\x64\145", "\154\157\156\147\151\x74\x75\144\145"]); goto oJlKD; oJlKD: if (!$store) { goto fvOqL; } goto f2xk2; kOVZA: $latitude = $disLngLat[1]; goto EcqUn; Su0Yl: return $distance; goto d1OcO; d1OcO: fvOqL: goto MnScu; MnScu: return 0; goto uJxLE; EcqUn: $distance = $this->getDistance($longitude, $latitude, $store->longitude, $store->latitude); goto Su0Yl; f2xk2: $longitude = $disLngLat[0]; goto kOVZA; uJxLE: } public function get($key, $default = null) { return isset($this->gpc[$key]) ? $this->gpc[$key] : $default; } public function wget($key, $default = null) { return isset($this->w[$key]) ? $this->w[$key] : $default; } public function http($url, $data = null) { goto YMBQW; Oqe63: curl_setopt($curl, CURLOPT_URL, $url); goto ZDUt1; WjLt0: curl_setopt($curl, CURLOPT_POST, 1); goto mQv1x; wOLvE: $output = curl_exec($curl); goto TFa0P; ZDUt1: curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); goto GKjyt; PMBCH: curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); goto wOLvE; mQv1x: curl_setopt($curl, CURLOPT_POSTFIELDS, $data); goto b3VKD; b3VKD: zJOjf: goto PMBCH; GKjyt: curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false); goto zP7_j; YCdDt: return $output; goto IsbHa; TFa0P: curl_close($curl); goto YCdDt; YMBQW: $curl = curl_init(); goto Oqe63; zP7_j: if (empty($data)) { goto zJOjf; } goto WjLt0; IsbHa: } public function response($code = 0, $message = '', $data = null) { goto sTs6e; s2xQD: wPGnS: goto fyEhc; sTs6e: if (!is_object($data)) { goto wPGnS; } goto LkmdS; LkmdS: $data = $data->toArray(); goto s2xQD; fyEhc: $this->result($code, $message, $data); goto nkgOJ; nkgOJ: } public function error($errno, $msg) { header("\103\157\x6e\x74\145\x6e\164\55\164\171\x70\145\x3a\x20\141\x70\160\x6c\151\143\x61\x74\x69\x6f\156\57\152\x73\157\x6e"); return $this->response($errno, $msg, null); } public function success($data = array()) { header("\103\x6f\156\164\145\x6e\164\55\x74\x79\x70\x65\x3a\40\x61\x70\160\x6c\x69\143\x61\164\151\x6f\156\57\x6a\x73\x6f\x6e"); return $this->response(0, '', $data); } public function log($content) { goto oH2Ni; oH2Ni: if (!$this->is_logger) { goto EAnK9; } goto T22Tw; T22Tw: load()->func("\154\157\x67\x67\x69\156\147"); goto nKHPd; nKHPd: logging_run($content); goto H8GyL; H8GyL: EAnK9: goto x16Uy; x16Uy: } protected function formateDistance($distance) { goto Gqf1k; yx5MB: return $distance . "\x6d"; goto FZkJA; B6Vv5: return round($distance / 1000, 2) . "\x6b\155"; goto obI_m; obI_m: fd6Gc: goto yx5MB; Gqf1k: if (!($distance > 1000)) { goto fd6Gc; } goto B6Vv5; FZkJA: } public function changeFieldName(&$item, $old, $new) { goto cjkcO; bkQlu: $item->{$new} = $item->{$old}; goto RlDJD; gM1vS: goto ttv8I; goto a92vD; cjkcO: if (is_array($item)) { goto PI6Zs; } goto ZELK3; Ftx8F: goto ttv8I; goto RRFba; RRFba: NmlH6: goto bkQlu; a92vD: PI6Zs: goto pOojm; RlDJD: unset($item->{$old}); goto kdRdf; ZELK3: if (is_object($item)) { goto NmlH6; } goto gM1vS; kdRdf: ttv8I: goto EW9Xa; oYuWi: unset($item[$old]); goto Ftx8F; pOojm: $item[$new] = $item[$old]; goto oYuWi; EW9Xa: } public function _checkAssocArray($arr) { goto pKY3q; gQHU0: foreach (array_keys($arr) as $key) { goto GrvV1; GrvV1: if (!($index++ != $key)) { goto AkhyV; } goto ISs3a; NUy8l: UxlXS: goto k5a2e; ISs3a: return false; goto nBg0N; nBg0N: AkhyV: goto NUy8l; k5a2e: } goto P305Y; pKY3q: $index = 0; goto gQHU0; I8Kh4: return true; goto G_okf; P305Y: K1RTH: goto I8Kh4; G_okf: } public function transformer(&$data, $fields) { goto FtTRx; HLl5E: mqnSf: goto P4Tuq; tYnmG: return $data; goto J4muo; AMieK: foreach ($fields as $key => $value) { goto VmkjB; gwT77: zkwuE: goto GAaT3; Suadx: jZn_b: goto gwT77; VmkjB: if (!array_key_exists($key, $data)) { goto jZn_b; } goto QE2oG; QE2oG: $data[$value] = $data[$key]; goto o4GNp; o4GNp: unset($data[$key]); goto Suadx; GAaT3: } goto j0oJv; C5E3V: goto vyt4Q; goto HLl5E; dZBEE: vyt4Q: goto tYnmG; p1NjL: tyx8l: goto dZBEE; P4Tuq: foreach ($data as &$item) { goto LS4Na; kjCcd: qAIdd: goto kkNfT; LS4Na: foreach ($fields as $key => $value) { goto PEA7Y; XQ2eI: unset($item[$key]); goto K0YOt; PEA7Y: if (!array_key_exists($key, $item)) { goto g1d5y; } goto BN0qd; nD8QK: XXv18: goto W_ABy; BN0qd: $item[$value] = $item[$key]; goto XQ2eI; K0YOt: g1d5y: goto nD8QK; W_ABy: } goto kjCcd; kkNfT: BF35c: goto DZ9Do; DZ9Do: } goto p1NjL; FtTRx: if ($this->_checkAssocArray($data)) { goto mqnSf; } goto AMieK; j0oJv: E10gl: goto C5E3V; J4muo: } public function is_json($string) { json_decode($string); return json_last_error() == JSON_ERROR_NONE; } public function changeUploadPath(&$path) { goto aeY1z; CZ3j4: NYjKw: goto Xh0NZ; bU6tw: goto NYjKw; goto vyjSb; ELLod: $path = $this->uploadPath(json_decode($path, true)); goto CZ3j4; aeY1z: if ($this->is_json($path)) { goto W_ZpM; } goto unHVa; unHVa: $path = $this->uploadPath($path); goto bU6tw; Xh0NZ: return $path; goto J6f10; vyjSb: W_ZpM: goto ELLod; J6f10: } public function getKeyFromArray($data) { goto WGrTp; BjEvG: foreach ($data as $key => $value) { $res[] = $key; SYWG_: } goto UJlU3; WGrTp: $res = []; goto BjEvG; UJlU3: YbAtz: goto gLK72; gLK72: return $res; goto xspgx; xspgx: } public function uploadPath($img) { goto ZOCv3; RecDL: goto UPIl7; goto Smoij; eWma6: vpsw9: goto RecDL; i9Pty: $baseUrl = getBaseUrl() . $storage->getUploadUrl(); goto r_a_p; W9HFD: goto vpsw9; goto Cuzh2; vTo2i: $storage = \App\Lib\Storage::instance(); goto CAd2R; fWkem: return $img; goto aHAyU; ZOCv3: if (is_array($img) || $img instanceof \Illuminate\Support\Collection) { goto yqEcE; } goto Sq76Y; Cuzh2: q2ky2: goto r8dsf; jQNSd: foreach ($img as &$item) { $item = $this->uploadPath($item); o0Kjh: } goto YCmYL; PDJZa: yqEcE: goto jQNSd; Smoij: hkIfk: goto fWkem; gQtU2: return $img; goto fckkY; CAd2R: if ($storage->isEnable()) { goto q2ky2; } goto i9Pty; r8dsf: return $storage->getUploadUrl() . $img; goto eWma6; YCmYL: nS_Ox: goto gQtU2; Y9h3v: goto nbFW_; goto PDJZa; aHAyU: UPIl7: goto Y9h3v; fckkY: nbFW_: goto yn3EJ; Sq76Y: if (isValidUrl($img)) { goto hkIfk; } goto vTo2i; r_a_p: return $baseUrl . $img; goto W9HFD; yn3EJ: } } goto YOntU; KvCzd: trait CouponTrait { private function getReceivedCouponCount($coupon_id) { return \App\Model\UserCoupon::instance()->where("\x63\x6f\165\x70\157\156\137\x69\144", $coupon_id)->count(); } private function isUserHasCoupon($user_id, $coupon_id) { return \App\Model\UserCoupon::instance()->where("\x75\x73\145\x72\137\151\144", $user_id)->where("\143\x6f\x75\160\x6f\x6e\x5f\x69\x64", $coupon_id)->count() > 0; } public function getUserCouponCount() { $today = date("\131\55\x6d\55\x64"); return \App\Model\UserCoupon::instance()->where("\165\x73\145\x72\137\x69\144", $this->user->id)->where("\x69\163\x5f\x75\163\x65\x64", false)->where("\x64\x61\164\145\50\x62\x65\147\151\156\137\141\164\x29", "\74\x3d", $today)->where("\144\141\164\x65\x28\145\156\144\x5f\x61\x74\x29", "\x3e\x3d", $today)->count(); } public function getActivityCouponApi() { goto wW8sF; M3g8w: $today = date("\131\x2d\155\x2d\x64"); goto Tajt9; R3NUl: foreach ($data as $item) { goto pXZrn; pXZrn: if ($this->isUserHasCoupon($this->user->id, $item->id)) { goto s3qNV; } goto X1gd1; avz9J: goto uXqMR; goto o_onN; M17eJ: cpMdp: goto WLymw; Gv6Gv: $item->day = $item->days; goto qyIDe; QuNmM: $item->status = 0; goto DjPYz; X1gd1: if ($this->getReceivedCouponCount($item->id) >= $item->total) { goto glqrf; } goto QuNmM; aY3RN: s3qNV: goto kL6Ww; o_onN: glqrf: goto p1mjn; DjPYz: goto uXqMR; goto aY3RN; kL6Ww: $item->status = 2; goto avz9J; sY7fw: uXqMR: goto Gv6Gv; qyIDe: $item->money = $item->amount; goto P7oJD; P7oJD: $item->remark = $item->name; goto M17eJ; p1mjn: $item->status = 1; goto sY7fw; WLymw: } goto GLqa3; wW8sF: $store_id = $this->get("\163\x74\x6f\162\x65\137\x69\x64", 0); goto M3g8w; Tajt9: $data = \App\Model\Coupon::instance()->where("\x73\164\157\x72\x65\137\151\144", $store_id)->where("\x64\x61\x74\145\50\x62\145\x67\x69\156\137\141\164\x29", "\x3c\75", $today)->where("\144\141\164\x65\x28\x65\156\144\137\x61\164\51", "\76\x3d", $today)->where("\151\163\x5f\145\156\141\142\154\x65", true)->orderBy("\151\144", "\141\x73\x63")->get(["\x69\144", "\x6e\141\x6d\145", "\141\155\x6f\x75\156\164", "\165\163\x65\x5f\141\155\x6f\x75\x6e\x74", "\x64\x61\171\163", "\164\157\164\141\x6c"]); goto R3NUl; whSH2: return $this->success($data); goto uGw8L; GLqa3: aLS4w: goto whSH2; uGw8L: } public function receiveCouponApi() { goto E1_Wy; vRRTf: $userCoupon->is_used = false; goto ANVGH; l21Py: $coupon = \App\Model\Coupon::instance()->find($coupon_id); goto e6ajq; HvjZl: if (!$limit) { goto isjrn; } goto xSJrT; xSJrT: return $this->response(-999, "\xe5\xb7\xb2\xe8\xa2\xab\xe6\x8a\242\345\205\x89"); goto bLqM8; a3tfd: $isHasCoupon = $this->isUserHasCoupon($this->user->id, $coupon_id); goto CK8SE; C544v: $userCoupon->store_id = $coupon->store_id; goto LbF4H; bVoMw: return $this->response(-999, "\346\x82\250\xe5\xb7\262\xe9\242\206\350\277\207"); goto nfYb8; XwrOc: $coupon_id = $this->get("\x63\157\x75\160\x6f\x6e\137\x69\144", 0); goto l21Py; TcJIL: $userCoupon->amount = $coupon->amount; goto UaXFS; EXvh_: $userCoupon->end_at = date("\131\55\x6d\55\x64\40\40\x48\x3a\151\x3a\163", strtotime("\53" . $coupon->days . "\x20\144\141\171", strtotime($date))); goto vRRTf; CK8SE: if (!$isHasCoupon) { goto LRYVo; } goto bVoMw; yLBFP: $userCoupon = \App\Model\UserCoupon::instance(); goto QcAhB; QcAhB: $userCoupon->name = $coupon->name; goto TcJIL; QrFB2: $userCoupon->coupon_id = $coupon->id; goto C544v; UaXFS: $userCoupon->use_amount = $coupon->use_amount; goto g2OJ_; bLqM8: isjrn: goto yLBFP; e6ajq: if (!$coupon) { goto m78f4; } goto a3tfd; E1_Wy: $date = date("\x59\x2d\x6d\55\x64\40\x20\110\x3a\x69\x3a\163"); goto XwrOc; ZjN4A: return $this->response(-999, "\350\xaf\xa5\344\xbc\230\346\x83\240\xe5\x88\xb8\xe4\270\215\345\255\230\xe5\234\250"); goto C_QJW; g2OJ_: $userCoupon->begin_at = $date; goto EXvh_; LbF4H: $userCoupon->save(); goto bT3K8; PxYBQ: m78f4: goto ZjN4A; JFbrE: $limit = $this->getReceivedCouponCount($coupon_id) >= $coupon->total; goto HvjZl; nfYb8: LRYVo: goto JFbrE; bT3K8: return $this->success(); goto PxYBQ; ANVGH: $userCoupon->user_id = $this->user->id; goto QrFB2; C_QJW: } public function getUserCouponApi() { goto FW40I; QuoTv: return $this->success($data); goto zxxfC; PWx3n: vPji5: goto QuoTv; cPiEN: foreach ($data as $item) { goto y4RCk; y4RCk: $item->store_name = $storeNameList[$item->store_id]; goto n61Wy; AZg2l: GazSA: goto sxRTH; n61Wy: $item->price = $item->amount; goto IOepa; IOepa: $item->minprice = $item->name; goto tNNYq; tNNYq: $item->time = date("\131\56\x6d\56\144", strtotime($item->begin_at)) . "\55" . date("\x59\56\x6d\56\144", strtotime($item->end_at)); goto AZg2l; sxRTH: } goto PWx3n; FW40I: $today = date("\x59\55\155\x2d\144"); goto vj3xd; vj3xd: $data = \App\Model\UserCoupon::instance()->where("\165\163\145\x72\137\151\x64", $this->user->id)->where("\x69\163\x5f\x75\163\145\x64", false)->where("\x64\141\164\x65\x28\142\145\x67\x69\156\137\141\164\x29", "\74\x3d", $today)->where("\144\141\x74\145\x28\145\x6e\144\x5f\x61\x74\x29", "\x3e\75", $today)->get(["\151\x64", "\156\141\155\x65", "\141\155\x6f\165\156\x74", "\165\163\145\137\141\155\x6f\165\156\164", "\x64\141\x74\x65\x28\x62\x65\x67\151\x6e\x5f\141\164\51\x20\141\163\x20\x62\145\147\151\x6e\137\141\x74", "\x64\141\164\x65\x28\145\x6e\144\x5f\141\x74\51\40\141\163\x20\145\x6e\144\137\x61\x74", "\x63\x6f\x75\160\x6f\x6e\137\151\x64", "\x73\164\157\162\x65\137\151\x64"]); goto q0SyT; q0SyT: $storeNameList = \App\Model\Store::instance()->pluck("\156\141\155\x65", "\x69\x64"); goto cPiEN; zxxfC: } } goto v5aaD; gqUmK: trait DisTrait { public function getDisListApi() { goto Djc2L; CZWDe: foreach ($disList as &$item) { goto t8FbM; U0fqN: $item["\141\x64\x64\x72\x65\163\x73"] = $address["\143\x6f\165\x6e\164\x79\x4e\141\x6d\x65"] . $address["\144\x65\x74\141\x69\154\111\156\x66\x6f"]; goto m2Z5H; JONKR: $item["\x75\156\141\155\145"] = $user->name; goto sjWdc; EbScX: $user = User::instance()->find($order->user_id); goto V3ymZ; lSylY: $order = \App\Model\Order::instance()->where("\163\x6e", $item["\157\x72\x64\x65\162\x5f\x73\156"])->first(); goto EbScX; V3ymZ: $store = \App\Model\Store::instance()->find($item["\x73\x74\x6f\162\x65\137\151\x64"]); goto JONKR; t8FbM: $item["\x63\162\145\x61\164\145\144\x5f\x61\164"] = date("\155\x2d\144\x20\110\72\151", strtotime($item["\143\162\145\x61\x74\x65\144\x5f\141\164"])); goto lSylY; DJRcx: $item["\x73\150\157\160\x6e\141\155\145"] = $store->name; goto e0s7R; m2Z5H: WIkc_: goto hHvwI; sjWdc: $item["\165\164\x68\x75\x6d\x62"] = $user->avatar; goto PEqXK; PEqXK: $item["\x64\151\x73\164\x61\156\143\x65"] = $this->getDistance($store->longitude, $store->latitude, $order->longitude, $order->latitude); goto DJRcx; e0s7R: $address = json_decode($order->address, true); goto U0fqN; hHvwI: } goto yDkWc; OBlzo: $this->transformer($banner, ["\141\143\x74\x69\x6f\x6e" => "\x62\151\156\x64"]); goto zUHxd; yDkWc: wyDdA: goto prpif; GDL_k: Il4bb: goto ZlDQn; kEhQI: $data = ["\x62\x61\156\x6e\145\x72" => $banner, "\x64\151\163\114\151\x73\x74" => $disList]; goto AWVht; ZlDQn: $disList = \App\Model\DisOrder::instance()->where("\x73\x74\141\x74\x75\x73", 10)->get(["\163\x74\157\x72\x65\x5f\x69\x64", "\157\x72\144\145\x72\137\x73\x6e", "\144\x69\x73\x5f\141\x6d\157\x75\156\164", "\x63\x72\145\141\164\145\144\137\141\164"])->toArray(); goto CZWDe; zUHxd: foreach ($banner as &$item) { goto KJn80; Kc1Sb: unset($item["\x61\143\x74\151\x6f\x6e\x5f\164\171\160\145"]); goto l35Vf; QmDzY: $this->transformerAction($item); goto Kc1Sb; l35Vf: E3_M3: goto noxBb; KJn80: $this->changeUploadPath($item["\155\x61\151\x6e\x5f\x69\155\x61\147\x65"]); goto QmDzY; noxBb: } goto GDL_k; prpif: $this->transformer($disList, ["\157\162\x64\145\162\x5f\x73\x6e" => "\x6f\162\x64\145\x72\156\x75\155", "\144\151\x73\x5f\x61\x6d\x6f\165\x6e\x74" => "\x70\x72\x69\143\x65", "\x63\x72\145\x61\164\145\144\x5f\141\x74" => "\164\x69\155\x65"]); goto kEhQI; AWVht: return $this->success($data); goto t3yLP; Djc2L: $banner = \App\Model\DisBanner::instance()->where("\151\163\137\x65\156\141\x62\x6c\145", true)->orderBy("\x6f\x72\144\x65\162", "\x61\163\x63")->get(["\155\141\151\x6e\137\151\x6d\x61\x67\x65", "\x61\143\x74\x69\157\x6e", "\141\x63\x74\x69\157\156\x5f\x74\x79\160\x65"])->toArray(); goto OBlzo; t3yLP: } public function receiveOrderApi() { goto XOgaI; XOgaI: $dis_order_sn = $this->get("\x64\x69\x73\137\x6f\x72\144\145\x72\x5f\163\156"); goto GkD2J; KD_O2: $dis_order->dis_user_id = $this->user->id; goto VGupV; XBe6p: return $this->success(); goto uucI0; I2pj1: if ($dis_order->status != 10) { goto Irf92; } goto KD_O2; GkD2J: $dis_order = \App\Model\DisOrder::instance()->where("\157\x72\x64\x65\x72\x5f\163\x6e", $dis_order_sn)->first(); goto ReSKh; yELC7: goto gpHdx; goto rSNpN; ixuwX: return $this->error(-1, "\346\234\xaa\xe6\x89\276\345\x88\xb0\350\xaf\xa5\350\xae\242\345\x8d\x95"); goto yELC7; e7USQ: gpHdx: goto bCVcH; rPuFP: return $this->error(-1, "\350\257\245\350\256\242\xe5\215\x95{$status_str}"); goto juJWK; FWneG: $status_list = [-10 => "\345\xb7\262\345\x8f\x96\346\266\x88", 20 => "\345\xb7\xb2\xe8\xa2\253\346\216\245\xe5\x8d\x95", 30 => "\345\xb7\262\351\205\x8d\xe9\x80\201\xe5\xae\214\346\x88\x90"]; goto NlPkr; NlPkr: $status_str = $status_list[$dis_order->status]; goto rPuFP; F5xTt: $dis_order->save(); goto XBe6p; juJWK: iwek5: goto e7USQ; VGupV: $dis_order->receive_at = now(); goto U8ezG; U8ezG: $dis_order->status = 20; goto F5xTt; uucI0: goto iwek5; goto CIXzj; rSNpN: lWSLk: goto I2pj1; CIXzj: Irf92: goto FWneG; ReSKh: if ($dis_order) { goto lWSLk; } goto ixuwX; bCVcH: } public function disOrderDetailApi() { goto shH_i; R4b6G: $dis_order = \App\Model\DisOrder::instance()->where("\157\162\x64\x65\x72\137\163\156", $dis_order_sn)->first(); goto w_wvK; LD2Yn: $order = \App\Model\Order::instance()->where("\x73\156", $dis_order_sn)->first(); goto R4b6G; rp00N: $info = ["\x6f\x72\x64\145\162\137\x73\x6e" => $dis_order_sn, "\x72\145\x6d\x61\x72\x6b" => $order->remark, "\x64\151\163\137\141\155\157\165\x6e\164" => $dis_order->dis_amount, "\165\x73\145\x72\116\141\x6d\x65" => $address["\x75\163\145\162\x4e\x61\155\x65"], "\x6c\157\156\x67\x69\164\165\x64\145" => floatval($order->longitude), "\154\141\164\151\164\x75\x64\145" => floatval($order->latitude), "\160\150\157\156\x65" => $address["\164\x65\154\116\165\x6d\x62\145\x72"], "\x61\144\144\162\145\x73\163" => $address["\143\157\x75\156\164\171\116\141\x6d\x65"] . $address["\x64\x65\x74\x61\151\154\111\x6e\146\x6f"]]; goto ISIMz; twS7f: $this->transformer($goods, ["\x67\157\x6f\144\x73\137\x6e\x61\x6d\x65" => "\164\151\164\154\x65", "\x67\157\x6f\x64\163\137\x70\x72\x69\143\145" => "\160\162\151\143\x65", "\x73\x72\x63" => "\151\x6d\147"]); goto LD2Yn; w_wvK: $address = json_decode($order->address, true); goto rp00N; Pkj8m: return $this->success(["\147\157\x6f\x64\x73" => $goods, "\x69\x6e\x66\157" => $info, "\163\x74\x61\x74\165\x73" => $status]); goto Ng5Qh; ISIMz: $status = $dis_order->status; goto Pkj8m; shH_i: $dis_order_sn = $this->get("\144\x69\x73\137\157\162\x64\x65\x72\x5f\x73\156"); goto ejDSf; ejDSf: $goods = \App\Model\OrderGoods::instance()->where("\157\162\144\145\162\x5f\x73\156", $dis_order_sn)->get(["\147\157\x6f\144\x73\137\x6e\141\155\x65", "\147\157\x6f\x64\x73\x5f\x70\x72\151\143\145", "\x62\165\x79\x5f\x74\x79\x70\145", "\x73\x72\143", "\x6e\x75\x6d"])->toArray(); goto twS7f; Ng5Qh: } public function getDisMonthSummary($year, $month) { goto X4kB1; RBy3l: $amount = \App\Model\DisAmountLog::instance()->where("\x64\151\x73\137\x75\x73\x65\x72\x5f\x69\144", $this->user->id)->where("\x63\x72\x65\x61\x74\x65\144\137\x61\164", "\x3e\75", $firstday)->where("\x63\162\x65\x61\x74\145\x64\x5f\141\x74", "\74\x3d", $lastday)->where("\164\x79\160\145", 0)->where("\x6e\141\x6d\145", "\x3c\x3e", "\346\217\220\347\x8e\260\xe5\244\261\xe8\xb4\245")->sum("\x61\x6d\x6f\165\156\164"); goto aeSxy; b26VX: $lastday = date("\x59\x2d\x6d\55\x64\40\x32\63\x3a\x35\x39\72\x35\71", strtotime("{$firstday}\40\53\x31\40\155\x6f\x6e\x74\150\x20\55\x31\40\144\141\171")); goto RBy3l; X4kB1: $firstday = date("\x59\x2d\x6d\55\x30\x31\x20\x30\60\x3a\x30\60\72\x30\60", strtotime(sprintf("\x25\x64\55\x25\144\55\x30\61\40\x30\x30\72\60\60\72\60\60", $year, $month))); goto b26VX; aeSxy: return $amount; goto ds4Ly; ds4Ly: } public function getDisMonthSummaryApi() { goto maO4h; maO4h: $year = $this->get("\171\x65\141\x72"); goto gXzUh; JXLco: $this->success(["\x61\155\157\x75\x6e\x74" => $amount]); goto eDlaF; gXzUh: $month = $this->get("\155\x6f\x6e\164\x68"); goto Mjuhf; Mjuhf: $amount = $this->getDisMonthSummary($year, $month); goto JXLco; eDlaF: } public function getDisOrderListApi() { goto f3oNw; EFbV7: $amount_log = $res; goto sWBON; Bhsko: foreach ($amount_log as $log) { goto jA3zO; rhPLU: EBixf: goto QmSH7; QmSH7: $subItem["\x6f\x72\144\145\162\156\x75\x6d"] = $log["\x6e\x61\x6d\x65"]; goto uUObh; ANuA5: $res[] = $subItem; goto i93q2; HY6ZC: goto nX0K3; goto rhPLU; uUObh: nX0K3: goto KMYUR; qdSye: $subItem["\x6f\x72\144\x65\162\156\x75\155"] = $log["\x72\x65\155\x61\162\153"]; goto HY6ZC; n7DKa: $subItem["\x74\x69\155\145"] = date("\131\55\155\x2d\x64", strtotime($log["\143\x72\145\x61\x74\x65\144\137\141\x74"])); goto U0Ffi; kIfvm: $subItem["\157\162\144\x65\162\156\165\x6d"] = $log["\x6e\141\155\x65"]; goto mfWta; vYpro: if ($log["\162\145\155\x61\162\x6b"] == '') { goto EBixf; } goto qdSye; DNcox: Jlig0: goto vYpro; U0Ffi: if ($log["\x74\x79\x70\x65"] == 0) { goto Jlig0; } goto kIfvm; mfWta: goto v3CJL; goto DNcox; KMYUR: v3CJL: goto ANuA5; jA3zO: $subItem = []; goto w3wc3; i93q2: iQi3_: goto T7LM3; w3wc3: $subItem["\x6d\157\156\145\x79"] = $log["\x61\x6d\157\x75\156\x74"]; goto n7DKa; T7LM3: } goto cLZLL; XIxnX: t2uvV: goto u3u6S; DZ_Ec: foreach ($disList as &$item) { goto Zen4v; xC8KK: $store = \App\Model\Store::instance()->find($item["\x73\164\157\162\145\137\x69\144"]); goto xKbW7; xKbW7: $item["\144\151\x73\164\141\156\143\145"] = $this->getDistance($store->longitude, $store->latitude, $order->longitude, $order->latitude); goto IsBxJ; yhCOZ: $order = \App\Model\Order::instance()->where("\x73\x6e", $item["\157\x72\x64\145\x72\x5f\x73\x6e"])->first(); goto xC8KK; U8nR1: $address = json_decode($order->address, true); goto EtenP; dxtUb: $this->transformer($goods, ["\x67\157\x6f\x64\163\x5f\x6e\x61\x6d\x65" => "\x74\x69\164\154\145", "\147\x6f\157\x64\x73\137\x70\162\151\x63\x65" => "\160\x72\151\x63\145", "\x73\162\143" => "\151\x6d\x67"]); goto KDk4z; EtenP: $item["\x61\144\x64\x72\x65\x73\163"] = $address["\x63\157\165\156\164\x79\x4e\x61\155\x65"] . $address["\x64\x65\164\x61\151\x6c\111\x6e\x66\x6f"]; goto XCXA5; IsBxJ: $item["\163\x68\157\x70\x6e\141\155\145"] = $store->name; goto U8nR1; Wc4Dj: U_YaD: goto PeiLt; Zen4v: $item["\143\162\x65\x61\x74\145\x64\x5f\141\164"] = date("\155\x2d\144\40\x48\72\x69", strtotime($item["\x63\162\145\141\164\x65\x64\137\x61\x74"])); goto yhCOZ; KDk4z: $item["\147\x6f\157\144\x73"] = $goods; goto Wc4Dj; XCXA5: $goods = \App\Model\OrderGoods::instance()->where("\157\162\144\145\162\x5f\x73\156", $item["\x6f\162\144\x65\x72\x5f\163\x6e"])->get(["\147\157\157\x64\x73\137\x6e\141\x6d\145", "\x67\x6f\157\144\x73\x5f\x70\x72\151\x63\x65", "\142\x75\171\x5f\164\171\160\145", "\163\162\x63", "\x6e\165\155"])->toArray(); goto dxtUb; PeiLt: } goto XIxnX; cLZLL: H00ws: goto EFbV7; sWBON: $month = date("\x6d"); goto OBLMs; oM21f: return $this->success(["\157\x72\144\x65\x72\x4c\151\163\x74" => $disList, "\144\151\x73\x5f\141\155\x6f\165\x6e\164" => $this->user->dis_amount, "\141\x6d\x6f\x75\156\164\137\154\157\x67" => $amount_log, "\x6d\x6f\x6e\164\x68\x5f\141\155\157\x75\x6e\164" => $month_amount, "\x6d\x6f\156\164\x68" => "\62\x30\61\x38\55" . $month]); goto RdCWZ; k2Ojs: $res = []; goto Bhsko; u3u6S: $this->transformer($disList, ["\157\x72\144\145\x72\137\x73\156" => "\x6f\x72\x64\x65\162\156\x75\x6d"]); goto w4G3v; w4G3v: $amount_log = \App\Model\DisAmountLog::instance()->where("\x64\x69\x73\x5f\165\163\x65\x72\137\151\144", $this->user->id)->orderBy("\x69\x64", "\x64\x65\x73\x63")->get(["\x72\145\155\x61\x72\x6b", "\164\x79\160\145", "\x6e\141\x6d\x65", "\x61\155\157\x75\156\164", "\x63\162\x65\141\x74\145\x64\137\x61\x74"])->toArray(); goto k2Ojs; f3oNw: $disList = \App\Model\DisOrder::instance()->where("\x73\x74\141\x74\165\163", "\x3e\x3d", 20)->where("\x64\x69\x73\137\x75\163\145\162\137\x69\144", $this->user->id)->get(["\x73\164\x6f\x72\145\x5f\151\144", "\157\162\x64\145\x72\x5f\x73\x6e", "\144\x69\163\137\x61\x6d\x6f\165\156\164", "\x63\162\145\x61\164\x65\x64\x5f\x61\164", "\163\x74\141\164\165\163"])->toArray(); goto DZ_Ec; OBLMs: $month_amount = $this->getDisMonthSummary(date("\x59"), $month); goto oM21f; RdCWZ: } public function disOrderDeleteApi() { goto qfPrO; STai2: $dis_order = \App\Model\DisOrder::instance()->where("\x6f\x72\144\x65\162\137\163\156", $dis_order_sn)->first(); goto cFg1k; cFg1k: $dis_order->status = -10; goto gnb4Z; gnb4Z: $dis_order->save(); goto W2qYb; W2qYb: return $this->success(); goto zZoql; qfPrO: $dis_order_sn = $this->get("\144\x69\x73\137\157\x72\144\145\162\137\163\156"); goto STai2; zZoql: } public function changeDisAmount($dis_user_id, $type, $name, $amount, $remark = '') { goto TnGNG; CCPMH: $dis_amount_log->name = $name; goto rKV3h; ikEJy: $this->user->save(); goto rs3cH; TXo6e: $dis_amount_log->remark = $remark; goto vqZxv; TnGNG: $dis_amount_log = \App\Model\DisAmountLog::instance(); goto U53as; vqZxv: $dis_amount_log->save(); goto NIPCc; NIPCc: $this->user->dis_amount += floatval($amount); goto ikEJy; q3385: $dis_amount_log->type = $type; goto CCPMH; rKV3h: $dis_amount_log->amount = $amount; goto TXo6e; U53as: $dis_amount_log->dis_user_id = $dis_user_id; goto q3385; rs3cH: } public function disOrderFinishApi() { goto CBVy8; zV3ts: $this->changeDisAmount($dis_order->dis_user_id, 0, "\351\205\x8d\xe9\200\201\xe8\277\x9b\xe5\xb8\x90", $dis_order->dis_amount, $order->sn); goto rlzVI; b70fN: $dis_order->save(); goto gcZP3; ssdip: $order = \App\Model\Order::instance()->where("\163\x6e", $dis_order_sn)->first(); goto XG422; gcZP3: $order->status = 40; goto fs1As; CBVy8: $dis_order_sn = $this->get("\x64\x69\x73\137\x6f\162\x64\145\x72\137\163\x6e"); goto xIWun; m8vI8: $dis_order->finish_at = now(); goto b70fN; rlzVI: return $this->success(); goto ffdGA; xIWun: $dis_order = \App\Model\DisOrder::instance()->where("\157\x72\144\145\162\x5f\x73\x6e", $dis_order_sn)->first(); goto ssdip; XG422: $dis_order->status = 30; goto m8vI8; fs1As: $order->save(); goto zV3ts; ffdGA: } public function getStoreOrderList($store_id) { goto ZaOnf; SnUx_: K1JhA: goto kNXUW; R07zK: pi02m: goto dW3O4; JN7fM: foreach ($disOrderList as $item) { $res[] = $item["\157\x72\144\145\162\137\163\x6e"]; CHEZa: } goto SnUx_; dW3O4: $disOrderList = \App\Model\DisOrder::instance()->where("\x73\164\x6f\x72\145\x5f\x69\144", $store_id)->where("\x73\x74\x61\164\165\163", 30)->get(["\157\x72\x64\x65\x72\x5f\x73\156"])->toArray(); goto JN7fM; kNXUW: return array_unique($res); goto T76oY; iWsQy: foreach ($orders as $item) { $res[] = $item["\163\x6e"]; Wj_k4: } goto R07zK; ZaOnf: $orders = \App\Model\Order::instance()->where("\x73\164\157\162\x65\137\151\x64", $store_id)->where("\163\x74\x61\164\x75\163", "\x3d", 20)->where("\x64\151\x73\x74\x72\x69\142\165\164\x69\157\156\137\164\x79\160\145", "\75", 0)->orderBy("\x69\144", "\x64\145\163\143")->get(["\163\156"])->toArray(); goto ZxKNf; ZxKNf: $res = []; goto iWsQy; T76oY: } public function getStoreOrderListApi() { goto cBM37; cBM37: $store_id = $this->user->is_admin; goto W0tjs; oh9as: NNz29: goto wAtGh; ERwsh: return $this->success($orders); goto oh9as; mx01W: kYo8V: goto ERwsh; EO8cU: u0PZd: goto Dysjo; ZMrKK: goto NNz29; goto EO8cU; IfoZa: $orders = \App\Model\Order::instance()->where("\163\x6e", "\151\x6e", $this->getStoreOrderList($store_id))->orderBy("\x69\144", "\144\x65\163\143")->get(["\151\144", "\x73\x74\x6f\x72\145\137\151\144", "\x73\x6e", "\163\164\141\164\165\x73", "\x70\141\x79\137\141\x6d\157\165\x6e\164", "\x63\162\145\141\164\x65\144\137\141\164", "\x64\x69\163\164\162\151\142\165\x74\151\x6f\x6e\137\141\x6d\x6f\x75\x6e\164", "\x61\x64\144\162\145\x73\x73", "\x6c\157\156\x67\151\164\165\x64\x65", "\154\141\164\151\x74\165\x64\145"])->toArray(); goto z0PXs; Dysjo: $store = \App\Model\Store::instance()->find($store_id); goto IfoZa; j88Do: return $this->error(400, "\xe6\202\250\344\xb8\215\346\x98\xaf\345\210\206\xe5\272\227\347\256\241\xe7\220\206\345\x91\230"); goto ZMrKK; z0PXs: foreach ($orders as &$item) { goto l5s5M; qxTdz: $distance = round($distance / 1000, 2); goto Ggfa6; PHwKX: OFvuf: goto eAs5C; kvQ8F: $item["\x73\164\141\164\x75\163"] = 40; goto QDG5S; Qw82_: goto GMxbm; goto BA8cw; RZB1x: $item["\x64\151\x73\x74\x72\x69\x62\165\164\151\x6f\156\x5f\x61\155\x6f\165\156\x74"] = $disOrder->dis_amount; goto dc2iT; mqrjq: $item["\x6e\165\155\163"] = count($goods); goto Pz0Uz; eAs5C: $item["\163\164\x61\x74\x75\163"] = 60; goto Qw82_; l5s5M: $address = json_decode($item["\x61\x64\144\x72\x65\163\163"], true); goto nlqk9; BA8cw: G1uGv: goto kvQ8F; iLtq3: if ($disOrder->status == 30) { goto G1uGv; } goto KX7eE; O6MBr: $item["\x67\x6f\157\144\x73"] = [$goods[0]]; goto mqrjq; fe5Vb: if (!$disOrder) { goto euE8M; } goto RZB1x; WWzxD: EUzaQ: goto ovpze; SypvI: $goods = \App\Model\OrderGoods::instance()->where("\157\162\144\x65\162\137\x73\x6e", $item["\x73\156"])->get(["\x67\157\157\144\163\x5f\x6e\141\155\145", "\147\x6f\x6f\x64\163\x5f\160\162\x69\143\145", "\142\x75\171\137\x74\x79\x70\145", "\163\162\143", "\x6e\x75\x6d"])->toArray(); goto kYULp; KX7eE: goto GMxbm; goto PHwKX; kYULp: $this->transformer($goods, ["\163\162\x63" => "\x67\x6f\x6f\x64\x73\137\x69\x6d\x67"]); goto O6MBr; Pz0Uz: $disOrder = \App\Model\DisOrder::instance()->where("\x6f\x72\144\145\162\x5f\163\156", $item["\163\x6e"])->first(); goto fe5Vb; QDG5S: GMxbm: goto OtG4y; nlqk9: $item["\x61\144\144\162\x65\163\x73"] = $address["\x63\x6f\165\x6e\x74\171\116\x61\155\145"] . $address["\144\x65\164\x61\x69\154\x49\x6e\146\157"]; goto Q0P1X; OtG4y: euE8M: goto WWzxD; Q0P1X: $distance = $this->getDistance($store->longitude, $store->latitude, $item["\154\x6f\156\x67\151\164\165\x64\x65"], $item["\154\x61\x74\151\x74\x75\144\x65"]); goto qxTdz; Ggfa6: $item["\x64\x69\x73\164\x61\x6e\x63\145"] = $distance; goto qIVK9; dc2iT: if ($disOrder->status == 10 || $disOrder->status == 20) { goto OFvuf; } goto iLtq3; qIVK9: $item["\143\162\x65\x61\x74\145\144\137\141\x74"] = date("\155\x2d\x64\40\x48\72\x69", strtotime($item["\143\x72\145\141\x74\x65\x64\x5f\141\164"])); goto SypvI; ovpze: } goto mx01W; W0tjs: if ($store_id > 0) { goto u0PZd; } goto j88Do; wAtGh: } public function postDisOrderApi() { goto j2whT; NHHRX: $disOrder->order_sn = $order->sn; goto AUI_a; wHRzz: $disOrder = \App\Model\DisOrder::instance(); goto Ft9Ie; edyAY: $disOrder->dis_amount = $dis_amount; goto NHHRX; Kmyrw: $order = \App\Model\Order::instance()->where("\x73\x6e", $order_sn)->first(); goto U8Tb0; U8Tb0: $disOrder = \App\Model\DisOrder::instance()->where("\157\162\144\x65\162\137\163\156", $order_sn)->first(); goto rqlet; Ft9Ie: $disOrder->store_id = $order->store_id; goto edyAY; AUI_a: $disOrder->save(); goto HE4Qm; f8YCi: return $this->success(); goto bVI1Y; UE6S7: $dis_amount = $this->get("\x64\151\163\x5f\141\155\157\x75\156\164"); goto Kmyrw; HE4Qm: Ot3Qp: goto f8YCi; rqlet: if ($disOrder) { goto Ot3Qp; } goto wHRzz; j2whT: $order_sn = $this->get("\163\x6e"); goto UE6S7; bVI1Y: } } goto zwQWM; zwQWM: trait StoreTrait { private function getCurrentStoreBaseInfo() { goto vBssQ; vBssQ: $store_id = $this->get("\x73\164\157\162\x65\x5f\x69\x64", 0); goto F23b3; Mm6sq: PKreW: goto ZHnQH; F23b3: if (!(0 == $store_id)) { goto PKreW; } goto wYCZY; wYCZY: $store_id = $this->getCurrentStore(); goto Mm6sq; ZHnQH: $store = \App\Model\Store::instance()->find($store_id, ["\151\x64", "\156\141\x6d\145"]); goto nIge5; nIge5: return $store; goto KRS5o; KRS5o: } protected function getCurrentStore() { goto YIS1K; A0BGV: return $id; goto ZNBQ7; LV_V7: $longitude = $this->user->longitude; goto GH2YN; PQUdW: $id = 0; goto LV_V7; ilQrp: wdV30: goto A0BGV; GH2YN: $latitude = $this->user->latitude; goto wO3W2; ubKTI: $minDistance = 999999999; goto PQUdW; wO3W2: foreach ($stores as $item) { goto I8BqB; m4x1s: $minDistance = $distance; goto JQgVg; LoGo4: if (!($distance < $minDistance)) { goto zWrWi; } goto m4x1s; Y_Yfh: SRaLY: goto qz2o0; I8BqB: $distance = $this->getDistance($longitude, $latitude, $item->longitude, $item->latitude); goto LoGo4; JQgVg: $id = $item->id; goto VJkFG; VJkFG: zWrWi: goto Y_Yfh; qz2o0: } goto ilQrp; YIS1K: $stores = \App\Model\Store::instance()->get(["\x69\x64", "\x6c\x61\164\x69\x74\x75\x64\145", "\154\x6f\156\x67\x69\164\x75\144\x65"]); goto ubKTI; ZNBQ7: } private function getLimitTimeActivity($store_id, $haveGoods = false) { goto GjpK9; fD7cE: $activity = ["\x73\164\x61\164\x75\163" => 0]; goto ulkmJ; rS17R: if ($activity) { goto fQyo6; } goto fD7cE; Mb0pk: $this->changeUploadPath($activity["\155\141\151\156\137\151\x6d\x61\147\145"]); goto TlUFy; ulkmJ: goto SKIHK; goto vkNIR; zFspW: $activity = $activity->toArray(); goto ptago; GjpK9: $now = date("\131\x2d\155\55\x64\x20\110\x3a\151\x3a\x73"); goto ucG5D; pPVaE: SKIHK: goto iPxNS; iPxNS: return $activity; goto pnB_W; ucG5D: $activity = \App\Model\LimitTimeActivity::instance()->where("\x73\x74\x61\x74\165\x73", 1)->where("\163\x74\x6f\x72\145\137\x69\144", $store_id)->where("\x62\145\x67\x69\156\137\141\x74", "\x3c\75", $now)->where("\145\156\x64\137\x61\x74", "\x3e\x3d", $now)->first(["\151\144", "\163\x74\141\x74\165\x73", "\x72\x65\x6d\141\162\x6b", "\x6d\x61\x69\156\x5f\x69\x6d\141\x67\x65", "\x69\155\x61\147\145\163"]); goto rS17R; oxgZi: if (!$haveGoods) { goto bsLLv; } goto cwzzW; TlUFy: $this->changeUploadPath($activity["\x62\141\156\156\x65\x72"]); goto oxgZi; cwzzW: $activity["\147\157\157\x64\x73"] = $this->getLimitTimeActivityGoods($store_id, $activity["\x69\144"]); goto yj4Dm; ptago: $this->transformer($activity, ["\151\x6d\141\x67\x65\x73" => "\x62\141\x6e\156\x65\x72"]); goto Mb0pk; yj4Dm: bsLLv: goto pPVaE; vkNIR: fQyo6: goto zFspW; pnB_W: } private function getBuyNumFormUser($user_id, $store_id, $goods_type, $goods_id) { return 0; } public function getSecKillActivityApi() { goto pFcnG; xQEkk: os9yG: goto ECsf1; pFcnG: $store_id = $this->get("\x73\x74\157\x72\145\137\x69\144"); goto Tcn8h; kTk7y: if (!$sec_kill_activity) { goto os9yG; } goto eV1UF; eV1UF: $sec_kill_activity_id = $sec_kill_activity->id; goto xQEkk; iUL1h: $sec_kill_activity = $activity = \App\Model\SecKillActivity::instance()->where("\163\164\x61\164\x75\163", 1)->where("\x73\x74\157\x72\145\137\151\144", $store_id)->where("\x62\145\x67\151\156\x5f\141\x74", "\x3c\x3d", $now)->where("\x65\x6e\x64\137\141\164", "\76\x3d", $now)->first(["\151\x64", "\x73\164\141\164\x75\163", "\164\x69\155\x65\x73"]); goto kTk7y; UBPVs: $sec_kill_activity_id = 0; goto v2Vec; ECsf1: $res = ["\163\145\x63\x4b\x69\x6c\154" => $data, "\163\x65\x63\x5f\153\x69\x6c\x6c\x5f\141\143\x74\151\x76\x69\164\x79\x5f\151\x64" => $sec_kill_activity_id, "\143\x75\162\162\145\156\164\x49\x6e\x64\x65\170" => $currentIndex]; goto Ons9n; Ons9n: $this->success($res); goto lGFpr; Tcn8h: list($data, $currentIndex) = $this->getSecKillActivity($store_id); goto UBPVs; v2Vec: $now = date("\x59\x2d\x6d\55\x64\40\x48\72\151\72\x73"); goto iUL1h; lGFpr: } private function getLimitTimeActivityGoods($store_id, $activity_id) { goto XeMJn; pjOXc: foreach ($goodslist as &$item) { goto h1l03; mwf6O: unset($item["\147\x6f\x6f\x64\x73\137\x69\x64"]); goto LrVY6; SKta9: $item["\x69\144"] = $item["\147\x6f\157\144\163\x5f\151\x64"]; goto mwf6O; aB0SV: PiVYY: goto DwqwR; mn74k: $item["\154\x69\x6d\151\x74"] = $item["\x6c\x69\155\151\x74\145\x64"]; goto gf0su; LrVY6: unset($item["\x6c\x69\x6d\151\x74\x65\x64"]); goto aB0SV; nsZxG: $item["\x73\x72\x63"] = $this->uploadPath($goods->main_image); goto AVw54; gf0su: $item["\x61\x63\x74\x69\x76\151\164\171\137\x67\x6f\157\144\x73\137\151\144"] = $item["\x69\144"]; goto SKta9; AVw54: $item["\156\x61\x6d\x65"] = $goods->name; goto mn74k; h1l03: $goods = \App\Model\Goods::instance()->find($item["\147\x6f\157\144\163\x5f\x69\x64"]); goto nsZxG; DwqwR: } goto qyklT; qyklT: POH6A: goto Vdt1q; Vdt1q: return $goodslist; goto LYgE7; XeMJn: $goodslist = \App\Model\ActivityGoods::instance()->where("\141\x63\164\151\x76\x69\x74\x79\137\x74\171\x70\x65", 1)->where("\x61\143\164\x69\166\x69\x74\x79\137\151\x64", $activity_id)->get(["\147\157\157\144\163\x5f\x69\x64", "\x70\x72\x69\143\x65", "\x6c\x69\155\151\x74\145\x64", "\142\x75\171\x5f\156\x75\x6d", "\x69\x64"])->toArray(); goto pjOXc; LYgE7: } private function getSecKillActivityGoods($store_id, $activity_id, $time) { goto mCBdX; mCBdX: $goodslist = \App\Model\ActivityGoods::instance()->where("\x61\x63\164\x69\x76\151\164\x79\137\x74\x79\160\x65", 2)->where("\141\143\x74\x69\166\x69\x74\x79\137\151\x64", $activity_id)->get(["\x67\157\157\x64\x73\137\x69\x64", "\x70\x72\151\143\x65", "\154\x69\x6d\151\x74\x65\144", "\142\165\x79\x5f\156\x75\x6d", "\x69\x64"])->toArray(); goto Hlljn; iCuHz: return $goodslist; goto s8L02; lFsa0: UVk0h: goto iCuHz; Hlljn: foreach ($goodslist as &$item) { goto wh0Er; qFZji: $item["\156\141\155\145"] = $goods->name; goto UjHvT; Td1H6: $item["\x6f\154\x64\120\x72\x69\x63\x65"] = $goods->shop_price; goto AR6fS; M60og: $item["\x61\x63\x74\151\166\151\x74\x79\x5f\x67\157\157\144\x73\137\151\x64"] = $item["\151\x64"]; goto QTYEZ; QTYEZ: $item["\x69\x64"] = $item["\147\157\x6f\144\x73\x5f\151\144"]; goto kaSLS; wh0Er: $goods = \App\Model\Goods::instance()->find($item["\147\x6f\157\144\x73\x5f\151\x64"]); goto Hlbej; Hlbej: $item["\x73\x72\143"] = $this->uploadPath($goods->main_image); goto qFZji; oGcG6: lnJSP: goto m1iCv; AR6fS: $item["\154\141\x73\164\x6e\x75\x6d"] = $item["\x6d\x61\170\116\x75\155"] - $item["\x62\x75\x79\x5f\x6e\x75\155"]; goto M60og; UjHvT: $item["\x6d\141\x78\116\165\155"] = $item["\154\151\155\151\x74\145\x64"]; goto uQFq9; uQFq9: $item["\x6e\165\155"] = $this->getBuyNumFormUser($this->user->id, $store_id, 2, $goods->id); goto Td1H6; kaSLS: unset($item["\147\x6f\157\144\163\x5f\151\144"]); goto BEhfV; BEhfV: unset($item["\154\151\x6d\x69\x74\x65\144"]); goto oGcG6; m1iCv: } goto lFsa0; s8L02: } private function getSecKillActivity($store_id) { goto bXakx; X5oH5: return [$res, $currentIndex]; goto YX2bt; MipjH: foreach ($times as $time) { goto Vl24I; GSmUY: $currentIndex = $index; goto kOOzF; Wcy8m: if ($time == $currentTime) { goto g1FI_; } goto cMHJ_; Vl24I: $currentTime = intval(date("\x48")); goto diKh2; kOOzF: goto mHT3p; goto gl0Y2; wxlu9: $index++; goto dyBTy; cMHJ_: $status = 0; goto GSmUY; hlmsB: $currentIndex = $index; goto YRCgX; ydKzt: vgGZF: goto FJ3rv; skmIk: goto WH0gv; goto ydKzt; p3kVS: $res[] = ["\x74\151\x6d\145" => sprintf("\45\x32\144\72\x30\x30", $time), "\x73\x74\141\164\165\163" => $status, "\143\154\157\143\x6b" => '', "\147\x6f\157\144\163" => $this->getSecKillActivityGoods($store_id, $activity["\x69\144"], $time)]; goto wxlu9; gl0Y2: g1FI_: goto xw8Q4; YRCgX: mHT3p: goto skmIk; FJ3rv: $status = 2; goto yMc5r; dyBTy: h1zI8: goto p7xIm; xw8Q4: $status = 1; goto hlmsB; diKh2: if ($time > $currentTime) { goto vgGZF; } goto Wcy8m; yMc5r: WH0gv: goto p3kVS; p7xIm: } goto IYIRw; zGS30: $activity = \App\Model\SecKillActivity::instance()->where("\x73\164\141\164\165\163", 1)->where("\x73\x74\157\x72\145\137\151\x64", $store_id)->where("\142\x65\147\x69\x6e\x5f\x61\x74", "\x3c\75", $now)->where("\145\156\x64\137\x61\x74", "\76\75", $now)->first(["\151\144", "\163\164\141\164\x75\163", "\x74\151\155\x65\x73"]); goto x0aOO; bXakx: $now = date("\x59\55\155\x2d\x64\40\x48\72\x69\72\163"); goto Oox8e; HYbJn: $activity = $activity->toArray(); goto yOGUb; rADal: $index = 0; goto MipjH; x0aOO: if (!$activity) { goto itTX_; } goto HYbJn; yOGUb: $times = json_decode($activity["\x74\x69\x6d\145\163"], true); goto rADal; Oox8e: $res = []; goto aX9o8; IYIRw: qGuN3: goto qgnfA; qgnfA: itTX_: goto X5oH5; aX9o8: $currentIndex = 0; goto zGS30; YX2bt: } public function getNewGoodsList($store_id) { goto pmN1c; pmN1c: $newGoodsIdlist = \App\Model\StoreGoods::instance()->where("\x69\163\x5f\156\145\167", true)->where("\x73\164\x6f\x72\x65\x5f\x69\144", $store_id)->orderBy("\x63\162\145\141\164\x65\x64\137\141\x74", "\x64\x65\x73\143")->limit(6)->get(["\x67\x6f\x6f\x64\163\x5f\151\x64", "\163\x68\157\x70\137\160\x72\151\x63\x65", "\151\x64"])->toArray(); goto ypKUU; D1Ikx: JCQiZ: goto EJwed; ypKUU: $newGoodsList = []; goto lA3yX; lA3yX: foreach ($newGoodsIdlist as $item) { goto YtZaZ; QMHju: WoNRf: goto vVfrz; YtZaZ: $goods = \App\Model\Goods::instance()->find($item["\x67\x6f\157\x64\x73\x5f\151\x64"]); goto DgD3Z; DgD3Z: if (!$goods->is_enable) { goto WoNRf; } goto JsCTs; vVfrz: eNz27: goto YRpNb; JsCTs: $newGoodsList[] = ["\x69\144" => $item["\x67\x6f\157\x64\163\x5f\x69\144"], "\156\x61\x6d\145" => $goods->name, "\x70\162\x69\x63\145" => $item["\163\x68\x6f\160\x5f\x70\162\x69\143\x65"], "\163\x72\x63" => $this->uploadPath($goods->main_image), "\x73\164\x6f\x72\145\x5f\147\157\157\x64\x73\x5f\151\144" => $item["\151\x64"]]; goto QMHju; YRpNb: } goto D1Ikx; EJwed: return $newGoodsList; goto NYhzX; NYhzX: } public function transformerAction(&$item) { goto WGWV3; WGWV3: if ($item["\x61\143\164\151\157\156\x5f\164\x79\x70\145"] == 1) { goto UgBq1; } goto EQE_6; nkFH2: $item["\142\x69\x6e\x64"] = "\x63\x6c\141\x73\163\x69\146\x79\x2f\x63\154\141\163\163\x69\x66\171\x3f\x69\x64\x3d" . $item["\142\x69\156\x64"]; goto W60l6; W60l6: j0FmU: goto YYJ1d; cavaD: $item["\142\x69\156\x64"] = "\151\x6e\x64\x65\x78\x2f\147\157\157\x64\x73\x2f\147\x6f\x6f\144\x73\77\151\144\75" . $item["\x62\151\156\x64"]; goto p21YI; EQE_6: if (!($item["\141\143\164\x69\157\x6e\137\164\x79\160\x65"] == 2)) { goto j0FmU; } goto nkFH2; YYJ1d: goto iNtKM; goto XKb63; XKb63: UgBq1: goto cavaD; p21YI: iNtKM: goto id6TV; id6TV: } public function testMsgTemplateApi() { } public function indexApi() { goto kNLGq; LcnJA: if (!$banner) { goto F2xCa; } goto TfyhQ; rUMl7: $tech["\x74\145\143\150\137\151\x73\x5f\x73\150\157\167"] = false; goto Sqx6G; POlIM: $sec_kill_activity = $activity = \App\Model\SecKillActivity::instance()->where("\x73\x74\141\164\165\163", 1)->where("\163\x74\x6f\162\x65\x5f\151\144", $store_id)->where("\x62\x65\147\151\x6e\137\141\x74", "\x3c\x3d", $now)->where("\x65\156\144\x5f\x61\164", "\76\75", $now)->first(["\x69\144", "\163\164\141\x74\165\163", "\x74\151\x6d\x65\163"]); goto z1JbC; hXmmb: $limit_time_res = $this->getLimitTimeActivity($store_id); goto eSc7K; eSc7K: list($sec_kill_res, $sec_kill_activity_index) = $this->getSecKillActivity($store_id); goto rVdkL; IfkMc: $store_id = $store->id; goto qIwXI; rW24c: ZLpVi: goto YIEzd; Sqx6G: $tech["\x74\145\x63\150\x5f\x70\150\x6f\x6e\145"] = ''; goto mtDxt; Ddg1D: $newGoodsList = $this->getNewGoodsList($store_id); goto hXmmb; mtDxt: $tech["\x74\145\143\x68\137\x69\155\147"] = ''; goto I9x1F; BcqG0: JssRR: goto MkXqv; UywoI: $now = date("\131\x2d\x6d\55\x64\40\x48\72\x69\72\x73"); goto POlIM; kIV2h: KIwmW: goto NGe8P; XN0p7: if (!$nav) { goto ZLpVi; } goto OcHxz; z1JbC: if (!$sec_kill_activity) { goto MSQ_P; } goto K2Mlg; bvXFj: $this->transformer($banner, ["\x61\143\164\x69\157\x6e" => "\x62\x69\156\x64"]); goto L8VdI; NahFZ: MSQ_P: goto vMEFC; L8VdI: foreach ($banner as &$item) { goto UWVJo; o_5B7: $this->transformerAction($item); goto WSZce; UWVJo: $this->changeUploadPath($item["\x6d\x61\151\x6e\137\151\155\141\147\145"]); goto o_5B7; cJL9L: ADSJP: goto Dw8aN; WSZce: unset($item["\141\143\x74\151\157\156\137\x74\171\x70\145"]); goto cJL9L; Dw8aN: } goto v6KZS; kNLGq: $store = $this->getCurrentStoreBaseInfo(); goto IfkMc; I9x1F: goto KIwmW; goto BcqG0; l_Ib2: zsUUf: goto rW24c; K2Mlg: $sec_kill_activity_id = $sec_kill_activity->id; goto NahFZ; MMRxv: $this->changeUploadPath($tech["\x74\145\x63\150\x5f\x69\x6d\x67"]); goto kIV2h; MkXqv: $tech = $tech->toArray(); goto MMRxv; qIwXI: $nav = \App\Model\Nav::instance()->where("\x69\163\x5f\x65\x6e\141\142\154\145", true)->orderBy("\x6f\x72\144\x65\162", "\141\163\x63")->get(["\164\151\164\x6c\x65", "\151\143\157\x6e", "\x61\143\164\151\x6f\156\x5f\x74\171\x70\x65", "\141\143\x74\x69\157\x6e"]); goto XN0p7; Vm8kd: $tech["\164\145\x63\x68\x5f\164\151\164\154\x65"] = ''; goto rUMl7; d9P5F: F2xCa: goto Ddg1D; VwVjQ: $this->transformer($nav, ["\x69\143\157\156" => "\163\x72\x63", "\141\x63\x74\151\x6f\156" => "\x62\151\x6e\x64"]); goto DmQ2p; OcHxz: $nav = $nav->toArray(); goto VwVjQ; TfyhQ: $banner = $banner->toArray(); goto bvXFj; o4tWt: $this->success($data); goto XwyP_; v6KZS: kZ0if: goto d9P5F; DmQ2p: foreach ($nav as &$item) { goto JDrlG; ts5NR: h9kNf: goto aqf4k; PJTzQ: $this->transformerAction($item); goto ts5NR; JDrlG: $this->changeUploadPath($item["\163\162\143"]); goto PJTzQ; aqf4k: } goto l_Ib2; b_a7U: $banner = \App\Model\StoreImages::instance()->where("\151\163\137\x65\156\141\x62\154\x65", true)->where("\x73\164\x6f\x72\145\137\151\144", $store_id)->orderBy("\x6f\162\x64\145\x72", "\141\163\143")->get(["\155\141\x69\156\x5f\151\x6d\141\x67\145", "\x61\x63\x74\x69\157\156", "\141\143\164\x69\x6f\x6e\x5f\x74\x79\160\x65"]); goto LcnJA; YIEzd: $announment = $announment = \App\Model\Announcement::instance()->where("\x69\163\137\x65\156\141\x62\154\145", true)->orderBy("\x6f\162\144\x65\162", "\x61\x73\143")->pluck("\x74\151\x74\154\145"); goto b_a7U; vMEFC: $data = ["\x62\x61\156\156\x65\162" => $banner, "\156\157\164\x69\143\x65" => $announment, "\x73\x74\157\x72\145" => $store->toArray(), "\x6e\x61\x76" => $nav, "\x6e\x65\x77\137\147\157\x6f\144\163" => $newGoodsList, "\154\x69\x6d\x69\164\137\x74\151\155\x65\137\x61\x63\x74\x69\x76\x69\x74\171" => $limit_time_res, "\163\x65\x63\x6f\156\144\137\153\151\154\154\x5f\x61\x63\164\151\x76\x69\x74\x79" => $sec_kill_res, "\164\x65\x63\x68" => $tech, "\x73\x65\143\x5f\x6b\151\x6c\x6c\x5f\x61\x63\x74\151\166\x69\164\171\137\x69\144" => $sec_kill_activity_id, "\x73\145\x63\137\153\151\x6c\154\137\141\x63\164\x69\x76\151\164\171\137\151\x6e\x64\145\x78" => $sec_kill_activity_index]; goto o4tWt; rVdkL: $tech = \App\Model\SystemInfo::instance()->first(["\164\145\143\150\x5f\x74\x69\x74\x6c\145", "\x74\145\x63\150\137\x69\x73\137\163\150\157\x77", "\164\x65\x63\150\137\160\150\x6f\156\145", "\x74\x65\143\x68\x5f\151\155\147"]); goto iy7jd; NGe8P: $sec_kill_activity_id = 0; goto UywoI; iy7jd: if ($tech) { goto JssRR; } goto Vm8kd; XwyP_: } public function getBottomTabApi() { goto DpLpW; GDmaM: $tab = []; goto JH8xa; icktn: return $this->success($tab); goto EyJBv; uxPkX: TLcp7: goto icktn; DpLpW: $bottomtab = \App\Model\BottomTab::instance()->where("\151\163\x5f\x65\156\x61\x62\154\145", true)->orderBy("\x6f\162\x64\145\x72", "\141\163\x63")->get()->toArray(); goto GDmaM; JH8xa: foreach ($bottomtab as $item) { goto svYEW; aKN3Z: WTTET: goto WL6cK; zUhuS: $tab_item["\160\x61\147\x65\x50\141\164\x68"] = "\151\x6e\x64\145\170\57\x67\157\x6f\144\163\57\x67\157\157\144\x73\x3f\x69\144\75" . $item["\141\x63\x74\151\157\x6e"]; goto C1Zta; UFa19: $tab_item["\x74\x65\x78\x74"] = $item["\x74\x69\x74\154\145"]; goto rM5X9; DyYvU: $tab_item["\x70\x61\147\x65\120\141\164\150"] = $item["\141\143\x74\151\x6f\x6e"]; goto DgMTh; L0Iec: akdP8: goto sTctM; EqJD4: t_wJE: goto iWUCd; iWUCd: goto JT9IP; goto QEGnm; svYEW: $tab_item = []; goto eStpS; eStpS: if ($item["\141\x63\164\151\157\156\x5f\x74\x79\x70\x65"] == 1) { goto o9JA8; } goto mFlpT; y7BWy: $tab[] = $tab_item; goto L0Iec; rM5X9: $tab_item["\151\x63\x6f\x6e\x50\x61\164\150"] = $this->changeUploadPath($item["\151\143\x6f\x6e"]); goto hQ9XB; hQ9XB: $tab_item["\163\x65\154\145\x63\164\x65\x64\111\x63\x6f\x6e\x50\141\164\x68"] = $this->changeUploadPath($item["\x73\x65\x6c\x65\x63\164\137\x69\x63\157\156"]); goto TNx3m; mFlpT: if ($item["\x61\x63\x74\151\157\156\137\x74\171\x70\x65"] == 2) { goto WTTET; } goto DyYvU; C1Zta: JT9IP: goto UFa19; DgMTh: goto t_wJE; goto aKN3Z; WL6cK: $tab_item["\x70\141\x67\145\120\141\x74\x68"] = "\x63\x6c\x61\163\x73\151\146\x79\57\143\x6c\141\x73\x73\x69\146\x79\x3f\151\144\75" . $item["\x61\143\x74\x69\x6f\x6e"]; goto EqJD4; QEGnm: o9JA8: goto zUhuS; bKSp2: $tab_item["\x61\143\x74\x69\166\x65"] = count($tab) == 0; goto y7BWy; TNx3m: $tab_item["\163\x65\154\145\143\164\145\x64\103\x6f\154\x6f\162"] = $item["\163\x65\x6c\x65\x63\164\137\x63\157\x6c\x6f\162"]; goto bKSp2; sTctM: } goto uxPkX; EyJBv: } public function getLimitTimeActivityApi() { $data = $this->getLimitTimeActivity($this->get("\163\164\x6f\162\x65\x5f\x69\144", 1), true); $this->success($data); } public function getStoreListApi() { goto DSwMd; Yheh0: $stores = pdo_fetchall($sql); goto CG07f; utyve: $sql = "\163\145\154\145\143\164\40\x2a\x2c\x70\x68\x6f\156\145\40\x61\163\x20\x74\145\154\x2c\x6d\x61\151\156\137\151\155\x61\x67\145\x20\x61\x73\40\160\151\x63\x20\x2c\143\x6f\156\166\145\x72\x74\50\141\143\157\163\50\143\157\163\50{$latitude}\x2a\160\151\x28\x29\57\61\70\x30\40\51\52\x63\157\163\50\x6c\141\164\151\164\x75\x64\145\x2a\x70\151\50\x29\57\61\x38\x30\51\x2a\143\x6f\163\x28{$longitude}\x2a\x70\151\50\51\x2f\61\70\60\40\x2d\154\157\x6e\x67\151\164\x75\x64\x65\x2a\160\x69\x28\51\57\61\x38\60\x29\53\163\x69\x6e\x28{$latitude}\52\160\x69\x28\x29\x2f\61\70\x30\x20\51\x2a\163\151\x6e\x28\x6c\x61\x74\151\164\x75\x64\145\52\160\x69\50\x29\57\61\x38\60\x29\x29\x2a\x36\63\67\60\71\71\66\x2e\x38\61\54\x64\x65\143\x69\x6d\141\154\x29\x20\x20\141\x73\40\x64\151\163\164\141\x6e\x63\x65\x20\x66\162\157\155\x20" . tablename("\171\172\142\x6c\144\137\x73\165\156\x5f\163\164\157\x72\145\x73") . "\40\x20\167\150\145\x72\x65\40\156\141\x6d\x65\x20\154\151\153\145\40\x27\x25" . $key . "\x25\47\40\x61\156\144\40\x75\x6e\x69\141\143\x69\x64\x20\75\x20{$this->uniacid}\40\157\x72\144\x65\x72\x20\142\171\40\144\151\x73\x74\x61\156\x63\x65"; goto pcyPt; I64ro: dAK4X: goto XaxOH; CG07f: foreach ($stores as &$item) { goto o9NfA; o9NfA: $this->changeUploadPath($item["\160\x69\143"]); goto NvEvp; Jk69j: DxftE: goto ICAy2; NvEvp: $item["\144\151\163\x74\x61\156\x63\145"] = $this->formateDistance($item["\x64\x69\x73\164\x61\x6e\143\145"]); goto Jk69j; ICAy2: } goto I64ro; DSwMd: $longitude = $this->user->longitude; goto abUjW; abUjW: $latitude = $this->user->latitude; goto fEAhh; XaxOH: return $this->success($stores); goto LMYyq; ciTbA: tbNNA: goto utyve; fEAhh: $key = $this->get("\153\145\x79", 0); goto CUb_9; HpBJL: goto J62X6; goto ciTbA; CUb_9: if ($key) { goto tbNNA; } goto QwfVX; QwfVX: $sql = "\163\x65\x6c\x65\x63\x74\x20\x2a\x2c\x70\x68\x6f\x6e\145\x20\141\163\x20\x74\x65\154\54\x6d\141\x69\x6e\x5f\x69\x6d\x61\147\145\x20\x61\x73\40\x70\151\143\40\x2c\143\x6f\156\x76\145\x72\x74\x28\x61\143\x6f\x73\x28\143\x6f\163\x28{$latitude}\52\160\x69\x28\x29\57\61\70\x30\x20\x29\x2a\x63\x6f\x73\50\x6c\x61\x74\x69\164\x75\x64\x65\52\x70\x69\x28\x29\57\x31\x38\60\51\x2a\143\x6f\x73\50{$longitude}\52\160\151\x28\51\57\x31\x38\x30\40\55\154\x6f\156\x67\151\x74\x75\144\x65\52\x70\x69\x28\51\x2f\61\x38\x30\x29\x2b\163\x69\x6e\50{$latitude}\52\x70\151\x28\51\x2f\x31\70\x30\x20\x29\x2a\163\x69\x6e\x28\x6c\141\164\151\x74\165\144\145\x2a\x70\151\50\x29\x2f\61\70\60\x29\x29\x2a\x36\63\x37\x30\71\71\x36\56\70\61\54\x64\145\x63\x69\155\141\154\51\x20\x20\x61\x73\40\x64\x69\x73\x74\141\x6e\x63\145\40\x66\162\x6f\x6d\40" . tablename("\x79\x7a\x62\154\144\137\163\x75\156\x5f\163\164\157\162\145\x73") . "\40\x20\x20\x77\x68\x65\162\x65\x20\x75\x6e\151\x61\143\151\x64\40\75\40{$this->uniacid}\x20\x6f\x72\144\x65\x72\x20\x62\171\x20\144\x69\x73\x74\141\x6e\143\145"; goto HpBJL; pcyPt: J62X6: goto Yheh0; LMYyq: } public function getStoreDetailApi() { goto usy2Y; CgcEb: $replacement = "\74\x69\155\x67\x20\163\162\143\x3d\x22" . getBaseUrl() . "\57\141\x74\164\141\143\150\x6d\x65\x6e\164\x2f\x69\155\x61\147\x65\163"; goto ONPPb; xGxEt: return $this->success($store); goto pf32C; DMdUm: $string = $store["\x63\157\156\164\145\x6e\164"]; goto nUmiF; GWLQG: $store = \App\Model\Store::instance()->find($store_id, ["\x69\x64", "\x6d\x61\151\x6e\137\151\x6d\141\x67\145", "\160\150\157\x6e\145", "\x6e\x61\155\145", "\143\157\156\x74\x65\156\x74", "\141\144\144\162\145\163\x73", "\145\x6d\141\151\x6c"])->toArray(); goto DMdUm; vAl84: $this->changeUploadPath($store["\x6d\x61\151\x6e\x5f\151\x6d\141\x67\145"]); goto xGxEt; nUmiF: $pattern = "\74\x69\155\x67\x20\163\x72\x63\x3d\42\57\141\x74\164\x61\x63\x68\x6d\x65\x6e\164\x2f\x69\155\141\x67\145\x73"; goto CgcEb; usy2Y: $store_id = $this->get("\163\164\157\x72\145\x5f\151\144"); goto GWLQG; ONPPb: $store["\143\x6f\156\x74\145\x6e\164"] = str_replace($pattern, $replacement, $string); goto vAl84; pf32C: } } goto lEr2P; lEr2P: trait GoodsTrait { private function getGoodsClass($parent_id) { $classes = \App\Model\GoodsClass::instance()->where("\160\x61\x72\145\x6e\164\137\151\144", $parent_id)->orderBy("\x6f\162\x64\145\x72", "\x61\x73\x63")->get(["\151\144", "\164\x69\164\x6c\145", "\160\x61\x72\x65\156\164\137\x69\144"])->toArray(); return $classes; } public function getGoodsClassApi() { goto TYzeo; tIcPS: ZDzTw: goto UHCb3; PEwW9: foreach ($classes as &$item) { goto eEQXV; yGwTU: $child = $this->getGoodsClass($item["\x69\x64"]); goto atwH0; XUQFE: XDnnh: goto x5OK1; Z8lS2: $item["\x67\162\157\165\x70"] = $child; goto LsslX; atwH0: foreach ($child as &$subItem) { goto iK3Gn; W_HFG: unset($subItem["\x70\141\162\x65\x6e\x74\137\x69\144"]); goto x5MNf; x5MNf: BwLox: goto dhGbI; iK3Gn: $this->changeFieldName($subItem, "\x74\x69\164\154\145", "\156\141\x6d\145"); goto W_HFG; dhGbI: } goto XUQFE; x5OK1: unset($item["\160\x61\162\x65\x6e\164\137\151\144"]); goto Z8lS2; eEQXV: $this->changeFieldName($item, "\x74\151\x74\x6c\145", "\x6e\x61\x6d\x65"); goto yGwTU; LsslX: NJmrW: goto xzGU0; xzGU0: } goto tIcPS; NMSU1: return $this->success($classes); goto W9QmR; UHCb3: $weekNewClass = [["\x69\144" => 0, "\156\x61\x6d\x65" => "\xe6\xaf\217\xe5\221\xa8\346\226\xb0\xe5\223\201", "\147\x72\x6f\x75\x70" => []]]; goto Ergrf; Ergrf: $classes = array_merge($weekNewClass, $classes); goto NMSU1; TYzeo: $classes = $this->getGoodsClass(0); goto PEwW9; W9QmR: } public function getClassIdList($class_id) { goto L3qGH; o1cT5: o_4hb: goto ok0OI; bGCgp: XSPiQ: goto HkOj_; A609r: goto o_4hb; goto bGCgp; xW6PS: zziG3: goto A609r; btIXi: if (in_array($class_id, $class_id_list)) { goto zziG3; } goto R7Cix; L3qGH: $class_id_list = \App\Model\GoodsClass::instance()->where("\160\x61\x72\145\x6e\164\137\x69\144", $class_id)->pluck("\x69\x64")->toArray(); goto ef1tw; R7Cix: array_push($class_id_list, $class_id); goto xW6PS; HkOj_: $class_id_list[] = $class_id; goto o1cT5; ok0OI: return $class_id_list; goto Tdz9J; ef1tw: if (0 == count($class_id_list)) { goto XSPiQ; } goto btIXi; Tdz9J: } public function getGoodsListApi() { goto yAeD_; JwxwB: Tmbwv: goto oqJ80; fkBNI: $class_id_list = $this->getClassIdList($class_id); goto URKQf; Sksi2: $goodslist = $res; goto snHam; yAeD_: $store_id = $this->get("\x73\164\x6f\x72\145\x5f\x69\x64", 1); goto jg01k; jg01k: $class_id = $this->get("\143\154\141\x73\x73\x5f\151\x64", 0); goto ZrYk6; OjIRx: $goodslist = \App\Model\StoreGoods::instance()->where("\x73\164\x6f\x72\145\137\151\144", $store_id)->where("\x69\163\137\156\145\x77", true)->orderBy("\x63\162\145\x61\x74\145\x64\137\141\164", "\144\145\x73\143")->get(["\x67\157\x6f\144\163\x5f\x69\144", "\x73\x68\x6f\x70\137\x70\162\x69\x63\145", "\151\x64", "\x73\164\x6f\143\153"])->toArray(); goto i2ar4; CCspd: foreach ($goodslist as &$item) { goto srKgu; yp19g: $item["\163\x74\157\x63\153"] = \App\Model\StoreGoods::instance()->where("\147\157\157\x64\163\137\x69\x64", $item["\x69\144"])->where("\163\x74\157\162\145\x5f\x69\x64", $store_id)->first()->stock; goto olghX; srKgu: $item["\x70\162\151\143\x65"] = $storeGoods[$item["\151\144"]]; goto AQ4bn; GBqF5: fohFt: goto zXQ8i; olghX: $this->changeUploadPath($item["\x73\162\143"]); goto GBqF5; AQ4bn: $item["\163\x74\157\162\145\137\147\157\157\x64\163\137\151\x64"] = \App\Model\StoreGoods::instance()->where("\147\157\x6f\144\163\x5f\x69\x64", $item["\151\144"])->where("\163\x74\157\x72\145\137\151\x64", $store_id)->first()->id; goto yp19g; zXQ8i: } goto JwxwB; PTPhm: $this->transformer($goodslist, ["\155\141\151\156\x5f\151\x6d\141\147\x65" => "\163\x72\143"]); goto CCspd; oqJ80: goto ou0Zr; goto Q0lWT; URKQf: $goodslist = \App\Model\Goods::instance()->where("\151\x64", $this->getKeyFromArray($storeGoods))->where("\147\x6f\x6f\x64\163\x5f\143\154\141\x73\163\x5f\151\144", $class_id_list)->where("\151\163\137\x65\156\x61\142\154\x65", true)->get(["\155\x61\x69\x6e\x5f\x69\155\141\147\145", "\x6e\141\x6d\145", "\x69\144"])->toArray(); goto PTPhm; JCwTz: return $this->success($goodslist); goto FMGX9; yMAeH: foreach ($goodslist as &$item) { goto ikz3Q; ikz3Q: $goods = \App\Model\Goods::instance()->find($item["\x69\x64"]); goto b6kDV; p4nLa: $item["\163\x72\143"] = $this->uploadPath($goods->main_image); goto pqNhZ; b6kDV: if (!$goods->is_enable) { goto G02eY; } goto p4nLa; e13cT: lgr10: goto ccr85; wp8Am: G02eY: goto e13cT; pqNhZ: $item["\156\x61\155\145"] = $goods->name; goto Nh_Z2; Nh_Z2: $res[] = $item; goto wp8Am; ccr85: } goto iMN0G; pEmbi: $res = []; goto yMAeH; ZrYk6: if (0 == $class_id) { goto lnedr; } goto rzz2c; i2ar4: $this->transformer($goodslist, ["\151\144" => "\163\x74\157\x72\145\137\147\157\x6f\x64\163\x5f\151\x64", "\147\x6f\157\x64\x73\137\x69\x64" => "\151\x64", "\x73\x68\x6f\x70\137\x70\x72\x69\x63\145" => "\x70\x72\151\x63\x65"]); goto pEmbi; snHam: ou0Zr: goto JCwTz; rzz2c: $storeGoods = \App\Model\StoreGoods::instance()->where("\163\164\x6f\162\145\x5f\151\x64", $store_id)->orderBy("\143\x72\x65\x61\164\145\144\137\141\x74", "\x64\x65\x73\143")->pluck("\x73\150\x6f\160\137\x70\162\x69\x63\145", "\x67\x6f\x6f\x64\x73\137\x69\x64", "\151\x64", "\x73\164\157\x63\x6b"); goto fkBNI; Q0lWT: lnedr: goto OjIRx; iMN0G: RS2Uq: goto Sksi2; FMGX9: } public function getGoodsDetailApi() { goto BHT80; lteGi: $this->changeUploadPath($goods["\x73\162\x63"]); goto nFm7W; fCBCj: $this->transformer($goods, ["\x73\x68\157\160\137\160\162\x69\143\x65" => "\160\x72\x69\143\x65", "\x6d\x61\151\156\x5f\x69\x6d\141\147\x65" => "\x73\162\143", "\x73\160\145\143\x69\x66\151\x63\x61\x74\x69\x6f\x6e" => "\163\x70\145\143"]); goto ljzQa; Tl4P0: $storeGoods = \App\Model\StoreGoods::instance()->where("\163\x74\157\x72\x65\x5f\151\144", $store_id)->where("\147\157\x6f\x64\163\137\151\144", $goods_id)->first(); goto l_MqP; Qd5cq: return $this->response(-999, "\350\xaf\245\345\225\206\xe5\223\201\344\xb8\x8d\345\255\230\345\x9c\250\x21"); goto y0KPf; jcPqt: $goods["\163\x74\x6f\162\145\137\x67\157\x6f\x64\163\x5f\151\144"] = $storeGoods->id; goto lteGi; ObQzd: $string = $goods["\x63\x6f\x6e\164\145\156\x74"]; goto Rc86X; JWXAi: return $this->success($goods); goto dAFvK; l_MqP: if (!$storeGoods) { goto F_A3q; } goto dRJlt; ljzQa: $goods["\x6e\165\x6d"] = 0; goto ZK3TZ; nFm7W: $this->changeUploadPath($goods["\x69\155\x61\147\145\163"]); goto ObQzd; jpTiP: F_A3q: goto Qd5cq; pPH_c: $goods["\x63\x6f\x6e\164\x65\x6e\164"] = str_replace($pattern, $replacement, $string); goto JWXAi; Rc86X: $pattern = "\x3c\151\x6d\147\x20\x73\x72\x63\x3d\x22\x2f\x61\164\164\x61\143\150\x6d\x65\x6e\164\x2f\151\155\141\x67\x65\163"; goto XH102; dAFvK: qLoDY: goto jpTiP; XH102: $replacement = "\74\x69\155\x67\x20\x73\162\x63\x3d\42" . getBaseUrl() . "\57\141\164\164\141\x63\150\x6d\145\156\164\x2f\151\155\x61\x67\145\x73"; goto pPH_c; ZK3TZ: $goods["\x6c\x69\155\x69\x74"] = 0; goto PR2g2; PR2g2: $goods["\x70\162\x69\143\x65"] = $storeGoods->shop_price; goto jcPqt; BHT80: $goods_id = $this->get("\147\157\x6f\x64\163\x5f\x69\144"); goto F6PyL; F6PyL: $store_id = $this->get("\163\164\157\162\x65\x5f\x69\x64"); goto Tl4P0; dRJlt: $goods = \App\Model\Goods::instance()->find($goods_id, ["\155\x61\151\x6e\x5f\151\x6d\x61\x67\x65", "\156\141\155\x65", "\x69\144", "\x73\x68\157\x70\137\x70\162\151\x63\x65", "\x69\x6d\141\147\x65\x73", "\163\160\x65\143\151\x66\x69\x63\x61\164\x69\x6f\x6e", "\x63\157\x6e\164\145\156\164"])->toArray(); goto BoAmq; BoAmq: if (!$goods) { goto qLoDY; } goto fCBCj; y0KPf: } public function searchGoodsApi() { goto vb9p9; nzr7j: $this->transformer($goodslist, ["\x6d\x61\x69\x6e\x5f\x69\155\141\147\145" => "\x73\162\143"]); goto ijiFJ; ijiFJ: foreach ($goodslist as &$item) { goto ls3gc; tgroE: Ovi51: goto BZqGS; ls3gc: $item["\x70\x72\151\x63\x65"] = $storeGoods[$item["\151\144"]]; goto cDBQi; cDBQi: $this->changeUploadPath($item["\163\162\x63"]); goto tgroE; BZqGS: } goto vpsoe; SrM9o: $goodslist = \App\Model\Goods::instance()->where("\151\x64", $this->getKeyFromArray($storeGoods))->where("\156\141\x6d\145", "\154\x69\153\x65", "\x25{$keyword}\45")->get(["\x6d\141\x69\x6e\x5f\x69\x6d\x61\x67\x65", "\x6e\x61\155\x65", "\151\x64"])->toArray(); goto nzr7j; hYUFV: return $this->success($goodslist); goto k9eko; vpsoe: yd5uZ: goto hYUFV; EmYy9: $store_id = $this->get("\x73\x74\x6f\x72\x65\x5f\151\x64"); goto qT_iU; qT_iU: $storeGoods = \App\Model\StoreGoods::instance()->where("\163\x74\157\162\x65\x5f\x69\144", $store_id)->orderBy("\x63\x72\x65\x61\164\x65\144\137\141\x74", "\x64\x65\163\143")->pluck("\x73\x68\x6f\160\137\x70\x72\151\x63\x65", "\147\157\x6f\x64\163\x5f\151\x64"); goto SrM9o; vb9p9: $keyword = $this->get("\x6b\x65\x79\x77\x6f\162\144"); goto EmYy9; k9eko: } public function getGoodsIdFromBarCodeApi() { goto kRx2f; kRx2f: $barcode = $this->get("\142\141\162\143\157\x64\x65"); goto EkoN1; To_hS: TVhb1: goto D_FTo; D_FTo: return $this->success(["\x69\x64" => $goods->id]); goto xi2O2; EkoN1: $goods = \App\Model\Goods::instance()->where("\142\141\162\143\157\144\145", $barcode)->first(["\x69\x64"]); goto Y11WN; xi2O2: jQfT_: goto SsHB5; Y11WN: if ($goods) { goto TVhb1; } goto CaAOG; ZpdMA: goto jQfT_; goto To_hS; CaAOG: return $this->response("\x2d\71\x39\x39", "\346\235\241\xe5\275\242\347\xa0\x81\xe4\270\x8d\xe5\255\x98\xe5\x9c\xa8"); goto ZpdMA; SsHB5: } } goto KvCzd; XL1Nn: trait OrderTrait { public function payNotify($data) { goto yAkuz; HSBaL: $attach = $data["\x61\x74\164\141\x63\x68"]; goto cmu9U; wi2JI: $order->status = 20; goto nRtDc; F7Viq: $_W["\165\156\151\141\x63\151\x64"] = $attach; goto YIMsa; vfKLq: $user->amount = $user->amount + $money; goto no_rC; HHyMB: if (!(substr($order_sn, 0, 3) == "\x32\60\x30")) { goto YQplD; } goto iCNwE; Y10G6: if (substr($order_sn, 0, 3) == "\x31\x30\x30") { goto FK744; } goto HHyMB; iCNwE: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(); goto aOuQt; benX5: DNSMR: goto a58YI; no_rC: $user->save(); goto benX5; YIMsa: $order_sn = $data["\x6f\165\x74\x5f\x74\x72\x61\x64\145\x5f\x6e\x6f"]; goto Y10G6; H62ju: YQplD: goto aIf2P; KHDkR: exit("\163\x75\143\143\x65\163\163"); goto DgqLz; n5Y6q: $rechargeLog->pay_at = date("\131\55\x6d\55\144\x20\x48\x3a\151\72\x73", time()); goto nVDyi; WD7De: goto HV1xf; goto UJFf9; OfDlO: $order->pay_at = date("\x59\55\155\x2d\x64\x20\110\x3a\151\x3a\163"); goto wi2JI; a58YI: IK0Hi: goto KHDkR; sJETC: $order->decStock($order_sn); goto bzCXT; YqHh2: $money = $rechargeLog->amount + $rechargeLog->gift; goto vfKLq; yDLpz: FK744: goto stI5l; aIf2P: goto whRUC; goto yDLpz; nVDyi: $rechargeLog->state = 1; goto ALs5t; Os_CY: if (!($rechargeLog->state == 0)) { goto IK0Hi; } goto n5Y6q; UJFf9: u8uj7: goto F7Viq; x5z_D: die("\x46\101\x49\x4c"); goto WD7De; nSKkh: WiGOj: goto vr1yL; ALs5t: $rechargeLog->save(); goto dt3g5; fdzxf: LVapE: goto nSKkh; nRtDc: $order->save(); goto sJETC; KpX7v: HV1xf: goto YwR6z; stI5l: $rechargeLog = \App\Model\RechargeLog::instance()->where("\x72\x65\x6d\141\162\x6b", $order_sn)->first(); goto Os_CY; cmu9U: if ($attach) { goto u8uj7; } goto x5z_D; DgqLz: whRUC: goto KpX7v; S3I_w: if (!$user) { goto DNSMR; } goto YqHh2; vr1yL: exit("\x73\x75\143\x63\x65\163\x73"); goto H62ju; yAkuz: global $_W; goto HSBaL; aOuQt: if (!$order) { goto WiGOj; } goto Y1fP3; Y1fP3: if (!($order->status == 10)) { goto LVapE; } goto OfDlO; dt3g5: $user = \App\Model\User::instance()->find($rechargeLog->user_id); goto S3I_w; bzCXT: $this->paySuccessEvent($order_sn); goto fdzxf; YwR6z: } private function wp_print($printer_user, $printer_ukey, $printer_sn, $orderInfo) { goto zOKJE; RUcSH: return false; goto SBAm1; csdZN: $stime = time(); goto uEB1a; uEB1a: $sig = sha1($printer_user . $printer_ukey . $stime); goto Zp54D; MWYvQ: goto VNGD2; goto qsXvJ; qsXvJ: qX2XD: goto RUcSH; SBAm1: VNGD2: goto roeQV; zOKJE: $ip = "\141\160\x69\x2e\146\x65\151\x65\171\x75\x6e\56\143\156"; goto aCOLR; aCOLR: $port = 80; goto csdZN; Zp54D: $content = array("\x75\x73\x65\x72" => $printer_user, "\x73\164\151\x6d\145" => $stime, "\163\151\147" => $sig, "\141\160\151\156\x61\155\145" => "\117\160\x65\x6e\137\x70\x72\151\156\x74\115\163\147", "\163\x6e" => $printer_sn, "\x63\x6f\x6e\164\145\156\164" => $orderInfo, "\164\151\155\x65\163" => 1); goto XYgnP; ZT59H: return true; goto MWYvQ; G9Z99: if (!$client->post("\x2f\101\x70\151\57\117\160\x65\x6e\x2f", $content)) { goto qX2XD; } goto ZT59H; XYgnP: $client = new \HttpClient($ip, $port); goto G9Z99; roeQV: } public function strlen($string) { return (strlen($string) + mb_strlen($string, "\x55\x54\106\x38")) / 2; } public function str_pad($input, $pad_length, $pad_string = "\40", $pad_type = STR_PAD_RIGHT) { goto KseNO; wlyFT: e1hjz: goto MjWS5; AlhlD: mcTp5: goto tFoVL; Pwifw: switch ($pad_type) { case STR_PAD_RIGHT: return $input . str_repeat($pad_string, $difference); goto BaGJO; case STR_PAD_LEFT: return str_repeat($pad_string, $difference) . $input; goto BaGJO; default: goto ITkOj; iqPXR: $right = $difference - $left; goto o6xPj; uRRtM: goto BaGJO; goto FVIdc; ITkOj: $left = $difference / 2; goto iqPXR; o6xPj: return str_repeat($pad_string, $left) . $input . str_repeat($pad_string, $right); goto uRRtM; FVIdc: } goto MTa2U; TR_By: BaGJO: goto AlhlD; KseNO: $strlen = $this->strlen($input); goto BAdv8; MjWS5: $difference = $pad_length - $strlen; goto Pwifw; VqcSh: return $input; goto dKAnp; BAdv8: if ($strlen < $pad_length) { goto e1hjz; } goto VqcSh; dKAnp: goto mcTp5; goto wlyFT; MTa2U: VRqZs: goto TR_By; tFoVL: } private function getPrinterOrderInfo($order) { goto PRwCn; KBiFK: vR_5Z: goto tYRrJ; ZUHSs: $orderInfo .= "\351\200\x81\xe8\xb4\247\345\234\xb0\347\202\271\xef\274\232" . $address . "\74\x42\122\x3e"; goto KBiFK; lnWBc: $orderInfo .= "\x2d\x2d\x2d\x2d\55\x2d\55\x2d\x2d\55\x2d\x2d\x2d\55\x2d\x2d\55\x2d\x2d\x2d\x2d\x2d\x2d\55\55\x2d\55\x2d\55\55\55\x2d\x3c\102\x52\76"; goto a_k33; xVXR0: if ($order->distribution_type == 0) { goto fWLDN; } goto aX_YM; WkgKT: o2e2k: goto CsJ4Z; iIqIC: $orderInfo .= "\345\220\x88\xe8\xae\xa1\xef\274\x9a" . $order->amount . "\xe5\x85\203\74\x42\122\x3e"; goto xVXR0; lsgik: WB7mt: goto CJSTE; yzC_c: $address = $arr["\x70\x72\157\x76\151\156\143\x65\116\x61\155\x65"] . $arr["\x63\151\x74\171\116\141\155\145"] . $arr["\143\157\165\x6e\164\x79\116\x61\x6d\x65"] . $arr["\144\145\164\141\151\154\111\156\146\157"]; goto yLO8d; CsJ4Z: $coupon_amount = \App\Model\UserCoupon::instance()->find($order->coupon_id)->amount; goto fXC5m; UkgOH: goto vR_5Z; goto e0Ste; sjpIz: goto Oh26s; goto WiVS4; MZUrB: $arr = json_decode($order->address, true); goto yzC_c; SQKQ8: $orderInfo .= "\344\270\213\345\x8d\225\xe6\x97\266\351\227\xb4\xef\xbc\232" . $order->updated_at . "\74\102\122\76"; goto fWucY; a_k33: $goods = \App\Model\OrderGoods::instance()->where("\157\x72\x64\x65\x72\x5f\163\156", $order->sn)->get(["\x67\157\157\x64\163\x5f\x6e\141\x6d\x65", "\147\x6f\x6f\144\163\137\160\x72\x69\x63\145", "\x6e\x75\155"]); goto c15cC; fWucY: debug($orderInfo); goto dI6JR; tr3Et: $coupon_amount = 0; goto P3mXT; e0Ste: fWLDN: goto ZUHSs; Sh9AR: Bf2ck: goto amuyt; LA9JJ: if ($order->distribution_type == 0) { goto CbjCb; } goto KgBKW; XOPzn: if (!($order->distribution_type == 0)) { goto Bf2ck; } goto tHALg; aX_YM: $orderInfo .= "\347\x94\xa8\xe6\x88\267\350\207\xaa\xe6\217\220\x3c\x42\122\76"; goto UkgOH; KgBKW: $address = ''; goto pzwtm; k4Jfl: $index = 1; goto pRuxR; c15cC: if ($order->coupon_id > 0) { goto o2e2k; } goto tr3Et; dI6JR: return $orderInfo; goto hmdGW; pRuxR: foreach ($goods as $item) { goto rIHks; IQL2a: $orderInfo .= $item->goods_name . "\x3c\102\122\76"; goto ztQFE; ztQFE: be_49: goto LuWYM; tUKXZ: $orderInfo .= $info; goto IQL2a; rIHks: $info = sprintf("\45\163\x25\x73\x25\163\x25\x73\74\102\122\x3e", $this->str_pad($index++, 8), $this->str_pad(round($item->goods_price, 2), 10), $this->str_pad($item->num, 7), round($item->goods_price * $item->num, 2)); goto tUKXZ; LuWYM: } goto lsgik; amuyt: $orderInfo .= "\344\274\x98\xe6\203\240\xe5\210\270\357\xbc\232\55" . $coupon_amount . "\xe5\205\203\74\x42\122\76"; goto NskFM; PioEl: $orderInfo .= "\55\x2d\x2d\x2d\x2d\55\55\x2d\x2d\x2d\55\55\x2d\55\55\55\x2d\x2d\x2d\x2d\x2d\55\55\x2d\55\x2d\x2d\x2d\x2d\55\55\x2d\74\102\122\x3e"; goto iIqIC; tHALg: $orderInfo .= "\351\x85\x8d\xe9\200\201\xe8\xb4\271\xef\274\232" . $order->distribution_amount . "\345\205\203\x3c\x42\x52\x3e"; goto Sh9AR; PRwCn: $orderInfo = "\x3c\103\102\x3e\xe8\256\242\xe5\x8d\225\344\277\241\xe6\201\xaf\74\57\x43\102\76\74\x42\x52\x3e"; goto nxt4c; hAAv1: Oh26s: goto k4Jfl; CJSTE: $orderInfo .= "\74\102\122\x3e"; goto XOPzn; pzwtm: $phone = $order->take_tel; goto sjpIz; P3mXT: goto SMXD3; goto WkgKT; NskFM: $orderInfo .= "\345\244\x87\346\263\xa8\xef\xbc\x9a" . $order->remark . "\x3c\x42\122\x3e"; goto PioEl; nxt4c: $orderInfo .= "\xe5\272\x8f\xe5\217\xb7\343\x80\x80\40\40\xe5\215\225\xe4\273\xb7\x20\40\x20\x20\40\40\xe6\x95\260\351\x87\217\x20\40\x20\351\207\x91\xe9\xa2\x9d\x3c\x42\122\76"; goto lnWBc; WiVS4: CbjCb: goto MZUrB; fXC5m: SMXD3: goto LA9JJ; yLO8d: $phone = $arr["\164\x65\154\116\165\155\x62\x65\162"]; goto hAAv1; tYRrJ: $orderInfo .= "\350\x81\x94\347\xb3\273\347\224\xb5\350\257\235\xef\274\x9a" . $phone . "\74\x42\122\76"; goto SQKQ8; hmdGW: } public function getPrinterOrderInfoApi() { $order = \App\Model\Order::instance()->first(); echo $this->getPrinterOrderInfo($order); } protected function getAccessToken() { goto TEq8J; wqTcD: if (empty($sys_info->access_token)) { goto Y1L1v; } goto sc_2H; i1Lng: Y1L1v: goto EIsql; sc_2H: $access_token = json_decode($sys_info->access_token, true); goto KNVrZ; tAlY4: HJa61: goto wcEi2; gjcE0: $res = $this->http($url); goto NWr0x; CMkwW: return $arr["\x74\x6f\x6b\x65\x6e"]; goto tAlY4; eHdxI: IvOOQ: goto i1Lng; Dyfyf: if (!$res) { goto HJa61; } goto CpBdr; KNVrZ: if (!($access_token["\145\x78\x70\151\162\x65\x64"] < time())) { goto IvOOQ; } goto RKiIh; K27EW: $sys_info->access_token = json_encode($arr); goto w_Jwl; fZZF4: $arr["\x65\x78\x70\151\162\x65\144"] = time() + intval($res["\145\x78\x70\x69\162\x65\x73\137\151\x6e"]) - 500; goto K27EW; w_Jwl: $sys_info->save(); goto CMkwW; RKiIh: return $access_token["\164\157\153\x65\x6e"]; goto eHdxI; wcEi2: return ''; goto yScZC; EIsql: $url = sprintf("\x68\x74\164\160\x73\72\57\x2f\x61\160\151\56\167\145\151\x78\x69\x6e\56\161\x71\x2e\143\x6f\x6d\57\143\147\151\x2d\142\x69\x6e\x2f\164\157\x6b\145\156\x3f\147\x72\141\156\164\137\x74\x79\x70\x65\x3d\143\154\151\145\156\x74\137\143\162\x65\x64\x65\156\x74\x69\x61\154\x26\141\x70\160\151\x64\75\45\x73\46\x73\x65\143\x72\x65\x74\x3d\45\163", $sys_info->appid, $sys_info->appsecret); goto gjcE0; NWr0x: $res = json_decode($res, true); goto Dyfyf; CpBdr: $arr["\x74\157\x6b\145\x6e"] = $res["\141\x63\x63\x65\x73\x73\x5f\164\x6f\x6b\x65\x6e"]; goto fZZF4; TEq8J: $sys_info = \App\Model\SystemInfo::instance()->first(); goto wqTcD; yScZC: } public function paySuccessEvent($order_sn) { goto DX6cU; s7vTW: $post = ["\164\x6f\x75\x73\145\x72" => $openid, "\x74\x65\155\160\154\x61\x74\x65\137\151\x64" => $template["\160\141\171\137\163\165\x63\x63\145\163\163"], "\x70\141\x67\x65" => "\171\x7a\142\154\x64\137\x73\x75\x6e\57\x70\141\147\145\163\57\x75\163\145\x72\x2f\165\163\145\162\77\162\x65\144\x69\162\145\143\x74\75" . $order_sn, "\x66\157\162\155\137\151\x64" => $order->form_id, "\x64\x61\164\141" => $data]; goto YUqMD; ZKP6E: $disOrder->save(); goto mAuS3; SIhWN: $disOrder = \App\Model\DisOrder::instance(); goto I30js; CIjx1: $form_id = $order->form_id; goto u1YG3; PQq98: if ($disOrder) { goto HzHB5; } goto SIhWN; umpol: $disOrder = \App\Model\DisOrder::instance()->where("\x6f\x72\144\x65\x72\137\x73\156", $order_sn)->first(); goto PQq98; mDD9I: $data = ["\153\145\171\167\157\x72\144\61" => ["\x76\x61\x6c\x75\145" => $order_sn], "\x6b\145\171\167\x6f\162\x64\x32" => ["\166\x61\154\165\145" => $goods[0]["\147\x6f\x6f\x64\163\x5f\x6e\141\x6d\x65"] . (count($goods) > 1 ? "\xe7\255\x89" : '')], "\153\145\x79\x77\x6f\x72\144\x33" => ["\x76\x61\154\x75\x65" => count($goods) . "\344\xbb\266"], "\x6b\145\x79\x77\157\x72\144\x34" => ["\x76\x61\x6c\x75\x65" => $order->amount], "\x6b\145\x79\167\157\162\144\65" => ["\166\141\x6c\x75\x65" => date("\131\55\x6d\x2d\x64\x20\110\x3a\151\x3a\163")]]; goto s7vTW; wQEzQ: $store = \App\Model\Store::instance()->find($order->store_id); goto V0UO3; DX6cU: $order = \App\Model\Order::instance()->where("\x73\156", $order_sn)->first(); goto wQEzQ; sjHmi: $url = "\150\x74\164\x70\163\x3a\x2f\57\141\x70\151\56\x77\145\x69\x78\151\x6e\56\x71\161\x2e\x63\x6f\x6d\x2f\143\x67\151\x2d\x62\x69\x6e\x2f\x6d\145\163\163\141\147\145\57\x77\x78\157\x70\x65\156\57\164\x65\155\x70\x6c\x61\x74\145\57\163\x65\x6e\x64\x3f\141\x63\143\x65\x73\x73\137\x74\157\x6b\x65\156\75{$access_token}"; goto BRt8Y; mAuS3: HzHB5: goto SDOZy; KsPg0: return true; goto AZg7E; S0MND: $dis_amount = $order->distribution_amount; goto x9zeO; oBsUE: JFF45: goto umpol; SDOZy: hHNx_: goto ybgEG; x9zeO: if (!($dis_amount == 0)) { goto JFF45; } goto maWiN; maWiN: $dis_amount = $store->min_dist_amount; goto oBsUE; V0UO3: if (!($order->distribution_type == 0 && $store->auto_dis)) { goto hHNx_; } goto S0MND; KqT9M: $orderInfo = $this->getPrinterOrderInfo($order); goto Z2YcS; Qk5LH: $template = json_decode($sys_info->msg_template, true); goto rTwSD; WrG_y: debug($res); goto pXuFY; xbjnO: ow7Ln: goto KsPg0; rTwSD: $access_token = $this->getAccessToken(); goto sjHmi; ybgEG: \App\Lib\Sms::send($store->phone); goto LPvO2; fOAQo: $disOrder->dis_amount = $dis_amount; goto m99JL; YUqMD: $res = $this->http($url, json_encode($post)); goto WrG_y; LPvO2: $openid = User::instance()->find($order->user_id)->openid; goto XhxpN; I30js: $disOrder->store_id = $order->store_id; goto fOAQo; GgIzu: XWqXD: goto XGS1D; Z2YcS: $this->wp_print($store->printer_user, $store->printer_ukey, $store->printer_sn, $orderInfo); goto xbjnO; XGS1D: if (!$store->enable_printer) { goto ow7Ln; } goto KqT9M; pXuFY: $res = json_decode($res, true); goto GgIzu; qOGc2: if (!(!empty($form_id) && !empty($msg_template))) { goto XWqXD; } goto Qk5LH; BRt8Y: $goods = \App\Model\OrderGoods::instance()->where("\x6f\162\144\x65\x72\137\163\156", $order->sn)->get(["\147\157\157\144\x73\137\x6e\141\x6d\x65", "\x6e\165\x6d"])->toArray(); goto mDD9I; m99JL: $disOrder->order_sn = $order->sn; goto ZKP6E; u1YG3: $msg_template = $sys_info->msg_template; goto qOGc2; XhxpN: $sys_info = \App\Model\SystemInfo::instance()->first(); goto CIjx1; AZg7E: } private function getDistAmount($store_id, $amount, $disLngLat) { goto yw1A1; yw1A1: $dis_amount_limit = \App\Model\Store::instance()->find($store_id)->dis_amount_limit; goto Qt4Gm; Qt4Gm: if ($amount >= $dis_amount_limit) { goto pZ_C8; } goto TH5yW; x612r: pZ_C8: goto FefuN; BIfqT: goto S3tsj; goto x612r; FefuN: return 0; goto fYr2d; TH5yW: return $this->getDistAmountFromDistance($store_id, $disLngLat); goto BIfqT; fYr2d: S3tsj: goto AFyl1; AFyl1: } public function getDistAmountFromDistance($store_id, $disLngLat) { goto LPqz5; kxsiq: return $dis_amount; goto blqGw; EZKKL: $distance = $this->getStoreDistance($store_id, $disLngLat); goto ZB2Em; ZB2Em: $distance = $distance / 1000; goto vqKW0; iPKNP: foreach ($dis_list as $item) { goto pbBgR; pbBgR: if (!(0 == $item->end)) { goto rY38Y; } goto XcfoZ; YJRMb: rY38Y: goto wiqJg; NXVgt: RS1J4: goto CCyyh; XcfoZ: $item->end = 99999; goto YJRMb; wiqJg: if (!($distance >= $item->start && $distance < $item->end)) { goto RS1J4; } goto HDsqh; CCyyh: FgGQs: goto qfzhq; YmPNu: goto x5qK_; goto NXVgt; HDsqh: $dis_amount = $item->cost; goto YmPNu; qfzhq: } goto Q3IUG; Q3IUG: x5qK_: goto kxsiq; LPqz5: $dis_amount = -1; goto EZKKL; vqKW0: $dis_list = \App\Model\Distribution::instance()->get(["\163\164\141\162\x74", "\x65\x6e\x64", "\x63\157\x73\164"]); goto iPKNP; blqGw: } private function getOrderCoupon($store_id, $amount) { goto wi8Rg; wi8Rg: $today = date("\131\x2d\155\x2d\x64"); goto GH4RG; DF_1q: return $data->toArray(); goto Bgcru; GH4RG: $data = \App\Model\UserCoupon::instance()->where("\x73\164\x6f\x72\145\x5f\151\x64", $store_id)->where("\x75\x73\145\162\137\151\144", $this->user->id)->where("\151\x73\137\x75\163\x65\144", false)->where("\141\x6d\x6f\165\156\x74", "\74", $amount)->where("\165\163\x65\137\141\x6d\x6f\165\156\164", "\x3c\x3d", $amount)->where("\x64\141\164\x65\50\142\x65\x67\x69\x6e\137\x61\x74\51", "\74\75", $today)->where("\x64\141\x74\x65\50\x65\156\144\137\x61\164\51", "\76\x3d", $today)->get(["\x69\x64", "\x6e\x61\x6d\145", "\141\x6d\157\165\156\164", "\165\x73\145\x5f\141\155\157\165\x6e\x74", "\x64\141\x74\145\x28\x62\145\x67\x69\x6e\137\x61\164\51\40\141\x73\40\x62\145\147\151\x6e\137\141\164", "\144\141\164\x65\50\x65\156\x64\x5f\141\x74\x29\40\141\163\40\145\156\144\x5f\141\x74", "\x63\157\x75\160\157\156\137\x69\x64"]); goto DF_1q; Bgcru: } public function getEnableOrder($open_start, $open_end) { goto vEwqg; yLRPN: $current_min = date("\151"); goto pKePS; sokMi: goto RA2Nv; goto b1iVb; KXbLF: if (!($current_hour == $end_hour && $current_min > $end_min)) { goto E8B7x; } goto OtNWa; vEwqg: $is_enable_order = true; goto bqYFg; ytEHU: $current_hour = date("\110"); goto yLRPN; zBJoy: $is_enable_order = true; goto ShZM_; ewD3G: gJiC3: goto KiCrR; OtNWa: $is_enable_order = false; goto p34D0; b1iVb: cOvsI: goto zBJoy; weR8s: $end_hour = date("\110", strtotime($open_end)); goto EqjP8; T4fim: goto gJiC3; goto W7T0f; eKPK2: HUouJ: goto mlPyz; eDN6C: E81KM: goto wCTIk; p34D0: E8B7x: goto T4fim; uZfyi: FqDr0: goto y8dcg; ShZM_: RA2Nv: goto uZfyi; oJMj5: if ($current_hour == $start_hour && $current_min < $start_min) { goto WUFi4; } goto KXbLF; q8lK1: if (!(!is_null($open_start) && !is_null($open_end))) { goto FqDr0; } goto olNp8; mlPyz: $enable_order_info = sprintf("\xe5\xbd\x93\345\211\215\xe4\xb8\215\xe5\x9c\250\xe8\220\245\xe4\xb8\232\xe6\227\xb6\xe9\227\xb4\45\60\x32\x64\72\x25\x30\62\144\55\x25\60\x32\x64\x3a\x25\60\x32\x64\54\xe6\227\240\xe6\263\225\xe4\270\x8b\345\215\x95", $start_hour, $start_min, $end_hour, $end_min); goto sokMi; W7T0f: WUFi4: goto JWcwc; olNp8: $start_hour = date("\x48", strtotime($open_start)); goto ytGGQ; JWcwc: $is_enable_order = false; goto ewD3G; y8dcg: return [$is_enable_order, $enable_order_info]; goto lgFPE; KiCrR: goto HUouJ; goto eDN6C; ytGGQ: $start_min = date("\151", strtotime($open_start)); goto weR8s; pKePS: if ($current_hour < $start_hour || $current_hour > $end_hour) { goto E81KM; } goto oJMj5; EqjP8: $end_min = date("\x69", strtotime($open_end)); goto sNPly; sNPly: if ($start_hour == 0 && $start_min == 0 && $end_hour == 0 && $end_min == 0) { goto cOvsI; } goto ytEHU; bqYFg: $enable_order_info = ''; goto q8lK1; wCTIk: $is_enable_order = false; goto eKPK2; lgFPE: } public function getOrderCouponApi() { goto IzOzh; QEjLx: $use_coupon_amount = 0; goto GI2RH; CMYNk: $is_enable_order = false; goto HNIpg; lELED: $distAmount = 0; goto h6Isk; uOoY1: $open_end = $store->open_end; goto EENOq; HNIpg: $enable_order_info = "\350\257\xa5\351\x97\250\346\x88\xb7\346\232\202\345\x81\x9c\xe8\220\xa5\xe4\270\232\x2c\xe6\227\xa0\346\xb3\225\xe4\270\213\345\x8d\225"; goto ckkfD; UcPBR: $open_start = $store->open_start; goto uOoY1; cZv3n: mgYCR: goto MYxVv; kfqXW: $cards = []; goto MBgf2; XhK5e: $store->main_image = $this->uploadPath($store->main_image); goto CedpD; GI2RH: $use_coupon_id = 0; goto VscQ4; MBgf2: foreach ($coupon as $item) { goto QR2BB; pr1rs: $use_coupon_amount = $item["\x61\155\x6f\165\156\164"]; goto Lh68u; i9uSs: j5JuG: goto riLlp; Lh68u: $use_coupon_id = $item["\x69\144"]; goto i9uSs; riLlp: $cards[] = ["\151\x64" => $item["\151\x64"], "\160\x72\151\143\145" => $item["\141\x6d\157\165\x6e\164"], "\x6d\x69\156\x70\162\151\143\145" => $item["\x75\x73\145\x5f\141\x6d\157\165\x6e\164"], "\164\x69\155\145" => sprintf("\x25\163\x2d\x25\x73", str_replace("\55", "\x2e", $item["\142\145\x67\x69\x6e\137\141\x74"]), str_replace("\x2d", "\56", $item["\x65\x6e\144\x5f\141\x74"]))]; goto eu8Ra; QR2BB: if (!($item["\141\x6d\157\165\x6e\x74"] > $use_coupon_amount)) { goto j5JuG; } goto pr1rs; eu8Ra: icc3M: goto mmFL1; mmFL1: } goto cZv3n; PJ9L4: return $this->success(["\x64\151\163\x74\162\x69\x62\165\164\151\x6f\x6e" => $distAmount, "\x63\x61\x72\x64\163" => $cards, "\x73\164\x6f\x72\x65" => $store->toArray(), "\151\163\x5f\x65\156\x61\142\154\145\x5f\157\x72\x64\x65\162" => $is_enable_order, "\145\156\141\x62\154\145\137\157\x72\144\145\x72\137\x69\156\146\x6f" => $enable_order_info, "\x75\163\145\137\x63\x6f\165\160\x6f\x6e" => ["\x61\x6d\157\165\x6e\x74" => $use_coupon_amount, "\x63\157\165\160\x6f\x6e\x5f\151\x64" => $use_coupon_id], "\165\x73\x65\162\137\x61\x6d\x6f\x75\156\x74\x5f\145\156\141\142\x6c\x65" => $user_amount_enable]); goto qXvEO; VscQ4: $user_amount_enable = $amount <= $this->user->amount; goto kfqXW; slzaL: nd6fC: goto CMYNk; EENOq: list($is_enable_order, $enable_order_info) = $this->getEnableOrder($open_start, $open_end); goto M8jg5; IzOzh: $store_id = $this->get("\163\164\157\x72\145\137\x69\144", 0); goto Wd0F0; MYxVv: if (!$store->is_enable) { goto nd6fC; } goto UcPBR; h6Isk: $coupon = $this->getOrderCoupon($store_id, $amount); goto QEjLx; M8jg5: goto L24un; goto slzaL; Wd0F0: $store = \App\Model\Store::instance()->find($store_id, ["\x6e\x61\155\x65", "\160\150\157\x6e\x65", "\x6d\141\151\156\137\x69\155\141\x67\x65", "\x61\x64\x64\162\145\x73\x73", "\x6f\x70\x65\156\x5f\163\x74\x61\162\x74", "\x6f\160\x65\156\137\145\156\x64", "\x69\163\137\145\x6e\x61\x62\x6c\145"]); goto XhK5e; ckkfD: L24un: goto PJ9L4; CedpD: $amount = $this->get("\141\x6d\157\x75\x6e\164", 0); goto lELED; qXvEO: } public function generateOrderSn() { return date("\x32\60\x30" . "\x59\155\144\x48\151\x73"); } private function getUserBuyCount($store_id, $goods_id) { goto K5B3C; K5B3C: $orders = \App\Model\Order::instance()->where("\x73\x74\x6f\162\145\x5f\151\x64", $store_id)->where("\165\x73\x65\162\x5f\x69\144", $this->user->id)->pluck("\163\x6e"); goto HF3Gh; e9g1p: $orderGoods = \App\Model\OrderGoods::instance()->where("\157\x72\x64\x65\162\x5f\x73\x6e", $orders)->where("\147\x6f\x6f\144\163\x5f\x69\144", $goods_id)->where("\142\165\171\137\164\x79\160\x65", 1)->get(["\156\165\x6d"]); goto TmBmT; jCup8: return $userBuyCount; goto qMoDa; GvBzn: EXii0: goto jCup8; TmBmT: foreach ($orderGoods as $item) { $userBuyCount += $item->num; IwilS: } goto GvBzn; HF3Gh: $userBuyCount = 0; goto e9g1p; qMoDa: } private function getUserBuyActivityCount($user_id, $activity_goods_id) { goto ZnoJN; ZnoJN: $query = \App\Model\OrderGoods::instance()->query; goto tUB6f; tUB6f: $count = $query->from("\x79\172\142\154\144\x5f\x73\165\x6e\137\157\162\144\x65\162\x73", "\157")->innerjoin("\171\172\142\154\x64\x5f\x73\x75\156\x5f\157\x72\x64\145\162\137\x67\x6f\157\x64\163", "\x64")->on("\x6f\56\x73\x6e", "\x64\56\157\162\144\x65\x72\x5f\x73\x6e")->where("\157\56\165\163\x65\162\137\x69\x64", $user_id)->where("\144\56\141\x63\164\x69\x76\x69\x74\x79\137\147\157\x6f\x64\163\x5f\151\144", $activity_goods_id)->where("\157\56\x73\x74\x61\164\165\x73\x20\x3e\75", 10)->where("\157\56\x73\x74\141\164\165\x73\40\x3c", 50)->getall(); goto LQI4_; gVDzu: foreach ($count as $item) { $buynum += $item["\156\165\155"]; MZO2H: } goto xreY0; xreY0: ska85: goto pgrfL; pgrfL: return $buynum; goto neBp3; LQI4_: $buynum = 0; goto gVDzu; neBp3: } public function isValidCartApi() { goto vUBQK; CpmVJ: if ($activity_type == 2) { goto RmlsG; } goto IPj1z; IPj1z: $activity_pre_user_limit = \App\Model\LimitTimeActivity::instance()->find($activity_id)->user_limit; goto ovFaH; c2FS_: $activity = \App\Model\ActivityGoods::instance()->where("\141\x63\x74\x69\x76\151\164\171\x5f\164\x79\160\145", $activity_type)->where("\x61\x63\164\x69\166\151\x74\171\x5f\x69\x64", $activity_id)->where("\x67\x6f\x6f\x64\x73\x5f\x69\x64", $goods_id)->first(["\154\x69\x6d\151\164\145\144", "\x62\165\x79\137\x6e\x75\x6d"]); goto U5zTK; GRFtJ: goto h6N7L; goto L3TZT; ioSbP: h6N7L: goto KB4t5; mqcna: $activity_pre_user_limit = 1; goto Ka2zw; ZgSrH: $goods_id = $this->get("\x67\157\x6f\144\x73\x5f\151\144"); goto QVLxH; dm7WH: RmlsG: goto mqcna; U5zTK: $activity_all_limit = $activity->limited; goto Dv9Zp; L3TZT: ptP2D: goto Om2yj; Ri9Xu: $msg = sprintf("\xe5\267\262\350\242\253\xe6\212\242\345\205\211", $activity_pre_user_limit); goto plkpN; VpIK7: if ($cartCount + $userBuyCount < $activity_pre_user_limit) { goto ptP2D; } goto NtmXJ; SMHLs: LNbDC: goto ioSbP; Om2yj: if ($activity_all_limit - $activity_buy_num > $cartCount) { goto VUZ7y; } goto Ri9Xu; Tfszf: VUZ7y: goto Io2ZM; V6KNG: $is_enable = false; goto YCOMj; mQWSs: $activity_id = $this->get("\141\143\164\x69\x76\151\x74\x79\x5f\x69\x64"); goto ZgSrH; YCOMj: $msg = ''; goto VpIK7; NtmXJ: $msg = sprintf("\344\270\x8d\xe8\203\xbd\xe8\xb6\205\350\xbf\207\346\257\x8f\xe4\272\272\xe9\x99\220\350\264\xad\351\207\x8f\45\x64\xe4\xbb\xb6", $activity_pre_user_limit); goto GRFtJ; t4zjZ: $userBuyCount = $this->getUserBuyActivityCount($this->user->id, $activity_goods_id); goto CpmVJ; MbEs2: $cartCount = $this->get("\143\x61\x72\x74\x43\x6f\165\156\164"); goto t4zjZ; Io2ZM: $is_enable = true; goto SMHLs; AdFlY: $activity_goods_id = $this->get("\141\143\x74\x69\166\151\164\x79\137\147\157\157\144\x73\137\151\144"); goto MbEs2; ovFaH: goto zlVrl; goto dm7WH; KB4t5: return $this->success(["\151\x73\137\145\156\x61\x62\154\x65" => $is_enable, "\x6d\163\x67" => $msg]); goto BCZSi; Ka2zw: zlVrl: goto c2FS_; vUBQK: $activity_type = $this->get("\x61\x63\164\x69\166\x69\164\x79\137\164\171\160\145"); goto mQWSs; Dv9Zp: $activity_buy_num = $activity->buy_num; goto V6KNG; QVLxH: $store_id = $this->get("\x73\x74\x6f\x72\x65\x5f\151\x64"); goto AdFlY; plkpN: goto LNbDC; goto Tfszf; BCZSi: } public function isValidSecKillCartApi() { goto h_O0s; YO5A1: $activity_goods_id = $this->get("\141\x63\x74\x69\x76\x69\164\x79\137\x67\x6f\x6f\x64\163\137\151\144"); goto kabAZ; WeQP2: $activity_all_limit = $activity->limited; goto JIakP; QlfK2: if ($cartCount + $userBuyCount < $activity_pre_user_limit) { goto PbjAJ; } goto cjgzQ; c9682: goto Yqk56; goto E3871; LMlb0: $activity_pre_user_limit = 1; goto F1xe1; F4cBB: if ($activity_all_limit - $activity_buy_num > $cartCount) { goto nvI8T; } goto A6nlL; E3871: PbjAJ: goto F4cBB; h_O0s: $activity_id = $this->get("\x61\x63\164\x69\166\x69\164\171\137\151\144"); goto PPfYi; JIakP: $activity_buy_num = $activity->buy_num; goto xALUv; Pl2kw: Yqk56: goto AqPnk; AqPnk: return $this->success(["\x69\163\137\x65\156\141\x62\x6c\145" => $is_enable, "\155\163\147" => $msg]); goto VxQd0; haPw6: $cartCount = $this->get("\143\141\x72\x74\x43\x6f\x75\x6e\x74"); goto YO5A1; cjgzQ: $msg = sprintf("\344\xb8\215\xe8\x83\xbd\xe8\266\205\xe8\277\x87\346\xaf\217\344\xba\272\xe9\x99\x90\xe8\264\255\xe9\x87\217\x25\x64\344\273\266", $activity_pre_user_limit); goto c9682; ozJT4: goto ylQlV; goto ch97t; xALUv: $is_enable = false; goto P5SfG; kabAZ: $userBuyCount = $this->getUserBuyActivityCount($this->user->id, $activity_goods_id); goto LMlb0; F1xe1: $activity = \App\Model\ActivityGoods::instance()->where("\x61\143\x74\151\x76\151\164\x79\137\x74\171\x70\145", 2)->where("\141\143\x74\151\166\x69\164\x79\x5f\x69\x64", $activity_id)->where("\147\157\x6f\x64\x73\137\151\x64", $goods_id)->first(["\154\x69\x6d\151\x74\x65\144", "\x62\x75\x79\137\156\x75\155"]); goto WeQP2; hPFoh: $store_id = $this->get("\x73\x74\x6f\162\145\x5f\x69\144"); goto haPw6; A6nlL: $msg = sprintf("\xe5\267\xb2\350\xa2\253\xe6\x8a\xa2\xe5\205\x89", $activity_pre_user_limit); goto ozJT4; gSgKU: ylQlV: goto Pl2kw; ch97t: nvI8T: goto gy8aP; P5SfG: $msg = ''; goto QlfK2; PPfYi: $goods_id = $this->get("\x67\157\157\x64\163\137\151\144"); goto hPFoh; gy8aP: $is_enable = true; goto gSgKU; VxQd0: } public function payOrderApi() { goto zd6Ub; h1nXf: d3VaN: goto lybvw; K0_vc: return $this->success(["\160\x61\171\x65\144" => 1, "\x73\156" => $order_sn, "\160\141\x79\x5f\x74\x79\160\x65" => $order->pay_type]); goto UOK1d; eY3Gi: $ordergoods = \App\Model\OrderGoods::instance()->where("\x6f\162\144\x65\x72\137\x73\156", $order_sn)->get(); goto iAy3d; aNxZ6: $order->save(); goto eY3Gi; r8EDS: $order->pay_type = $pay_type; goto HB0pl; HB0pl: $order->form_id = $this->get("\x66\157\162\x6d\x5f\151\144", ''); goto aNxZ6; UOK1d: vBQFs: goto E1yLg; E1yLg: return $this->success(["\x70\141\171\145\144" => 0, "\163\x6e" => $order_sn, "\160\x61\171\137\x74\x79\160\x65" => $order->pay_type]); goto T5C5C; lybvw: if (!$this->payOrderFromAmount($order_sn)) { goto vBQFs; } goto K0_vc; zd6Ub: $order_sn = $this->get("\157\x72\x64\145\162\x5f\163\x6e"); goto NWhXl; iAy3d: $ordergoods = $ordergoods->toArray(); goto el4vu; NWhXl: $pay_type = $this->get("\160\x61\171\137\x74\171\x70\x65"); goto waEAQ; waEAQ: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(); goto r8EDS; el4vu: foreach ($ordergoods as $item) { goto RLieF; OFZ41: $stock = $order->checkStock($item, $this->user->id); goto HlIpx; ZQGpw: GAmNL: goto OFZ41; RLieF: if (isset($item["\147\157\157\144\163\137\164\x79\x70\x65"])) { goto GAmNL; } goto RIgjs; RIgjs: $item["\x67\157\157\144\163\137\164\171\x70\x65"] = $item["\x62\165\x79\137\x74\171\160\x65"]; goto ZQGpw; RjwEM: return $this->error(-999, "\345\225\206\345\x93\x81\xe5\267\262\xe6\x97\240\xe5\272\223\345\255\x98\41"); goto GWz0w; HlIpx: if (!$stock) { goto jVRmj; } goto RjwEM; GWz0w: jVRmj: goto vYSCx; vYSCx: i5Ieo: goto zdkxZ; zdkxZ: } goto h1nXf; T5C5C: } public function payOrderFromAmount($order_sn) { goto YG_uj; q3_Y5: return true; goto dxZ1F; SzpDT: return false; goto iwtzT; SOP4X: $ordergoods = \App\Model\OrderGoods::instance()->where("\157\162\x64\145\x72\137\163\156", $order_sn)->get(); goto W89zG; UDjm9: $order->decStock($order_sn); goto laO1w; W89zG: $ordergoods = $ordergoods->toArray(); goto bkzjl; l8VL5: $pay_amount = $order->pay_amount; goto sE3uq; KuB0i: $this->user->save(); goto qdPzC; qdPzC: $order->status = 20; goto d1uVd; laO1w: $this->paySuccessEvent($order_sn); goto q3_Y5; d1uVd: $order->pay_at = date("\x59\x2d\155\55\144\x20\x48\72\151\72\163"); goto zCGso; YG_uj: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(); goto SOP4X; u3SZd: NatRp: goto SzpDT; feSEl: qDyB0: goto dEzjU; dEzjU: if (!($order && $order->pay_type == 1)) { goto NatRp; } goto l8VL5; lDMpc: $this->user->amount -= $pay_amount; goto KuB0i; dxZ1F: ye_mz: goto u3SZd; sE3uq: if (!(floatval($this->user->amount) >= floatval($pay_amount))) { goto ye_mz; } goto lDMpc; bkzjl: foreach ($ordergoods as $item) { goto De7W3; WfAj9: return $this->error(-999, "\345\225\206\345\223\x81\xe5\267\xb2\xe6\x97\240\xe5\272\x93\xe5\255\230\41"); goto HwGmP; ciG1I: $stock = $order->checkStock($item, $this->user->id); goto asaOD; asaOD: if (!$stock) { goto OlMNC; } goto WfAj9; jR7WE: SjTUG: goto ciG1I; HwGmP: OlMNC: goto WIZ6f; WIZ6f: vaarn: goto FJOeE; De7W3: if (isset($item["\x67\x6f\157\144\x73\x5f\x74\171\160\145"])) { goto SjTUG; } goto k_X1e; k_X1e: $item["\x67\157\157\x64\x73\137\x74\x79\x70\145"] = $item["\x62\165\x79\x5f\x74\x79\x70\x65"]; goto jR7WE; FJOeE: } goto feSEl; zCGso: $order->save(); goto UDjm9; iwtzT: } public function getCartInfoApi() { goto K_xfV; fh15N: $dis_amount_limit = $store->dis_amount_limit; goto zRayx; w79Yx: $fullPrice = $store->min_consume; goto fh15N; ZlCu9: $store = \App\Model\Store::instance()->find($store_id); goto w79Yx; K_xfV: $store_id = $this->get("\163\x74\157\x72\x65\x5f\151\x64"); goto ZlCu9; zRayx: $distribution = 0; goto utkk6; utkk6: $this->success(["\146\x75\x6c\x6c\120\x72\151\143\145" => $fullPrice, "\x64\x69\163\137\x61\155\x6f\x75\x6e\164\x5f\x6c\x69\155\x69\164" => $dis_amount_limit, "\144\x69\x73\x74\162\151\x62\x75\x74\x69\x6f\x6e" => $distribution]); goto bzN7Q; bzN7Q: } private function handleExpiredOrder() { goto P0Jvf; C8PfO: hFiH3: goto PxV2s; yaV4W: foreach ($expired_orders as $item) { goto JQtnx; PLR7f: zkk7x: goto M6h9C; NVkSP: $item->save(); goto PLR7f; JQtnx: $item->status = 50; goto NVkSP; M6h9C: } goto C8PfO; P0Jvf: $expired_minute = 30; goto S7pAk; S7pAk: $now = date("\x59\55\155\x2d\144\x20\110\x3a\151\72\163", strtotime("\55{$expired_minute}\40\155\151\156\165\x74\x65")); goto mbT62; mbT62: $expired_orders = \App\Model\Order::instance()->where("\163\164\141\x74\x75\x73", 10)->where("\x63\x72\x65\x61\x74\145\x64\137\141\x74", "\x3c", $now)->get(["\x69\x64", "\x73\164\141\x74\165\163"]); goto yaV4W; PxV2s: } public function getOrderListApi() { goto xIAvN; aLz99: foreach ($orders as &$item) { goto xH7iu; lDu_f: $item["\x61\x6c\x6c\137\x6e\x75\x6d"] = count($goods); goto FgwMD; juyd4: $item["\163\x74\x6f\x72\145\137\160\150\x6f\x6e\145"] = \App\Model\Store::instance()->find($item["\x73\164\x6f\x72\145\x5f\x69\144"])->phone; goto lDu_f; xH7iu: $goods = \App\Model\OrderGoods::instance()->where("\157\162\x64\x65\162\x5f\x73\156", $item["\163\156"])->get(["\x67\157\157\144\163\x5f\x6e\x61\155\x65", "\x67\157\157\144\x73\137\160\162\151\143\x65", "\142\165\x79\x5f\164\x79\160\145", "\x73\162\143", "\156\165\155"])->toArray(); goto KwaP0; KwaP0: $this->transformer($goods, ["\x67\157\x6f\x64\163\137\156\x61\x6d\x65" => "\156\141\155\x65", "\x67\157\x6f\x64\163\137\160\162\151\143\x65" => "\x70\x72\151\x63\145", "\163\x72\143" => "\x69\155\147"]); goto TUvfp; FgwMD: Np9y8: goto TX_NV; TUvfp: $item["\147\157\x6f\x64\163"] = [$goods[0]]; goto juyd4; TX_NV: } goto oiZXf; oiZXf: yrRXs: goto xP7eq; xP7eq: return $this->success(["\x6f\x72\144\x65\162\163" => $orders, "\165\x73\x65\x72\137\141\155\x6f\x75\156\x74" => $this->user->amount]); goto D12vU; xIAvN: $orders = \App\Model\Order::instance()->where("\165\x73\x65\x72\x5f\151\144", $this->user->id)->where("\163\x74\x61\164\165\x73", "\x3c\76", -10)->orderBy("\151\144", "\144\145\163\x63")->get(["\151\144", "\163\x74\x6f\162\145\x5f\151\x64", "\163\156", "\163\164\141\x74\165\163", "\x70\x61\x79\137\141\x6d\157\x75\156\164", "\x63\x72\x65\x61\164\145\144\137\141\x74"])->toArray(); goto aLz99; D12vU: } public function changeOrderStatusApi() { goto MebZt; sHhqU: $order_sn = $this->get("\157\162\x64\145\x72\x5f\x73\x6e"); goto c1eab; FEODz: $order->save(); goto bJoyK; MebZt: $status = $this->get("\163\164\x61\164\x75\163"); goto sHhqU; VRpFe: $order->status = $status; goto FEODz; c1eab: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(); goto VRpFe; bJoyK: return $this->getOrderListApi(); goto n72Iv; n72Iv: } public function postOrderApi() { goto SUSQ_; QiTG9: $address = str_replace("\x26\161\x75\157\x74\x3b", "\42", $address); goto hXy4K; NW77M: $order->take_tel = $this->get("\164\141\153\x65\x5f\x74\145\154"); goto HD2R8; IOkzl: SRUbg: goto DOwQE; YwLBK: $user_coupon->is_used = 1; goto q3rvq; ggOBD: $order->address = json_encode($address); goto HsTKN; r1uSy: aXPet: goto HxgkW; Btvd0: Fya2w: goto g35zv; crMH5: rlkyU: goto EyxS0; xiEY9: if (!($order->coupon_id > 0)) { goto UX880; } goto rK0Io; BHUAA: $order->pay_amount = $this->get("\x70\141\171\x5f\141\x6d\157\165\x6e\164"); goto i9WqP; HsTKN: goto KhaQM; goto IOkzl; Py9_b: $order->status = 10; goto FlhZK; EyxS0: $order->sn = $this->generateOrderSn(); goto bhy_E; Fav8M: $order->verify_sn = \Encore\Admin\Str::random_bytes(10); goto FNmDb; bhy_E: $order->user_id = $this->user->id; goto igU_8; DOwQE: $order->address = ''; goto U2uaO; UA1xn: $order->distribution_type = $this->get("\x64\x69\163\164\162\151\142\165\x74\151\157\x6e\x5f\x74\x79\x70\145"); goto txiVZ; U2uaO: KhaQM: goto Fav8M; y0IZX: UX880: goto k6zGr; igU_8: $order->store_id = $this->get("\x73\164\157\162\145\137\x69\x64"); goto fWvqz; txiVZ: $order->take_time = $this->get("\164\x61\153\x65\137\164\151\155\x65"); goto NW77M; AGVpr: if (!$user_coupon) { goto KZbkS; } goto YwLBK; fWvqz: $order->amount = $this->get("\x61\x6d\157\165\x6e\164"); goto BHUAA; ZMA8W: $address = $this->get("\x61\144\x64\x72\x65\163\x73"); goto KWWpv; gQDAa: $order = \App\Model\Order::instance(); goto qaSEa; XMCzf: KZbkS: goto y0IZX; sp0x6: foreach ($goods as $item) { goto njOZM; EwmYF: $orderGoods->activity_goods_id = $item["\141\x63\x74\x69\x76\x69\x74\x79\x5f\147\x6f\157\144\163\137\151\144"]; goto cVJdk; HYJlB: wdJon: goto Khsf9; GY9ag: $orderGoods->goods_id = $item["\151\x64"]; goto XhzLw; ftDrM: $orderGoods->num = $item["\x6e\165\x6d"]; goto OzrdC; njOZM: $orderGoods = \App\Model\OrderGoods::instance(); goto bHiwm; SjTMx: BEbcA: goto ftDrM; OzrdC: $orderGoods->src = $item["\163\162\143"]; goto KbA3F; c8Cdz: if ($orderGoods->buy_type == 0) { goto jNEtS; } goto EwmYF; XhzLw: $orderGoods->goods_name = $item["\156\141\x6d\145"]; goto fMC6U; cVJdk: goto BEbcA; goto FR7e6; bHiwm: $orderGoods->order_sn = $order->sn; goto GY9ag; fMC6U: $orderGoods->goods_price = $item["\x70\162\151\143\x65"]; goto cJWPL; FR7e6: jNEtS: goto yMVoI; cJWPL: $orderGoods->buy_type = $item["\147\x6f\157\144\x73\137\x74\x79\160\x65"]; goto c8Cdz; KbA3F: $orderGoods->save(); goto HYJlB; yMVoI: $orderGoods->store_goods_id = $item["\x73\x74\x6f\x72\x65\x5f\147\x6f\157\144\x73\137\x69\x64"]; goto SjTMx; Khsf9: } goto Btvd0; HD2R8: $order->latitude = $this->get("\x6c\x61\164", 0); goto mpkc3; q3rvq: $user_coupon->save(); goto XMCzf; cQ34T: $order->coupon_id = $this->get("\143\x6f\165\x70\x6f\x6e\x5f\151\144"); goto xiEY9; HxgkW: P8FXx: goto w8nQ4; gyxqm: $order->distribution_amount = $this->get("\144\x69\x73\x74\x72\151\x62\x75\164\151\x6f\x6e\x5f\141\155\157\165\156\164"); goto Py9_b; SUSQ_: $goods = $this->get("\x67\157\157\x64\x73"); goto M3Vnl; hXy4K: $address = json_decode($address, true); goto ggOBD; rK0Io: $user_coupon = \App\Model\UserCoupon::instance()->find($order->coupon_id); goto AGVpr; FNmDb: $order->save(); goto sp0x6; k6zGr: $order->remark = $this->get("\x72\x65\x6d\x61\162\x6b"); goto ZMA8W; uBRVC: $goods = json_decode($goods, true); goto gQDAa; qaSEa: foreach ($goods as $item) { goto epKTg; C6kkD: return $this->error(-999, "\xe5\x95\206\xe5\223\x81\345\xb7\xb2\346\227\xa0\345\272\223\345\xad\x98\41"); goto n_eUu; tFyCc: BnD33: goto XPdRT; epKTg: $stock = $order->checkStock($item, $this->user->id); goto zeUbp; n_eUu: opFpk: goto tFyCc; zeUbp: if (!$stock) { goto opFpk; } goto C6kkD; XPdRT: } goto crMH5; mpkc3: $order->longitude = $this->get("\x6c\156\147", 0); goto cQ34T; M3Vnl: $goods = str_replace("\46\161\165\x6f\164\73", "\x22", $goods); goto uBRVC; w8nQ4: return $this->success(["\x70\x61\171\145\x64" => 0, "\x73\156" => $order->sn, "\x70\x61\171\137\x74\x79\160\145" => $order->pay_type]); goto YEwPZ; g35zv: if (!($order->pay_type == 1)) { goto P8FXx; } goto bSZlo; FlhZK: $order->form_id = $this->get("\x66\x6f\162\x6d\137\x69\x64"); goto UA1xn; bSZlo: if (!$this->payOrderFromAmount($order->sn)) { goto aXPet; } goto sYjp1; KWWpv: if ($address == '') { goto SRUbg; } goto QiTG9; sYjp1: return $this->success(["\x70\x61\171\145\x64" => 1, "\x73\x6e" => $order->sn, "\160\141\171\x5f\x74\171\x70\145" => $order->pay_type]); goto r1uSy; i9WqP: $order->pay_type = $this->get("\x70\141\171\137\x74\x79\x70\x65"); goto gyxqm; YEwPZ: } public function payApi() { goto QbT4y; vSEmW: goto nKDzX; goto PvbtT; mu5hU: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(["\160\141\x79\137\141\x6d\157\x75\156\x74"]); goto hIBqA; XFC0o: aeWe1: goto VQ1JK; W3n0g: nKDzX: goto GzEYo; P9ElL: eZMhb: goto vSEmW; lAm7C: FTQr6: goto NZBPD; eBWgQ: $params = array("\157\x70\x65\156\151\x64" => $this->get("\x6f\x70\x65\156\151\144"), "\x6f\x75\164\137\164\162\x61\144\x65\x5f\x6e\x6f" => $order_sn, "\x74\x6f\164\x61\154\137\x66\x65\145" => intval($order->pay_amount * 100), "\x62\x6f\144\x79" => "\xe5\x85\205\xe5\x80\xbc"); goto W3n0g; WGnkV: if (!(substr($order_sn, 0, 3) == "\x32\60\x30")) { goto eZMhb; } goto mu5hU; hIBqA: $ordergoods = \App\Model\OrderGoods::instance()->where("\x6f\162\144\145\162\x5f\163\x6e", $order_sn)->get(); goto kVR52; gxtVg: return $this->success($pay_params); goto mgNu6; VG3sv: U76Lk: goto WMs3r; K90Bl: if (isset($pay_params["\155\x65\x73\x73\x61\x67\145"])) { goto U76Lk; } goto qNa7q; O6WkL: goto aeWe1; goto VG3sv; kVR52: $ordergoods = $ordergoods->toArray(); goto hCqXT; i7TSa: $order = \App\Model\RechargeLog::instance()->where("\x72\145\155\141\162\x6b", $order_sn)->first(["\x70\x61\171\x5f\141\155\x6f\x75\156\x74"]); goto eBWgQ; GzEYo: $pay_params = $this->weixin_pay($params); goto YkA_P; WMs3r: return $this->error(1, $pay_params["\155\x65\163\x73\x61\x67\x65"]); goto XFC0o; VQ1JK: jO9Lt: goto gxtVg; jjGve: if (substr($order_sn, 0, 3) == "\x31\x30\60") { goto UWqIC; } goto WGnkV; YkA_P: if (!is_error($pay_params)) { goto jO9Lt; } goto K90Bl; qNa7q: return $this->error(1, "\346\x94\xaf\344\273\230\345\244\261\xe8\264\xa5\xef\274\214\xe8\xaf\267\351\x87\x8d\xe8\xaf\x95"); goto O6WkL; QbT4y: $order_sn = $this->get("\157\x72\144\145\162\151\x64"); goto jjGve; NZBPD: $params = array("\x6f\160\x65\x6e\x69\144" => $this->get("\157\160\145\156\x69\144"), "\157\165\164\x5f\164\x72\141\x64\x65\137\156\157" => $order_sn, "\164\157\164\x61\154\137\146\x65\x65" => intval($order->pay_amount * 100), "\142\157\144\x79" => "\350\264\xad\xe7\211\xa9"); goto P9ElL; PvbtT: UWqIC: goto i7TSa; hCqXT: foreach ($ordergoods as $item) { goto l8PBh; gir33: if (!$stock) { goto g_CYG; } goto o0uGa; l8PBh: if (isset($item["\x67\157\157\144\163\x5f\164\x79\x70\x65"])) { goto PCYjf; } goto bnhQR; THznO: kyZD9: goto pmy_U; Sf8fb: PCYjf: goto klfiR; klfiR: $stock = $order->checkStock($item, $this->user->id); goto gir33; bnhQR: $item["\147\x6f\x6f\x64\x73\137\x74\x79\160\145"] = $item["\142\165\171\137\164\x79\160\145"]; goto Sf8fb; o0uGa: return $this->error(-999, "\345\x95\206\xe5\x93\201\345\xb7\262\xe6\x97\xa0\345\272\x93\xe5\255\x98\x21"); goto QIbLB; QIbLB: g_CYG: goto THznO; pmy_U: } goto lAm7C; mgNu6: } public function weixin_pay($params) { goto JAsVL; t_XQ1: $sysinfo = \App\Model\SystemInfo::instance()->first(); goto Dr3_3; cw0nO: $weixinpay = new \WeixinPay($appid, $params["\157\x70\145\x6e\151\144"], $mch_id, $key, $params["\x6f\165\164\x5f\164\x72\x61\x64\x65\x5f\156\x6f"], $params["\x62\x6f\x64\x79"], $params["\164\157\x74\x61\154\x5f\146\145\x65"], $notify_url, $attach); goto Nz0jQ; iqGob: $notify_url = $_W["\x73\151\164\x65\x72\157\x6f\164"] . "\141\x64\144\157\x6e\163\x2f\x79\x7a\x62\x6c\144\137\x73\x75\x6e\57\x6e\157\x74\x69\146\x79\x2e\x70\150\x70"; goto jWYZl; Axa5Q: $key = $sysinfo->wxkey; goto iqGob; jWYZl: $attach = $_W["\165\x6e\x69\141\x63\151\144"]; goto cw0nO; jSEZN: return $res; goto uCl62; Nz0jQ: $res = $weixinpay->pay(); goto jSEZN; aqH6q: $mch_id = $sysinfo->mchid; goto Axa5Q; in_5S: return false; goto iHKy5; JAsVL: global $_W; goto t_XQ1; mpxld: $appid = $sysinfo->appid; goto aqH6q; Dr3_3: if (!$sysinfo) { goto fzhRj; } goto mpxld; uCl62: fzhRj: goto in_5S; iHKy5: } private function getTodayOrder($store_id) { $count = \App\Model\Order::instance()->where("\163\x74\157\x72\x65\x5f\x69\x64", $store_id)->where("\163\164\x61\164\x75\x73", [20, 30, 40])->where("\144\x61\164\145\x28\x70\141\171\137\x61\164\x29", date("\x59\x2d\155\x2d\x64"))->count(); return $count; } private function getNoDisOrder($store_id) { $count = \App\Model\DisOrder::instance()->where("\x73\164\157\x72\145\137\x69\x64", $store_id)->where("\x73\x74\x61\164\165\x73", 10)->where("\x64\x61\x74\145\50\143\162\145\141\x74\145\144\137\x61\x74\51", date("\x59\x2d\155\x2d\144"))->count(); return $count; } private function getDisOrder($store_id) { $count = \App\Model\DisOrder::instance()->where("\x73\164\157\162\x65\137\151\144", $store_id)->where("\x73\164\141\164\x75\x73", 20)->where("\x64\x61\x74\145\x28\162\x65\143\145\151\166\x65\137\141\164\51", date("\131\55\x6d\55\x64"))->count(); return $count; } private function getTodaySales($store_id) { $sum = \App\Model\Order::instance()->where("\x73\164\157\x72\145\x5f\x69\x64", $store_id)->where("\x73\x74\x61\164\x75\x73", [20, 30, 40])->where("\x64\x61\164\145\x28\160\x61\171\137\x61\x74\51", date("\131\55\x6d\x2d\x64"))->sum("\160\x61\x79\137\x61\x6d\157\165\156\x74"); return $sum; } private function getYesterdaySales($store_id) { $sum = \App\Model\Order::instance()->where("\x73\164\157\162\145\137\151\144", $store_id)->where("\163\164\x61\164\165\x73", [20, 30, 40])->where("\144\x61\164\145\x28\160\x61\x79\x5f\141\164\x29", date("\x59\55\x6d\55\x64", strtotime("\x2d\x31\40\144\x61\x79\163")))->sum("\160\141\x79\137\141\155\157\x75\156\x74"); return $sum; } private function getAllSales($store_id) { $sum = \App\Model\Order::instance()->where("\x73\164\157\162\x65\137\x69\x64", $store_id)->where("\x73\164\141\164\x75\163", [20, 30, 40])->sum("\x70\141\x79\137\x61\155\x6f\165\156\164"); return $sum; } public function getStoreSummaryApi() { goto Tsuy1; Tsuy1: $store_id = $this->user->is_admin; goto m5L54; RhUcK: if (!$store) { goto EX839; } goto Df5_S; m5L54: if (!($store_id > 0)) { goto y6Nhc; } goto jQYQA; jQYQA: $store = \App\Model\Store::instance()->find($store_id); goto RhUcK; IL3OH: return $this->error(-1, "\346\202\xa8\344\xb8\x8d\xe6\x98\xaf\345\210\x86\345\272\227\347\xae\xa1\xe7\x90\206\345\x91\230"); goto DFVZP; VdZfy: $summary = ["\164\157\x64\x61\171\x4f\x72\x64\145\162" => $this->getTodayOrder($store_id), "\156\157\104\151\163\x4f\x72\x64\145\162" => $this->getNoDisOrder($store_id), "\104\151\163\117\162\144\145\162" => $this->getDisOrder($store_id), "\x74\157\144\141\x79\123\141\154\x65\163" => $this->getTodaySales($store_id), "\x79\145\x73\164\x65\x72\x64\141\x79\123\141\154\x65\x73" => $this->getYesterdaySales($store_id), "\141\154\x6c\123\141\154\x65\x73" => $this->getAllSales($store_id)]; goto VHEKr; kEcl9: y6Nhc: goto IL3OH; VHEKr: $this->success(["\163\x74\x6f\x72\145\x4e\141\155\x65" => $storeName, "\x73\165\x6d\155\141\x72\x79" => $summary]); goto hij9d; Df5_S: $storeName = $store->name; goto VdZfy; hij9d: EX839: goto kEcl9; DFVZP: } public function adminVerifyOrderApi() { goto Y2T0w; Y2T0w: $order_sn = $this->get("\x6f\x72\144\x65\162\137\x73\156"); goto eoukg; au_ws: goto K3tkY; goto pIrDA; zbI6U: $order->save(); goto GrHj7; xZVXO: K3tkY: goto uLxJf; aAt3s: $order->status = 40; goto zbI6U; nCBrH: if ($order) { goto wECbL; } goto Dhvo_; GrHj7: return $this->success(); goto xZVXO; pIrDA: wECbL: goto aAt3s; eoukg: $order = \App\Model\Order::instance()->where("\x73\x6e", $order_sn)->first(); goto nCBrH; Dhvo_: return $this->error(-1, "\xe6\240\270\351\224\x80\xe7\xa0\201\xe4\270\215\345\xaf\271"); goto au_ws; uLxJf: } public function userVerifyOrderApi() { goto b1ffh; FhItQ: NhXXn: goto knv5c; o8rXs: TD1YT: goto cnWYr; jpwBj: $disorder = \App\Model\DisOrder::instance()->where("\x6f\x72\x64\145\x72\x5f\163\156", $order_sn)->first(); goto qA7UQ; MvOHm: $disorder->status = 30; goto fSu7R; HKmwg: $order->status = 40; goto JWe87; JWe87: $order->save(); goto jpwBj; aR2Il: FCc5Z: goto HKmwg; WDVgu: iKviO: goto UvaAy; knv5c: goto TD1YT; goto aR2Il; xbezf: return $this->error(-1, "\xe6\xa0\xb8\xe9\224\200\xe7\240\x81\344\xb8\215\345\xaf\271"); goto s1h7B; qA7UQ: if (!$disorder->order_sn) { goto iKviO; } goto MvOHm; JMwdP: return $this->error(-1, "\350\xae\242\345\x8d\x95\xe5\xb7\262\xe5\xae\x8c\xe6\x88\220\x2c\350\257\xb7\xe5\213\277\xe9\207\215\345\244\215\xe7\x82\xb9\345\x87\xbb"); goto FhItQ; bdxR5: $this->changeDisAmount($disorder->dis_user_id, 0, "\351\x85\215\351\200\201\350\277\233\xe5\xb8\220", $disorder->dis_amount, $order->sn); goto WDVgu; ph5nA: lKzoD: goto JMwdP; jHz3k: if ($order && $order->status != 40) { goto FCc5Z; } goto cN2OY; b1ffh: $order_sn = $this->get("\x6f\162\x64\145\162\x5f\x73\156"); goto w0gza; UvaAy: return $this->success(); goto o8rXs; fSu7R: $disorder->save(); goto bdxR5; cN2OY: if ($order && $order->status == 40) { goto lKzoD; } goto xbezf; s1h7B: goto NhXXn; goto ph5nA; w0gza: $order = \App\Model\Order::instance()->where("\163\156", $order_sn)->first(); goto jHz3k; cnWYr: } public function getOrderSnFromVerifySnApi() { goto OMC64; iPz3S: C_YkJ: goto xwZk_; Se1mk: goto NNUq1; goto pjtY1; CaIui: if ($order) { goto oL5oP; } goto qCXi6; DcVd0: Ri9GW: goto khg2n; MYmjq: return $this->error(-1, "\346\x82\xa8\xe4\xb8\215\346\230\257\345\x88\x86\345\xba\227\347\256\xa1\xe7\x90\206\xe5\221\x98"); goto K2FVp; NYmNd: if ($order->store_id == $store_id) { goto yfCRd; } goto q1kO9; mbLTf: return $this->success(["\157\x72\x64\x65\x72\x5f\163\156" => $order->sn]); goto iPz3S; xwZk_: NNUq1: goto juCtX; juCtX: M0dNn: goto DcVd0; UWj1x: return $this->error(-1, "\xe6\xa0\270\xe9\x94\200\347\xa0\x81\344\xb8\x8d\xe5\257\xb9"); goto XA0oF; UK3Oj: yfCRd: goto mbLTf; yRnzB: goto Ri9GW; goto WmEml; ekkx0: WfIgP: goto askMs; XA0oF: goto ypWCg; goto XJ3OJ; sccDu: ypWCg: goto yRnzB; aeTOc: $order = \App\Model\Order::instance()->where("\x76\145\162\x69\146\171\137\x73\156", $verify_sn)->first(); goto CaIui; C688t: if ($order) { goto Fr1eH; } goto UWj1x; qCXi6: return $this->error(-1, "\xe6\xa0\270\351\x94\200\xe7\240\201\344\270\x8d\xe5\xaf\271"); goto Se1mk; askMs: $verify_sn = $this->get("\x76\x65\x72\151\x66\x79\x5f\x73\x6e"); goto aeTOc; WmEml: tTHNf: goto nuCj9; JRQua: $admin = $this->get("\141\144\155\x69\x6e", 0); goto CRFCc; UfjdL: $verify_sn = $this->get("\166\x65\x72\151\x66\x79\137\x73\156"); goto ducQj; ducQj: $order = \App\Model\Order::instance()->where("\166\145\162\x69\146\x79\x5f\163\x6e", $verify_sn)->first(); goto C688t; pjtY1: oL5oP: goto NYmNd; tMWz1: goto C_YkJ; goto UK3Oj; XJ3OJ: Fr1eH: goto V3aOi; K2FVp: goto M0dNn; goto ekkx0; CRFCc: if ($admin == 1) { goto tTHNf; } goto UfjdL; OMC64: $store_id = $this->user->is_admin; goto JRQua; V3aOi: return $this->success(["\157\162\144\145\162\137\x73\156" => $order->sn]); goto sccDu; nuCj9: if ($store_id > 0) { goto WfIgP; } goto MYmjq; q1kO9: return $this->error(-1, "\350\257\245\xe8\256\xa2\xe5\215\225\344\270\215\xe5\xb1\x9e\344\xba\x8e\346\x82\xa8\xe7\x9a\x84\xe5\x88\x86\345\xba\227"); goto tMWz1; khg2n: } public function getOrderDetailApi() { goto zLrNe; g3Cpz: $order["\x61\144\144\x72\x65\x73\163"] = json_decode($order["\x61\x64\x64\162\x65\x73\x73"], true); goto AA6gq; GMYv9: $store = \App\Model\Store::instance()->find($order["\163\x74\x6f\162\145\137\151\144"], ["\156\x61\x6d\x65", "\x70\x68\x6f\x6e\145", "\x61\144\x64\162\x65\x73\x73"])->toArray(); goto rQ4Kl; Wo0s8: if ($order["\x63\x6f\x75\x70\x6f\x6e\137\151\x64"] > 0) { goto S40Kq; } goto Ii4Wr; Ii4Wr: $order["\143\x6f\165\x70\157\x6e\137\x61\155\x6f\165\x6e\x74"] = 0; goto KVo3G; SSQsz: $order = \App\Model\Order::instance()->where("\x73\156", $order_sn)->first()->toArray(); goto Wo0s8; zLrNe: $order_sn = $this->get("\x6f\162\x64\145\x72\137\x73\156"); goto SSQsz; KVo3G: goto QIHuS; goto XzxJ6; O3BW9: $goods = \App\Model\OrderGoods::instance()->where("\x6f\162\144\145\162\137\x73\156", $order_sn)->get(["\147\157\157\x64\163\137\156\141\155\145", "\x67\157\157\x64\163\x5f\160\162\x69\x63\145", "\142\165\x79\137\164\171\x70\145", "\163\162\143", "\x6e\165\155"])->toArray(); goto nfkkr; AA6gq: cKHfV: goto O3BW9; CVUyI: QIHuS: goto w1xbt; w1xbt: if (!($order["\141\144\x64\162\x65\163\163"] != '')) { goto cKHfV; } goto g3Cpz; nfkkr: $this->transformer($goods, ["\147\x6f\157\144\x73\x5f\x6e\141\x6d\x65" => "\x6e\141\x6d\x65", "\x67\x6f\x6f\144\163\x5f\160\162\151\x63\145" => "\160\162\151\x63\x65", "\x73\162\143" => "\x69\x6d\x67"]); goto GMYv9; rQ4Kl: $this->success(["\x6f\162\144\145\x72" => $order, "\147\157\x6f\x64\163" => $goods, "\163\164\157\x72\145" => $store]); goto Xjh8p; XzxJ6: S40Kq: goto r1ayI; r1ayI: $order["\x63\x6f\165\x70\x6f\x6e\x5f\x61\x6d\x6f\x75\x6e\x74"] = \App\Model\UserCoupon::instance()->find($order["\143\157\165\160\157\156\x5f\x69\x64"])->amount; goto CVUyI; Xjh8p: } private function caculateAKSN($sk, $url, $querystring_arrays, $method = "\107\105\x54") { goto MTGTK; qzf03: ksort($querystring_arrays); goto F_NBy; UF1MD: $querystring = http_build_query($querystring_arrays); goto x8IET; MTGTK: if (!($method === "\120\117\x53\x54")) { goto YLQi7; } goto qzf03; F_NBy: YLQi7: goto UF1MD; x8IET: return md5(urlencode($url . "\x3f" . $querystring . $sk)); goto qcZSp; qcZSp: } private function getLngLatFromAddress($address) { goto POTwJ; XedaL: $url = "\150\164\164\x70\163\x3a\x2f\x2f\141\x70\x69\x73\56\155\x61\160\56\161\161\x2e\x63\x6f\155\57\x77\x73\57\x67\145\x6f\x63\x6f\144\145\162\x2f\166\x31"; goto IAi8C; Ps3F1: return false; goto YEmtw; IAi8C: $arg = http_build_query($arg); goto BB8v3; AUI4J: $lnglat = $res["\162\145\x73\165\x6c\x74"]["\x6c\x6f\x63\141\164\x69\157\x6e"]; goto aYR1A; BB8v3: $url .= "\x3f" . $arg; goto YqBpP; X0jbW: $res = json_decode($res, true); goto qxPP0; XBncb: $sn = $this->caculateAKSN("\101\x6c\x47\x6e\161\x57\x4d\146\x30\x69\127\132\x5a\111\x74\x4d\x73\x6c\121\x61\153\x35\x49\115\x45\x34\x39\x6b\x6d\151\x65\x4e", "\x2f\167\163\57\x67\x65\x6f\x63\x6f\x64\145\x72\x2f\x76\x31", $params, "\107\x45\124"); goto HmuoA; YqBpP: $res = $this->http($url); goto X0jbW; HmuoA: $arg = array_merge($params, ["\163\156" => $sn]); goto XedaL; POTwJ: $params = array("\141\x64\144\162\x65\163\x73" => $address, "\153\145\x79" => "\x56\112\x50\102\x5a\55\x53\x41\115\103\66\x2d\131\x32\62\x53\x43\55\x4d\x4b\x35\130\113\55\116\107\x58\x4b\106\55\116\113\x46\x34\x4f"); goto XBncb; qxPP0: if (!($res && isset($res["\163\x74\x61\164\165\163"]) && $res["\163\164\141\x74\x75\x73"] == 0)) { goto DvkST; } goto AUI4J; gcrzV: DvkST: goto Ps3F1; aYR1A: return [$lnglat["\x6c\156\147"], $lnglat["\154\141\164"]]; goto gcrzV; YEmtw: } public function getDistanceFromAddressApi() { goto y_OnC; xwK9B: $amount = $this->get("\141\155\157\x75\x6e\164"); goto bQ3o6; bVLId: goto EVxZS; goto djNoj; kOOsa: if ($lnglat === false) { goto mh7Au; } goto gS0xB; y_OnC: $address = $this->get("\141\x64\x64\162\145\x73\163"); goto chMOX; TNsp5: $res = ["\x64\151\x73\x74\162\151\x62\165\x74\x69\x6f\x6e" => \App\Model\Distribution::instance()->max("\143\x6f\x73\164"), "\151\x73\x5f\145\156\141\142\x6c\145" => true]; goto gW9Fz; OgQtD: $lnglat = $this->getLngLatFromAddress($address); goto kOOsa; bQ3o6: $store_id = $this->get("\x73\164\157\162\x65\137\151\x64"); goto OgQtD; M39Uh: $address = substr($address, 0, $pos1); goto n_CLc; zyLix: if ($distribution == -1) { goto OoLWL; } goto pPCVe; n_CLc: Q1cyE: goto xwK9B; gW9Fz: hMCM1: goto UxZ2D; BduzU: EVxZS: goto Kldpk; Kldpk: goto hMCM1; goto mXcJC; chMOX: $pos1 = strpos($address, "\50"); goto CI3d9; djNoj: OoLWL: goto ERQiu; gS0xB: $distribution = $this->getDistAmount($store_id, $amount, $lnglat); goto CVi3p; pPCVe: $res = ["\x64\x69\x73\164\162\x69\142\165\x74\151\x6f\x6e" => $distribution, "\x69\163\x5f\145\156\141\142\154\145" => true, "\144\x69\x73\x74\x61\x6e\x63\145" => $distance, "\154\156\x67" => $lnglat[0], "\x6c\141\x74" => $lnglat[1]]; goto bVLId; UxZ2D: return $this->success($res); goto lx1Zu; ERQiu: $res = ["\x64\151\x73\164\162\x69\x62\165\164\x69\157\156" => 0, "\151\x73\x5f\x65\x6e\x61\142\154\x65" => false, "\144\x69\x73\164\x61\x6e\x63\145" => $distance, "\x6c\156\x67" => $lnglat[0], "\x6c\141\x74" => $lnglat[1]]; goto BduzU; CVi3p: $distance = $this->getStoreDistance($store_id, $lnglat); goto zyLix; mXcJC: mh7Au: goto TNsp5; CI3d9: if (!($pos1 !== false)) { goto Q1cyE; } goto M39Uh; lx1Zu: } } goto gqUmK; dI3Dx: trait Test { function testApi() { goto sNaVw; xekzf: $list = $query->from("\171\172\x62\154\x64\x5f\x73\x75\x6e\137\163\x74\157\x72\x65\x73")->where("\x75\156\x69\141\x63\151\x64", $this->uniacid)->getall(); goto Kaf31; Kaf31: var_dump($list); goto MTtwh; sNaVw: $query = load()->object("\x71\165\x65\162\x79"); goto xekzf; MTtwh: } }