<?php
 namespace think\queue; use Exception; use think\Hook; use think\Queue; class Worker { public function pop($queue = null, $delay = 0, $sleep = 3, $maxTries = 0) { goto AMwBG; j7i3B: return $this->process($job, $maxTries, $delay); goto sU3hI; lVxbo: if (is_null($job)) { goto wjd1I; } goto T5UJw; cIKCC: Hook::listen("\x77\157\x72\153\145\x72\x5f\142\145\x66\x6f\162\x65\x5f\163\154\x65\145\160", $queue); goto q4MpA; q4MpA: $this->sleep($sleep); goto j7ygs; j7ygs: return ["\x6a\x6f\142" => null, "\x66\141\151\x6c\x65\144" => false]; goto dDJmG; AMwBG: $job = $this->getNextJob($queue); goto lVxbo; T5UJw: Hook::listen("\x77\157\162\153\145\162\x5f\142\x65\146\x6f\162\x65\137\160\162\x6f\143\x65\163\163", $queue); goto j7i3B; sU3hI: wjd1I: goto cIKCC; dDJmG: } protected function getNextJob($queue) { goto z7OQO; qfFSX: return Queue::pop(); goto dSk2f; z7OQO: if (!is_null($queue)) { goto hCYh0; } goto qfFSX; pbSnA: foreach (explode("\x2c", $queue) as $queue) { goto UKdHe; UKdHe: if (is_null($job = Queue::pop($queue))) { goto vU_uu; } goto oAGcy; riULu: vU_uu: goto bxatF; bxatF: oQWRv: goto MFkFW; oAGcy: return $job; goto riULu; MFkFW: } goto yRCNZ; dSk2f: hCYh0: goto pbSnA; yRCNZ: wrUXF: goto FLsq2; FLsq2: } public function process(Job $job, $maxTries = 0, $delay = 0) { goto lq0ET; i6h8H: try { $job->fire(); return ["\x6a\x6f\142" => $job, "\x66\x61\x69\154\145\144" => false]; } catch (Exception $e) { goto iRWoC; Q7BkQ: throw $e; goto zBL14; yRDcX: xBRn8: goto Q7BkQ; iRWoC: if ($job->isDeleted()) { goto xBRn8; } goto uSfAD; uSfAD: $job->release($delay); goto yRDcX; zBL14: } goto rcs6x; hJApC: return $this->logFailedJob($job); goto oMCud; oMCud: F8hin: goto i6h8H; lq0ET: if (!($maxTries > 0 && $job->attempts() > $maxTries)) { goto F8hin; } goto hJApC; rcs6x: } protected function logFailedJob(Job $job) { goto Op21s; TzL67: return ["\x6a\x6f\x62" => $job, "\x66\141\x69\154\x65\x64" => true]; goto DLOgN; XB_CD: Bt6fs: goto TzL67; rfdd6: try { $job->delete(); $job->failed(); } finally { Hook::listen("\161\x75\x65\x75\x65\137\x66\x61\151\x6c\145\144", $job); } goto XB_CD; Op21s: if ($job->isDeleted()) { goto Bt6fs; } goto rfdd6; DLOgN: } public function sleep($seconds) { sleep($seconds); } }