{extend name="common/edit" /}
{block name="content"}

<div class="layui-form-item">
    <label class="layui-form-label">所属商圈</label>
    <div class="layui-input-block">
        <select name="district_id" id="district_id" class="select2" lay-verify="required" lay-ignore></select>
    </div>
</div>



<div class="layui-form-item">
    <label class="layui-form-label">所属分类</label>
    <div class="layui-input-block">
        <select name="cat_id" id="cat_id" class="select2" lay-verify="required" lay-ignore></select>
    </div>
</div>

{if !$info['id']}
<div class="layui-form-item">
    <label class="layui-form-label">所属用户</label>
    <div class="layui-input-block">
        <select name="user_id" id="user_id" class="select2" lay-verify="required" lay-ignore></select>
    </div>
</div>
<input type="hidden" name="check_status" value="2">
{/if}


<div class="layui-form-item">
    <label class="layui-form-label">商户名称</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="name" lay-verify="required" placeholder="请输入门店名称" class="layui-input" value="{$info.name??''}">
    </div>
</div>
<div class="layui-form-item">
    <label class="layui-form-label">联系人</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="contact" placeholder="请输入联系人" class="layui-input" value="{$info.contact??''}">
    </div>
</div>
<div class="layui-form-item">
    <label class="layui-form-label">联系电话</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="tel" placeholder="请输入联系电话" class="layui-input" value="{$info.tel??''}">
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">商家手机</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="phone" placeholder="请输入商家手机" class="layui-input" value="{$info.phone??''}">
    </div>
</div>
<!--<div class="layui-form-item">-->
    <!--<label class="layui-form-label">微信号</label>-->
    <!--<div class="layui-input-block">-->
        <!--<input autocomplete="off" type="text" name="wechat_number" placeholder="请输入微信号" class="layui-input" value="{$info.wechat_number??''}">-->
    <!--</div>-->
<!--</div>-->

<div class="layui-form-item">
    <label class="layui-form-label">平台抽成比率</label>
    <div class="layui-input-inline">
        <input autocomplete="off" type="number" name="ptcc_rate" lay-verify="required" placeholder="平台抽成比率" class="layui-input" value="{$info.ptcc_rate??''}">%
    </div>
</div>
<!--
<div class="layui-form-item">
    <label class="layui-form-label">地址</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="address" placeholder="请输入地址" class="layui-input" value="{$info.address??''}">
    </div>
</div>-->
{if condition="$distributionset['store_setting'] eq 1 and $distributionset['level'] gt 0"}
<div class="layui-form-item">
    <label class="layui-form-label">是否开启分销</label>
    <div class="layui-input-block">
        <input type="radio" name="distribution_open" value="1" title="开启" {$info.distribution_open == 1 ?"checked":""}>
        <input type="radio" name="distribution_open" value="0" title="关闭" {$info.distribution_open == 0 ?"checked":""}>
    </div>
</div>

<div class="layui-form-item commissiontype">
    <label class="layui-form-label">分销佣金类型</label>
    <div class="layui-input-block">
        <input type="radio" name="commissiontype" value="1" title="百分比" {$info.commissiontype == 1||!$info.commissiontype ?"checked":""}>
        <input type="radio" name="commissiontype" value="2" title="固定金额" {$info.commissiontype == 2 ?"checked":""}>
    </div>
</div>

<div class="layui-form-item commission">
    <div class="layui-inline">
        <label class="layui-form-label">一级佣金</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="first_money" placeholder="" class="layui-input" value="{$info.first_money??''}">
            <label class="commissiontype_1">%</label><label class="commissiontype_2">元</label>
        </div>
    </div>
    {if condition="$distributionset['level'] gt 1"}
    <div class="layui-inline">
        <label class="layui-form-label">二级佣金</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="second_money" placeholder="" class="layui-input" value="{$info.second_money??''}">
            <label class="commissiontype_1">%</label><label class="commissiontype_2">元</label>
        </div>
    </div>
    {/if}
    {if condition="$distributionset['level'] gt 2"}
    <div class="layui-inline">
        <label class="layui-form-label">三级佣金</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="third_money" placeholder="" class="layui-input" value="{$info.third_money??''}">
            <label class="commissiontype_1">%</label><label class="commissiontype_2">元</label>
        </div>
    </div>
    {/if}
</div>
{/if}



<div class="layui-form-item">
    <label class="layui-form-label">logo</label>
    <div class="layui-input-block">
        {php}echo tpl_form_field_image('logo', isset($info['logo'])?$info['logo']:'','/web/resource/images/nopic.jpg');{/php}
        <div class="layui-form-mid layui-word-aux">建议尺寸：220*220</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">首页菜单图标</label>
    <div class="layui-input-block">
        {php}echo tpl_form_field_image('icon', isset($info['icon'])?$info['icon']:'','/web/resource/images/nopic.jpg');{/php}
        <div class="layui-form-mid layui-word-aux">建议尺寸：40*40</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">banner轮播图</label>
    <div class="layui-input-block">
        {php}echo tpl_form_field_multi_image('banner', isset($info['banner'])?$info['banner']:'');{/php}
        <div class="layui-form-mid layui-word-aux">建议尺寸：750*400</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">海报图</label>
    <div class="layui-input-block">
        {php}echo tpl_form_field_image('posterpic', isset($info['posterpic'])?$info['posterpic']:'','/web/resource/images/nopic.jpg');{/php}
        <div class="layui-form-mid layui-word-aux">建议尺寸：750*1330，不上传则自动生成显示默认海报</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">详情二维码</label>
    <div class="layui-input-block">
        {php}echo tpl_form_field_image('detail_qrcode',$info['detail_qrcode']);{/php}
        <div class="layui-form-mid layui-word-aux">建议尺寸：500*500，</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">营业时间</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="business_range" id="business_range" placeholder=" - " class="layui-input" value="{$info.business_range??''}">
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">星级</label>
    <div class="layui-input-block">
        <select name="star" id="star" class="select2" lay-verify="required" lay-ignore></select>
    </div>
</div>

<div class="layui-form-item ytx253">
    <label class="layui-form-label">服务设施</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="service"  placeholder="" class="layui-input" value="{$info.service??''}">
        <div class="layui-form-mid layui-word-aux"> *多个服务设施用 用逗号,隔开 例 刷卡支付,停车</div>
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">人均消费</label>
    <div class="layui-input-block">
        <input autocomplete="off" type="text" name="per_consumption" lay-verify="required" placeholder="请输入人均消费(单位元)" class="layui-input" value="{$info.per_consumption??''}">
    </div>
</div>

<div class="layui-form-item">
    <label class="layui-form-label">过期时间</label>
    <div class="layui-input-block">
        <input type="text" class="layui-input" id="end_time" lay-verify="required" readonly="readonly" name="end_time" placeholder="yyyy-MM-dd HH:mm:ss" value="{$info.end_time}">
    </div>
</div>
<!--
<div class="layui-form-item">
    <label class="layui-form-label">商家介绍</label>
    <div class="layui-input-block">
        <textarea name="detail" placeholder="请输入介绍" class="layui-textarea">{$info.detail??''}</textarea>
    </div>
</div>-->

<div class="layui-form-item">
    <label class="layui-form-label">商家推荐</label>
    <div class="layui-input-block">
        <input type="radio" name="is_recommend" value="1" title="推荐" {$info.is_recommend == 1 ?"checked":""}>
        <input type="radio" name="is_recommend" value="0" title="取消" {$info.is_recommend == 0 ?"checked":""}>
    </div>
</div>


<div class="layui-form-item">
    <label class="layui-form-label">品质商家</label>
    <div class="layui-input-block">
        <input type="radio" name="quality_status" value="1" title="是" {$info.quality_status == 1 ?"checked":""}>
        <input type="radio" name="quality_status" value="0" title="否" {$info.quality_status == 0 ?"checked":""}>
    </div>
</div>




{include file='common/locationchoosestore'/}

<div class="layui-form-item">
    <label class="layui-form-label">商店介绍</label>
    <div class="layui-input-block">
        {php}echo tpl_ueditor('details', $info['details']);{/php}
    </div>
</div>


<script>
    layui.use('laydate',function () {
        var laydate = layui.laydate;
        laydate.render({
            elem: '#end_time'
            ,type: 'datetime'
            ,format: 'yyyy-MM-dd HH:mm:ss'
        });
    })
    require(['select2'], function () {
        $('.select2').select2();

        //广告类型
        var ret = [
            {id:1,text:'首页轮播图'},
            {id:2,text:'首页中部广告'},
        ];
        ret.unshift({id: '', text: '请选择类型'});
        ret.map(function (obj) {
            obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
            if(obj.id == "{$info.type??''}"){
                obj.selected = true;
            }
            return obj;
        });
        $('#type').select2({
            data: ret,
        })

        var star=[
            {id:1,text:'一星'},
            {id:2,text:'二星'},
            {id:3,text:'三星'},
            {id:4,text:'四星'},
            {id:5,text:'五星'},
        ]
        star.map(function (obj) {
            obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
            if(obj.id == "{$info.star??''}"){
                obj.selected = true;
            }
            return obj;
        });
        $('#star').select2({
            data: star,
        })

        //商圈
        $.get("{:adminurl('selectrules','Cstoredistrict')}", function (ret) {
            if (typeof ret == "string") {
                ret = JSON.parse(ret);
            }
            ret.unshift({id: '', text: '请选择商圈'});
            ret.map(function (obj) {
                obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
                if (obj.id == "{$info.district_id??''}") {
                    obj.selected = true;
                }
                return obj;
            });
            $('#district_id').select2({
                data: ret,
            })
        })
        //分类
        $.get("{:adminurl('selectrules','Cstorecategory')}", function (ret) {
            if (typeof ret == "string") {
                ret = JSON.parse(ret);
            }
            ret.unshift({id: '', text: '请选择分类'});
            ret.map(function (obj) {
                obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
                if (obj.id == "{$info.cat_id??''}") {
                    obj.selected = true;
                }
                return obj;
            });
            $('#cat_id').select2({
                data: ret,
            })
        })
        //用户
        $.get("{:adminurl('selectrules','Cuser')}", function (ret) {
            if (typeof ret == "string") {
                ret = JSON.parse(ret);
            }
            ret.unshift({id: '', text: '请选择用户'});
            ret.map(function (obj) {
                obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
                if (obj.id == "{$info.user_id??''}") {
                    obj.selected = true;
                }
                return obj;
            });
            $('#user_id').select2({
                data: ret,
            })
        })


        layui.use('laydate',function () {
            var laydate = layui.laydate;
            laydate.render({
                elem: '#business_range'
                ,type: 'time'
                ,range: true
            });
        })

        setcommissiontypeshow();
        setdistribution_openshow();
        function setcommissiontypeshow(){
            var  commissiontype= $('[name=commissiontype]:checked').val();
            if(commissiontype==1){
                $('.commissiontype_1').show();
                $('.commissiontype_2').hide();
            }else if(commissiontype==2){
                $('.commissiontype_1').hide();
                $('.commissiontype_2').show();
            }else{
                $('.commissiontype_1').hide();
                $('.commissiontype_2').hide();
            }
        }
        function setdistribution_openshow(){
            var distribution_open= $('[name=distribution_open]:checked').val();
            if(distribution_open==0){
                $('.commissiontype').hide();
                $('.commission').hide();
            }else if(distribution_open==1){
                $('.commissiontype').show();
                $('.commission').show();
            }
        }
        layui.use(['table','form'],function () {
            var table = layui.table;
            var form = layui.form;
            form.on('radio', function (data) {
                if ($(data.elem).is('[name=commissiontype]')) {
                    setcommissiontypeshow();
                }
                if ($(data.elem).is('[name=distribution_open]')) {
                    setdistribution_openshow();
                }
            });
        })

    })
</script>
{/block}