{extend name="common/editnosub" /}
{block name="content"}

<form class="layui-form" method="post" action="{:adminurl('save')}&modelName=Freesheet">
    <input type="hidden" name="id" value="{$info.id??''}">
    <div class="layui-form-item">
        <label class="layui-form-label">所属商家</label>
        <div class="layui-input-block">
            <select name="store_id" id="store_id" class="select2" lay-verify="required" lay-ignore></select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">商品分类</label>
        <div class="layui-input-block">
            <select name="cat_id" id="cat_id" class="select2" lay-ignore></select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">商品名称</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="name" lay-verify="required" placeholder="请输入商品名称" class="layui-input" value="{$info.name??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">封面图</label>
        <div class="layui-input-block">
            {php}echo tpl_form_field_image('pic', isset($info['pic'])?$info['pic']:'','/web/resource/images/nopic.jpg');{/php}
            <div class="layui-form-mid layui-word-aux">建议尺寸：340*340</div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">轮播图</label>
        <div class="layui-input-block">
            {php}echo tpl_form_field_multi_image('pics', isset($info['pics'])?$info['pics']:'');{/php}
            <div class="layui-form-mid layui-word-aux">建议尺寸：750*500</div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">活动推荐图</label>
        <div class="layui-input-block">
            {php}echo tpl_form_field_image('indexpic', isset($info['indexpic'])?$info['indexpic']:'','/web/resource/images/nopic.jpg');{/php}
            <div class="layui-form-mid layui-word-aux">建议尺寸：710*400</div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">开奖人数</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="number" name="allnum"  min="1" class="layui-input" value="{$info.allnum??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">分享可获得抽奖码次数</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="number" name="share_num" placeholder="0为不限量" min="0" class="layui-input" value="{$info.share_num??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">仅限会员参与</label>
        <div class="layui-input-block">
            <input type="radio" name="only_vip" value="1" title="开启" {$info.only_vip == 1 ?"checked":""}>
            <input type="radio" name="only_vip" value="0" title="关闭" {$info.only_vip == 0 ?"checked":""}>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">开奖方式</label>
        <div class="layui-input-block">
            <input type="radio" name="auto_lottery" value="1" title="自动开奖" {$info.auto_lottery !== 2 ?"checked":""}>
            <input type="radio" name="auto_lottery" value="0" title="手动开奖" {$info.auto_lottery == 2 ?"checked":""}>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">开始时间</label>
            <div class="layui-input-block">
                <input type="text" name="start_time" id="start_time" value="{$info.start_time}" placeholder="yyyy-MM-dd"
                       autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">结束时间</label>
            <div class="layui-input-block">
                <input type="text" name="end_time" id="end_time" value="{$info.end_time}" placeholder="yyyy-MM-dd"
                       autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">开奖时间</label>
            <div class="layui-input-block">
                <input type="text" name="lottery_time" id="lottery_time" value="{$info.lottery_time}"
                       placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">消费截止时间</label>
            <div class="layui-input-block">
                <input type="text" name="expire_time" id="expire_time" value="{$info.expire_time}"
                       placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label"></label>
            <div class="layui-form-mid layui-word-aux">* 开始时间 < 结束时间 < 开奖时间 < 消费截止时间</div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">虚拟关注数</label>
            <div class="layui-input-block">
                <input autocomplete="off" type="number" min="0" name="read_num_virtual" class="layui-input" value="{$info.read_num_virtual??''}">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">商品详情</label>
        <div class="layui-input-block">
            {php}echo tpl_ueditor('details', $info['details']);{/php}
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit="">立即提交</button>
            <button class="layui-btn layui-btn-primary" id="btnCancel">取消</button>
        </div>
    </div>
</form>

<script>
    //JavaScript代码区域
    layui.use(['element','form','laydate'], function(){
        var element = layui.element;
        var form = layui.form;
        var laydate = layui.laydate;
        laydate.render({
            elem: '#end_time'
            , type: 'datetime'
            , format: 'yyyy-MM-dd HH:mm:ss'
        });
        laydate.render({
            elem: '#start_time'
            , type: 'datetime'
            , format: 'yyyy-MM-dd HH:mm:ss'
        });
        laydate.render({
            elem: '#expire_time'
            , type: 'datetime'
            , format: 'yyyy-MM-dd HH:mm:ss'
        });
        laydate.render({
            elem: '#lottery_time'
            , type: 'datetime'
            , format: 'yyyy-MM-dd HH:mm:ss'
        });
        // 新增界面、保存、取消事件
        form.on('submit', function(data){
            if(!$(data.elem).is('button')){
                return false;
            }
            var data = data.field;
            console.log(data);
            var url = "{:adminurl('save')}&modelName=Freesheet";
            $.post(url,data,function(res){
                if (typeof res == 'string'){
                    res = $.parseJSON(res);
                }
                if (res.code == 0) {
                    var index=parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                    parent.layer.msg('保存成功',{icon: 6,anim: 6});
                    parent.layui.table.reload('laytable',{});
                }else{
                    layer.msg(res.msg,{icon: 5,anim: 6});
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
        $('#btnCancel').click(function(e){
            var index=parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    })
</script>
<script>
    require(['select2'], function () {
        $('.select2').select2();
        $.get("{:adminurl('selectrules','Cstore')}", function (ret) {
            if (typeof ret == "string"){
                ret = JSON.parse(ret);
            }
            ret.map(function (obj) {
                obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
                if(obj.id == "{$info.id??''}"){
                    obj.selected = true;
                }
                return obj;
            });
            $('#store_id').select2({
                data: ret,
            })
        })
    })
    require(['select2'], function () {
        $('.select2').select2();
        $.get("{:adminurl('select','ccategory')}", function (ret) {
            if (typeof ret == "string"){
                ret = JSON.parse(ret);
            }
            ret.unshift({id: '', text: '请选择分类'});
            ret.map(function (obj) {
                obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
                if(obj.id == "{$info.cat_id??''}"){
                    obj.selected = true;
                }
                return obj;
            });
            $('#cat_id').select2({
                data: ret,
            })
        })
    })
</script>
{/block}
{/block}