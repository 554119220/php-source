<?php
 goto IQPNN; q9oz1: class Online { public $token, $uniacid; public function __construct($token, $uniacid, $appid) { goto Xtozo; xXCr4: $this->uniacid = $uniacid; goto j75nB; Xtozo: $this->token = $token; goto xXCr4; j75nB: $this->appid = $appid; goto tKdjt; tKdjt: } public function check_server() { goto Zzmpm; Zzmpm: if (isset($_GET["\x65\x63\x68\157\x73\164\x72"])) { goto nzP6E; } goto upxcY; upxcY: $this->responseMsg(); goto pBE3Y; vzzKz: nzP6E: goto PSr7l; Sf7Dd: ryc_S: goto Br4S2; PSr7l: $this->valid(); goto Sf7Dd; pBE3Y: goto ryc_S; goto vzzKz; Br4S2: } public function valid() { goto xw7O0; swqJU: if ($this->checkSignature()) { goto xmVNy; } goto C0AAC; nro3v: exit; goto jozmS; baXyt: Gi7lj: goto xE6BO; xw7O0: $echoStr = $_GET["\145\x63\150\x6f\163\164\162"]; goto swqJU; jozmS: goto Gi7lj; goto qry9T; S_5Ht: header("\x63\157\156\164\145\x6e\x74\55\164\x79\x70\145\72\x74\x65\170\x74"); goto ORJi2; qry9T: xmVNy: goto S_5Ht; C0AAC: echo $echoStr . "\53\53\53" . $this->token; goto nro3v; OplN7: exit; goto baXyt; ORJi2: echo $echoStr; goto OplN7; xE6BO: } private function checkSignature() { goto Ncp5P; i4l3O: goto EibLg; goto jc8P2; o2i4M: $tmpArr = array($token, $timestamp, $nonce); goto gpObZ; gpObZ: sort($tmpArr, SORT_STRING); goto YMQ8p; W6QZn: return true; goto IUhB2; YMQ8p: $tmpStr = implode($tmpArr); goto hs9Zv; nzqal: $timestamp = $_GET["\164\x69\x6d\x65\x73\x74\141\155\x70"]; goto mKAUw; fmXtY: if ($tmpStr == $signature) { goto lL6VZ; } goto R3vKJ; Ncp5P: $signature = $_GET["\x73\151\x67\x6e\x61\x74\x75\162\x65"]; goto nzqal; IYXDU: $token = $this->token; goto o2i4M; mKAUw: $nonce = $_GET["\156\157\x6e\x63\x65"]; goto IYXDU; hs9Zv: $tmpStr = sha1($tmpStr); goto fmXtY; R3vKJ: return false; goto i4l3O; jc8P2: lL6VZ: goto W6QZn; IUhB2: EibLg: goto axmS9; axmS9: } public function responseMsg() { goto k3rWo; k3rWo: $postStr = $GLOBALS["\x48\x54\124\120\x5f\x52\x41\x57\137\x50\x4f\123\124\137\x44\101\x54\x41"]; goto xdSi5; dJ7km: echo "\x73\165\143\x63\145\x73\163"; goto eyT1H; w1N5f: AWPna: goto WsTcc; aaDTJ: B8MCE: goto Zh8U9; pszu2: EcNdE: goto SnzJ1; Cbncg: if (!empty($postArr["\115\163\147\x54\171\x70\145"]) && $postArr["\x4d\x73\147\124\x79\x70\145"] == "\x74\145\170\164") { goto OH63v; } goto e_mZK; SnzJ1: $postArr = json_decode($postStr, true); goto Cbncg; XkyqS: $data["\x6f\160\x65\x6e\x69\144"] = $postArr["\106\x72\157\155\x55\x73\x65\x72\x4e\141\x6d\145"]; goto Kf4Dm; hIhfb: goto J5j9N; goto w1N5f; oLa6Y: OH63v: goto QvLLf; UrinL: $data["\143\x6f\156\x74\145\x6e\x74"] = $postArr["\120\x69\143\x55\162\154"]; goto fxQT4; WkYz_: $this->checkOnline($data); goto Kcn_B; WsTcc: $data["\x75\156\151\141\143\151\x64"] = $this->uniacid; goto aX7Gy; e_mZK: if (!empty($postArr["\x4d\x73\147\124\x79\x70\x65"]) && $postArr["\x4d\163\x67\x54\171\x70\x65"] == "\151\x6d\x61\147\x65") { goto AWPna; } goto w_bkS; QvLLf: $data["\165\156\x69\x61\x63\x69\x64"] = $this->uniacid; goto XkyqS; vpPda: goto B8MCE; goto pszu2; fxQT4: $this->checkOnline($data); goto lbOLg; nxg3R: $data["\x74\x79\160\x65"] = 2; goto UrinL; aX7Gy: $data["\157\160\145\156\x69\144"] = $postArr["\x46\162\157\155\125\163\x65\x72\116\141\155\145"]; goto nxg3R; un2in: goto gNyf3; goto BXAWB; xdSi5: if (!empty($postStr) && is_string($postStr)) { goto EcNdE; } goto nEiQn; Kcn_B: cT42d: goto dJ7km; HJR_T: exit; goto vpPda; Kf4Dm: $data["\164\171\160\145"] = 1; goto yobaL; nEiQn: echo ''; goto HJR_T; ZDyf1: gNyf3: goto hIhfb; eyT1H: exit; goto aaDTJ; lbOLg: J5j9N: goto WXNVS; WXNVS: goto cT42d; goto oLa6Y; BXAWB: vFAb2: goto ZDyf1; w_bkS: if ($postArr["\115\x73\147\124\171\160\x65"] == "\145\166\145\x6e\164" && $postArr["\x45\166\x65\x6e\164"] == "\165\163\145\x72\137\145\156\164\145\x72\137\164\145\x6d\160\x73\x65\163\x73\x69\x6f\x6e") { goto vFAb2; } goto un2in; yobaL: $data["\x63\157\156\164\x65\x6e\x74"] = base64_encode($postArr["\x43\x6f\156\x74\145\156\164"]); goto WkYz_; Zh8U9: } public function checkOnline($data) { goto HTjRg; MyYwS: zeytV: goto KuCb3; Aftrj: tuDUe: goto hVeW6; nHygj: KGWfW: goto ywG4f; DIVoC: goto CGEa2; goto nHygj; Vy6Vx: $config["\x63\x6f\x6e\x74\145\156\164"] = json_decode($config["\143\157\156\x74\x65\156\x74"], true); goto DhZNe; k_rMe: if (!$config) { goto a9ild; } goto Vy6Vx; vR8xt: if (!$request) { goto mP90O; } goto PONGw; dhAQi: $data["\x70\151\144"] = pdo_insertid(); goto acR1n; HTjRg: $online = pdo_get("\170\143\137\x66\x61\x72\x6d\x5f\157\x6e\154\x69\156\x65", array("\165\x6e\151\x61\x63\151\144" => $data["\x75\156\151\x61\143\151\144"], "\157\160\x65\x6e\x69\x64" => $data["\x6f\160\x65\156\151\144"])); goto gG0ov; KUuZK: if (!(time() - strtotime($prev[0]["\143\x72\145\141\x74\x65\x74\x69\x6d\x65"]) >= intval($config["\143\157\156\x74\x65\x6e\x74"]["\x6a\151\141\156\x67\x65"]))) { goto wjXA7; } goto k3ut_; bDOjj: H_RMK: goto zaowZ; vapqt: pdo_query($sql, array("\x3a\x74\151\155\145\163" => date("\x59\55\x6d\x2d\x64\x20\x48\72\x69\x3a\x73"), "\72\151\144" => $online["\x69\x64"], "\x3a\x75\156\151\141\143\x69\x64" => $data["\165\x6e\x69\x61\x63\151\x64"], "\x3a\x74\171\x70\x65" => $data["\x74\171\160\145"], "\72\x63\x6f\156\164\145\156\x74" => $data["\x63\157\x6e\x74\145\x6e\164"])); goto v2Jtp; sS60M: CGEa2: goto ZqKoR; rIv6u: $request = pdo_insert("\x78\143\137\x66\x61\162\155\x5f\x6f\x6e\x6c\151\x6e\145", array("\165\x6e\x69\141\143\151\144" => $data["\165\156\x69\141\x63\151\144"], "\157\160\145\x6e\x69\144" => $data["\x6f\160\x65\156\151\x64"], "\x6d\x65\x6d\142\x65\x72" => 1, "\x75\x70\x64\141\164\x65\x74\151\155\145" => date("\x59\x2d\x6d\x2d\x64\x20\x48\x3a\151\72\163"), "\x74\x79\x70\145" => $data["\164\171\x70\145"], "\143\x6f\x6e\x74\145\x6e\164" => $data["\143\x6f\x6e\x74\145\156\x74"], "\x63\x72\145\x61\164\145\164\x69\x6d\145" => date("\x59\55\x6d\55\x64\40\110\72\x69\x3a\163"))); goto qOmF6; DhZNe: if (empty($config["\x63\157\156\164\x65\156\164"]["\x6a\x69\141\x6e\147\145"])) { goto H_RMK; } goto KUuZK; t8QL4: pdo_insert("\x78\143\x5f\x66\x61\162\x6d\137\x6f\x6e\154\151\156\x65\137\x6c\157\147", $data); goto PFqmP; DD92H: if ($prev) { goto KGWfW; } goto emiZK; PFqmP: $this->sendMon($data); goto RCY1Z; emiZK: $this->sendMon($data); goto DIVoC; zaowZ: a9ild: goto sS60M; HtGCz: wjXA7: goto bDOjj; PONGw: $sql = "\x55\x50\x44\101\x54\x45\x20" . tablename("\x78\x63\137\x66\141\x72\x6d\x5f\157\x6e\154\151\156\x65") . "\x20\x53\105\x54\x20\155\x65\x6d\142\145\162\x3d\x6d\145\155\x62\x65\x72\53\61\54\165\x70\144\x61\164\145\164\151\155\145\75\72\x74\x69\155\145\x73\54\164\171\160\x65\75\x3a\x74\x79\160\x65\x2c\143\x6f\x6e\164\145\x6e\164\75\72\143\157\x6e\x74\145\x6e\164\40\127\110\x45\x52\x45\40\x69\144\75\x3a\x69\144\40\x41\x4e\x44\x20\165\x6e\151\x61\x63\x69\x64\75\72\165\x6e\151\141\143\x69\144"; goto vapqt; RCY1Z: ukbH0: goto m2aOW; hICnE: $request = pdo_insert("\x78\x63\137\x66\141\x72\x6d\x5f\157\x6e\x6c\151\x6e\x65\137\x6c\x6f\147", $data); goto vR8xt; ywG4f: $config = pdo_get("\170\143\137\x66\x61\x72\155\137\143\157\156\x66\x69\x67", array("\x78\153\x65\171" => "\x6f\x6e\154\151\156\x65", "\165\x6e\151\141\143\x69\x64" => $this->uniacid)); goto k_rMe; m2aOW: goto zeytV; goto Aftrj; hVeW6: $data["\x70\151\144"] = $online["\x69\144"]; goto EaBwj; ZqKoR: mP90O: goto MyYwS; acR1n: $data["\143\x72\145\141\164\145\164\x69\x6d\x65"] = date("\x59\55\x6d\55\144\40\x48\72\x69\x3a\163"); goto t8QL4; v2Jtp: $prev = pdo_getall("\x78\143\x5f\146\141\x72\155\137\157\156\154\x69\x6e\x65\x5f\x6c\157\147", array("\x75\x6e\x69\141\x63\151\x64" => $data["\165\x6e\151\141\x63\151\x64"], "\160\151\144" => $data["\x70\151\144"], "\144\x75\x74\x79" => 2), array(), '', "\143\x72\145\x61\164\145\164\x69\155\x65\40\104\105\123\x43\54\151\x64\x20\104\105\123\103", array(1, 5)); goto DD92H; gG0ov: if ($online) { goto tuDUe; } goto rIv6u; EaBwj: $data["\143\x72\145\x61\x74\x65\x74\151\155\145"] = date("\131\x2d\155\x2d\144\40\110\72\x69\72\163"); goto hICnE; k3ut_: $this->sendMon($data); goto HtGCz; qOmF6: if (!$request) { goto ukbH0; } goto dhAQi; KuCb3: } public function sendMon($data) { goto nvTtr; lhPMk: momessv2($accessurl, $template, $sendopenid, $templateParam); goto R323F; paw91: $web = pdo_get("\x78\143\137\146\141\x72\155\137\143\157\156\146\x69\147", array("\x78\153\x65\x79" => "\167\x65\142", "\165\x6e\x69\141\x63\x69\x64" => $this->uniacid)); goto HXoUJ; y_jQQ: $sendopenid = array(); goto xBvSQ; vKwdo: $config = pdo_get("\170\x63\x5f\146\141\162\155\x5f\143\x6f\156\146\x69\147", array("\x78\153\x65\171" => "\157\x6e\x6c\151\156\145", "\165\x6e\x69\141\143\x69\x64" => $this->uniacid)); goto S84V2; hLtBV: $web["\143\x6f\x6e\164\145\156\x74"] = json_decode($web["\x63\157\156\164\x65\x6e\164"], true); goto z5KkY; wuJ0g: Qg0UP: goto NEMSK; aiIb0: $template["\144\x61\164\141"] = $config["\x63\157\156\x74\x65\x6e\x74"]["\x64\141\x74\x61"]; goto bTaT0; KZZz0: $token = $account_api->getAccessToken(); goto RBYd3; rQfEt: r3Tab: goto Jh0fD; fWbjX: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto p3a32; vt0Dp: RTqC9: goto Og8KS; JFb0l: if (!($data["\x74\x79\x70\x65"] == 2)) { goto GtjpU; } goto cwwaB; bTaT0: $openids = $config["\143\157\x6e\x74\x65\x6e\164"]["\165\x73\x65\162\154\x69\x73\164"]; goto y_jQQ; MoJTH: qVwAO: goto wuJ0g; Og8KS: Jvr_k: goto rQfEt; nLmcI: $web = pdo_get("\170\143\x5f\x66\x61\162\x6d\x5f\x63\x6f\156\x66\151\x67", array("\170\x6b\x65\x79" => "\167\x65\142", "\x75\156\151\x61\x63\x69\144" => $data["\x75\x6e\151\141\143\151\x64"])); goto WZlgt; RBYd3: $url = "\150\x74\x74\160\163\72\57\57\x61\160\151\x2e\x77\x65\x69\x78\x69\x6e\56\161\x71\56\x63\157\x6d\x2f\x63\x67\151\x2d\142\x69\x6e\57\155\145\x73\x73\141\x67\x65\x2f\x63\165\x73\x74\x6f\155\57\x73\x65\156\x64\x3f\x61\143\143\145\x73\x73\x5f\x74\x6f\x6b\145\x6e\75" . $token; goto pLqfG; F6N67: hpSMt: goto r0tep; oFOsc: $pdata = curl_exec($ch); goto cvb9y; pLqfG: $data = array("\x74\157\165\163\x65\x72" => $data["\x6f\160\x65\x6e\x69\x64"], "\155\163\x67\x74\171\160\145" => "\164\145\170\164", "\164\x65\x78\164" => array("\143\x6f\x6e\x74\x65\x6e\164" => $config["\x63\157\156\x74\145\156\164"]["\x72\145\160\154\171\x5f\x63\157\156\164\145\x6e\x74"])); goto ak_FD; H5B1m: goto uBqxX; goto F6N67; ojhHB: if (!($userinfo && !empty($userinfo["\156\151\143\153"]))) { goto jVvgT; } goto Ts8I3; NEMSK: $userinfo = pdo_get("\x78\143\137\x66\141\162\x6d\x5f\x75\163\145\162\x69\x6e\146\x6f", array("\165\156\x69\141\143\151\x64" => $this->uniacid, "\157\x70\x65\x6e\x69\x64" => $data["\x6f\160\x65\156\x69\144"])); goto ojhHB; S84V2: if (!$config) { goto r3Tab; } goto iLSwo; wPgdF: $templateParam["\x77\145\142\156\141\x6d\x65\170"] = $web["\143\x6f\156\x74\145\156\164"]["\x77\145\x62\x6e\x61\x6d\x65"]; goto MoJTH; uNLf6: curl_setopt($ch, CURLOPT_URL, $url); goto i0aAI; z5KkY: JW_hK: goto DDSZ4; i0aAI: curl_setopt($ch, CURLOPT_HEADER, 0); goto mAC_0; G4MUl: if (empty($config["\143\157\x6e\x74\145\156\x74"])) { goto Jvr_k; } goto nLmcI; p3a32: curl_setopt($ch, CURLOPT_POST, true); goto YhQb6; tQjw8: uBqxX: goto lhPMk; njusL: if ($data["\x74\171\160\145"] == 1) { goto hpSMt; } goto JFb0l; KJjPe: yL7oK: goto paw91; LUy2O: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto fWbjX; JU0FQ: $ch = curl_init(); goto uNLf6; mAC_0: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto LUy2O; df055: $account_api = WeAccount::create(); goto KZZz0; xMPkG: GtjpU: goto H5B1m; WZlgt: if (!$web) { goto JW_hK; } goto hLtBV; DDSZ4: $accessurl = $web["\143\157\156\x74\145\x6e\164"]["\x78\143\x6d\145\163\163\x61\147\x65"] . "\46\x6f\160\x3d\163\145\x6e\x64\x76\x32"; goto udnND; xBvSQ: foreach ($openids as $itemopenis) { $sendopenid[] = $itemopenis["\x6f\x70\145\156\151\144"]; i7cDF: } goto KJjPe; YhQb6: curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); goto oFOsc; Au6jX: if (!(!empty($web["\x63\x6f\156\164\145\156\x74"]) && !empty($web["\x63\x6f\x6e\x74\x65\x6e\164"]["\167\145\142\x6e\141\x6d\x65"]))) { goto qVwAO; } goto wPgdF; Q0lt0: $web["\x63\x6f\156\164\145\156\x74"] = json_decode($web["\143\157\156\164\x65\156\164"], true); goto Au6jX; cwwaB: $templateParam["\x63\157\156\164\145\x6e\164"] = "\345\233\xbe\347\x89\x87"; goto xMPkG; HXoUJ: if (!$web) { goto Qg0UP; } goto Q0lt0; ak_FD: $postFields = json_encode($data, JSON_UNESCAPED_UNICODE); goto JU0FQ; nvTtr: $templateParam = array("\167\x65\142\156\141\x6d\145\170" => "\346\227\xa0", "\156\151\143\153" => "\346\227\240", "\143\x6f\156\164\x65\x6e\164" => "\xe6\227\240", "\x61\x70\160\x69\x64" => $this->appid, "\x70\141\x67\x65" => "\x78\143\137\146\141\x72\155\x2f\160\141\147\x65\x73\57\157\x6e\x6c\x69\x6e\145\57\x69\x6e\144\x65\x78"); goto vKwdo; r0tep: $templateParam["\143\x6f\x6e\x74\145\156\164"] = base64_decode($data["\143\x6f\156\x74\145\x6e\x74"]); goto tQjw8; vV78i: jVvgT: goto njusL; udnND: $template = $config["\x63\x6f\x6e\x74\145\156\164"]["\170\x63"]; goto aiIb0; Ts8I3: $templateParam["\156\x69\x63\153"] = base64_decode($userinfo["\156\x69\143\153"]); goto vV78i; iLSwo: $config["\143\x6f\x6e\164\x65\x6e\x74"] = json_decode($config["\143\x6f\x6e\x74\x65\156\164"], true); goto G4MUl; R323F: if (!($config["\143\x6f\x6e\164\145\x6e\x74"]["\x72\x65\160\154\x79\137\x73\164\x61\x74\165\x73"] == 1 && !empty($config["\143\157\x6e\x74\x65\x6e\x74"]["\x72\145\160\x6c\x79\x5f\x63\157\x6e\164\145\156\164"]))) { goto RTqC9; } goto df055; cvb9y: curl_close($ch); goto vt0Dp; Jh0fD: } } goto CjCS4; Haa78: oT4aj: goto DpCqM; etEyS: if (!(!empty($config["\x63\x6f\156\x74\145\x6e\164"]) && !empty($config["\143\157\x6e\164\x65\156\164"]["\x74\x6f\153\145\x6e"]))) { goto oT4aj; } goto HAX4C; T4k6A: $online = new Online($token, $uniacid, $_W["\141\x63\143\157\165\156\x74"]["\153\x65\x79"]); goto M0EgN; I_riV: $config["\x63\x6f\x6e\164\145\x6e\164"] = json_decode($config["\143\x6f\156\x74\x65\156\x74"], true); goto etEyS; DpCqM: hEXq3: goto T4k6A; XOnyD: $config = pdo_get("\x78\x63\137\x66\x61\x72\x6d\137\x63\157\x6e\x66\x69\147", array("\x78\x6b\145\171" => "\x6f\x6e\154\x69\x6e\x65", "\165\156\x69\x61\x63\151\x64" => $uniacid)); goto xCvLY; frZRj: load()->func("\x6c\x6f\147\x67\x69\x6e\x67"); goto q9oz1; xCvLY: if (!$config) { goto hEXq3; } goto I_riV; IQPNN: global $_W, $_GPC; goto d5HjL; d5HjL: $uniacid = $_W["\165\x6e\151\x61\143\x69\144"]; goto frZRj; HAX4C: $token = $config["\143\x6f\x6e\x74\145\156\164"]["\x74\x6f\153\x65\156"]; goto Haa78; CjCS4: $token = ''; goto XOnyD; M0EgN: $online->check_server();