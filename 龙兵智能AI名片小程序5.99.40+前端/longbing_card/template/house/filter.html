<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../addons/{$module_name}/images/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../addons/{$module_name}/images/layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="../../../addons/{$module_name}/images/css/main.css" media="all">
    <!--<script src="../../../addons/{$module_name}/images/js/jquery.min.js"></script>-->


    <link href="./resource/css/bootstrap.min.css?v=20170426" rel="stylesheet">
    <link href="./resource/css/common.css?v=20170426" rel="stylesheet">
    <script type="text/javascript" src="./resource/js/lib/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="./resource/js/lib/bootstrap.min.js"></script>
    <script type="text/javascript" src="./resource/js/app/util.js?v=20170426"></script>
    <script type="text/javascript" src="./resource/js/app/common.min.js?v=20170426"></script>
    <script type="text/javascript" src="./resource/js/require.js?v=20170426"></script>
</head>
<body>


<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">


            <div class="layui-card">
                <div class="layui-card-header">房源筛选管理</div>

                <div class="layui-card-body">

                    <div class="layui-tab layui-tab-card">
                        <ul class="layui-tab-title">
                            <li class="layui-this">区域</li>
                            <li>价格</li>
                            <li>户型</li>
                        </ul>
                        <div class="layui-tab-content">
                            <!--区域-->
                            <div id="areadiv" class="layui-tab-item {if $pageflag==1}layui-show{/if}">

                                <div class="layui-card-body">
                                    <div class="div-search-body">
                                        <a class="layui-btn btn-add-area" href="javascript:;">
                                            <i class="layui-icon">&#xe608;</i> 新增区域
                                        </a>
                                    </div>
                                    <table class="layui-table">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>名称</th>
                                            <th>排序值</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {loop $arealist $item}
                                        <tr>
                                            <td>{$item['id']}</td>
                                            <td>{$item['title']}</td>
                                            <td>{$item['sort']}</td>
                                            <td>
                                                <button type="button" class="layui-btn layui-btn-xs btn-edit-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    编辑
                                                </button>

                                                <button type="button" class="layui-btn layui-btn-xs btn-delete-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    删除
                                                </button>

                                            </td>
                                        </tr>
                                            <!--第二集判断是否有子集-->
                                            {if isset($item['_child'])}
                                                <!--循环-->
                                        {loop $item['_child'] $item}
                                        <tr>
                                            <td>{$item['id']}</td>
                                            <td>-------{$item['title']}</td>
                                            <td>{$item['sort']}</td>
                                            <td>
                                                <button type="button" class="layui-btn layui-btn-xs btn-edit-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    编辑
                                                </button>

                                                <button type="button" class="layui-btn layui-btn-xs btn-delete-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    删除
                                                </button>

                                            </td>
                                        </tr>
                                        <!--第三集判断是否有子集-->
                                        {if isset($item['_child'])}
                                        <!--循环-->
                                        {loop $item['_child'] $item}
                                        <tr>
                                            <td>{$item['id']}</td>
                                            <td>--------------------{$item['title']}</td>
                                            <td>{$item['sort']}</td>
                                            <td>
                                                <button type="button" class="layui-btn layui-btn-xs btn-edit-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    编辑
                                                </button>

                                                <button type="button" class="layui-btn layui-btn-xs btn-delete-item-area"
                                                        itemId="{$item['id']}" itemTop="{$item['sort']}" itemTitle="{$item['title']}">
                                                    删除
                                                </button>

                                            </td>
                                        </tr>
                                        {/loop}






                                        {/if}
                                        {/loop}




                                            {/if}
                                        {/loop}
                                        </tbody>
                                    </table>
                                </div>

                            </div>

                            <!--价格-->
                            <div id="pricediv" class="layui-tab-item {if $pageflag==2}layui-show{/if}" >
                                <div class="layui-card-body">
                                    <div class="div-search-body">
                                        <a class="layui-btn btn-add-price" href="javascript:;">
                                            <i class="layui-icon">&#xe608;</i> 新增价格
                                        </a>
                                    </div>
                                    <table class="layui-table">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>标题</th>
                                            <th>值</th>
                                            <th>排序值</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {loop $pricelist $item}
                                        <tr>
                                            <td>{$item['id']}</td>
                                            <td>{$item['title']}</td>
                                            <td>{$item['value']}</td>
                                            <td>{$item['sort']}</td>
                                            <td>
                                                <button type="button" class="layui-btn layui-btn-xs btn-edit-item-price"
                                                        itemId="{$item['id']}" itemSort="{$item['sort']}" itemTitle="{$item['title']}"  itemValue="{$item['value']}">
                                                    编辑
                                                </button>

                                                <button type="button" class="layui-btn layui-btn-xs btn-delete-item-price"
                                                        itemId="{$item['id']}" itemSort="{$item['sort']}" itemTitle="{$item['title']}"  itemValue="{$item['value']}">
                                                    删除
                                                </button>

                                            </td>
                                        </tr>
                                        {/loop}
                                        </tbody>
                                    </table>
                                    <input type="hidden" name="itemId" id="itemId" value="0">
                                </div>
                            </div>

                            <!--户型-->
                            <div id="huxingdiv" class="layui-tab-item {if $pageflag==3}layui-show{/if}">
                                <div class="layui-card-body">
                                    <div class="div-search-body">
                                        <a class="layui-btn btn-add-huxing" href="javascript:;">
                                            <i class="layui-icon">&#xe608;</i> 新增户型
                                        </a>
                                    </div>
                                    <table class="layui-table">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>标题</th>
                                            <th>排序值</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {loop $huxinglist $item}
                                        <tr>
                                            <td>{$item['id']}</td>
                                            <td>{$item['title']}</td>
                                            <td>{$item['sort']}</td>
                                            <td>
                                                <button type="button" class="layui-btn layui-btn-xs btn-edit-item-huxing"
                                                        itemId="{$item['id']}" itemSort="{$item['sort']}" itemTitle="{$item['title']}" >
                                                    编辑
                                                </button>

                                                <button type="button" class="layui-btn layui-btn-xs btn-delete-item-huxing"
                                                        itemId="{$item['id']}" itemSort="{$item['sort']}" itemTitle="{$item['title']}">
                                                    删除
                                                </button>

                                            </td>
                                        </tr>
                                        {/loop}
                                        </tbody>
                                    </table>
                                    <input type="hidden" name="itemIdHuxing" id="itemIdHuxing" value="0">
                                </div>

                            </div>

                        </div>
                    </div>

                </div>
            </div>



        </div>
    </div>
</div>


{template 'common/footer'}

<style>
    .friend-link{
        text-align: center;
    }
    .copyright{
        text-align: center;
        padding-bottom: 20px;
    }
</style>

<script src="../../../addons/{$module_name}/images/layuiadmin/layui/layui.js"></script>

<script>
    layui.use(['layer', 'element'], function () {
        var layer = layui.layer
            , element = layui.element
        //删除区域
        $('.btn-delete-item-area').click(function () {
            var id = $(this).attr('itemId');
            if (!id) {
                layer.msg('获取参数失败!');
                return false;
            }
            layer.open({
                content: '是否删除该内容?',
                yes: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    layer.load();
                    var url = "{php echo $this->createWebUrl('house/filter')}";
                    var data = {
                        action: 'area-disable',
                        id: id
                    };
                    postDataReload(url, data);
                }
            });
        });
        //新增/编辑区域
        $('.btn-add-area').click(function () {
            layer.load();
            var url = "{php echo $this->createWebUrl('house/areaEdit')}";
            window.location.href = url;
        });
        $('.btn-edit-item-area').click(function () {
            var id = $(this).attr('itemId');
            if (!id) {
                layer.msg('获取id失败!');
                return false;
            }
            layer.load();
            var url = "{php echo $this->createWebUrl('house/areaEdit')}" + "&id=" +id;
            window.location.href = url;
        });


        //删除价格
        $('.btn-delete-item-price').click(function () {
            var id = $(this).attr('itemId');
            if (!id) {
                layer.msg('获取参数失败!');
                return false;
            }
            layer.open({
                content: '是否删除该内容?',
                yes: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    layer.load();
                    var url = "{php echo $this->createWebUrl('house/filter')}";
                    var data = {
                        action: 'price-disable',
                        id: id
                    };
                    postDataReload(url, data);
                }
            });
        });

        //新增价格
       $('.btn-add-price').click(function () {
         $('#itemId').val(0);
         layer.open({
         type: 1,
         title: '新增价格',
         closeBtn: 0,
         shadeClose: true,
         skin: 'yourClass',
         content: '<div style="padding: 20px; width: 260px; height: 160px;">' +
         '<input type="text" autocomplete="off" class="layui-input" value="" id="typeTitle" placeholder="名称">' +
         '<input type="text" autocomplete="off" class="layui-input" value="" id="typeValue" placeholder="值" style="margin-top: 20px">' +
         '<input type="text" autocomplete="off" class="layui-input" value="" id="typeSort" placeholder="排序值" style="margin-top: 20px">' +
         '<button class="layui-btn" required  lay-verify="required" style="margin-top: 30px" onclick="btnSubPrice()">立即提交</button>' +
         '</div>'
         });
     });

        //编辑价格
        $('.btn-edit-item-price').click(function () {

            var id = $(this).attr('itemId');
            var typeTitle = $(this).attr('itemTitle');
            var typeSort = $(this).attr('itemSort');
            var typeValue = $(this).attr('itemValue');

            if (!id || !typeTitle || !typeSort  ||  !typeValue) {
                layer.msg('获取参数失败!');
                return false;
            }

            $('#itemId').val(id);
            layer.open({
                type: 1,
                title: '编辑价格',
                closeBtn: 0,
                shadeClose: true,
                skin: 'yourClass',
                content: '<div style="padding: 20px; width: 260px; height: 160px;">' +
                '<input type="text" autocomplete="off" class="layui-input" value="' + typeTitle + '" id="typeTitle" placeholder="名称">' +
                '<input type="text" autocomplete="off" class="layui-input" value="' + typeValue + '" id="typeValue" placeholder="值" style="margin-top: 20px">' +
                '<input type="text" autocomplete="off" class="layui-input" value="' + typeSort + '" id="typeSort" placeholder="排序值" style="margin-top: 20px">' +
                '<button class="layui-btn" required  lay-verify="required" style="margin-top: 30px" onclick="btnSubPrice()">立即提交</button>' +
                '</div>'
            });
        });


        //删除户型
        $('.btn-delete-item-huxing').click(function () {
            var id = $(this).attr('itemId');
            if (!id) {
                layer.msg('获取参数失败!');
                return false;
            }
            layer.open({
                content: '是否删除该内容?',
                yes: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    layer.load();
                    var url = "{php echo $this->createWebUrl('house/filter')}";
                    var data = {
                        action: 'huxing-disable',
                        id: id
                    };
                    postDataReload(url, data);
                }
            });
        });

        //新增户型
        $('.btn-add-huxing').click(function () {
            $('#itemIdHuxing').val(0);
            layer.open({
                type: 1,
                title: '新增户型',
                closeBtn: 0,
                shadeClose: true,
                skin: 'yourClass',
                content: '<div style="padding: 20px; width: 260px; height: 160px;">' +
                '<input type="text" autocomplete="off" class="layui-input" value="" id="typeTitle" placeholder="名称">' +
                '<input type="text" autocomplete="off" class="layui-input" value="" id="typeSort" placeholder="排序值" style="margin-top: 20px">' +
                '<button class="layui-btn" required  lay-verify="required" style="margin-top: 30px" onclick="btnSubHuxing()">立即提交</button>' +
                '</div>'
            });
        });

        //编辑户型
        $('.btn-edit-item-huxing').click(function () {

            var id = $(this).attr('itemId');
            var typeTitle = $(this).attr('itemTitle');
            var typeSort = $(this).attr('itemSort');

            if (!id || !typeTitle || !typeSort ) {
                layer.msg('获取参数失败!');
                return false;
            }

            $('#itemIdHuxing').val(id);
            layer.open({
                type: 1,
                title: '编辑价格',
                closeBtn: 0,
                shadeClose: true,
                skin: 'yourClass',
                content: '<div style="padding: 20px; width: 260px; height: 160px;">' +
                '<input type="text" autocomplete="off" class="layui-input" value="' + typeTitle + '" id="typeTitle" placeholder="名称">' +
                '<input type="text" autocomplete="off" class="layui-input" value="' + typeSort + '" id="typeSort" placeholder="排序值" style="margin-top: 20px">' +
                '<button class="layui-btn" required  lay-verify="required" style="margin-top: 30px" onclick="btnSubHuxing()">立即提交</button>' +
                '</div>'
            });
        });
    });

    //  提交
    function btnSubPrice ()
    {
        layer.load();
        var typeTitle = $('#typeTitle').val();
        var typeSort = $('#typeSort').val();
        var typeValue = $('#typeValue').val();

        var itemId = $('#itemId').val();

        if (itemId == 0)
        {
            var action = 'price-add';
            itemId = 0;
        }
        else
        {
            var action = 'price-edit';
        }

        if (!typeTitle || typeTitle == '')
        {
            layer.closeAll();
            return false;
        }

        var url = "{php echo $this->createWebUrl('house/filter')}";

        var id = itemId;
        var data = {
            action: action,
            id: id,
            typeTitle: typeTitle,
            typeSort: typeSort,
            typeValue: typeValue
        };
        if (id > 0) {
            data.id = id;
        }
        postDataReload(url, data)
        return false;
    }

    function btnSubHuxing ()
    {
        layer.load();
        var typeTitle = $('#typeTitle').val();
        var typeSort = $('#typeSort').val();

        var itemId = $('#itemIdHuxing').val();

        if (itemId == 0)
        {
            var action = 'huxing-add';
            itemId = 0;
        }
        else
        {
            var action = 'huxing-edit';
        }

        if (!typeTitle || typeTitle == '')
        {
            layer.closeAll();
            return false;
        }

        var url = "{php echo $this->createWebUrl('house/filter')}";

        var id = itemId;
        var data = {
            action: action,
            id: id,
            typeTitle: typeTitle,
            typeSort: typeSort,
        };
        if (id > 0) {
            data.id = id;
        }
        postDataReload(url, data)
        return false;
    }
</script>
<script src="../../../addons/{$module_name}/images/js/main.js"></script>
</body>
</html>