<?php
 goto XTZw2; q3Orh: include IA_ROOT . '/addons/yzhyk_sun_plugin_distribution/func/func.php'; goto V8AwE; XTZw2: defined('IN_IA') or exit('Access Denied'); goto q3Orh; V8AwE: class yzhyk_sun_plugin_distributionModuleSite extends WeModuleSite { public function doWebdistribution_set() { goto XrYkZ; EUKWm: $todo = $_GPC['todo']; goto yk8oO; EBW6u: switch ($settype) { case 1: goto crleo; Wd_E3: $add = json_decode($info, true); goto fv9zm; W6dim: $data['id'] = 'AT1242'; goto Sis2V; e1NrA: $data['id'] = 'AT0830'; goto r2Okw; NCe6a: $datas['uniacid'] = trim($_W['uniacid']); goto c_gUL; UTvnd: if ($tid == 'tpl_wd_arrival') { goto Bdkon; } goto v89ru; DMkb9: goto DkW9r; goto xzexJ; wF7vk: message('设置失败!', '', 'error'); goto WBJjt; Dqa3I: HZQFg: goto BKlQf; kXSXD: message('设置失败!!' . $add['errmsg'], '', 'error'); goto xrzJu; MpvN9: goto HjrUZ; goto dGzT5; xrzJu: goto RajJh; goto AneXa; MrSPY: if (empty($_GPC['id'])) { goto iEhtH; } goto B5u45; c_gUL: $datas[$tid] = $add['template_id']; goto Fnp3o; DUp4K: BEpwq: goto NCe6a; pZPxr: if ($todo == 'savetemplate') { goto Dp4Di; } goto MpvN9; SCPNe: goto eqwpv; goto CLIpg; C_igJ: if (empty($_GPC['id'])) { goto BEpwq; } goto YD1bX; xd8Tg: yGEjG: goto hfh97; hfh97: if ($res) { goto F8uku; } goto RpFSl; r2Okw: $data['keyword_id_list'] = [5, 3, 1, 8, 6]; goto DMkb9; YD1bX: $res = pdo_update('yzhyk_sun_distribution_set', array($tid => $add['template_id']), array("uniacid" => $_W['uniacid'])); goto hAdOO; N60Qs: $data_first = $_GPC['indata']; goto Xv87Q; RIOeP: Dp4Di: goto AhNHK; AtUun: DkW9r: goto qonqu; v89ru: if ($tid == 'tpl_wd_fail') { goto LVcKj; } goto QLxNU; eWJxT: message('模板消息设置成功', $this->createWebUrl('distribution_set', array("settype" => 1)), 'success'); goto Dqa3I; FWv0b: message('设置失败,参数错误', '', 'error'); goto g6Gr6; Ybk3k: message('成功!', $this->createWebUrl('distribution_set', array("settype" => 1)), 'success'); goto aoosx; aoosx: eqwpv: goto LoKuT; rW_G8: Bdkon: goto e1NrA; T2m0a: $url = 'https://api.weixin.qq.com/cgi-bin/wxopen/template/add?access_token=' . $token; goto UTvnd; tjvIc: goto DkW9r; goto IRcwk; Sis2V: $data['keyword_id_list'] = [3, 2]; goto tjvIc; Xv87Q: $data = $data_first; goto MrSPY; QLxNU: if ($tid == 'tpl_share_check') { goto h00Rd; } goto FWv0b; RpFSl: message('失败!', $this->createWebUrl('distribution_set', array("settype" => 1)), 'error'); goto SCPNe; hS1k0: iEhtH: goto lFW8_; hehSd: $token = getaccess_token(); goto T2m0a; IRcwk: h00Rd: goto E7UJG; WBJjt: goto HZQFg; goto IOCwO; bhV8U: goto yGEjG; goto hS1k0; lFW8_: $data['uniacid'] = $_W['uniacid']; goto arEE6; crleo: if ($todo == 'setting') { goto cC8Yk; } goto pZPxr; yIqTx: $data['keyword_id_list'] = [2, 4, 1]; goto AtUun; qonqu: $data = json_encode($data); goto yMdvz; LoKuT: HjrUZ: goto nIVAo; AneXa: Xdrky: goto C_igJ; B5u45: $res = pdo_update('yzhyk_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto bhV8U; BKlQf: RajJh: goto ZMsAp; Fnp3o: $res = pdo_insert('yzhyk_sun_distribution_set', $datas); goto N6lZA; hAdOO: goto eZmy3; goto DUp4K; arEE6: $res = pdo_insert('yzhyk_sun_distribution_set', $data); goto xd8Tg; AhNHK: $data = array(); goto N60Qs; E7UJG: $data['id'] = 'AT0674'; goto yIqTx; ZMsAp: goto HjrUZ; goto RIOeP; dGzT5: cC8Yk: goto hehSd; N6lZA: eZmy3: goto M5L3a; IOCwO: ccju_: goto eWJxT; yMdvz: $info = tocurl($url, $data, 0); goto Wd_E3; nIVAo: goto J8RAO; goto pWCu0; xzexJ: LVcKj: goto W6dim; CLIpg: F8uku: goto Ybk3k; fv9zm: if ($add['errcode'] == 0 && $add['errmsg'] == 'ok') { goto Xdrky; } goto kXSXD; g6Gr6: goto DkW9r; goto rW_G8; M5L3a: if ($res) { goto ccju_; } goto wF7vk; pWCu0: default: goto kH7AD; WCPJE: kpv7t: goto O1CYR; tLSQG: $urlarr = array(); goto E37xF; ROtuB: goto LMQa3; goto WCPJE; Elh4Z: goto ZBw2I; goto oFigC; E37xF: if ($settype == 0) { goto XoJ0T; } goto Js9LF; udOuv: if ($res) { goto kpv7t; } goto N8Nmw; F0ajE: goto N0Zs0; goto t3_bo; Pn1Oh: $data = $data_first; goto TNEMj; FjcvT: goto J8RAO; goto piMJk; ln822: $res = pdo_update('yzhyk_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto Elh4Z; N8Nmw: message('失败!', $this->createWebUrl('distribution_set', $urlarr), 'error'); goto ROtuB; oFigC: FnBl0: goto h9DyL; t3_bo: XoJ0T: goto RRhX8; TNEMj: if (empty($_GPC['id'])) { goto FnBl0; } goto ln822; O1CYR: message('成功!', $this->createWebUrl('distribution_set', $urlarr), 'success'); goto xx7m6; Vp1_m: ZBw2I: goto udOuv; Js9LF: $urlarr['settype'] = $settype; goto F0ajE; kH7AD: if (!checksubmit()) { goto SWks3; } goto xJM2Q; rcPA9: $data_first = $_GPC['indata']; goto tLSQG; h9DyL: $data['uniacid'] = $_W['uniacid']; goto neyPm; xx7m6: LMQa3: goto bAVNJ; xJM2Q: $data = array(); goto rcPA9; bAVNJ: SWks3: goto FjcvT; RRhX8: $data_first['withdrawtype'] = implode(',', $data_first['withdrawtype']); goto ENa52; neyPm: $res = pdo_insert('yzhyk_sun_distribution_set', $data); goto Vp1_m; ENa52: N0Zs0: goto Pn1Oh; piMJk: } goto lLL_j; Necwh: include $this->template('web/distribution_set'); goto V2ZMb; u9tiG: $info['withdrawtype'] = $info['withdrawtype'] ? explode(',', $info['withdrawtype']) : array(); goto EBW6u; kcw52: J8RAO: goto Necwh; lLL_j: oTJUR: goto kcw52; XrYkZ: global $_GPC, $_W; goto owYR2; owYR2: $settype = intval($_GPC['settype']); goto EUKWm; yk8oO: $tid = $_GPC['tid']; goto fQGVO; fQGVO: $info = pdo_get('yzhyk_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto u9tiG; V2ZMb: } public function doWebdistribution_commission() { goto lHOpy; WIICf: if (empty($_GPC['id'])) { goto xnKVx; } goto dKrIQ; xlUly: $data_first = $_GPC['indata']; goto FBu_6; T1EYb: $data['uniacid'] = $_W['uniacid']; goto Hhkb_; Hhkb_: $res = pdo_insert('yzhyk_sun_distribution_set', $data); goto geyx1; FBu_6: $data = $data_first; goto WIICf; EDuqM: goto rtA9d; goto OFm7A; G4qMe: $info = pdo_get('yzhyk_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto aixcn; PACol: message('失败!', $this->createWebUrl('distribution_commission'), 'error'); goto Yr6ER; bYFT4: include $this->template('web/distribution_commission'); goto LUPAS; Yr6ER: goto twJg4; goto MxCc0; wyHEA: if ($res) { goto s8leK; } goto PACol; lHOpy: global $_GPC, $_W; goto G4qMe; geyx1: rtA9d: goto wyHEA; dGOk2: twJg4: goto SGiIm; aixcn: if (!checksubmit()) { goto hNr9J; } goto j7Qwm; IE2uC: message('成功!', $this->createWebUrl('distribution_commission'), 'success'); goto dGOk2; OFm7A: xnKVx: goto T1EYb; dKrIQ: $res = pdo_update('yzhyk_sun_distribution_set', $data, array("uniacid" => $_W['uniacid'])); goto EDuqM; j7Qwm: $data = array(); goto xlUly; MxCc0: s8leK: goto IE2uC; SGiIm: hNr9J: goto bYFT4; LUPAS: } public function doWebdistribution_withdraw() { goto nmOEv; RzVtV: $where .= ' and w.status = 1'; goto wQdDs; W5l51: $data[':uniacid'] = $uniacid; goto izLvf; q8oei: rGLcV: goto W5l51; peJJb: if ($nametype == 'key_reject') { goto jNWDp; } goto vnjXM; E2yev: $uniacid = $_W['uniacid']; goto Hf2pJ; wQdDs: goto a2FTU; goto gSg1j; vnjXM: goto a2FTU; goto XTYEr; ph7Tq: $pager = pagination($total, $pageindex, $pagesize); goto j4u71; vVk8I: if ($nametype == 'key_nick') { goto I0ZLA; } goto ZN3ZK; dMgae: a2FTU: goto q8oei; izLvf: $sql = 'select w.*,u.name,u.img from ' . tablename('yzhyk_sun_distribution_withdraw') . ' as w left join ' . tablename('yzhyk_sun_user') . ' as u on u.openid=w.openid ' . $where; goto MtyeF; jrNUd: $where .= " and u.name LIKE '%{$keywords}%'"; goto NgUBl; gSg1j: jNWDp: goto MOf_0; yjbRo: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_withdraw') . ' as w left join ' . tablename('yzhyk_sun_user') . ' as u on u.openid=w.openid ' . $where, $data); goto ph7Tq; Hf2pJ: $where = ' where w.uniacid=:uniacid '; goto M7jbH; s7dsP: $pagesize = 10; goto E2yev; reqs3: $where .= ' and w.status = 2'; goto dMgae; M7jbH: if (empty($_GPC['nametype'])) { goto rGLcV; } goto rI3fK; NgUBl: goto a2FTU; goto pJ1k0; rI3fK: $nametype = $_GPC['nametype']; goto vVk8I; XTYEr: I0ZLA: goto BwfWG; Uzhl7: $keywords = 2; goto RzVtV; Lv6I7: $status_color = array("", "blue", "red"); goto woBU9; mmCNr: goto a2FTU; goto ihwdd; MtyeF: $select_sql = $sql . ' order by w.id desc LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto WqC9N; WqC9N: $list = pdo_fetchall($select_sql, $data); goto yjbRo; j4u71: include $this->template('web/distribution_withdraw'); goto ZyKFx; x4ZBk: if ($nametype == 'key_complete') { goto GtfWN; } goto peJJb; ihwdd: GtfWN: goto Uzhl7; zfyeQ: $where .= ' and w.status = 0'; goto mmCNr; pJ1k0: rjnC5: goto f23ZG; woBU9: $wd_type_str = array("", "微信", "支付宝", "银行卡", "余额"); goto Mg2Rd; IAnDL: $wd_type = array("", "微信昵称", "支付宝账号", "银行卡号", "用户名"); goto Pey1P; Mg2Rd: $pageindex = max(1, intval($_GPC['page'])); goto s7dsP; MOf_0: $keywords = 3; goto reqs3; Pey1P: $status = array("待打款", "已经打款", "驳回"); goto Lv6I7; f23ZG: $keywords = 1; goto zfyeQ; nmOEv: global $_GPC, $_W; goto IAnDL; BwfWG: $keywords = $_GPC['keywords']; goto jrNUd; ZN3ZK: if ($nametype == 'key_wait') { goto rjnC5; } goto x4ZBk; ZyKFx: } public function doWebChangeWithdraw() { goto lx9Qq; iivuh: $desc = '分销提现打款'; goto RjtH1; tbqcv: goto h8p1U; goto Y2uko; m02e7: $mchid = $appData['mchid']; goto eOYd2; fZl6r: if (!($appData['appid'] == '' || $appData['mchid'] == '' || $appData['wxkey'] == '' || $appData['apiclient_cert'] == '' || $appData['apiclient_key'] == '')) { goto ge14K; } goto WV_tx; Ag_i4: $data['memo'] = '分销提现到余额'; goto qo369; h_GL0: goto izt5p; goto edO6u; b8xg_: $return = $weixinfirmpay->pay(); goto fgKax; Mav5v: $data['rc_id'] = 0; goto Br93d; hqb9l: $re_user_name = $info['uname']; goto iivuh; xdTpe: mgGe8: goto ZkrhT; Yc3Ud: if ($status == 1) { goto go7vX; } goto vpwHY; qo369: $data['uniacid'] = $uniacid; goto Y8OJU; Nz3X3: $sendtplmessage = true; goto e_81p; VKTta: eV9t6: goto g2tXr; gvsrq: $res1 = pdo_update('yzhyk_sun_distribution_promoter', array("freezemoney -=" => $info['realmoney'], "canwithdraw -=" => $info['realmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto VpFA1; Br93d: $data['money'] = $info['realmoney']; goto MTgRx; hsc8P: if (!($info['time'] >= $sevenday)) { goto SvDl2; } goto R3gX8; N2YI2: $res = pdo_update('yzhyk_sun_distribution_withdraw', $data, array("uniacid" => $_W['uniacid'], "id" => $id)); goto ATyVm; OLs0F: $apiclient_cert = IA_ROOT . '/addons/yzhyk_sun/cert/' . $appData['apiclient_cert']; goto o4bk4; rfoSH: if (!($info['time'] >= $sevenday)) { goto dso9u; } goto LWuXI; tnoSK: $status = intval($_GPC['status']); goto D1R9_; enW02: $data['rtype'] = 5; goto Ag_i4; Zy0Fp: $data['openid'] = $info['openid']; goto Mav5v; g2tXr: $res = pdo_update('yzhyk_sun_user', array("money +=" => $info['realmoney']), array("uniacid" => $_W['uniacid'], "id" => $info['uid'])); goto Skmrh; pzNSH: if ($info['withdrawaltype'] == 1) { goto DoD2u; } goto ZZMr9; E2hQy: $uniacid = $_W['uniacid']; goto aMi17; ZkrhT: $res1 = pdo_update('yzhyk_sun_distribution_promoter', array("freezemoney -=" => $info['realmoney'], "canwithdraw -=" => $info['realmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto OutLO; U8Af3: $res2 = pdo_update('yzhyk_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto Nz3X3; uxI6q: $appData = pdo_get('yzhyk_sun_system', array("uniacid" => $uniacid)); goto G1Om6; o4bk4: $apiclient_key = IA_ROOT . '/addons/yzhyk_sun/cert/' . $appData['apiclient_key']; goto fZl6r; CWIfP: $sendtplmessage = true; goto h_GL0; DYoom: npm4E: goto KHus6; Qk4sA: $partner_trade_no = $mchid . time() . rand(100000, 999999); goto hqb9l; Q8ZLj: include IA_ROOT . '/addons/yzhyk_sun_plugin_distribution/wxfirmpay.php'; goto uxI6q; aMi17: $id = intval($_GPC['id']); goto tnoSK; bTFKm: OT343: goto agtNm; BZmDr: $data['addtime'] = time(); goto enW02; Aekrh: DJv4p: goto vkUqd; vkUqd: message('成功!', $this->createWebUrl('distribution_withdraw'), 'success'); goto S20or; D1R9_: $info = pdo_get('yzhyk_sun_distribution_withdraw', array("uniacid" => $_W['uniacid'], "id" => $id)); goto ob1Mw; Of9i_: izt5p: goto ITQPC; e5E0j: message('失败，错误信息：参数错误', $this->createWebUrl('distribution_withdraw'), 'error'); goto tbqcv; e_81p: h8p1U: goto Of9i_; ob1Mw: $wd_type = array("", "微信零钱", "支付宝", "银行卡", "账户余额"); goto r5pGA; G1Om6: $mch_appid = $appData['appid']; goto m02e7; HU0Mm: sendtelmessage($info['openid'], 'tpl_wd_fail', $haveformid, $tpldata); goto DYoom; WV_tx: message('失败，请先配置好小程序!', $this->createWebUrl('distribution_withdraw'), 'error'); goto tBoPO; Z8LR3: $data = array(); goto Zy0Fp; tBoPO: ge14K: goto KD9Lr; ATyVm: if (!($status == 2)) { goto npm4E; } goto Cns3t; KHus6: goto DJv4p; goto L13uU; ZZMr9: if ($info['withdrawaltype'] == 4) { goto eV9t6; } goto gvsrq; vJ8_x: sendtelmessage($info['openid'], 'tpl_wd_arrival', $haveformid, $tpldata); goto uCqt3; r5pGA: $sendtplmessage = false; goto Yc3Ud; Y2uko: NeueW: goto YwlOt; vpwHY: $data = array(); goto wAyxk; NHpwL: SvDl2: goto UEDex; KD9Lr: $weixinfirmpay = new WeixinfirmPay($mch_appid, $mchid, $key, $openid, $partner_trade_no, $re_user_name, $desc, $amount, $apiclient_cert, $apiclient_key); goto b8xg_; UEDex: $tpldata = array(); goto r1d29; eOYd2: $key = $appData['wxkey']; goto G1iRg; fgKax: if ($return['result_code'] == 'SUCCESS') { goto mgGe8; } goto rjrg2; r1d29: $tpldata['price'] = $info['money']; goto HU0Mm; edO6u: DoD2u: goto Q8ZLj; Z34qs: $sevenday = strtotime('-7 days'); goto hsc8P; qnn0G: $tpldata = array(); goto GVWPU; EC9XY: $sevenday = strtotime('-7 days'); goto rfoSH; Cns3t: $res1 = pdo_update('yzhyk_sun_distribution_promoter', array("freezemoney -=" => $info['money']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto Z34qs; uCqt3: KsOZp: goto Aekrh; GVWPU: $tpldata['price'] = $info['money']; goto gkv2I; wAyxk: $data['status'] = $status; goto N2YI2; Y8OJU: $res3 = pdo_insert('yzhyk_sun_rechargelogo', $data); goto U8Af3; MTgRx: $data['addmoney'] = 0; goto BZmDr; RjtH1: $amount = $info['realmoney'] * 100; goto OLs0F; ITQPC: if (!$sendtplmessage) { goto KsOZp; } goto EC9XY; YwlOt: $res1 = pdo_update('yzhyk_sun_distribution_promoter', array("freezemoney -=" => $info['realmoney'], "canwithdraw -=" => $info['realmoney']), array("uniacid" => $_W['uniacid'], "uid" => $info['uid'])); goto Z8LR3; AbFhT: dso9u: goto qnn0G; R3gX8: $haveformid = $info['form_id']; goto NHpwL; G1iRg: $openid = $info['openid']; goto Qk4sA; rjrg2: message('失败，错误信息：' . $return['return_msg'], $this->createWebUrl('distribution_withdraw'), 'error'); goto PQDEu; EhDXQ: $tpldata['realmoney'] = $info['realmoney']; goto nGGLV; LWuXI: $haveformid = $info['form_id']; goto AbFhT; L13uU: go7vX: goto pzNSH; nGGLV: $tpldata['wd_type'] = $wd_type[$info['withdrawaltype']]; goto vJ8_x; PQDEu: goto OT343; goto xdTpe; yK5I5: $sendtplmessage = true; goto bTFKm; agtNm: goto izt5p; goto VKTta; gkv2I: $tpldata['ratesmoney'] = $info['ratesmoney']; goto EhDXQ; Skmrh: if ($res) { goto NeueW; } goto e5E0j; OutLO: $res2 = pdo_update('yzhyk_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto yK5I5; lx9Qq: global $_GPC, $_W; goto E2hQy; VpFA1: $res2 = pdo_update('yzhyk_sun_distribution_withdraw', array("status" => 1), array("uniacid" => $_W['uniacid'], "id" => $id)); goto CWIfP; S20or: } public function doWebdistributor() { goto gqdGE; DA9Os: $pagesize = 10; goto iuZVk; uylUX: $data[':uniacid'] = $uniacid; goto BvrlT; TdhJX: $pageindex = max(1, intval($_GPC['page'])); goto DA9Os; RtatY: $select_sql = $sql . ' order by w.id desc LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto aM3zE; METSt: $keywords = $_GPC['keywords']; goto yX86S; BvrlT: if (empty($_GPC['nametype'])) { goto D2T9r; } goto CN1Ao; vVLM3: $sql = 'select w.*,a.name,a.img from ' . tablename('yzhyk_sun_distribution_promoter') . ' as w left join ' . tablename('yzhyk_sun_user') . 'as a on a.openid = w.openid ' . $where; goto RtatY; KypUh: CkukN: goto hqjDM; yX86S: if (!($nametype == 'key_uname')) { goto c54W0; } goto La34x; MTAwH: D2T9r: goto vVLM3; iuZVk: $uniacid = $_W['uniacid']; goto YU0F4; hDcEX: foreach ($list as $key => $val) { goto xKPHD; lnx0g: if (!($info['status'] >= 1)) { goto jYszn; } goto KU38B; qDOle: Lra_f: goto SL9tR; OmU5X: if (!($info['status'] >= 2)) { goto u2jin; } goto PW2ho; sI3qf: jYszn: goto OmU5X; PW2ho: $list[$key]['nexttwo'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('yzhyk_sun_user') . ' where parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $val['uid'] . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . '; '); goto eALby; xKPHD: $list[$key]['code_img'] = ''; goto lnx0g; eALby: u2jin: goto qN1pA; bom0Z: $list[$key]['nextthree'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('yzhyk_sun_user') . ' where parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $val['uid'] . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . '; '); goto Z4R7k; Z4R7k: jJDzq: goto qDOle; qN1pA: if (!($info['status'] >= 3)) { goto jJDzq; } goto bom0Z; KU38B: $list[$key]['nextone'] = pdo_fetchcolumn('select count(id) as wname from ' . tablename('yzhyk_sun_user') . ' where parents_id=' . $val['uid'] . ' '); goto sI3qf; SL9tR: } goto KypUh; gqdGE: global $_GPC, $_W; goto a1WR7; ydstC: $info = pdo_get('yzhyk_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto ymxvf; Myd0P: c54W0: goto MTAwH; CN1Ao: $nametype = $_GPC['nametype']; goto METSt; nRvzW: $pager = pagination($total, $pageindex, $pagesize); goto IMgJO; hqjDM: tR99W: goto Oh5XG; IMgJO: include $this->template('web/distributor'); goto DLWEO; YU0F4: $where = ' where w.uniacid=:uniacid '; goto uylUX; xaaid: $status = array("待审核", "通过审核", "拒绝"); goto TdhJX; Oh5XG: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_promoter') . ' as w ' . $where, $data); goto nRvzW; La34x: $where .= " and a.name LIKE '%{$keywords}%' "; goto Myd0P; a1WR7: $wd_type = array("", "微信昵称", "支付宝账号", "银行卡号", "用户名"); goto xaaid; aM3zE: $list = pdo_fetchall($select_sql, $data); goto ydstC; ymxvf: if (!($info['status'] > 0)) { goto tR99W; } goto hDcEX; DLWEO: } public function doWebdistribution_order() { goto gpxR2; RVC3K: $where .= " and o.order_number LIKE '%{$keywords}%'"; goto k4t5o; eavkO: $status = array("", "待支付", "待核销", "已核销", "已取消", "已删除"); goto kVCwg; bpZOv: if ($ordertype == 4) { goto jTwgR; } goto nYf6v; eUJo4: $where .= ' AND os.parent_id_1>0 '; goto e9PXo; RiR1R: FUHXZ: goto gBYAH; uFzMS: MLoEx: goto b9lxe; sFfj0: goto c89Km; goto U5KqD; y5rbm: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '); goto fd027; jtxHS: y90xA: goto x0V9Q; Svbga: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_orderapp') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '); goto RiR1R; U5KqD: puftn: goto RVC3K; fthwE: BdVB3: goto DqtHX; e9PXo: goto y90xA; goto fthwE; nYf6v: goto FUHXZ; goto KX5Y5; EwW23: O7Yey: goto ugFPm; QXU5e: $ordertype = $ordertype > 0 ? $ordertype : 1; goto cVEV0; A8JOu: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '); goto O45xQ; iwv4K: if ($nametype == 'key_nick') { goto O7Yey; } goto sFfj0; k4t5o: goto c89Km; goto EwW23; gpxR2: global $_GPC, $_W; goto AEeF_; VlGXi: $nametype = $_GPC['nametype']; goto fg_10; DkVhO: jTwgR: goto LmUJO; mFk7J: if ($nametype == 'key_ordernum') { goto puftn; } goto iwv4K; LbmuM: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '); goto L3pJs; EJJ2v: if ($ordertype == 2) { goto oJepe; } goto XkLSO; fg_10: $keywords = $_GPC['keywords']; goto mFk7J; JpbZ0: $pager = pagination($total, $pageindex, $pagesize); goto QXrjd; gFNUn: $ordertype = intval($_GPC['ordertype']); goto QXU5e; uUY44: oJepe: goto Scrxy; DqtHX: $where .= ' AND (os.parent_id_1=\'' . $uid . '\' or os.parent_id_2=\'' . $uid . '\' or os.parent_id_3=\'' . $uid . '\') AND os.parent_id_1>0 '; goto jtxHS; Kgyev: MbvDP: goto m7X2O; O45xQ: goto FUHXZ; goto DkVhO; b9lxe: $sql = 'select o.state,o.time,u.name,u.img as uthumb,o.order_number,o.pay_amount,o.id,os.first_price,os.second_price,os.third_price from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '; goto A8JOu; AEeF_: $uid = intval($_GPC['uid']); goto gFNUn; Gm33y: $where = ' where o.uniacid=\'' . $uniacid . '\' and u.uniacid=\'' . $uniacid . '\' and os.ordertype=\'' . $ordertype . '\' '; goto z3YCJ; L3pJs: goto FUHXZ; goto uUY44; csH2K: include $this->template('web/distribution_order'); goto bvDPp; SOcFv: if ($ordertype == 4) { goto Bhnp1; } goto e91X1; LmUJO: $sql = 'select o.state,o.time,u.name,u.img as uthumb,o.order_number,o.pay_amount,o.id,os.first_price,os.second_price,os.third_price from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_orderapp') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '; goto Svbga; QXrjd: $d_set = pdo_get('yzhyk_sun_distribution_set', array("uniacid" => $_W['uniacid'])); goto csH2K; ItGdc: c89Km: goto Kgyev; tK6fD: $uniacid = $_W['uniacid']; goto SOcFv; kVCwg: aHL7x: goto Gm33y; tbeO2: if (!($list && ($ordertype == 1 || $ordertype == 2 || $ordertype == 3 || $ordertype == 4))) { goto lZhVv; } goto siLWi; siLWi: foreach ($list as $k => $v) { goto XVQu6; cZ4v2: goto cxgGM; goto jAmer; jAmer: u4rSQ: goto fUdgr; MTQz_: $list[$k]['goods'] = pdo_getall('yzhyk_sun_ordergoods', array("uniacid" => $_W['uniacid'], "order_id" => $v['id'])); goto cZ4v2; XVQu6: if ($ordertype == 4) { goto u4rSQ; } goto MTQz_; fUdgr: $list[$k]['goods'] = pdo_getall('yzhyk_sun_orderappgoods', array("uniacid" => $_W['uniacid'], "order_id" => $v['id'])); goto SnCSh; SNt_O: RY2zo: goto CpE2Y; SnCSh: cxgGM: goto SNt_O; CpE2Y: } goto aojTw; m7X2O: if ($ordertype == 1) { goto fPfUS; } goto EJJ2v; Scrxy: $sql = 'select o.state,o.time,u.name,u.img as uthumb,o.order_number,o.pay_amount,o.id,os.first_price,os.second_price,os.third_price from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id  ' . $where . ' order by o.id desc '; goto y5rbm; e91X1: $status = array("", "待支付", "待付款", "待发货", "待收货", "已完成", "已取消", "已退款"); goto GOqku; GOqku: goto aHL7x; goto SHUes; fd027: goto FUHXZ; goto uFzMS; z3YCJ: if ($uid > 0) { goto BdVB3; } goto eUJo4; gBYAH: $select_sql = $sql . ' LIMIT ' . ($pageindex - 1) * $pagesize . ',' . $pagesize; goto nT1Y3; aojTw: cl350: goto bJuc1; nT1Y3: $list = pdo_fetchall($select_sql, $data); goto tbeO2; bJuc1: lZhVv: goto JpbZ0; Pt_h1: $sql = 'select o.state,o.time,u.name,u.img as uthumb,o.order_number,o.pay_amount,o.id,os.first_price,os.second_price,os.third_price from ' . tablename('yzhyk_sun_distribution_order') . ' as os left join ' . tablename('yzhyk_sun_order') . ' as o on o.id=os.order_id left join ' . tablename('yzhyk_sun_user') . ' as u on u.id=o.user_id ' . $where . ' order by o.id desc '; goto LbmuM; XkLSO: if ($ordertype == 3) { goto MLoEx; } goto bpZOv; cVEV0: $pageindex = max(1, intval($_GPC['page'])); goto XuKk_; ugFPm: $where .= " and u.name LIKE '%{$keywords}%'"; goto ItGdc; XuKk_: $pagesize = 10; goto tK6fD; SHUes: Bhnp1: goto eavkO; x0V9Q: if (empty($_GPC['nametype'])) { goto MbvDP; } goto VlGXi; KX5Y5: fPfUS: goto Pt_h1; bvDPp: } public function doWebSetStatus() { goto fN9co; vXz_V: $uniacid = $_W['uniacid']; goto EP26_; L6058: $res = pdo_update('yzhyk_sun_distribution_promoter', $data, array("uniacid" => $_W['uniacid'], "id" => $id)); goto mn1LM; kcDB0: $id = intval($_GPC['id']); goto rUeCL; uoy2T: $haveformid = $promoter['form_id']; goto h_W_i; YRWsD: sendtelmessage($promoter['openid'], 'tpl_share_check', $haveformid, $tpldata); goto GmAVM; GmAVM: message('成功!', $this->createWebUrl('distributor'), 'success'); goto Ihky4; h_W_i: mfmp9: goto JBwzU; WkEfP: message('失败!', $this->createWebUrl('distributor'), 'error'); goto XHrZI; Ngj16: $sevenday = strtotime('-7 days'); goto l5yd5; l5yd5: if (!($promoter['addtime'] >= $sevenday)) { goto mfmp9; } goto uoy2T; DuA7J: $data['status'] = $status; goto L6058; XHrZI: goto xj4GN; goto ukb8m; g9__3: $promoter = pdo_get('yzhyk_sun_distribution_promoter', array("uniacid" => $_W['uniacid'], "id" => $id)); goto R6LTP; fN9co: global $_GPC, $_W; goto vXz_V; ukb8m: NDe0V: goto g9__3; EP26_: $status = intval($_GPC['status']); goto kcDB0; mn1LM: if ($res) { goto NDe0V; } goto WkEfP; R6LTP: $status = array("审核中", "已通过", "被拒绝"); goto Ngj16; rUeCL: $data = array(); goto DuA7J; LefjY: $tpldata['status'] = $status[$promoter['status']]; goto YRWsD; JBwzU: $tpldata = array(); goto LefjY; Ihky4: xj4GN: goto jY_x1; jY_x1: } public function doWebDeleteDistributor() { goto oVRIu; YU1in: $uniacid = $_W['uniacid']; goto QcnO6; DTjQc: message('失败!', $this->createWebUrl('distributor'), 'error'); goto hDXXW; hDXXW: goto pIx8f; goto p4MXq; QcnO6: $id = intval($_GPC['id']); goto srgQs; srgQs: $delres = pdo_delete('yzhyk_sun_distribution_promoter', array("uniacid" => $uniacid, "id" => $id)); goto jRrua; p4MXq: KwRV9: goto IcH4V; IcH4V: message('成功!', $this->createWebUrl('distributor'), 'success'); goto Ix8DP; Ix8DP: pIx8f: goto ODX4U; jRrua: if ($delres) { goto KwRV9; } goto DTjQc; oVRIu: global $_GPC, $_W; goto YU1in; ODX4U: } public function doWebGetNextInfo() { goto PBRGV; zJHKq: if ($type == 2) { goto fTKLv; } goto pGOku; o8kAL: $uid = intval($_GPC['uid']); goto ohlAg; VBaIn: $sql = 'select u.*,p.allcommission,p.referrer_name,p.status from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=\'' . $uid . '\' '; goto GDRsw; zfctp: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $uid . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . ')'); goto i8ZGC; HbIec: if ($type == 1) { goto S_7pW; } goto zJHKq; NpGhk: $pageindex = max(1, intval($_GPC['page'])); goto NApZt; k4SZ2: include $this->template('web/usersinfo'); goto zathu; ohlAg: $type = intval($_GPC['type']); goto SjsZL; G8efs: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $uid . ' and uniacid=' . $uniacid . ')'); goto A8ENk; SjsZL: $status = array("待审核", "通过审核", "拒绝"); goto NpGhk; GDRsw: $total = pdo_fetchcolumn('select count(*) as wname from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=\'' . $uid . '\' '); goto cR7Fy; x_hnR: $uniacid = $_W['uniacid']; goto o8kAL; iEMwy: V0zG8: goto yhToB; C2e75: $sql = 'select u.*,p.allcommission,p.referrer_name,p.status from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $uid . ' and uniacid=' . $uniacid . ')'; goto G8efs; yhToB: $pager = pagination($total, $pageindex, $pagesize); goto k4SZ2; Ss87t: $list = pdo_fetchall($sql); goto U1x0q; U1x0q: if (!$list) { goto V0zG8; } goto xNWG2; pGOku: $sql = 'select u.*,p.allcommission,p.referrer_name,p.status from ' . tablename('yzhyk_sun_user') . ' as u left join ' . tablename('yzhyk_sun_distribution_promoter') . ' as p on u.id=p.uid where  u.uniacid=\'' . $uniacid . '\' and u.parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=ANY(SELECT id as user1 FROM ' . tablename('yzhyk_sun_user') . ' WHERE parents_id=' . $uid . ' and uniacid=' . $uniacid . ') and uniacid=' . $uniacid . ')'; goto zfctp; PBRGV: global $_GPC, $_W; goto x_hnR; xNWG2: foreach ($list as $k => $v) { $list[$k]['no'] = $k + 1; B5kg5: } goto lGBLR; cR7Fy: goto QDv_1; goto gsUmE; Gyfr3: S_7pW: goto VBaIn; lGBLR: rHPAH: goto iEMwy; A8ENk: QDv_1: goto Ss87t; NApZt: $pagesize = 10; goto HbIec; gsUmE: fTKLv: goto C2e75; i8ZGC: goto QDv_1; goto Gyfr3; zathu: } } ?>