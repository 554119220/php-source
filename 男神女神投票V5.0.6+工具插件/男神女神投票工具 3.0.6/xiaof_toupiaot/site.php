<?php
 defined('IN_IA') or exit('Access Denied'); class Xiaof_toupiaotModuleSite extends WeModuleSite { public function _init() { goto lJ8Fd; ydJJN: $modules = module_fetch('xiaof_toupiao'); goto Z9OUS; lJ8Fd: load()->model('module'); goto ydJJN; oWwiq: message('本模块为男神女神投票工具插件，必须先安装男神女神投票主程序，才可以使用'); goto r9y9V; Z9OUS: if (!(count($modules) <= 0)) { goto MB603; } goto oWwiq; r9y9V: MB603: goto Bf9oi; Bf9oi: } public function doWebAddvote() { goto xRZLQ; IBSt1: include $this->template('edit'); goto hbgwP; Iilqb: $sleep = $stoptime - $starttime; goto c1wVZ; j5K39: closedir($handle); goto Smhr1; nDRnz: if (!is_dir($dir . '/' . $file)) { goto zYvP6; } goto GhYTE; ocCYJ: $uids = array(); goto biF5Y; Z2NPa: goto DAZ0u; goto rKPnh; nISu3: wJ5Zu: goto GZHe9; HGlHT: O5OsU: goto Awqr1; QmA9M: QOWeu: goto Jhmig; HjTY9: $files = array(); goto n3ve0; tiJta: $stoptime = strtotime($_GPC['times']['end']); goto RmQmM; Enslo: if (!($file != '..' && $file != '.')) { goto kyS9B; } goto nDRnz; sxsND: if (!@($handle = opendir($dir))) { goto AYLe2; } goto Pz290; GZHe9: message('计划任务添加成功', $this->createWebUrl('tasklist'), 'success'); goto dem6u; TR6hB: $sid = intval($_GPC['sid']); goto sMtJh; oQRe9: $starttime = date('Y-m-d H:i:s', TIMESTAMP); goto ss7gQ; g3VgL: $settinglists = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiao_setting') . $condition); goto HjTY9; c1wVZ: $sleeptime['good'] = empty($_GPC['ltime']) ? 10 : intval($_GPC['ltime']); goto sIlgm; W9BKf: $this->_init(); goto eWJzb; RmQmM: $starttime = $starttime <= TIMESTAMP ? TIMESTAMP : $starttime; goto Iilqb; anXjK: $accounts = uni_owned(); goto oQRe9; nvloI: DAZ0u: goto g1g33; biF5Y: if (strexists($_GPC['uid'], ',')) { goto xkBW9; } goto nSRu0; G4Oqc: OeN1B: goto zSrDG; NxKou: if (!(($file = readdir($handle)) !== false)) { goto D4hfl; } goto Enslo; hiADb: message('参数错误', referer(), 'error'); goto G4Oqc; tn1Iz: D4hfl: goto j5K39; GhYTE: $files[] = $file; goto yC_ET; Pz290: cvY0W: goto NxKou; RfAOp: load()->func('tpl'); goto zZnu1; sIlgm: if (!($sleeptime['good'] < 3)) { goto QOWeu; } goto GblO_; y1oW4: $condition = ' WHERE `uniacid` = ' . $_W['uniacid'] . ' '; goto g3VgL; zZnu1: $condition = ''; goto y1oW4; n3ve0: $dir = MODULE_ROOT . '/template'; goto sxsND; rKPnh: xkBW9: goto Sc5nC; nSRu0: $uidall = array($_GPC['uid']); goto Z2NPa; eWJzb: load()->model('account'); goto anXjK; Awqr1: foreach ($uids as $value) { goto QSOv0; QSOv0: if ($uitem = pdo_fetch('SELECT * FROM ' . tablename('xiaof_toupiao') . ' WHERE `sid` = :sid AND `uid` = :uid', array(":sid" => $sid, ":uid" => $value))) { goto wCvv3; } goto pQUi2; SNV6r: wCvv3: goto y3UMY; VIJWx: message('计划任务添加失败', '', 'error'); goto FgFFI; TB1wf: eSw0C: goto ID68M; pQUi2: message('该活动中未查询到该选手！', '', 'error'); goto SNV6r; FgFFI: T0qar: goto TB1wf; y3UMY: if (pdo_insert('xiaof_toupiaot', array("sid" => $sid, "openlog" => $_GPC['makelog'], "fans" => $_GPC['fans'], "uniacid" => $_W['uniacid'], "acid" => 0, "uid" => $value, "pid" => $uitem['id'], "sleeptime" => iserializer($sleeptime), "goodnum" => intval($_GPC['goodvalue']), "clicknum" => intval($_GPC['clickvalue']), "sharenum" => intval($_GPC['sharevalue']), "addr" => $_GPC['ipaddrs'], "starttime" => $starttime, "stoptime" => $stoptime, "created_at" => TIMESTAMP))) { goto T0qar; } goto VIJWx; ID68M: } goto nISu3; pcESS: kyS9B: goto ZRLVL; g1g33: foreach ($uidall as $v) { goto CB7VT; ON3yc: goto vCpVe; goto DrWpg; ooKZS: FWRn8: goto jUIuy; TAxT1: B4NPL: goto s24pz; jq8hE: $i++; goto mpmhC; vKBhb: jC2WY: goto s0yjo; CB7VT: if (strexists($v, '-')) { goto AHwou; } goto cy_kc; s0yjo: vCpVe: goto ooKZS; s24pz: if (!($i <= $uidregion[1])) { goto jC2WY; } goto kIjeD; h4qUO: $i = $uidregion[0]; goto TAxT1; mpmhC: goto B4NPL; goto vKBhb; TgR0g: $uidregion = explode('-', $v); goto h4qUO; kIjeD: $uids[] = $i; goto xNQj0; cy_kc: $uids[] = intval($v); goto ON3yc; DrWpg: AHwou: goto TgR0g; xNQj0: FwFsq: goto jq8hE; jUIuy: } goto HGlHT; NBKx8: $sleeptime['click'] = sprintf('%.2f', $sleep / intval($_GPC['clickvalue'])); goto ocCYJ; Jhmig: $sleeptime['share'] = sprintf('%.2f', $sleep / intval($_GPC['sharevalue'])); goto NBKx8; Sc5nC: $uidall = explode(',', $_GPC['uid']); goto nvloI; yC_ET: zYvP6: goto pcESS; GblO_: message('加票时间间隔不能少于3'); goto QmA9M; dem6u: rljDb: goto IBSt1; Smhr1: AYLe2: goto IiiGt; ss7gQ: $endtime = date('Y-m-d H:i:s', TIMESTAMP); goto RfAOp; xRZLQ: global $_W, $_GPC; goto W9BKf; zSrDG: $starttime = strtotime($_GPC['times']['start']); goto tiJta; ZRLVL: goto cvY0W; goto tn1Iz; IiiGt: if (!$_W['ispost']) { goto rljDb; } goto TR6hB; sMtJh: if (!empty($sid)) { goto OeN1B; } goto hiADb; hbgwP: } public function doWebAddgiftvote() { goto PBtmk; LyuPB: $sleep = $stoptime - $starttime; goto yuJrn; Nndc0: $dir = MODULE_ROOT . '/template'; goto OdAXS; GnFJu: include $this->template('giftedit'); goto NL_0M; y3c5v: zWTOV: goto XffQ6; oNzlc: xhK2F: goto Py4SS; p28WD: if ($keyword) { goto pCNrg; } goto X8KBB; ojnR1: $filter = array("uniacid" => $_W['uniacid'], "tit like" => "%{$keyword}%"); goto GGU91; XffQ6: foreach ($uidall as $v) { goto eaLUg; wvO96: goto SQIeu; goto fqL3F; AHRR2: Ys1Bl: goto xQQW8; hMvOV: fLFqn: goto BN3TV; BN3TV: SQIeu: goto QEmrH; s8PyX: $uids[] = $i; goto FheMF; FheMF: xcOKT: goto SsC5g; G1Y2J: $i = $uidregion[0]; goto AHRR2; bM2HZ: $uids[] = intval($v); goto wvO96; xQQW8: if (!($i <= $uidregion[1])) { goto fLFqn; } goto s8PyX; fqL3F: cmGVk: goto O55Ru; E65wh: goto Ys1Bl; goto hMvOV; QEmrH: Jic11: goto IQ8HF; SsC5g: $i++; goto E65wh; O55Ru: $uidregion = explode('-', $v); goto G1Y2J; eaLUg: if (strexists($v, '-')) { goto cmGVk; } goto bM2HZ; IQ8HF: } goto eZ7_G; YiUPg: if (!(count($_GPC['givinglist']) <= 0)) { goto d8vKW; } goto eu9DT; XWPsL: if (!($sleeptime['good'] < 3)) { goto rPDaP; } goto Y3x31; in90o: i_DN5: goto rCr2i; p3JIM: load()->func('tpl'); goto GEwJh; nYR0o: message('计划任务添加成功'); goto S2Kxs; kDJ4S: dYf5U: goto hlt5X; LszZR: ctqTp: goto n5QOm; jiepG: $uids = array(); goto EOAWv; qbcM7: $uidall = explode(',', $_GPC['uid']); goto y3c5v; ta4jJ: $uidall = array($_GPC['uid']); goto GK9Ac; Y3x31: message('加票时间间隔不能少于3'); goto xU9E5; rCr2i: $starttime = strtotime($_GPC['times']['start']); goto gPSie; xU9E5: rPDaP: goto YiUPg; PiIco: exit; goto XWcVa; S2Kxs: JaADK: goto GnFJu; OdAXS: if (!@($handle = opendir($dir))) { goto xhK2F; } goto LszZR; v5RIV: load()->model('account'); goto fLNRY; Ia937: $settinglists = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiao_setting') . $condition); goto J_NsL; pm6xh: $sleeptime['click'] = sprintf('%.2f', $sleep / intval($_GPC['clickvalue'])); goto saKjX; eu9DT: message('至少选择一种礼物'); goto vOnqe; fLNRY: $accounts = uni_owned(); goto IevoZ; kNaxs: $condition = ' WHERE `uniacid` = ' . $_W['uniacid'] . ' '; goto Ia937; X8KBB: exit; goto y_2In; GK9Ac: goto zWTOV; goto LGLcF; yuJrn: $sleeptime['good'] = empty($_GPC['ltime']) ? 10 : intval($_GPC['ltime']); goto XWPsL; I0kjH: message('参数错误', referer(), 'error'); goto in90o; oGpZN: echo json_encode($list); goto PiIco; Z3zdY: $this->_init(); goto v5RIV; CLHns: if (!empty($sid)) { goto i_DN5; } goto I0kjH; J_NsL: $files = array(); goto Nndc0; eZ7_G: CIFvK: goto kN36h; teYSM: B6lyQ: goto nYR0o; vOnqe: d8vKW: goto PHeB9; jFRER: if (!($file != '..' && $file != '.')) { goto gAUmm; } goto v3Oz1; QkuAC: Q3bip: goto s5Z1X; kN36h: foreach ($uids as $value) { goto i_ZsQ; TfP2l: goto stBr2; goto kBjec; i_ZsQ: if ($uitem = pdo_fetch('SELECT * FROM ' . tablename('xiaof_toupiao') . ' WHERE `sid` = :sid AND `uid` = :uid', array(":sid" => $sid, ":uid" => $value))) { goto gvnJX; } goto TfP2l; kBjec: gvnJX: goto Vl2pG; Y0_7V: stBr2: goto GP_di; Vl2pG: pdo_insert('xiaof_toupiaot', array("sid" => $sid, "type" => 1, "data" => iserializer($_GPC['givinglist']), "vnum" => $vnum, "openlog" => $_GPC['makelog'], "fans" => $_GPC['fans'], "uniacid" => $_W['uniacid'], "acid" => 0, "uid" => $value, "pid" => $uitem['id'], "sleeptime" => iserializer($sleeptime), "goodnum" => intval($_GPC['goodvalue']), "clicknum" => intval($_GPC['clickvalue']), "sharenum" => intval($_GPC['sharevalue']), "addr" => $_GPC['ipaddrs'], "starttime" => $starttime, "stoptime" => $stoptime, "created_at" => TIMESTAMP)); goto Y0_7V; GP_di: } goto teYSM; Py4SS: if (!($_GPC['act'] == 'getact')) { goto OiHPR; } goto PsVIi; s5Z1X: closedir($handle); goto oNzlc; BsQWv: if (!$_W['ispost']) { goto JaADK; } goto TFqLT; XWcVa: OiHPR: goto BsQWv; v3Oz1: if (!is_dir($dir . '/' . $file)) { goto dYf5U; } goto zlwjd; n5QOm: if (!(($file = readdir($handle)) !== false)) { goto Q3bip; } goto jFRER; PHeB9: $sleeptime['share'] = sprintf('%.2f', $sleep / intval($_GPC['sharevalue'])); goto pm6xh; zlwjd: $files[] = $file; goto kDJ4S; fId2u: $endtime = date('Y-m-d H:i:s', TIMESTAMP); goto p3JIM; gPSie: $stoptime = strtotime($_GPC['times']['end']); goto KgOR6; EOAWv: if (strexists($_GPC['uid'], ',')) { goto NmJru; } goto ta4jJ; KgOR6: $starttime = $starttime <= TIMESTAMP ? TIMESTAMP : $starttime; goto LyuPB; saKjX: $vnum = empty($_GPC['giftnum']) ? 1 : intval($_GPC['giftnum']); goto jiepG; y_2In: pCNrg: goto ksLhn; TFqLT: $sid = intval($_GPC['sid']); goto CLHns; GGU91: $list = pdo_getall('xiaof_toupiao_setting', $filter, '', '', $orderby, array()); goto oGpZN; LGLcF: NmJru: goto qbcM7; PBtmk: global $_W, $_GPC; goto Z3zdY; KQuGe: goto ctqTp; goto QkuAC; PsVIi: $keyword = $_GPC['keyword']; goto p28WD; hlt5X: gAUmm: goto KQuGe; ksLhn: $orderby = 'ORDER BY created_at DESC'; goto ojnR1; GEwJh: $condition = ''; goto kNaxs; IevoZ: $starttime = date('Y-m-d H:i:s', TIMESTAMP); goto fId2u; NL_0M: } public function doWebgetgift() { goto K6Pg1; wbBbc: echo json_encode(array("message" => $result)); goto Dadfg; TC2IJ: exit('缺少参数'); goto f3kuv; HYx7F: $settings = pdo_fetch('SELECT * FROM ' . tablename('xiaof_toupiao_setting') . $condition); goto otxDs; IpyZe: $condition = ' WHERE `id` = ' . intval($_GPC['sid']) . ' '; goto HYx7F; vlBKy: $result = ''; goto iUfqx; otxDs: $data = iunserializer($settings['data']); goto vlBKy; K6Pg1: global $_GPC; goto FZ603; FZ603: if (isset($_GPC['sid'])) { goto tDHXF; } goto TC2IJ; iUfqx: foreach ($data['giving'] as $k => $v) { $result .= '<label class="checkbox-inline"><input type="checkbox" name="givinglist[]" value="' . $k . '">' . $v['name'] . '</label>'; cILi4: } goto mYjxp; f3kuv: tDHXF: goto IpyZe; mYjxp: PVkgY: goto wbBbc; Dadfg: } public function doWebtasklist() { goto f4m1L; hCvez: $playery = pdo_get('xiaof_toupiao', array("sid" => $task['sid'], "id" => $task['pid'])); goto yXZEt; GMcJv: pdo_query('DELETE FROM ' . tablename('xiaof_toupiaot') . ' WHERE `id` IN (\'' . implode('\',\'', $fanids) . '\')'); goto NOGXH; dcg7T: $tid = $_GPC['tid']; goto dqrPW; tlIoj: PUvvv: goto tKrW5; KvgAx: $list = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiaot') . $condition . ' ORDER BY `id` DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, $pars); goto mUX9_; O3c3m: sOcmJ: goto zGxSz; NCT92: if (empty($_GPC['del'])) { goto Qhsq2; } goto JXWBF; gtzql: foreach ($settinglists as $v) { $sids[] = intval($v['id']); Y06vl: } goto J3OzT; NgeaM: $condition .= ' `sid`=:sid'; goto vxwKM; H5mYK: if (empty($_GPC['status1'])) { goto sOcmJ; } goto FFTSJ; PoC2u: hq7yt: goto PvzHl; KTMCU: $pars[':status'] = intval($_GPC['status1']) - 1; goto O3c3m; jMo_G: include $this->template('taskdetail'); goto PoC2u; Jlbkz: $this->_init(); goto NCT92; UXRAK: if ($act == 'display') { goto A8j29; } goto p81YY; FFTSJ: $condition .= ' AND `status`=:status'; goto KTMCU; p81YY: if ($act == 'detail') { goto PUvvv; } goto o8FL5; cxSW8: if (!isset($_GPC['status'])) { goto tse5g; } goto Dfv99; mUX9_: $pager = pagination($total, $pindex, $psize); goto FmhSt; LlgKI: A8j29: goto Jlbkz; FmhSt: include $this->template('tasklist'); goto Dengq; vxwKM: $pars[':sid'] = intval($_GPC['sid']); goto QrhOU; zGxSz: $pindex = max(1, intval($_GPC['page'])); goto QE4OV; ChuBC: goto NvkmB; goto SufDo; M00cP: $condition .= empty($condition) ? ' WHERE ' : ' AND '; goto i7ALG; Lx08t: vjyR2: goto GMcJv; iv7vI: $act = in_array($_GPC['act'], array("display", "detail")) ? $_GPC['act'] : 'display'; goto UXRAK; SufDo: bI0aB: goto NgeaM; eKIfF: $pars = array(); goto ChuBC; LrRxr: $condition .= ' `sid` in (\'' . implode('\',\'', $sids) . '\')'; goto eKIfF; Dfv99: pdo_update('xiaof_toupiaot', array("status" => intval($_GPC['status'])), array("id" => intval($_GPC['tid']))); goto Idjfn; NOGXH: Qhsq2: goto cxSW8; f4m1L: global $_W, $_GPC; goto iv7vI; cr4jX: $settinglists = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiao_setting') . $condition . ''); goto M00cP; ZCrep: $activity = pdo_get('xiaof_toupiao_setting', array("uniacid" => $_W['uniacid'], "id" => $task['sid'])); goto hCvez; Idjfn: tse5g: goto o7SDo; Xr3mF: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('xiaof_toupiaot') . $condition, $pars); goto KvgAx; K3oKV: foreach ($_GPC['delete'] as $v) { $fanids[] = intval($v); gsvky: } goto Lx08t; hEjC1: woFTI: goto cr4jX; o7SDo: $condition = ''; goto TElwE; QE4OV: $psize = 20; goto Xr3mF; xgzSN: $condition = ' WHERE `uniacid` = ' . $_W['uniacid'] . ' '; goto hEjC1; dqrPW: $task = pdo_get('xiaof_toupiaot', array("uniacid" => $_W['uniacid'], "id" => $tid)); goto ZCrep; J3OzT: oPvGK: goto LrRxr; JXWBF: $fanids = array(); goto K3oKV; yXZEt: $condition = ' WHERE `sid`=' . $task['sid'] . ' AND `rid`=' . $playery['uid']; goto TCI8K; TElwE: if ($_W['isfounder']) { goto woFTI; } goto xgzSN; TCI8K: $playery['giftnum'] = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('xiaof_toupiao_giving') . $condition); goto jMo_G; QrhOU: NvkmB: goto H5mYK; i7ALG: if (!empty($_GPC['sid'])) { goto bI0aB; } goto p_dtG; p_dtG: $sids = array(); goto gtzql; Dengq: goto hq7yt; goto tlIoj; o8FL5: goto hq7yt; goto LlgKI; tKrW5: $area = array("s_BJ" => "北京", "s_GD" => "广东", "s_SD" => "山东", "s_ZJ" => "浙江", "s_JS" => "江苏", "s_SH" => "上海", "s_LN" => "辽宁", "s_SC" => "四川", "s_HA" => "河南", "s_HB" => "湖北", "s_FJ" => "福建", "s_HN" => "湖南", "s_HE" => "河北", "s_CQ" => "重庆", "s_SX" => "山西", "s_JX" => "江西", "s_SN" => "陕西", "s_AH" => "安徽", "s_HL" => "黑龙江", "s_GX" => "广西", "s_JL" => "吉林", "s_YN" => "云南", "s_TJ" => "天津", "s_NM" => "内蒙古", "s_XJ" => "新疆", "s_GS" => "甘肃", "s_GZ" => "贵州", "s_HI" => "海南", "s_NX" => "宁夏", "s_QH" => "青海", "s_XZ" => "西藏", "s_HK" => "香港"); goto dcg7T; PvzHl: } public function doWebtaskstart() { goto Lu7oa; PBh7n: message($html, $_W['siteroot'] . $_W['script_name'] . '?' . $_SERVER['QUERY_STRING']); goto kn2a2; MLhbf: goto NJ_Ys; goto w4Cnv; KYuSw: FlQLo: goto oRrw0; yxIrU: $domainrand = array_rand($domains); goto lc7Wn; Lu7oa: global $_W, $_GPC; goto nXaHj; j7go_: if ($list = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiaot') . ' WHERE `status` = \'0\' AND `starttime` <= \'' . TIMESTAMP . '\' AND `updated_at` <= \'' . $updated_at . '\'')) { goto SY6wR; } goto M7dku; W_p3W: goto f4t3V; goto iCxNg; ptImE: foreach ($list as $k => $v) { goto uKeiw; FPCdW: $this->makelog($v, $xiaofsetting, $ip, $addnum, $addlogtime, $fansinfo, $rid); goto p1WUt; Lcj9p: $ipget = ihttp_request($domain . '/ipaddr.php?city=' . $v['addr'] . '&num=2000', array(), 5); goto k4aOS; Gp1bC: $set .= ' `complete` = complete+' . $addnum . ', `goodtime` = \'' . $goodtime . '\''; goto am806; QARsr: kjTEp: goto jTjHj; dx2rt: if (!($v['sharenum'] >= 1 && empty($uitem['locking_count']))) { goto pHdu1; } goto WyMpP; JEvCJ: $set .= ','; goto Z2RYn; YyCFN: vpZDs: goto uCox3; L_XVW: zyfJ2: goto UMw7E; fly4Q: $fansinfo = $this->getfansinfo($v['sid'], $v['fans']); goto n1YBu; gEs3z: goto bN0Qn; goto XTk1Q; pxUTY: $sharevalue = intval($t / $sleeptimes['share']); goto EBONv; uLJWb: $addnum = 1; goto BByxK; KI2vB: $set = ' `updated_at` = \'' . TIMESTAMP . '\' '; goto DM1B0; FCX_L: if (empty($toupiaoset)) { goto nR2Zo; } goto Y9PDD; p419e: $html .= '投票UID：' . $v['uid'] . '，加点击：' . $clickvalue . '<br/>'; goto YyCFN; kL_6x: $set .= ' , `status` = \'2\' '; goto zewZb; owyq7: $this->makelog($v, $xiaofsetting, $ip, $addnum, $addlogtime, $fansinfo, $rid, 1); goto qp0fB; qp0fB: goto uZmZ2; goto P1afJ; Pyjzs: $giftlist = iunserializer($v['data']); goto f3OTO; WyMpP: $t = empty($v['sharetime']) ? 3 : intval(TIMESTAMP - $v['sharetime']); goto pxUTY; DZDEQ: $toupiaoset .= ' `click` = click+' . $clickvalue . ' '; goto rJGpH; YxPri: nR2Zo: goto YrI3x; QfwoZ: if (!($ipget['code'] != 200)) { goto zyfJ2; } goto mpw5m; am806: $toupiaoset .= ' `good` = good+' . $addnum . ', `updated_at` = \'' . TIMESTAMP . '\' '; goto Q2sdG; nnPLI: wofaz: goto zFn3I; nBG1D: CK9Rb: goto gLF1E; f0M5I: empty($v['clicktime']) && ($clickvalue = 5); goto wttHn; DM1B0: $sleeptimes = iunserializer($v['sleeptime']); goto ORm1p; tLGct: bN0Qn: goto dx2rt; zewZb: goto bN0Qn; goto aehCB; XAJWS: $clickvalue = intval($t / $sleeptimes['click']); goto f0M5I; k4aOS: if (!($ipget['code'] != 200)) { goto CD_Q_; } goto vZW59; dnRKs: pdo_query('UPDATE ' . tablename('xiaof_toupiaot') . ' SET ' . $set . ' WHERE `id` = \'' . $v['id'] . '\''); goto MBfzH; UNdLy: dv3Gu: goto cMKj5; F12cK: $rid = mt_rand(10000000, 2147483647); goto PnKik; QPOxN: $clickvalue > 5 && ($clickvalue = 5); goto IZi2n; Q2sdG: $html .= '投票UID：' . $v['uid'] . '，加票：' . $addnum . '<br/>'; goto yb_G3; BzW7r: $set .= ','; goto nBG1D; HeQMi: $sharevalue > 3 && ($sharevalue = 3); goto FCX_L; rJGpH: if (empty($set)) { goto CK9Rb; } goto BzW7r; uKeiw: $uitem = pdo_fetch('SELECT * FROM ' . tablename('xiaof_toupiao') . ' WHERE `sid` = :sid AND `uid` = :uid', array(":sid" => $v['sid'], ":uid" => $v['uid'])); goto wOgL6; IZi2n: if (empty($toupiaoset)) { goto o4Ncd; } goto Tyopu; D4Tvn: goto uZmZ2; goto c2Ma9; bFZyc: pHdu1: goto EHfyQ; wjrda: Ru5QE: goto bFZyc; P1afJ: ldhu0: goto FPCdW; GxpoF: $html .= '投票UID：' . $v['uid'] . '，加分享：' . $sharevalue . '<br/>'; goto wjrda; rW3TZ: pdo_query('UPDATE ' . tablename('xiaof_toupiao') . ' SET ' . $toupiaoset . ' WHERE `id` = \'' . $v['pid'] . '\''); goto UNdLy; mpw5m: message('ip生成api错误'); goto L_XVW; Tyopu: $toupiaoset .= ','; goto ngdrE; ZFMch: DQUaC: goto VS0Z7; n1YBu: if (!empty($v['type'])) { goto d1GxT; } goto bfdK3; gLF1E: $set .= ' `clicktime` = \'' . TIMESTAMP . '\' '; goto p419e; c2Ma9: d1GxT: goto Pyjzs; R3RZg: if ($v['goodtime'] < TIMESTAMP) { goto ZPLwM; } goto gEs3z; yTdOM: if (!(!empty($toupiaoset) && empty($uitem['locking_count']))) { goto dv3Gu; } goto rW3TZ; BByxK: $addlogtime = TIMESTAMP; goto F12cK; uCox3: B17Ka: goto yTdOM; tsjfj: $this->cacheSet($ipcachekey, $ips, 600); goto MKNYc; MBfzH: SUpez: goto QARsr; nuMIf: qgWa7: goto tLGct; f3OTO: $gid = $giftlist[array_rand($giftlist)]; goto N7BGK; wOgL6: $ipcachekey = $v['addr']; goto vtNOt; vZW59: $ipget = ihttp_request($domain1 . '/ipaddr.php?city=' . $v['addr'] . '&num=2000', array(), 5); goto QfwoZ; zFn3I: $html .= '选手：' . $uitem['name'] . '。 编号(UID)：' . $v['uid'] . '，已被锁定,无法加票。<br/>'; goto nuMIf; EBONv: empty($v['sharetime']) && ($sharevalue = 3); goto C5Bus; vtNOt: if ($ips = $this->cacheGet($ipcachekey)) { goto GoHUy; } goto Lcj9p; aehCB: ZPLwM: goto HFPs6; oscO6: if (empty($set)) { goto DQUaC; } goto qN5HG; XTk1Q: H1FTF: goto kL_6x; YrI3x: $toupiaoset .= ' `share` = share+' . $sharevalue . ' '; goto Mbfm1; ngdrE: o4Ncd: goto DZDEQ; Z2RYn: A5_Sl: goto qQd29; Y9PDD: $toupiaoset .= ','; goto YxPri; qQd29: $set .= ' `sharetime` = \'' . TIMESTAMP . '\' '; goto GxpoF; tvqvm: $ips = json_decode($ipget['content'], true); goto tsjfj; PnKik: $ip = sprintf('%u', ip2long($ips[array_rand($ips)])); goto fly4Q; C5Bus: if (!($sharevalue >= 1)) { goto Ru5QE; } goto HeQMi; p1WUt: uZmZ2: goto oscO6; cpd6H: $t = empty($v['clicktime']) ? 3 : intval(TIMESTAMP - $v['clicktime']); goto XAJWS; yb_G3: goto qgWa7; goto nnPLI; EHfyQ: if (!($v['clicknum'] >= 1 && empty($uitem['locking_count']))) { goto B17Ka; } goto cpd6H; cMKj5: if (!(!empty($set) && empty($uitem['locking_count']))) { goto SUpez; } goto dnRKs; wttHn: if (!($clickvalue >= 1)) { goto vpZDs; } goto QPOxN; VS0Z7: $goodtime = TIMESTAMP + $sleeptimes['good']; goto Gp1bC; MKNYc: GoHUy: goto I6i9n; bfdK3: if (!empty($v['openlog'])) { goto ldhu0; } goto D4Tvn; qN5HG: $set .= ','; goto ZFMch; UMw7E: CD_Q_: goto tvqvm; Mbfm1: if (empty($set)) { goto A5_Sl; } goto JEvCJ; ORm1p: if ($v['complete'] >= $v['goodnum'] or $v['stoptime'] <= TIMESTAMP) { goto H1FTF; } goto R3RZg; N7BGK: $addnum = $this->makegiftlog($v, $xiaofsetting, $gid, $fansinfo, $v['pid'], $addlogtime, $rid, $ip); goto owyq7; HFPs6: if (!empty($uitem['locking_count'])) { goto wofaz; } goto uLJWb; I6i9n: $toupiaoset = ''; goto KI2vB; jTjHj: } goto Z1YpL; M7dku: message('本次任务已全部完成'); goto W_p3W; lmZTd: f4t3V: goto PBh7n; Z1YpL: FbSOA: goto lmZTd; sM1C7: load()->func('communication'); goto ptImE; iCxNg: SY6wR: goto sM1C7; vH8G8: wClgN: goto hdbMB; MXvM5: NJ_Ys: goto AQQEl; HKCwm: $xiaofsetting = array(); goto nyiwq; w4Cnv: lsqEr: goto PIw3F; lc7Wn: $domain = $domains[$domainrand]; goto mXS1b; M7yKj: $html = 'start' . '<br/>'; goto lfgtg; PIw3F: $xiaofsetting['version'] = 0; goto MXvM5; nXaHj: $domains = array("http://demo.puzzlephp.com", "http://weixin.puzzlephp.com"); goto yxIrU; AQQEl: $this->cacheSet($settingcachekey, $xiaofsetting, 600); goto KYuSw; nyiwq: foreach ($settinglists as $v) { goto Pedx2; Pedx2: $data = iunserializer($v['data']); goto TgfyT; CMY5W: sNKwJ: goto aQvw9; Q75hZ: isset($data['giving']) && ($xiaofsetting['giftdata'][$v['id']] = $data['giving']); goto CMY5W; TgfyT: $xiaofsetting['setting'][$v['id']] = $data['splittingtable']; goto Q75hZ; aQvw9: } goto vH8G8; I2tZl: if ($xiaofsetting = $this->cacheGet($settingcachekey)) { goto FlQLo; } goto lnPT8; hdbMB: if (!pdo_tableexists('xiaof_toupiao_giving')) { goto lsqEr; } goto rZ2U1; lnPT8: $settinglists = pdo_fetchall('SELECT * FROM ' . tablename('xiaof_toupiao_setting')); goto HKCwm; rZ2U1: $xiaofsetting['version'] = 10; goto MLhbf; mXS1b: $domain1 = empty($domainrand) ? $domains[1] : $domains[0]; goto M7yKj; lfgtg: $settingcachekey = 'setting'; goto I2tZl; oRrw0: $updated_at = TIMESTAMP - 3; goto j7go_; kn2a2: } public function doWebinventeddata() { goto yk_1q; vbtLf: $files = array(); goto Li9hT; y9IRf: OA_24: goto nNaoV; yk_1q: global $_W, $_GPC; goto vbtLf; Li9hT: $dir = MODULE_ROOT . '/template'; goto m7PzC; FAsiM: $li['path'] = tomedia($path . '/' . $file_s); goto IGwFQ; m7PzC: if (!@($handle = opendir($dir))) { goto yqrbX; } goto XmlIi; nNaoV: closedir($handle); goto pWLq3; bDlOx: include $this->template('inventeddata'); goto FxPJu; iGu2P: if (is_dir('./' . $file_s)) { goto mzAcQ; } goto nlJYA; fUVH_: if (!(false !== ($file_s = readdir($handle_s)))) { goto lz8Yi; } goto qS4po; aZB8S: if (!(($file = readdir($handle)) !== false)) { goto OA_24; } goto wTkml; nuUWy: $files[] = $fi; goto enUpH; nl9kF: goto BEzfU; goto jvEpE; eCkZ4: fHK3H: goto U2ozJ; grYGb: r91fy: goto D7T28; jvEpE: lz8Yi: goto ZjNEq; zvWy6: $li['name'] = $names[0]; goto FAsiM; qS4po: list($filesname, $kzm) = explode('.', $file_s); goto Z77Fz; pc2Je: BEzfU: goto fUVH_; enUpH: JblNA: goto eCkZ4; nE23z: d2iYP: goto bDlOx; QiRrX: uUEdi: goto nl9kF; Vw44K: $list[] = $li; goto QiRrX; nlJYA: $names = explode('.', $file_s); goto zvWy6; XmlIi: NOkaz: goto aZB8S; mMMzc: foreach ($list as $k => $i) { rXgvd: } goto grYGb; Z77Fz: if (!($kzm == 'gif' or $kzm == 'jpg' or $kzm == 'JPG' or $kzm == 'png')) { goto uUEdi; } goto Jmj_5; xGoF_: if (!is_dir($dir . '/' . $file)) { goto JblNA; } goto RP8ZD; Gj2FX: $list = array(); goto pc2Je; Jmj_5: $li = array(); goto iGu2P; IGwFQ: mzAcQ: goto Vw44K; kM_PL: $fi = array(); goto l5aa3; D7T28: if (!$_W['ispost']) { goto d2iYP; } goto nE23z; l5aa3: $fi['filename'] = $file; goto prV0m; U2ozJ: goto NOkaz; goto y9IRf; ZjNEq: $fi['list'] = $list; goto nuUWy; pWLq3: yqrbX: goto mMMzc; prV0m: $handle_s = opendir($path); goto Gj2FX; RP8ZD: $path = MODULE_ROOT . '/template/' . $file; goto kM_PL; wTkml: if (!($file != '..' && $file != '.')) { goto fHK3H; } goto xGoF_; FxPJu: } protected function cacheSet($key, $data, $expiration = 60) { goto SUUwL; VI9jK: $record = array(); goto PFjvA; PFjvA: $record['key'] = $key; goto lbidq; hPZZL: y3zc4: goto VI9jK; lbidq: $record['value'] = iserializer($data); goto zkolC; Up25m: return cache_write($cachekey, $record); goto XHtzP; wLOm4: return false; goto hPZZL; SUUwL: if (!(empty($key) || !isset($data))) { goto y3zc4; } goto wLOm4; zkolC: $record['expiration'] = TIMESTAMP + $expiration; goto eqAFu; eqAFu: $cachekey = 'xiaoftool:' . $key; goto Up25m; XHtzP: } protected function cacheGet($key) { goto TGoRm; IKlE4: return false; goto vkjdr; uFjOK: if (!(TIMESTAMP >= $cache['expiration'])) { goto cdqoL; } goto jT4fF; oCLeW: cdqoL: goto D8uIM; hzFrR: $cachekey = 'xiaoftool:' . $key; goto jVuuY; C85N2: return false; goto EpLdk; jVuuY: if ($cache = cache_read($cachekey)) { goto PmDGU; } goto IKlE4; jT4fF: cache_delete($cachekey); goto dK1o9; vkjdr: PmDGU: goto uFjOK; dK1o9: return false; goto oCLeW; D8uIM: return iunserializer($cache['value']); goto dAFjH; EpLdk: VTl3H: goto hzFrR; TGoRm: if (!empty($key)) { goto VTl3H; } goto C85N2; dAFjH: } protected function getfansinfo($sid, $fans) { goto wamfR; zprw7: M_8Mz: goto EuiQk; kzPYf: if (!@($handle = opendir($dir))) { goto jyNVt; } goto tsBA2; dH6t2: if (!(($file = readdir($handle)) !== false)) { goto J8coV; } goto FEYYj; YX8CK: $dir = MODULE_ROOT . '/template'; goto kzPYf; j7FEN: $files = array(); goto YX8CK; EuiQk: return $fansinfos[array_rand($fansinfos)]; goto HZBNO; FEYYj: if (!($file != '..' && $file != '.')) { goto IR00P; } goto YQhFG; zCp6h: if (!empty($fans)) { goto lPErh; } goto j7FEN; qK2Ar: $fansinfos[] = array("a" => tomedia($path . '/' . $file_s), "n" => $file_s_s[0], "o" => ""); goto S3CgY; Zgp4t: DGoP9: goto BaprB; wamfR: global $_W; goto zCp6h; qqEgl: $fansinfos = array(); goto qMRcR; jKtNm: $fans = $files[array_rand($files)]; goto WtLNF; xRdvP: closedir($handle); goto io4R6; tsBA2: ZdvNo: goto dH6t2; ydZEb: list($filesname, $kzm) = explode('.', $file_s); goto WY7_l; PeI7A: if (!(false !== ($file_s = readdir($handle_s)))) { goto M_8Mz; } goto ydZEb; io4R6: jyNVt: goto jKtNm; Ag9aE: J8coV: goto xRdvP; WY7_l: if (!($kzm == 'gif' or $kzm == 'jpg' or $kzm == 'JPG' or $kzm == 'png')) { goto DGoP9; } goto BPmXU; ylK_2: $fansinfos = array(); goto hxqhh; qMRcR: yFTd0: goto PeI7A; BaprB: goto yFTd0; goto zprw7; hxqhh: $path = MODULE_ROOT . '/template/' . $fans; goto lfCPj; iKkhQ: $file_s_s = explode('.', $file_s); goto qK2Ar; S3CgY: ozMT2: goto Zgp4t; BPmXU: if (is_dir('./' . $file_s)) { goto ozMT2; } goto iKkhQ; lfCPj: $handle_s = opendir($path); goto qqEgl; Np7oC: MZ4HW: goto eauqF; WtLNF: lPErh: goto ylK_2; jM4E4: goto ZdvNo; goto Ag9aE; eauqF: IR00P: goto jM4E4; YQhFG: if (!is_dir($dir . '/' . $file)) { goto MZ4HW; } goto H_wca; H_wca: $files[] = $file; goto Np7oC; HZBNO: } protected function makegiftlog($item, $setting, $givingid, $fansinfo, $pid, $ltime, $rid, $ip) { goto stj9n; x2RnN: b5Tsi: goto R7CLu; kmjgv: $giving['id'] = $givingid; goto dMmpD; stj9n: $giving = $setting['giftdata'][$item['sid']][$givingid]; goto kmjgv; dMmpD: $addnum = intval($giving['adding']); goto o9t46; hOIXh: return $addnum; goto XXS0M; FR3RN: eBptg: goto e6teI; IiWW8: $addnum = mt_rand($nums[0], $nums[1]); goto FR3RN; e6teI: if (!($item['vnum'] > 1)) { goto b5Tsi; } goto HCbUc; HCbUc: $addnum = $giving['adding'] * $item['vnum']; goto x2RnN; en9r0: $nums = explode('-', $giving['adding']); goto IiWW8; R7CLu: pdo_insert('xiaof_toupiao_giving', array("pid" => $pid, "actual_num" => 1, "status" => 1, "day_at" => date('Ymd'), "use_at" => $ltime, "sid" => $item['sid'], "actions" => 1, "type" => 1, "givingid" => $givingid, "givingnum" => 1, "giving_name" => $giving['name'], "num" => $addnum, "buycredit" => $giving['buycredit'], "leftcredit" => 0, "rid" => $rid, "openid" => $fansinfo['o'], "uid" => 0, "nickname" => $fansinfo['n'], "avatar" => $fansinfo['a'], "ip" => $ip, "data" => iserializer($giving), "created_at" => $ltime)); goto hOIXh; o9t46: if (!strexists($giving['adding'], '-')) { goto eBptg; } goto en9r0; XXS0M: } protected function makelog($item, $xiaofsetting, $ip, $num = 1, $addlogtime, $fansinfo, $rid, $type = 0) { goto dwt7N; bL4UZ: return true; goto npugV; MBU5W: $logtable = empty($xiaofsetting['setting'][$item['sid']]) ? 'xiaof_toupiao_log' : 'xiaof_toupiao_log_' . $item['sid']; goto siG6F; Ib0fO: zuD4c: goto MBU5W; itPOq: pdo_insert('xiaof_toupiao_log', array("sid" => $item['sid'], "pid" => $item['pid'], "fanid" => 0, "nickname" => $fansinfo['n'], "avatar" => $fansinfo['a'], "num" => $num, "openid" => $fansinfo['o'], "ip" => $ip, "unique_at" => date('Ymd'), "created_at" => $addlogtime)); goto TI48E; TI48E: goto GMB9B; goto Ib0fO; dwt7N: if ($xiaofsetting['version'] == 10) { goto zuD4c; } goto itPOq; siG6F: pdo_insert($logtable, array("sid" => $item['sid'], "pid" => $item['pid'], "type" => $type, "rid" => $rid, "fanid" => 0, "nickname" => $fansinfo['n'], "avatar" => $fansinfo['a'], "num" => $num, "openid" => $fansinfo['o'], "ip" => $ip, "unique_at" => date('Ymd'), "created_at" => $addlogtime)); goto Z4ERB; Z4ERB: GMB9B: goto bL4UZ; npugV: } } ?>