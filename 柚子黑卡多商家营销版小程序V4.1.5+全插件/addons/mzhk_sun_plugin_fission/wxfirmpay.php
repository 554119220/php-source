<?php
 class WeixinfirmPay { protected $mch_appid; protected $mchid; protected $key; protected $openid; protected $partner_trade_no; protected $re_user_name; protected $desc; protected $amount; protected $apiclient_cert; protected $apiclient_key; function __construct($mch_appid, $mchid, $key, $openid, $partner_trade_no, $re_user_name, $desc, $amount, $apiclient_cert, $apiclient_key) { goto YkbiY; InRn9: $this->key = $key; goto BzgaH; j2u6g: $this->re_user_name = $re_user_name; goto Q0TVd; ysZ4x: $this->partner_trade_no = $partner_trade_no; goto j2u6g; BzgaH: $this->openid = $openid; goto ysZ4x; Q0TVd: $this->desc = $desc; goto mmKCz; KHPZf: $this->apiclient_key = $apiclient_key; goto YRQ1j; YkbiY: $this->mch_appid = $mch_appid; goto X5R7x; cIICT: $this->apiclient_cert = $apiclient_cert; goto KHPZf; mmKCz: $this->amount = $amount; goto cIICT; X5R7x: $this->mchid = $mchid; goto InRn9; YRQ1j: } public function pay() { $return = $this->unifiedorder(); return $return; } private function unifiedorder() { goto w9kIV; cDhiL: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60, $this->apiclient_cert, $this->apiclient_key)); goto Ny8if; EJWkN: $parameters = array("\155\x63\x68\x5f\x61\160\x70\x69\x64" => $this->mch_appid, "\x6d\x63\150\151\144" => $this->mchid, "\x6e\157\156\143\145\137\x73\x74\162" => $this->createNoncestr(), "\160\x61\x72\164\156\x65\x72\x5f\x74\x72\x61\x64\x65\x5f\x6e\x6f" => $this->partner_trade_no, "\157\x70\145\156\x69\144" => $this->openid, "\x63\x68\145\143\x6b\x5f\156\x61\x6d\145" => "\x4e\x4f\x5f\x43\110\105\103\113", "\x72\x65\137\165\163\x65\162\137\x6e\x61\x6d\x65" => $this->re_user_name, "\x61\x6d\157\x75\x6e\164" => $this->amount, "\144\x65\163\x63" => $this->desc, "\x73\x70\x62\151\x6c\154\x5f\143\x72\x65\141\164\145\137\x69\x70" => "\x31\x32\x30\56\x37\71\x2e\x31\65\x32\x2e\61\x30\x35"); goto oSAxu; cY13O: $xmlData = $this->arrayToXml($parameters); goto cDhiL; Ny8if: return $return; goto YWFGK; w9kIV: $url = "\x68\x74\x74\160\163\72\57\57\x61\x70\151\56\155\x63\x68\x2e\167\145\x69\170\x69\x6e\x2e\161\161\56\143\x6f\x6d\x2f\x6d\155\x70\x61\171\155\x6b\164\x74\162\141\156\163\x66\145\162\163\x2f\x70\x72\x6f\155\x6f\164\x69\157\156\57\x74\x72\141\x6e\x73\x66\x65\162\163"; goto EJWkN; oSAxu: $parameters["\x73\151\147\156"] = $this->getSign($parameters); goto cY13O; YWFGK: } private static function postXmlCurl($xml, $url, $second = 30, $apiclient_cert, $apiclient_key) { goto e4FtF; A9R34: curl_close($ch); goto NEqir; upvlP: curl_setopt($ch, CURLOPT_SSLKEY, $apiclient_key); goto qS3BP; C41mp: if ($data) { goto slRXp; } goto vm9fA; DHGel: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto H211i; Yo72X: throw new WxPayException("\143\x75\162\x6c\xe5\x87\xba\xe9\x94\x99\357\274\214\xe9\224\231\xe8\257\257\xe7\240\x81\x3a{$error}"); goto TcK5i; EgVAp: curl_setopt($ch, CURLOPT_URL, $url); goto us5HU; GPuZh: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto EgVAp; qS3BP: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto Tx_26; zX3v3: $data = curl_exec($ch); goto C41mp; AqdAA: curl_close($ch); goto Yo72X; vm9fA: $error = curl_errno($ch); goto AqdAA; ZzVd9: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto O_8zX; TcK5i: goto d9u_2; goto G4fVn; SFe1T: curl_setopt($ch, CURLOPT_POST, TRUE); goto EHQl6; SAwMs: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto SFe1T; EHQl6: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto ZzVd9; O_8zX: curl_setopt($ch, CURLOPT_SSLCERT, $apiclient_cert); goto upvlP; H211i: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto SAwMs; m9DAx: d9u_2: goto y_xHT; NEqir: return $data; goto m9DAx; us5HU: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto DHGel; Tx_26: set_time_limit(0); goto zX3v3; G4fVn: slRXp: goto A9R34; e4FtF: $ch = curl_init(); goto GPuZh; y_xHT: } private function arrayToXml($arr) { goto yXwyi; ufIZ7: $xml .= "\x3c\57\x72\157\157\164\76"; goto MLuOm; FBlEi: oI5zP: goto ufIZ7; yXwyi: $xml = "\74\x72\157\157\x74\x3e"; goto wl4GH; wl4GH: foreach ($arr as $key => $val) { goto xEkf7; IEt9b: p2ReA: goto bk02U; pEDgh: NRR6P: goto FQbUG; xEkf7: if (is_array($val)) { goto p2ReA; } goto i50b0; J4F1I: IanYk: goto pEDgh; i50b0: $xml .= "\x3c" . $key . "\76" . $val . "\74\x2f" . $key . "\76"; goto Tjb7a; bk02U: $xml .= "\74" . $key . "\x3e" . arrayToXml($val) . "\74\x2f" . $key . "\x3e"; goto J4F1I; Tjb7a: goto IanYk; goto IEt9b; FQbUG: } goto FBlEi; MLuOm: return $xml; goto g4MCZ; g4MCZ: } private function xmlToArray($xml) { goto l6W00; dfFY8: $xmlstring = simplexml_load_string($xml, "\123\151\155\160\x6c\145\130\x4d\x4c\x45\x6c\x65\155\x65\156\x74", LIBXML_NOCDATA); goto mWpa_; l6W00: libxml_disable_entity_loader(true); goto dfFY8; F4BlJ: return $val; goto kWleb; mWpa_: $val = json_decode(json_encode($xmlstring), true); goto F4BlJ; kWleb: } private function createNoncestr($length = 32) { goto J194b; JdJQL: goto IBhOV; goto Ed5u_; GLPQk: $i++; goto JdJQL; EDWAt: $i = 0; goto HaovW; Ed5u_: x1sXH: goto pCbAO; cgML0: XbIkL: goto GLPQk; bONss: if (!($i < $length)) { goto x1sXH; } goto HVDVh; HaovW: IBhOV: goto bONss; pCbAO: return $str; goto sCUlP; HVDVh: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto cgML0; zsnMP: $str = ''; goto EDWAt; J194b: $chars = "\x61\142\x63\144\145\146\147\150\x69\x6a\x6b\154\x6d\x6e\x6f\x70\161\x72\x73\x74\165\166\x77\x78\171\172\60\61\x32\63\64\65\66\x37\x38\71"; goto zsnMP; sCUlP: } private function getSign($Obj) { goto JF2tv; Tb71p: $String = $String . "\x26\153\x65\171\75" . $this->key; goto T99UG; JF2tv: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; aqPle: } goto QhVTh; WqH7x: $String = $this->formatBizQueryParaMap($Parameters, false); goto Tb71p; tL3Zw: ksort($Parameters); goto WqH7x; ljQKX: return $result_; goto B87c8; QhVTh: GTsyx: goto tL3Zw; T99UG: $String = md5($String); goto o_A6x; o_A6x: $result_ = strtoupper($String); goto ljQKX; B87c8: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto cmFQa; uygyf: foreach ($paraMap as $k => $v) { goto Bi3YR; Bi3YR: if (!$urlencode) { goto FlI1m; } goto Y3NJV; q_UTc: FlI1m: goto kvk9M; d4lWT: SNnBp: goto EWbpG; kvk9M: $buff .= $k . "\75" . $v . "\x26"; goto d4lWT; Y3NJV: $v = urlencode($v); goto q_UTc; EWbpG: } goto b5KFp; u49tA: if (!(strlen($buff) > 0)) { goto sEC7z; } goto FmXmP; b5KFp: vy__4: goto u0BQF; a29mU: return $reqPar; goto HrCpx; u0BQF: $reqPar; goto u49tA; cmFQa: $buff = ''; goto pGvXi; pGvXi: ksort($paraMap); goto uygyf; Yx1F3: sEC7z: goto a29mU; FmXmP: $reqPar = substr($buff, 0, strlen($buff) - 1); goto Yx1F3; HrCpx: } }