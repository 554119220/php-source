<?php
 class WeixinPay { protected $appid; protected $mch_id; protected $key; protected $openid; protected $out_trade_no; protected $body; protected $total_fee; function __construct($appid, $openid, $mch_id, $key, $out_trade_no, $body, $total_fee) { goto Gwryg; iAunb: $this->openid = $openid; goto QgF52; JavGl: $this->total_fee = $total_fee; goto Twvlq; HrRXu: $this->out_trade_no = $out_trade_no; goto AtAzm; QgF52: $this->mch_id = $mch_id; goto JoSPH; JoSPH: $this->key = $key; goto HrRXu; AtAzm: $this->body = $body; goto JavGl; Gwryg: $this->appid = $appid; goto iAunb; Twvlq: } public function pay() { $return = $this->weixinapp(); return $return; } private function unifiedorder() { goto XKXKK; P_3gb: $parameters = array("\141\160\x70\x69\144" => $this->appid, "\x6d\x63\x68\137\x69\x64" => $this->mch_id, "\156\x6f\x6e\x63\145\x5f\163\x74\x72" => $this->createNoncestr(), "\142\x6f\x64\x79" => $this->body, "\157\x75\164\x5f\x74\x72\141\144\145\137\x6e\157" => $this->out_trade_no, "\164\x6f\x74\x61\x6c\x5f\146\x65\145" => $this->total_fee, "\163\x70\142\x69\154\154\x5f\x63\162\x65\141\x74\145\x5f\x69\160" => "\61\71\62\x2e\61\x36\70\x2e\60\x2e\x31\x36\x31", "\x6e\x6f\x74\x69\146\x79\137\x75\162\154" => "\150\164\164\x70\72\x2f\57\167\x77\x77\x2e\167\145\151\x78\x69\156\56\161\161\x2e\143\x6f\x6d\x2f\x77\170\x70\x61\x79\57\x70\141\171\56\x70\x68\160", "\x6f\x70\x65\156\x69\144" => $this->openid, "\164\x72\141\144\x65\x5f\x74\171\x70\x65" => "\112\123\101\120\111"); goto YR4_k; cyXA9: $xmlData = $this->arrayToXml($parameters); goto Q188c; YR4_k: $parameters["\x73\151\x67\156"] = $this->getSign($parameters); goto cyXA9; Q188c: $return = $this->xmlToArray($this->postXmlCurl($xmlData, $url, 60)); goto hGvXK; hGvXK: return $return; goto vYdaQ; XKXKK: $url = "\x68\x74\164\160\163\72\57\57\141\160\x69\x2e\155\143\150\56\167\x65\151\170\151\156\56\x71\161\x2e\x63\x6f\155\x2f\x70\x61\x79\57\165\x6e\151\x66\151\145\144\x6f\x72\x64\x65\x72"; goto P_3gb; vYdaQ: } private static function postXmlCurl($xml, $url, $second = 30) { goto cul4S; fuEPg: curl_setopt($ch, CURLOPT_TIMEOUT, 40); goto WA3ld; fFpWf: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto HBJg7; hxLkc: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto Veabp; uO9Nb: throw new WxPayException("\x63\x75\162\x6c\345\207\xba\xe9\x94\x99\357\274\214\xe9\224\x99\350\257\257\347\240\201\72{$error}"); goto bmWLH; q6SWI: curl_setopt($ch, CURLOPT_URL, $url); goto fFpWf; cU5Ex: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto xUAAG; N312D: curl_close($ch); goto i7zX6; xUAAG: curl_setopt($ch, CURLOPT_POST, TRUE); goto hxLkc; WA3ld: set_time_limit(0); goto F8PhY; i7zX6: return $data; goto gNVUb; DSebW: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto cU5Ex; HBJg7: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto DSebW; mIXvo: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto q6SWI; Y3DNo: DyNzI: goto N312D; bmWLH: goto uPwKs; goto Y3DNo; zGpbf: curl_close($ch); goto uO9Nb; sQ1jy: $error = curl_errno($ch); goto zGpbf; F8PhY: $data = curl_exec($ch); goto THDgB; Veabp: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 20); goto fuEPg; gNVUb: uPwKs: goto ORe1w; cul4S: $ch = curl_init(); goto mIXvo; THDgB: if ($data) { goto DyNzI; } goto sQ1jy; ORe1w: } private function arrayToXml($arr) { goto KpaEJ; QiOfq: return $xml; goto eJTAS; ABl1O: j1Uog: goto HXIVX; HXIVX: $xml .= "\74\x2f\x72\157\157\x74\76"; goto QiOfq; GHOCW: foreach ($arr as $key => $val) { goto NBIXA; nCznB: $xml .= "\74" . $key . "\76" . arrayToXml($val) . "\74\57" . $key . "\x3e"; goto dGNPI; hAPYZ: $xml .= "\74" . $key . "\x3e" . $val . "\x3c\x2f" . $key . "\x3e"; goto jCYcD; dbhZV: mJZ24: goto RSr3U; IDgM5: nGtW1: goto nCznB; jCYcD: goto ujNtY; goto IDgM5; dGNPI: ujNtY: goto dbhZV; NBIXA: if (is_array($val)) { goto nGtW1; } goto hAPYZ; RSr3U: } goto ABl1O; KpaEJ: $xml = "\74\x72\157\157\164\x3e"; goto GHOCW; eJTAS: } private function xmlToArray($xml) { goto HistW; ZJ2QZ: $xmlstring = simplexml_load_string($xml, "\x53\x69\x6d\x70\154\x65\x58\x4d\114\105\x6c\x65\155\x65\x6e\164", LIBXML_NOCDATA); goto n76qW; n76qW: $val = json_decode(json_encode($xmlstring), true); goto jaW5c; HistW: libxml_disable_entity_loader(true); goto ZJ2QZ; jaW5c: return $val; goto R1W2v; R1W2v: } private function weixinapp() { goto v7zF8; QSfUU: return $parameters; goto Gqz0S; k6o0M: $parameters["\x70\141\x79\123\151\147\156"] = $this->getSign($parameters); goto QSfUU; v7zF8: $unifiedorder = $this->unifiedorder(); goto Z7TvG; Z7TvG: $parameters = array("\x61\x70\x70\x49\x64" => $this->appid, "\x74\x69\155\145\x53\x74\x61\155\160" => '' . time() . '', "\x6e\157\x6e\143\x65\123\x74\x72" => $this->createNoncestr(), "\x70\x61\143\153\x61\x67\145" => "\160\x72\x65\160\141\171\137\151\144\x3d" . $unifiedorder["\x70\162\145\160\x61\x79\x5f\151\144"], "\163\x69\x67\x6e\124\171\x70\x65" => "\115\104\65"); goto k6o0M; Gqz0S: } private function createNoncestr($length = 32) { goto KFv2g; ZsSfe: cwzrT: goto WqonO; vpYAE: return $str; goto Et9Ai; FK8pL: if (!($i < $length)) { goto LNNJ1; } goto Pcys8; ZCeii: LNNJ1: goto vpYAE; WqonO: $i++; goto t2c3j; Pcys8: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto ZsSfe; KFv2g: $chars = "\x61\x62\x63\144\x65\x66\x67\x68\151\152\x6b\x6c\x6d\156\x6f\160\x71\x72\163\164\165\x76\167\x78\x79\172\x30\x31\62\63\x34\x35\66\x37\x38\71"; goto cjrCA; d4lAn: qXNBl: goto FK8pL; t2c3j: goto qXNBl; goto ZCeii; cjrCA: $str = ''; goto kijuZ; kijuZ: $i = 0; goto d4lAn; Et9Ai: } private function getSign($Obj) { goto xr3xF; vtPtw: $String = $this->formatBizQueryParaMap($Parameters, false); goto AQAjM; MzLaT: duo3l: goto RuQl7; xr3xF: foreach ($Obj as $k => $v) { $Parameters[$k] = $v; fCFnf: } goto MzLaT; Q4O0X: $result_ = strtoupper($String); goto miPL8; RuQl7: ksort($Parameters); goto vtPtw; AQAjM: $String = $String . "\x26\x6b\x65\x79\x3d" . $this->key; goto z_Iwa; z_Iwa: $String = md5($String); goto Q4O0X; miPL8: return $result_; goto aKfri; aKfri: } private function formatBizQueryParaMap($paraMap, $urlencode) { goto nP6Lw; eEHjJ: $reqPar; goto CIaHZ; cAnCL: K2XoY: goto xsteS; nP6Lw: $buff = ''; goto QspVH; DfPWW: foreach ($paraMap as $k => $v) { goto q5oZ4; sxxfB: r9KhT: goto qLTjk; qLTjk: $buff .= $k . "\75" . $v . "\x26"; goto miMvj; miMvj: DDEt0: goto GTjtL; uIXS2: $v = urlencode($v); goto sxxfB; q5oZ4: if (!$urlencode) { goto r9KhT; } goto uIXS2; GTjtL: } goto vhZT4; xsteS: return $reqPar; goto OEFiV; JsLUM: $reqPar = substr($buff, 0, strlen($buff) - 1); goto cAnCL; vhZT4: JX90L: goto eEHjJ; QspVH: ksort($paraMap); goto DfPWW; CIaHZ: if (!(strlen($buff) > 0)) { goto K2XoY; } goto JsLUM; OEFiV: } }