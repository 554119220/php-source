<?php
 require IA_ROOT . "\57\x61\x64\x64\157\156\x73\57\x73\165\x70\145\162\155\x61\x6e\137\x68\141\156\144\x32\x5f\160\154\x75\x67\151\x6e\137\x77\x65\x63\150\x61\164\x2f\x67\x6c\157\x62\x61\x6c\x2e\160\x68\x70"; class SupermanHand2PluginWechatUtil { private static $debug = true; public static function weiqing_polyfill() { goto kbXWQ; tUjBe: Sa71f: goto p5q3C; zuEhP: if (!empty($do)) { goto QNsjK; } goto OUb7b; yidNK: QNsjK: goto Ki62y; zPr90: $do = $_GPC["\144\157"]; goto QG4uX; u88XE: $_GPC["\155"] = $row["\155\x6f\x64\165\x6c\x65"]; goto zPr90; nh4Ud: $row = pdo_get("\x6d\x6f\144\x75\x6c\145\x73\x5f\142\151\x6e\144\x69\156\147\x73", array("\145\x69\x64" => $eid)); goto qZNzk; qZNzk: if (empty($row)) { goto kKfb0; } goto I7bJz; kbXWQ: global $_GPC, $do; goto AbCFq; Dd52d: VXPqw: goto WkaDn; Ki62y: goto z5xbL; goto tUjBe; I7bJz: $_GPC["\x64\x6f"] = $row["\144\x6f"]; goto u88XE; AbCFq: if (empty($_GPC["\144\157"])) { goto Sa71f; } goto zuEhP; IBJHd: $eid = intval($_GPC["\x65\x69\x64"]); goto nh4Ud; WkaDn: z5xbL: goto qHb9i; OUb7b: $do = $_GPC["\144\157"]; goto yidNK; QG4uX: kKfb0: goto Dd52d; p5q3C: if (!(isset($_GPC["\145\x69\x64"]) && $_GPC["\145\151\144"])) { goto VXPqw; } goto IBJHd; qHb9i: } public static function redirect($url) { goto M7GOv; PgLCP: exit; goto xgGI8; M7GOv: ob_end_clean(); goto w273F; w273F: @header("\x4c\x6f\143\x61\x74\x69\157\156\72\40" . $url); goto PgLCP; xgGI8: } public static function get_getcash_status_style($status) { goto VlHnr; VlHnr: switch ($status) { case -1: return "\x6c\x61\x62\145\x6c\x20\154\x61\x62\145\154\55\144\141\156\x67\145\x72"; goto yd2eo; case 0: return "\x6c\x61\x62\x65\154\x20\x6c\x61\x62\x65\154\x2d\144\145\146\141\165\x6c\164"; goto yd2eo; case 1: return "\154\141\142\x65\x6c\40\x6c\x61\x62\145\154\x2d\x73\165\x63\x63\145\163\163"; goto yd2eo; default: return "\154\141\142\145\154\x20\154\x61\x62\x65\x6c\x2d\144\x65\146\x61\x75\154\x74"; goto yd2eo; } goto qYGlf; qYGlf: RwAm0: goto IMqM2; IMqM2: yd2eo: goto z6_7h; z6_7h: } public static function get_getcash_status_title($status) { goto xu3mw; sBHX9: pk7IV: goto rnVCg; xu3mw: switch ($status) { case -1: return "\346\217\220\347\x8e\260\345\xa4\261\350\xb4\245"; goto HVwpT; case 0: return "\346\x9c\xaa\xe6\224\xaf\344\273\230"; goto HVwpT; case 1: return "\xe5\xb7\xb2\xe6\x94\xaf\344\xbb\x98"; goto HVwpT; default: return "\165\156\x6b\x6e\x6f\x77\x6e"; goto HVwpT; } goto sBHX9; rnVCg: HVwpT: goto uY6MJ; uY6MJ: } public static function get_getcash_account_type_title($account_type) { goto UvRK9; l_BLf: f3dgz: goto MJK5j; MJK5j: sZq75: goto xUVaY; UvRK9: switch ($account_type) { case "\x77\x65\x63\x68\141\164": return "\345\xbe\xae\344\xbf\241"; goto sZq75; case "\x62\141\x6e\x6b": return "\351\x93\xb6\350\xa1\214"; goto sZq75; case "\141\x6c\151\160\x61\x79": return "\346\x94\257\xe4\xbb\x98\xe5\xae\235"; goto sZq75; default: return "\165\156\153\x6e\157\x77\156"; goto sZq75; } goto l_BLf; xUVaY: } public static function uid2openid($uid) { $fans = mc_fansinfo($uid); return $fans && $fans["\157\160\x65\156\x69\144"] ? $fans["\x6f\160\145\156\151\x64"] : ''; } public static function float_format($num, $len = 2) { goto Q8Cf8; qBPqn: $arr = explode("\x2e", $num * $multiplier); goto U9vcp; BSEvz: return sprintf("\x25\56" . $len . "\x66", $result); goto YopZy; Q8Cf8: $multiplier = pow(10, $len); goto qBPqn; U9vcp: $result = $arr[0] / $multiplier; goto BSEvz; YopZy: } public static function get_uid_formid($uid) { goto RjkIU; e3HBN: return $row; goto wDaVS; RjkIU: global $_W; goto URAMk; duIPZ: return false; goto frIzm; Qlnr2: if ($row) { goto xgvLl; } goto duIPZ; URAMk: $row = pdo_get("\163\165\x70\x65\x72\155\141\156\x5f\150\141\156\x64\62\x5f\x6d\x65\x6d\x62\145\x72\x5f\146\x6f\x72\x6d\151\x64", array("\x75\156\151\x61\x63\x69\144" => $_W["\165\156\x69\141\x63\x69\144"], "\165\x69\x64" => $uid, "\143\162\145\141\x74\145\x74\x69\x6d\145\x20\76" => TIMESTAMP - 7 * 24 * 3600), array("\151\144", "\x66\157\x72\155\151\144")); goto Qlnr2; frIzm: xgvLl: goto e3HBN; wDaVS: } public static function delete_uid_formid($id) { global $_W; pdo_delete("\163\x75\160\x65\162\x6d\141\x6e\x5f\x68\141\x6e\144\62\137\155\x65\x6d\142\x65\x72\137\146\x6f\x72\155\x69\x64", array("\165\156\x69\x61\143\x69\144" => $_W["\x75\x6e\x69\x61\x63\x69\144"], "\151\x64" => $id)); } public static function send_wxapp_msg($data, $openid, $tmpl_id, $url, $form_id) { goto AOlEx; Ahsjk: WeUtility::logging("\146\x61\164\x61\x6c", "\x5b\163\x65\156\144\x5f\x77\170\x61\x70\160\x5f\x6d\163\147\x5d\x20\xe6\xa8\xa1\xe6\x9d\xbf\346\266\x88\346\x81\257\xe5\217\221\351\200\x81\xe5\244\261\xe8\264\xa5\xef\274\232\x6f\x70\145\x6e\x69\x64\xe4\270\xba\xe7\xa9\272"); goto dLqGU; Rjnqz: if (!empty($openid)) { goto WPeDv; } goto Ahsjk; hSvg2: fYvg2: goto UM1ci; tqE9t: if (!is_error($token)) { goto d2upB; } goto oNoz9; NjXjf: WeUtility::logging("\146\x61\x74\x61\154", "\x5b\x73\x65\x6e\144\x5f\x77\x78\x61\x70\x70\137\x6d\163\147\135\40\xe6\xa8\241\346\x9d\277\346\xb6\x88\xe6\201\257\xe5\x8f\x91\351\x80\201\345\244\xb1\350\xb4\245\357\274\232\xe6\x9c\252\351\x85\x8d\347\xbd\256\346\250\xa1\347\211\210\346\266\x88\346\x81\xaf"); goto VdNl7; GndTp: WeUtility::logging("\x69\156\x66\x6f", "\345\x8f\x91\xe9\x80\201\xe5\244\261\xe8\xb4\xa5\357\xbc\x9a\165\151\144\x3d{$uid}\54\40\x6f\x70\145\x6e\151\x64\x3d{$openid}\x2c\40\162\145\x73\x75\x6c\x74\75" . var_export($result, true) . "\x2c\40\x70\157\x73\164\75" . var_export($post, true)); goto y0tHD; f1u_Y: EBnIp: goto Qf05F; hy_To: WPeDv: goto b1SEw; r92r9: $post_url = "\x68\x74\164\160\x73\x3a\x2f\57\141\160\151\56\167\145\151\170\151\x6e\x2e\x71\161\x2e\x63\x6f\x6d\57\x63\147\151\55\142\151\156\x2f\x6d\145\x73\x73\141\147\x65\57\x77\x78\x6f\x70\x65\156\x2f\164\x65\x6d\160\x6c\141\164\x65\x2f\x73\x65\156\144\x3f\x61\143\x63\145\x73\163\137\164\157\x6b\x65\156\x3d" . $token; goto XE1vA; b1SEw: $account = WeAccount::create($_W["\141\143\143\x6f\165\x6e\164"]); goto t9wNR; y0tHD: return false; goto hSvg2; oNoz9: WeUtility::logging("\x66\x61\164\141\154", "\x67\145\164\x41\x63\x63\145\163\163\124\157\x6b\x65\x6e\x20\x66\141\151\154\145\144\72\x20\164\157\153\145\156\x3d" . var_export($token, true)); goto VxZiy; dLqGU: return false; goto hy_To; WgeN0: if (!empty($tmpl_id)) { goto j8xsT; } goto NjXjf; qM1y8: kTSkO: goto GndTp; fKiY6: if (is_error($result)) { goto kTSkO; } goto MUucN; XE1vA: $result = self::superman_hand2_request($post_url, json_encode($post)); goto f219F; ctJmb: j8xsT: goto Rjnqz; AOlEx: global $_W; goto WgeN0; Yajpz: d2upB: goto uIMua; t9wNR: if (!empty($account)) { goto EBnIp; } goto eo0sC; MUucN: WeUtility::logging("\x69\156\146\157", "\xe5\x8f\221\xe9\x80\201\xe6\x88\x90\345\212\x9f\xef\xbc\x9a\165\x69\144\75{$uid}\54\40\157\x70\145\156\x69\x64\75{$openid}"); goto zHYOb; VdNl7: return false; goto ctJmb; f219F: $uid = mc_openid2uid($openid); goto fKiY6; eo0sC: WeUtility::logging("\146\x61\164\141\154", "\x63\x72\x65\141\x74\145\40\x61\x63\x63\x6f\x75\x6e\164\x20\x66\x61\151\154\x65\x64\72\40\x61\143\143\x6f\165\156\164\75" . var_export($_W["\x61\143\x63\x6f\165\156\164"], true)); goto SGigo; UM1ci: return true; goto k_wHX; zHYOb: goto fYvg2; goto qM1y8; Qf05F: $token = $account->getAccessToken(); goto tqE9t; VxZiy: return false; goto Yajpz; SGigo: return false; goto f1u_Y; uIMua: $post = array("\x74\x6f\165\163\145\162" => $openid, "\164\145\155\x70\154\141\x74\x65\137\x69\144" => $tmpl_id, "\x70\x61\x67\x65" => $url, "\x66\x6f\x72\x6d\x5f\151\x64" => $form_id, "\x64\x61\164\141" => $data); goto r92r9; k_wHX: } public static function pay($params, $extra = array()) { goto cDVGj; hpjlb: goto kJgN2; goto WW3hH; ywJzf: $cert_filename = $path . $_W["\x75\156\151\141\143\151\x64"] . "\137\167\x65\x63\x68\x61\164\137\x70\141\x79\x5f\x61\154\x6c\56\x70\x65\155"; goto kZ8t4; YIp_N: $xml_data = "\74\170\155\154\x3e\74\x6d\143\x68\137\x61\x70\x70\151\x64\x3e{$data["\x6d\x63\x68\x5f\141\160\160\x69\144"]}\74\x2f\x6d\143\150\x5f\x61\160\160\151\x64\76\x3c\155\143\150\151\144\x3e{$data["\x6d\143\x68\151\144"]}\74\57\x6d\143\x68\x69\x64\76\x3c\156\157\156\143\x65\137\163\x74\x72\x3e{$data["\156\x6f\x6e\143\x65\137\x73\x74\x72"]}\x3c\57\x6e\157\156\143\x65\137\163\164\162\76\x3c\160\x61\162\164\x6e\145\162\x5f\x74\x72\x61\144\145\x5f\156\157\76{$data["\160\141\162\x74\156\x65\162\137\164\x72\x61\x64\145\137\156\x6f"]}\x3c\x2f\160\x61\162\164\156\145\162\137\x74\162\141\x64\145\137\156\157\x3e\74\157\160\145\x6e\x69\x64\x3e{$data["\x6f\x70\145\156\151\144"]}\x3c\x2f\157\x70\x65\x6e\x69\x64\x3e\74\143\x68\x65\x63\153\137\x6e\141\155\x65\76{$data["\x63\x68\145\x63\x6b\137\156\x61\x6d\x65"]}\74\57\143\150\145\x63\153\137\x6e\x61\155\145\76\x3c\162\x65\137\165\x73\145\162\137\156\x61\155\x65\76{$data["\162\x65\137\165\x73\145\162\x5f\156\x61\155\x65"]}\x3c\57\x72\x65\x5f\x75\163\145\x72\137\x6e\x61\155\x65\x3e\x3c\x61\155\157\x75\x6e\164\x3e{$data["\x61\155\x6f\165\x6e\x74"]}\x3c\57\x61\x6d\x6f\x75\x6e\x74\x3e\x3c\144\145\163\143\x3e{$data["\x64\x65\x73\x63"]}\x3c\57\x64\145\x73\143\76\74\x73\x70\142\x69\154\154\x5f\143\162\145\x61\x74\145\x5f\x69\x70\76{$data["\163\160\x62\x69\154\154\137\x63\x72\145\x61\164\145\137\x69\x70"]}\74\x2f\x73\x70\142\151\154\x6c\x5f\143\162\x65\x61\x74\145\137\151\x70\x3e\x3c\163\x69\147\156\76{$sign}\74\x2f\163\151\147\156\76\x3c\57\x78\155\x6c\76"; goto TVQLa; FVh6a: $xml = @simplexml_load_string($response); goto l7YHt; F7gtV: ZL6UC: goto kFYoL; bWPdN: WeUtility::logging("\164\x72\141\x63\x65", "\133\127\170\x70\x61\x79\x3a\160\x61\171\x5d\x20\170\155\154\x3d" . var_export($xml, true)); goto F7gtV; X8KQV: if (!self::$debug) { goto OYEbG; } goto jnwZo; kZ8t4: file_put_contents($cert_filename, $cert . $key); goto UeNnz; Nwi5L: aiOjj: goto FVh6a; i1G1q: $headers["\x43\x55\122\x4c\x4f\120\x54\137\x53\123\x4c\137\126\105\x52\111\106\131\x48\117\x53\124"] = false; goto EWEsG; UeNnz: $headers["\x43\125\122\x4c\x4f\x50\124\137\x53\123\x4c\103\105\122\x54"] = $cert_filename; goto X8KQV; VTOMs: $headers["\103\157\x6e\x74\145\x6e\x74\x2d\x54\171\160\145"] = "\x61\160\160\154\151\x63\141\164\x69\157\156\x2f\170\x2d\x77\x77\x77\55\146\157\162\155\55\x75\x72\154\x65\x6e\x63\x6f\x64\145\x64"; goto wNTfR; cDVGj: global $_W; goto dM2cS; WW3hH: w_Wgp: goto Z9z5d; kFYoL: $return_code = $xml->return_code ? (string) $xml->return_code : ''; goto i4nt7; At49q: $key = authcode($_W["\141\x63\143\157\x75\x6e\x74"]["\163\145\x74\164\x69\156\147"]["\160\141\171\x6d\145\x6e\x74"]["\x77\x65\x63\x68\x61\164\137\162\x65\146\x75\156\144"]["\153\x65\171"], "\104\x45\103\x4f\104\x45"); goto Rp4R4; EWEsG: $cert = authcode($_W["\x61\x63\x63\x6f\165\156\164"]["\x73\x65\164\164\x69\156\147"]["\160\x61\x79\x6d\145\x6e\164"]["\x77\x65\143\150\x61\x74\x5f\162\145\146\x75\x6e\x64"]["\143\145\x72\164"], "\x44\105\x43\x4f\x44\x45"); goto At49q; v91BG: RZ0FE: goto jOL0z; L1NU7: return "\133\x77\170\x70\x61\171\x2d\141\160\x69\72\x70\x61\171\135\x20\162\145\x73\x70\157\156\163\x65\40\116\125\x4c\x4c"; goto wonTr; jOL0z: if (!self::$debug) { goto ZL6UC; } goto bWPdN; o2vWr: if (!($response == '')) { goto BhM0i; } goto L1NU7; khO3c: $response = $response["\143\x6f\156\x74\145\x6e\164"]; goto YjobX; TVQLa: $headers = array(); goto VTOMs; J7pK4: kJgN2: goto zhZdo; l7YHt: if (!empty($xml)) { goto RZ0FE; } goto yKdUR; uJ0fT: if ($return_code == "\123\x55\x43\x43\x45\123\123" && $result_code == "\123\x55\103\103\105\x53\x53") { goto w_Wgp; } goto ZPYjx; jnwZo: WeUtility::logging("\164\162\x61\x63\145", "\133\x57\170\160\x61\x79\x3a\x70\141\171\x5d\40\x78\155\154\x5f\144\141\x74\x61\75" . $xml_data); goto ih9YU; i3rJO: WeUtility::logging("\164\162\141\143\x65", "\x5b\x57\170\x70\x61\171\x3a\160\x61\171\135\40\x72\x65\163\160\x6f\x6e\x73\145\75" . $response); goto Nwi5L; Z9z5d: $ret = array("\x73\165\x63\143\145\x73\x73" => true, "\160\x61\162\x74\x6e\145\162\x5f\164\162\x61\x64\x65\x5f\x6e\x6f" => $xml->partner_trade_no, "\x70\x61\171\155\145\x6e\x74\x5f\156\x6f" => $xml->payment_no, "\x70\x61\x79\155\145\x6e\x74\x5f\x74\151\x6d\x65" => $xml->payment_time); goto mi2Kd; dM2cS: $data = array("\x6d\x63\150\137\x61\160\160\151\x64" => $params["\155\x63\150\137\x61\x70\x70\x69\144"], "\155\143\x68\151\x64" => $params["\155\143\x68\x69\x64"], "\x6e\x6f\x6e\143\x65\x5f\163\x74\x72" => $params["\156\157\x6e\143\x65\137\x73\x74\x72"], "\160\x61\x72\x74\156\x65\162\137\164\x72\141\144\145\137\x6e\157" => $params["\x70\141\162\164\x6e\145\x72\137\x74\162\141\x64\x65\137\x6e\x6f"], "\x6f\160\145\156\x69\144" => $params["\x6f\x70\x65\156\x69\x64"], "\x63\x68\x65\143\153\x5f\156\141\x6d\x65" => $params["\x63\x68\x65\x63\x6b\137\156\141\x6d\145"], "\x72\145\x5f\165\163\145\x72\137\x6e\141\x6d\x65" => $params["\162\145\137\x75\163\x65\x72\137\156\141\x6d\145"], "\x61\155\157\x75\156\x74" => $params["\141\155\x6f\x75\x6e\x74"] * 100, "\x64\x65\163\143" => $params["\144\x65\163\143"], "\163\160\142\x69\154\x6c\x5f\x63\x72\145\141\x74\145\x5f\x69\160" => $params["\x73\160\142\x69\x6c\x6c\137\x63\x72\x65\x61\x74\x65\x5f\151\160"]); goto ShTn2; wonTr: BhM0i: goto khO3c; SPjQp: OYEbG: goto FIhjq; yKdUR: return "\x5b\167\170\x70\141\171\55\x61\x70\151\x3a\x70\x61\x79\135\x20\x70\141\162\x73\x65\40\x78\x6d\154\x20\x4e\x55\x4c\x4c"; goto v91BG; wNTfR: $headers["\x43\125\122\114\117\x50\124\x5f\x53\123\114\137\x56\105\x52\x49\106\x59\120\x45\x45\x52"] = false; goto i1G1q; vIpi4: $err_code = $xml->err_code ? (string) $xml->err_code : ''; goto zdXBy; ShTn2: $sign = self::sign($data, $extra["\x73\x69\147\x6e\x5f\x6b\145\x79"]); goto YIp_N; FIhjq: $pay_url = "\150\x74\164\x70\x73\72\x2f\x2f\x61\x70\x69\56\x6d\x63\x68\56\x77\145\x69\x78\151\x6e\56\161\x71\x2e\x63\157\155\x2f\155\155\160\x61\171\x6d\153\x74\x74\x72\x61\x6e\x73\x66\145\x72\163\x2f\x70\x72\x6f\155\157\x74\x69\x6f\x6e\57\164\x72\141\156\163\x66\x65\162\163"; goto g2lbf; i4nt7: $return_msg = $xml->return_msg ? (string) $xml->return_msg : ''; goto GIRWF; ZPYjx: return $return_code . "\x3a" . $return_msg . "\54" . $err_code . "\72" . $err_code_des; goto hpjlb; Rp4R4: $path = MODULE_ROOT . "\144\141\x74\x61\57"; goto zAlV5; ju10f: @unlink($cert_filename); goto o2vWr; YjobX: if (!self::$debug) { goto aiOjj; } goto i3rJO; zdXBy: $err_code_des = $xml->err_code_des ? (string) $xml->err_code_des : ''; goto uJ0fT; mi2Kd: return $ret; goto J7pK4; g2lbf: $response = ihttp_request($pay_url, $xml_data, $headers); goto ju10f; zAlV5: mkdirs($path); goto ywJzf; ih9YU: WeUtility::logging("\x74\x72\x61\x63\145", "\133\127\x78\160\x61\171\x3a\x70\141\x79\135\x20\x68\145\x61\144\x65\x72\x73\75" . var_export($headers, true)); goto SPjQp; GIRWF: $result_code = $xml->result_code ? (string) $xml->result_code : ''; goto vIpi4; zhZdo: } public static function sign($data, $sign_key) { goto PPGtS; PPGtS: ksort($data); goto LKY8a; Z4Fl1: return $sign; goto LLaYe; qIGbw: AHYKJ: goto jhHs1; LKY8a: $data_str = ''; goto NCSLH; jhHs1: $data_str .= "\153\x65\x79\75" . $sign_key; goto kz0Ex; NCSLH: foreach ($data as $k => $v) { goto HI85F; rbI9e: zI3yP: goto FSLOh; DGAxC: goto zI3yP; goto uxm3l; HI85F: if (!($v == '' || $k == "\x73\151\x67\156")) { goto yU1yK; } goto DGAxC; uxm3l: yU1yK: goto uAu6O; uAu6O: $data_str .= "{$k}\x3d{$v}\x26"; goto rbI9e; FSLOh: } goto qIGbw; kz0Ex: $sign = strtoupper(md5($data_str)); goto Z4Fl1; LLaYe: } }